{"version":3,"file":"static/chunks/1622-7ce2d6b5c250b3ff.js","mappings":"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","sources":["webpack://_N_E/?ec90","webpack://_N_E/./src/lib/date-utils.ts","webpack://_N_E/./src/components/app-seo-content.tsx","webpack://_N_E/./src/components/ui/accordion.tsx","webpack://_N_E/./src/lib/settings-service.ts","webpack://_N_E/./src/context/settings-context.tsx","webpack://_N_E/./src/components/ui/button.tsx","webpack://_N_E/./src/components/ui/alert.tsx","webpack://_N_E/./src/components/ui/table.tsx","webpack://_N_E/./src/lib/formattingUtils.ts","webpack://_N_E/./src/components/results-display/utils.ts","webpack://_N_E/./src/components/results-display/calculation-steps-display.tsx","webpack://_N_E/./src/components/settings-modal/form-schema.ts","webpack://_N_E/./src/components/settings-modal/types.ts","webpack://_N_E/./src/components/settings-modal/locale-select.tsx","webpack://_N_E/./src/components/settings-modal/number-field.tsx","webpack://_N_E/./src/components/settings-modal/separator-select.tsx","webpack://_N_E/./src/components/settings-modal/index.tsx","webpack://_N_E/./src/components/settings-modal.tsx","webpack://_N_E/./src/components/results-display/export-excel.ts","webpack://_N_E/./src/components/results-display/export-pdf.ts","webpack://_N_E/./src/components/results-display/index.tsx","webpack://_N_E/./src/components/results-display.tsx","webpack://_N_E/./src/components/invoice-form/error-handler.ts","webpack://_N_E/./src/components/invoice-form/demo-data-handler.ts","webpack://_N_E/./src/components/invoice-calculator-client.tsx","webpack://_N_E/./src/components/ui/input.tsx","webpack://_N_E/./src/components/ui/visually-hidden.tsx","webpack://_N_E/./src/components/ui/accessible-icon.tsx","webpack://_N_E/./src/components/ui/dialog.tsx","webpack://_N_E/./src/components/ui/card.tsx","webpack://_N_E/./src/components/ui/form/index.tsx","webpack://_N_E/./src/components/ui/select/index.tsx","webpack://_N_E/./src/lib/calculations.ts","webpack://_N_E/./src/components/ui/label.tsx","webpack://_N_E/./src/lib/errors.ts","webpack://_N_E/./src/components/loading.tsx"],"sourcesContent":["import(/* webpackMode: \"eager\", webpackExports: [\"__esModule\",\"default\"] */ \"C:\\\\Users\\\\Mauro\\\\Repos\\\\Siempi\\\\Saas\\\\billingperiodallocator\\\\node_modules\\\\next\\\\dist\\\\client\\\\app-dir\\\\link.js\");\n;\nimport(/* webpackMode: \"eager\", webpackExports: [\"default\"] */ \"C:\\\\Users\\\\Mauro\\\\Repos\\\\Siempi\\\\Saas\\\\billingperiodallocator\\\\src\\\\components\\\\app-seo-content.tsx\");\n;\nimport(/* webpackMode: \"eager\" */ \"C:\\\\Users\\\\Mauro\\\\Repos\\\\Siempi\\\\Saas\\\\billingperiodallocator\\\\src\\\\components\\\\invoice-calculator-client.tsx\");\n;\nimport(/* webpackMode: \"eager\", webpackExports: [\"default\"] */ \"C:\\\\Users\\\\Mauro\\\\Repos\\\\Siempi\\\\Saas\\\\billingperiodallocator\\\\src\\\\components\\\\loading.tsx\");\n;\nimport(/* webpackMode: \"eager\", webpackExports: [\"TranslationContext\"] */ \"C:\\\\Users\\\\Mauro\\\\Repos\\\\Siempi\\\\Saas\\\\billingperiodallocator\\\\src\\\\components\\\\translation-provider.tsx\");\n","/**\n * @fileoverview Date Utility Functions\n *\n * Timezone Strategy:\n * 1. Input Parsing: User-entered date strings (e.g., \"YYYY-MM-DD\") are parsed by `parseDate`\n *    into JavaScript `Date` objects representing **midnight UTC** of that calendar day.\n *    This is achieved by `createUTCDate` which appends 'T00:00:00Z'.\n * 2. Calculations: All core date calculations (e.g., in `calculations.ts`) operate on these\n *    UTC-normalized `Date` objects.\n * 3. Display: Dates are formatted for display by `formatDateForDisplay` using `Intl.DateTimeFormat`\n *    with the `timeZone: 'UTC'` option. This ensures that the displayed day, month, and year\n *    correspond to the UTC date, preventing shifts due to the user's local timezone.\n * 4. General Timestamps: Non-critical timestamps (e.g., \"Generated on\") may use local time.\n */\n\nimport { format, isValid, parse } from \"date-fns\";\n\n/**\n * Creates a Date object that's timezone-agnostic by setting time to midnight UTC.\n * This ensures consistent behavior regardless of user's timezone.\n *\n * @param dateStr - A date string in the format YYYY-MM-DD\n * @returns A Date object set to midnight UTC\n */\nexport function createUTCDate(dateStr: string): Date {\n  // Append T00:00:00Z to ensure UTC timezone\n  return new Date(`${dateStr}T00:00:00Z`);\n}\n\n/**\n * Parse a date from various formats with timezone consistency.\n * The returned date will be normalized to midnight UTC time.\n *\n * @param dateStr - A date string in various supported formats\n * @param formats - An array of formats to try (date-fns format patterns)\n * @returns A Date object or null if parsing fails\n */\nexport function parseDate(\n  dateStr: string,\n  formats: string[] = [\"yyyy-MM-dd\", \"dd.MM.yyyy\"],\n): Date | null {\n  if (!dateStr) return null;\n\n  // Try direct ISO parsing first\n  if (dateStr.includes(\"T\")) {\n    const date = new Date(dateStr);\n    if (isValid(date)) {\n      // Normalize to midnight UTC\n      return createUTCDate(format(date, \"yyyy-MM-dd\"));\n    }\n  }\n\n  // Try each format\n  for (const formatPattern of formats) {\n    try {\n      const parsedDate = parse(dateStr, formatPattern, new Date());\n      if (isValid(parsedDate)) {\n        // Normalize to midnight UTC\n        return createUTCDate(format(parsedDate, \"yyyy-MM-dd\"));\n      }\n    } catch {\n      // Continue to next format\n    }\n  }\n\n  return null;\n}\n\n/**\n * Format a date for display, taking into account the locale\n *\n * @param date - A Date object or ISO date string\n * @param locale - The locale to use for formatting (e.g., 'en', 'de')\n * @returns A formatted date string\n */\nexport function formatDateForDisplay(\n  date: Date | string | undefined,\n  locale: string,\n): string {\n  if (!date) return \"N/A\";\n\n  try {\n    const dateObj =\n      typeof date === \"string\"\n        ? date.includes(\"T\")\n          ? new Date(date)\n          : createUTCDate(date)\n        : date;\n\n    // Format in UTC to display the date as it is, ignoring local timezone conversion for date parts\n    return new Intl.DateTimeFormat(locale, {\n      year: \"numeric\",\n      month: \"short\",\n      day: \"numeric\",\n      timeZone: \"UTC\",\n    }).format(dateObj);\n  } catch (error) {\n    console.error(\"Error formatting date:\", error);\n    // Fallback should also ideally respect UTC if possible\n    if (typeof date === \"string\") {\n      // Attempt to return YYYY-MM-DD if it's a simple date string, otherwise indicate error\n      return date.match(/^\\d{4}-\\d{2}-\\d{2}$/) ? date : \"Invalid Date String\";\n    }\n    return date.toISOString().split(\"T\")[0]; // This gives YYYY-MM-DD from UTC date\n  }\n}\n","\"use client\";\n\nimport { useEffect, useState } from \"react\";\n\nimport { usePathname } from \"next/navigation\";\n\n/**\n * Client-only SEO content component.\n * Renders JSON-LD structured data only on the client to avoid hydration mismatches.\n */\nexport default function AppSeoContent() {\n  const [mounted, setMounted] = useState(false);\n  const pathname = usePathname();\n  const isAppPage = pathname?.includes(\"/app\");\n\n  // Determine language from URL path instead of i18n hooks to avoid hydration issues\n  const isGerman = pathname?.includes(\"/de/\");\n\n  // Always run this effect at top level\n  useEffect(() => {\n    setMounted(true);\n  }, []);\n\n  // Don't render during SSR\n  if (!mounted || !isAppPage) {\n    return null;\n  }\n\n  // Hardcoded content by language for reliable rendering\n  const description = isGerman\n    ? \"Teilen Sie Rechnungen przise auf Geschftsjahre, Quartale oder Monate auf.\"\n    : \"Split invoices across fiscal years, quarters, or months with precision.\";\n\n  return (\n    <div className=\"hidden\">\n      <script\n        type=\"application/ld+json\"\n        dangerouslySetInnerHTML={{\n          __html: JSON.stringify({\n            \"@context\": \"https://schema.org\",\n            \"@type\": \"SoftwareApplication\",\n            name: \"BillSplitter\",\n            applicationCategory: \"FinanceApplication\",\n            operatingSystem: \"Web\",\n            offers: {\n              \"@type\": \"Offer\",\n              price: \"0\",\n              priceCurrency: \"USD\",\n            },\n            description: description,\n          }),\n        }}\n      />\n    </div>\n  );\n}\n","\"use client\";\n\nimport * as AccordionPrimitive from \"@radix-ui/react-accordion\";\nimport * as React from \"react\";\n\nimport { ChevronDownIcon } from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\n\nfunction Accordion({\n  ...props\n}: React.ComponentProps<typeof AccordionPrimitive.Root>) {\n  return <AccordionPrimitive.Root data-slot=\"accordion\" {...props} />;\n}\n\nfunction AccordionItem({\n  className,\n  ...props\n}: React.ComponentProps<typeof AccordionPrimitive.Item>) {\n  return (\n    <AccordionPrimitive.Item\n      data-slot=\"accordion-item\"\n      className={cn(\"\", className)}\n      {...props}\n    />\n  );\n}\n\nfunction AccordionTrigger({\n  className,\n  children,\n  ...props\n}: React.ComponentProps<typeof AccordionPrimitive.Trigger>) {\n  return (\n    <AccordionPrimitive.Header className=\"flex\">\n      <AccordionPrimitive.Trigger\n        data-slot=\"accordion-trigger\"\n        className={cn(\n          \"focus-visible:border-ring focus-visible:ring-ring/50 flex flex-1 items-start justify-between gap-4 rounded-md py-4 text-left text-sm font-medium transition-all outline-none hover:underline focus-visible:ring-[3px] disabled:pointer-events-none disabled:opacity-50 [&[data-state=open]>svg]:rotate-180\",\n          \"cursor-pointer select-none\",\n          className,\n        )}\n        {...props}\n      >\n        {children}\n        <ChevronDownIcon className=\"text-muted-foreground pointer-events-none size-4 shrink-0 translate-y-0.5 transition-transform duration-200\" />\n      </AccordionPrimitive.Trigger>\n    </AccordionPrimitive.Header>\n  );\n}\n\nfunction AccordionContent({\n  className,\n  children,\n  ...props\n}: React.ComponentProps<typeof AccordionPrimitive.Content>) {\n  return (\n    <AccordionPrimitive.Content\n      data-slot=\"accordion-content\"\n      className={cn(\n        \"data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down overflow-hidden text-sm\",\n        className,\n      )}\n      {...props}\n    >\n      <div className={cn(\"pt-0 pb-4\", className)}>{children}</div>\n    </AccordionPrimitive.Content>\n  );\n}\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent };\n","\"use client\";\r\n\r\nimport { Locale } from \"@/context/settings-context\";\r\nimport { safeJsonParse } from \"./utils\";\r\n\r\nexport type AppSettings = {\r\n  decimalPlaces: number; // 0-6\r\n  roundingPrecision: number; // e.g., 0.01, 0.05, 1\r\n  thousandsSeparator: string; // Values: ',', '.', \"'\", ' '\r\n  locale?: Locale; // Optional to keep backward compatibility\r\n};\r\n\r\n// Storage key constants\r\nexport const SETTINGS_STORAGE_KEY = \"appSettings\";\r\n\r\n// Default settings\r\nexport const DEFAULT_SETTINGS: Omit<AppSettings, \"locale\"> = {\r\n  decimalPlaces: 2,\r\n  roundingPrecision: 0.01,\r\n  thousandsSeparator: \",\",\r\n};\r\n\r\n/**\r\n * Load settings from localStorage\r\n * @returns The loaded settings merged with defaults\r\n */\r\nexport function loadSettings(): Omit<AppSettings, \"locale\"> {\r\n  if (typeof window === \"undefined\") {\r\n    return DEFAULT_SETTINGS;\r\n  }\r\n\r\n  try {\r\n    const savedSettings = localStorage.getItem(SETTINGS_STORAGE_KEY);\r\n    if (!savedSettings) {\r\n      return DEFAULT_SETTINGS;\r\n    }\r\n\r\n    const parsed = safeJsonParse<AppSettings>(savedSettings, {} as AppSettings);\r\n    \r\n    // Remove locale if it exists (handled by language-service now)\r\n    if (\"locale\" in parsed) {\r\n      delete parsed.locale;\r\n    }\r\n\r\n    // Validate the settings\r\n    if (\r\n      typeof parsed.decimalPlaces === \"number\" &&\r\n      typeof parsed.roundingPrecision === \"number\" &&\r\n      parsed.roundingPrecision > 0 &&\r\n      typeof parsed.thousandsSeparator === \"string\" &&\r\n      [\",\", \".\", \"'\", \" \"].includes(parsed.thousandsSeparator)\r\n    ) {\r\n      return { ...DEFAULT_SETTINGS, ...parsed };\r\n    } else {\r\n      console.warn(\r\n        \"Loaded settings from localStorage are invalid or incomplete. Using defaults.\"\r\n      );\r\n      return DEFAULT_SETTINGS;\r\n    }\r\n  } catch (error) {\r\n    console.error(\"Failed to load settings from localStorage:\", error);\r\n    return DEFAULT_SETTINGS;\r\n  }\r\n}\r\n\r\n/**\r\n * Save settings to localStorage\r\n * @param settings The settings to save\r\n */\r\nexport function saveSettings(settings: Partial<Omit<AppSettings, \"locale\">>): void {\r\n  if (typeof window === \"undefined\") {\r\n    return;\r\n  }\r\n\r\n  try {\r\n    // Get current settings first\r\n    const currentSettings = loadSettings();\r\n    \r\n    // Create a clean copy without any potential 'locale' property\r\n    const cleanSettings = {\r\n      ...(settings.decimalPlaces !== undefined && {\r\n        decimalPlaces: settings.decimalPlaces,\r\n      }),\r\n      ...(settings.roundingPrecision !== undefined && {\r\n        roundingPrecision: settings.roundingPrecision,\r\n      }),\r\n      ...(settings.thousandsSeparator !== undefined && {\r\n        thousandsSeparator: settings.thousandsSeparator,\r\n      }),\r\n    };\r\n\r\n    const updatedSettings = { ...currentSettings, ...cleanSettings };\r\n    \r\n    // Save to localStorage\r\n    localStorage.setItem(SETTINGS_STORAGE_KEY, JSON.stringify(updatedSettings));\r\n    \r\n    return;\r\n  } catch (error) {\r\n    console.error(\"Failed to save settings to localStorage:\", error);\r\n  }\r\n}\r\n\r\n/**\r\n * Clear all settings and reset to defaults\r\n */\r\nexport function resetSettings(): void {\r\n  if (typeof window === \"undefined\") {\r\n    return;\r\n  }\r\n  \r\n  try {\r\n    localStorage.removeItem(SETTINGS_STORAGE_KEY);\r\n  } catch (error) {\r\n    console.error(\"Failed to reset settings:\", error);\r\n  }\r\n} \r\n","\"use client\";\n\nimport {\n  DEFAULT_SETTINGS,\n  AppSettings as ServiceAppSettings,\n  loadSettings,\n  saveSettings as saveSettingsToStorage\n} from \"@/lib/settings-service\";\nimport React, {\n  ReactNode,\n  createContext,\n  useContext,\n  useEffect,\n  useState,\n} from \"react\";\n\nexport type Locale = \"en\" | \"de\";\n\n// Re-export the AppSettings type for consistency\nexport type AppSettings = Omit<ServiceAppSettings, \"locale\"> & { locale?: Locale };\n\ninterface SettingsContextProps {\n  settings: Omit<AppSettings, \"locale\">;\n  saveSettings: (newSettings: Partial<Omit<AppSettings, \"locale\">>) => void; // Allow partial updates\n}\n\nconst SettingsContext = createContext<SettingsContextProps | undefined>(\n  undefined,\n);\n\nexport const SettingsProvider = ({ children }: { children: ReactNode }) => {\n  const [settings, setSettings] = useState<Omit<AppSettings, \"locale\">>(DEFAULT_SETTINGS);\n  const [isLoaded, setIsLoaded] = useState(false); // Flag to ensure localStorage is read only once\n\n  // Effect to load settings from localStorage on initial client mount\n  useEffect(() => {\n    if (typeof window !== \"undefined\" && !isLoaded) {\n      // Load settings using the settings service\n      const loadedSettings = loadSettings();\n      setSettings(loadedSettings);\n      setIsLoaded(true); // Mark as loaded to prevent re-running\n    }\n  }, [isLoaded]); // Dependency array ensures it runs once after initial mount\n\n  // Save settings to localStorage whenever they change\n  const saveSettings = (newSettings: Partial<Omit<AppSettings, \"locale\">>) => {\n    if (typeof window !== \"undefined\") {\n      // Ensure running on client\n      try {\n        // Update context state with new settings\n        const updatedSettings = { ...settings, ...newSettings };\n        setSettings(updatedSettings);\n        \n        // Save to localStorage using the settings service\n        saveSettingsToStorage(newSettings);\n      } catch (error) {\n        console.error(\"Failed to save settings:\", error);\n      }\n    }\n  };\n\n  return (\n    <SettingsContext.Provider value={{ settings, saveSettings }}>\n      {children}\n    </SettingsContext.Provider>\n  );\n};\n\nexport const useSettings = (): SettingsContextProps => {\n  const context = useContext(SettingsContext);\n  if (!context) {\n    throw new Error(\"useSettings must be used within a SettingsProvider\");\n  }\n  return context;\n};\n","import * as React from \"react\";\nimport { Slot } from \"@radix-ui/react-slot\";\nimport { cva, type VariantProps } from \"class-variance-authority\";\n\nimport { cn } from \"@/lib/utils\";\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 ring-offset-background aria-[invalid=true]:ring-destructive/20 dark:aria-[invalid=true]:ring-destructive/40 cursor-pointer hover:transform hover:translate-y-[-2px] hover:scale-[1.015] select-none\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"bg-primary text-primary-foreground shadow-md hover:bg-primary/90 hover:shadow-md\",\n        destructive:\n          \"bg-destructive text-destructive-foreground shadow-md hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 hover:shadow-md\",\n        outline:\n          \"border bg-background shadow-md hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50 hover:shadow-md\",\n        secondary:\n          \"bg-secondary text-secondary-foreground shadow-md hover:bg-secondary/80 hover:shadow-md\",\n        ghost: \"\",\n        link: \"text-primary underline-offset-4 hover:underline hover:text-[#F5A623]\",\n      },\n      size: {\n        default: \"h-10 px-4 py-2\",\n        sm: \"h-8 rounded-md px-3 py-1\",\n        lg: \"h-12 px-6 py-3\",\n        icon: \"size-10\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  },\n);\n\nfunction Button({\n  className,\n  variant,\n  size,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"button\"> &\n  VariantProps<typeof buttonVariants> & {\n    asChild?: boolean;\n  }) {\n  const Comp = asChild ? Slot : \"button\";\n\n  return (\n    <Comp\n      data-slot=\"button\"\n      className={cn(buttonVariants({ variant, size, className }))}\n      {...props}\n    />\n  );\n}\n\nexport { Button, buttonVariants };\n","import * as React from \"react\";\nimport { cva, type VariantProps } from \"class-variance-authority\";\n\nimport { cn } from \"@/lib/utils\";\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border px-4 py-3 text-sm grid has-[>svg]:grid-cols-[calc(var(--spacing)*4)_1fr] grid-cols-[0_1fr] has-[>svg]:gap-x-3 gap-y-0.5 items-start [&>svg]:size-4 [&>svg]:translate-y-0.5 [&>svg]:text-current\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-card text-card-foreground\",\n        destructive:\n          \"text-destructive bg-card [&>svg]:text-current *:data-[slot=alert-description]:text-destructive/90\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  },\n);\n\nfunction Alert({\n  className,\n  variant,\n  ...props\n}: React.ComponentProps<\"div\"> & VariantProps<typeof alertVariants>) {\n  return (\n    <div\n      data-slot=\"alert\"\n      role=\"alert\"\n      className={cn(alertVariants({ variant }), className)}\n      {...props}\n    />\n  );\n}\n\nfunction AlertTitle({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"alert-title\"\n      className={cn(\n        \"col-start-2 line-clamp-1 min-h-4 font-medium tracking-tight\",\n        className,\n      )}\n      {...props}\n    />\n  );\n}\n\nfunction AlertDescription({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"alert-description\"\n      className={cn(\n        \"text-muted-foreground col-start-2 grid justify-items-start gap-1 text-sm [&_p]:leading-relaxed\",\n        className,\n      )}\n      {...props}\n    />\n  );\n}\n\nexport { Alert, AlertTitle, AlertDescription };\n","\"use client\";\n\nimport * as React from \"react\";\n\nimport { cn } from \"@/lib/utils\";\n\nfunction Table({ className, ...props }: React.ComponentProps<\"table\">) {\n  return (\n    <div\n      data-slot=\"table-container\"\n      className=\"relative w-full overflow-x-auto\"\n    >\n      <table\n        data-slot=\"table\"\n        className={cn(\"w-full caption-bottom text-sm\", className)}\n        {...props}\n      />\n    </div>\n  );\n}\n\nfunction TableHeader({ className, ...props }: React.ComponentProps<\"thead\">) {\n  return (\n    <thead\n      data-slot=\"table-header\"\n      className={cn(\"[&_tr]:border-b\", className)}\n      {...props}\n    />\n  );\n}\n\nfunction TableBody({ className, ...props }: React.ComponentProps<\"tbody\">) {\n  return (\n    <tbody\n      data-slot=\"table-body\"\n      className={cn(\"[&_tr:last-child]:border-0\", className)}\n      {...props}\n    />\n  );\n}\n\nfunction TableFooter({ className, ...props }: React.ComponentProps<\"tfoot\">) {\n  return (\n    <tfoot\n      data-slot=\"table-footer\"\n      className={cn(\n        \"bg-muted/50 border-t font-medium [&>tr]:last:border-b-0\",\n        className,\n      )}\n      {...props}\n    />\n  );\n}\n\nfunction TableRow({ className, ...props }: React.ComponentProps<\"tr\">) {\n  return (\n    <tr\n      data-slot=\"table-row\"\n      className={cn(\n        \"hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors\",\n        className,\n      )}\n      {...props}\n    />\n  );\n}\n\nfunction TableHead({ className, ...props }: React.ComponentProps<\"th\">) {\n  return (\n    <th\n      data-slot=\"table-head\"\n      className={cn(\n        \"text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]\",\n        className,\n      )}\n      {...props}\n    />\n  );\n}\n\nfunction TableCell({ className, ...props }: React.ComponentProps<\"td\">) {\n  return (\n    <td\n      data-slot=\"table-cell\"\n      className={cn(\n        \"p-2 align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]\",\n        className,\n      )}\n      {...props}\n    />\n  );\n}\n\nfunction TableCaption({\n  className,\n  ...props\n}: React.ComponentProps<\"caption\">) {\n  return (\n    <caption\n      data-slot=\"table-caption\"\n      className={cn(\"text-muted-foreground mt-4 text-sm\", className)}\n      {...props}\n    />\n  );\n}\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n};\n","import { AppSettings } from \"@/context/settings-context\";\nimport { formatDateForDisplay } from \"./date-utils\";\n\n/**\n * Formats a number according to the application settings using Intl.NumberFormat.\n * @param value The number to format.\n * @param locale The locale string.\n * @param settings The current application settings.\n * @returns Formatted number string.\n */\nexport function formatNumber(\n  value: number,\n  locale: string,\n  settings: Omit<AppSettings, \"locale\">,\n): string {\n  try {\n    return new Intl.NumberFormat(locale, {\n      minimumFractionDigits: settings.decimalPlaces,\n      maximumFractionDigits: settings.decimalPlaces,\n    }).format(value);\n  } catch (error) {\n    console.error(\"Error formatting number:\", error);\n    // Fallback to simple formatting\n    return value.toFixed(settings.decimalPlaces);\n  }\n}\n\n/**\n * Formats a date according to locale. Accepts either a Date object or a string in YYYY-MM-DD format.\n * @param dateInput Date as a string in 'yyyy-MM-dd' format or as a Date object.\n * @param locale Locale string (e.g., 'en', 'de').\n * @returns Formatted date string.\n */\nexport function formatDateLocale(\n  dateInput: string | Date | undefined,\n  locale: string,\n): string {\n  // Use the improved date formatting function from date-utils.ts\n  return formatDateForDisplay(dateInput, locale);\n}\n\n/**\n * Formats a percentage value according to locale.\n * @param value The percentage value (0 to 1).\n * @param locale The locale string.\n * @returns Formatted percentage string.\n */\nexport function formatPercent(value: number, locale: string): string {\n  try {\n    return new Intl.NumberFormat(locale, {\n      style: \"percent\",\n      minimumFractionDigits: 2, // Usually keep 2 decimals for percentages\n      maximumFractionDigits: 2,\n    }).format(value);\n  } catch (error) {\n    console.error(\"Error formatting percent:\", error);\n    // Fallback\n    return (value * 100).toFixed(2) + \"%\";\n  }\n}\n","import {\n  formatDateLocale,\n  formatNumber,\n  formatPercent,\n} from \"@/lib/formattingUtils\";\n\nimport { AppSettings } from \"@/context/settings-context\";\nimport { de } from \"date-fns/locale/de\";\nimport { enUS } from \"date-fns/locale/en-US\";\nimport { format } from \"date-fns\";\n\n// --- Period Formatting Helper ---\nexport function formatPeriodIdentifier(\n  identifier: string,\n  periodType: \"yearly\" | \"quarterly\" | \"monthly\",\n  locale: string,\n): string {\n  switch (periodType) {\n    case \"monthly\":\n      try {\n        const [year, month] = identifier.split(\"-\");\n        const date = new Date(parseInt(year), parseInt(month) - 1, 1);\n        return format(date, \"MMMM yyyy\", {\n          locale: locale === \"de\" ? de : enUS,\n        });\n      } catch {\n        return identifier;\n      }\n    case \"quarterly\":\n      return identifier;\n    case \"yearly\":\n    default:\n      return identifier;\n  }\n}\n\n// Function to get appropriate header for the allocation table\nexport function getPeriodHeader(\n  splitPeriodUsed: \"yearly\" | \"quarterly\" | \"monthly\",\n  t: (key: string, options?: { defaultValue?: string; values?: Record<string, string | number> }) => string,\n): string {\n  switch (splitPeriodUsed) {\n    case \"monthly\":\n      return t(\"ResultsDisplay.monthHeader\");\n    case \"quarterly\":\n      return t(\"ResultsDisplay.quarterHeader\");\n    case \"yearly\":\n    default:\n      return t(\"ResultsDisplay.yearHeader\");\n  }\n}\n\n// Formatting utility wrapper functions\nexport function formatNumForDisplay(\n  value: number | undefined,\n  locale: string,\n  settings: Omit<AppSettings, \"locale\">,\n): string {\n  return value !== undefined ? formatNumber(value, locale, settings) : \"\";\n}\n\nexport function formatPctForDisplay(\n  value: number | undefined,\n  locale: string,\n): string {\n  return value !== undefined ? formatPercent(value, locale) : \"\";\n}\n\nexport function formatDateForDisplay(\n  dateObj: Date | string | undefined,\n  locale: string,\n): string {\n  return dateObj ? formatDateLocale(dateObj, locale) : \"\";\n}\n\nexport function formatPeriodIdForDisplay(\n  id: string,\n  splitPeriodUsed: \"yearly\" | \"quarterly\" | \"monthly\",\n  locale: string,\n): string {\n  return formatPeriodIdentifier(id, splitPeriodUsed, locale);\n}\n","\"use client\";\n\nimport {\n  formatDateForDisplay,\n  formatNumForDisplay,\n  formatPctForDisplay,\n  formatPeriodIdForDisplay,\n} from \"./utils\";\n\nimport { CalculationStepsDisplayProps } from \"./types\";\nimport React from \"react\";\nimport { useTranslation } from \"@/translations\";\n\nexport function CalculationStepsDisplay({\n  steps,\n  settings,\n  splitPeriodUsed,\n}: CalculationStepsDisplayProps) {\n  const { t, i18n } = useTranslation();\n  const currentLocale = i18n.language;\n\n  if (steps.error) {\n    // Convert the error to a string representation\n    const errorMessage =\n      typeof steps.error === \"string\"\n        ? steps.error\n        : steps.error.message || \"Unknown error\";\n\n    return <p className=\"text-destructive\">{errorMessage}</p>;\n  }\n\n  const { periodSegments, amountCalculations } = steps;\n\n  const fmtNum = (num: number) =>\n    formatNumForDisplay(num, currentLocale, settings);\n  const fmtPeriod = (id: string) =>\n    formatPeriodIdForDisplay(id, splitPeriodUsed, currentLocale);\n  const fmtDate = (dateStr: string) =>\n    formatDateForDisplay(dateStr, currentLocale);\n  const fmtPct = (val: number) => formatPctForDisplay(val, currentLocale);\n\n  return (\n    <div className=\"text-sm space-y-6\">\n      {/* Total Duration and Period Breakdown Section */}\n      <section className=\"bg-muted/40 rounded-lg p-4 space-y-4\">\n        <h4 className=\"font-semibold text-foreground\">\n          {t(\"ResultsDisplay.totalDuration\")}\n        </h4>\n        <div className=\"grid grid-cols-2 gap-2 text-xs border-b pb-2 mb-2\">\n          <div>{t(\"ResultsDisplay.periodLabel\")}</div>{\" \"}\n          <div className=\"text-right\">\n            {fmtDate(steps.totalDuration.start)} -{\" \"}\n            {fmtDate(steps.totalDuration.end)}\n          </div>\n          <div>{t(\"ResultsDisplay.totalDays\")}</div>{\" \"}\n          <div className=\"text-right\">\n            {steps.totalDuration.days} (\n            {steps.totalDuration.included\n              ? t(\"ResultsDisplay.inclusiveLabel\")\n              : t(\"ResultsDisplay.exclusiveLabel\")}\n            )\n          </div>\n        </div>\n        <h4 className=\"font-semibold text-foreground\">\n          {t(\"ResultsDisplay.proportionCalculation\")}\n        </h4>\n        <div className=\"space-y-1\">\n          {periodSegments.map((seg) => (\n            <div\n              key={seg.periodIdentifier}\n              className=\"grid grid-cols-3 gap-2 text-xs\"\n            >\n              <div className=\"font-medium\">\n                {fmtPeriod(seg.periodIdentifier)}:\n              </div>\n              <div className=\"text-muted-foreground text-center\">\n                {seg.days} / {steps.totalDuration.days}{\" \"}\n                {t(\"ResultsDisplay.daysLabel\")}\n              </div>\n              <div className=\"text-muted-foreground text-right\">\n                {fmtPct(seg.proportion)}\n              </div>\n            </div>\n          ))}\n        </div>\n      </section>\n\n      {/* Split Calculation per Input Amount Section */}\n      <section className=\"bg-muted/40 rounded-lg p-4\">\n        <h4 className=\"font-semibold text-foreground mb-4\">\n          {t(\"ResultsDisplay.splitCalculation\")}\n        </h4>\n        <div className=\"space-y-6\">\n          {amountCalculations.map((amtCalc, index) => (\n            <div\n              key={index}\n              className=\"rounded-md border bg-background p-4 space-y-2 transition-shadow hover:shadow-md\"\n            >\n              <div className=\"font-bold text-[15px] text-primary mb-3 pb-1 border-b border-primary/20 bg-primary/[0.08] -mx-4 px-4 py-2 rounded-t-md\">\n                {t(\"ResultsDisplay.inputAmountLabel\")} #{index + 1}:{\" \"}\n                {fmtNum(amtCalc.originalAmount)}\n              </div>\n              <div className=\"space-y-3\">\n                {amtCalc.periodSplits.map((ps, periodIndex) => (\n                  <div\n                    key={ps.periodIdentifier}\n                    className={`pl-2 text-xs space-y-0.5 ${periodIndex < amtCalc.periodSplits.length - 1 ? \"border-b border-muted/30 pb-2\" : \"\"}`}\n                  >\n                    <div className=\"font-medium shrink-0 text-foreground\">\n                      {fmtPeriod(ps.periodIdentifier)}:\n                    </div>\n                    <div className=\"text-muted-foreground ml-2\">\n                      <span>\n                        {fmtNum(amtCalc.originalAmount)} *{\" \"}\n                        {periodSegments\n                          .find(\n                            (s) => s.periodIdentifier === ps.periodIdentifier,\n                          )\n                          ?.proportion.toFixed(6)}\n                      </span>\n                      <span className=\"block sm:inline\">\n                        {\" \"}\n                        = {ps.rawSplit.toFixed(6)}\n                      </span>\n                    </div>\n                    <div className=\"ml-2 flex items-center gap-x-2\">\n                      <span></span>\n                      <span className=\"font-medium text-foreground\">\n                        {t(\"ResultsDisplay.roundedLabel\")}:{\" \"}\n                        {fmtNum(ps.roundedSplit)}\n                      </span>\n                      {ps.adjustment !== 0 && (\n                        <span className=\"text-muted-foreground text-xs\">\n                          ({t(\"ResultsDisplay.adjustmentLabel\")}:{\" \"}\n                          {fmtNum(ps.adjustment)})\n                        </span>\n                      )}\n                    </div>\n                  </div>\n                ))}\n              </div>\n              <div className=\"border-t pt-2 mt-2 space-y-1 text-xs\">\n                <p>\n                  <span className=\"font-medium text-foreground\">\n                    {t(\"ResultsDisplay.discrepancyLabel\")}:\n                  </span>\n                  <span\n                    className={`${Math.abs(amtCalc.discrepancy) > 0.001 ? \"text-warning dark:text-warning\" : \"text-muted-foreground/70\"}`}\n                  >\n                    {\" \"}\n                    {fmtNum(amtCalc.discrepancy)}\n                  </span>\n                  {amtCalc.adjustmentAppliedToPeriod && (\n                    <span className=\"text-muted-foreground\">\n                      (\n                      {t(\"ResultsDisplay.adjustedInYearLabel\", {\n                        defaultValue: \"Applied in Year\",\n                      })}{\" \"}\n                      {fmtPeriod(amtCalc.adjustmentAppliedToPeriod)})\n                    </span>\n                  )}\n                </p>\n                <p className=\"font-semibold text-sm text-foreground pt-1\">\n                  {t(\"ResultsDisplay.finalSumLabel\")}:{\" \"}\n                  <span className=\"text-primary\">\n                    {fmtNum(amtCalc.finalSum)}\n                  </span>\n                </p>\n              </div>\n            </div>\n          ))}\n        </div>\n      </section>\n    </div>\n  );\n}\n","import { ValidationResult } from \"./types\";\n\n// Default separator\nexport const DEFAULT_SEPARATOR = \",\";\n\n// Validation functions\nexport function validateDecimalPlaces(value: string): ValidationResult {\n  const decimalPlaces = Number(value);\n  if (isNaN(decimalPlaces) || decimalPlaces < 0 || decimalPlaces > 6) {\n    return {\n      valid: false,\n      message: \"Decimal places must be between 0 and 6\",\n    };\n  }\n  return { valid: true };\n}\n\nexport function validateRoundingPrecision(value: string): ValidationResult {\n  const normalized = value.replace(\",\", \".\");\n  const roundingPrecision = Number(normalized);\n  if (\n    isNaN(roundingPrecision) ||\n    roundingPrecision < 0.0001 ||\n    roundingPrecision > 100\n  ) {\n    return {\n      valid: false,\n      message: \"Rounding precision must be between 0.0001 and 100\",\n    };\n  }\n  return { valid: true };\n}\n","\"use client\";\r\n\r\nimport * as z from \"zod\";\r\n\r\nimport { Button } from \"@/components/ui/button\";\r\n\r\n// Re-export FormSchema from here to avoid circular dependencies\r\nexport const FormSchema = z.object({\r\n  decimalPlaces: z.string().nonempty(\"Decimal places is required\"),\r\n  roundingPrecision: z.string().nonempty(\"Rounding precision is required\"),\r\n  thousandsSeparator: z.string(),\r\n  locale: z.string(),\r\n});\r\n\r\n// Form values type\r\nexport type FormValues = z.infer<typeof FormSchema>;\r\n\r\n// Validation result interface\r\nexport interface ValidationResult {\r\n  valid: boolean;\r\n  message?: string;\r\n}\r\n\r\n/**\r\n * Props for the SettingsModal component\r\n */\r\nexport interface SettingsModalProps {\r\n  /** If provided, controls the open state of the modal */\r\n  isOpen?: boolean;\r\n  /** Callback when the open state changes */\r\n  onOpenChange?: (isOpen: boolean) => void;\r\n  /** Variant of the button - only used when not controlled externally */\r\n  variant?: React.ComponentProps<typeof Button>[\"variant\"];\r\n  /** Size of the button - only used when not controlled externally */\r\n  size?: React.ComponentProps<typeof Button>[\"size\"];\r\n  /** Additional class name to apply to the button */\r\n  className?: string;\r\n} \r\n","\"use client\";\n\nimport {\n  FormControl,\n  FormDescription,\n  FormField,\n  FormItem,\n  FormLabel,\n  FormMessage,\n} from \"@/components/ui/form\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\n\nimport { FormValues } from \"./types\";\nimport { UseFormReturn } from \"react-hook-form\";\nimport { useTranslation } from \"@/translations\";\n\ninterface LocaleSelectProps {\n  form: UseFormReturn<FormValues>;\n}\n\nexport function LocaleSelect({ form }: LocaleSelectProps) {\n  const { t } = useTranslation();\n\n  return (\n    <FormField\n      control={form.control}\n      name=\"locale\"\n      render={({ field }) => (\n        <FormItem>\n          <FormLabel>{t(\"SettingsModal.localeLabel\")}</FormLabel>\n          <Select onValueChange={field.onChange} defaultValue={field.value}>\n            <FormControl>\n              <SelectTrigger>\n                <SelectValue\n                  placeholder={t(\"SettingsModal.localePlaceholder\")}\n                />\n              </SelectTrigger>\n            </FormControl>\n            <SelectContent>\n              <SelectItem value=\"en-US\">English (United States)</SelectItem>\n              <SelectItem value=\"de-DE\">Deutsch (Deutschland)</SelectItem>\n              {/* Add other locales as needed */}\n            </SelectContent>\n          </Select>\n          <FormDescription>\n            {t(\"SettingsModal.localeDescription\")}\n          </FormDescription>\n          <FormMessage />\n        </FormItem>\n      )}\n    />\n  );\n}\n","\"use client\";\n\nimport { ControllerRenderProps, UseFormReturn } from \"react-hook-form\";\nimport {\n  FormControl,\n  FormDescription,\n  FormField,\n  FormItem,\n  FormLabel,\n  FormMessage,\n} from \"@/components/ui/form\";\n\nimport { FormValues } from \"./types\";\nimport { Input } from \"@/components/ui/input\";\n\ninterface NumberFieldProps {\n  form: UseFormReturn<FormValues>;\n  name: \"decimalPlaces\" | \"roundingPrecision\";\n  label: string;\n  description: string;\n}\n\nexport function NumberField({\n  form,\n  name,\n  label,\n  description,\n}: NumberFieldProps) {\n  return (\n    <FormField\n      control={form.control}\n      name={name}\n      render={({ field }: { field: ControllerRenderProps<FormValues, \"decimalPlaces\" | \"roundingPrecision\"> }) => (\n        <FormItem>\n          <FormLabel>{label}</FormLabel>\n          <FormControl>\n            <Input required {...field} />\n          </FormControl>\n          <FormDescription>{description}</FormDescription>\n          <FormMessage />\n        </FormItem>\n      )}\n    />\n  );\n}\n","\"use client\";\n\nimport {\n  FormControl,\n  FormDescription,\n  FormField,\n  FormItem,\n  FormLabel,\n  FormMessage,\n} from \"@/components/ui/form\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\n\nimport { DEFAULT_SEPARATOR } from \"./form-schema\";\nimport { FormValues } from \"./types\";\nimport { UseFormReturn } from \"react-hook-form\";\nimport { useTranslation } from \"@/translations\";\n\ninterface SeparatorSelectProps {\n  form: UseFormReturn<FormValues>;\n  currentSeparator: string;\n}\n\nexport function SeparatorSelect({\n  form,\n  currentSeparator,\n}: SeparatorSelectProps) {\n  const { t } = useTranslation();\n\n  return (\n    <FormField\n      control={form.control}\n      name=\"thousandsSeparator\"\n      render={({ field }) => (\n        <FormItem>\n          <FormLabel>{t(\"SettingsModal.thousandsSeparatorLabel\")}</FormLabel>\n          <Select\n            onValueChange={(value) => {\n              field.onChange(value || DEFAULT_SEPARATOR);\n            }}\n            value={currentSeparator}\n          >\n            <FormControl>\n              <SelectTrigger>\n                <SelectValue>\n                  {currentSeparator === \",\"\n                    ? `${t(\"SettingsModal.comma\")} (1,234.56)`\n                    : currentSeparator === \".\"\n                      ? `${t(\"SettingsModal.period\")} (1.234,56)`\n                      : currentSeparator === \"'\"\n                        ? `${t(\"SettingsModal.apostrophe\")} (1&apos;234.56)`\n                        : currentSeparator === \" \"\n                          ? `${t(\"SettingsModal.space\")} (1 234.56)`\n                          : t(\"SettingsModal.comma\")}\n                </SelectValue>\n              </SelectTrigger>\n            </FormControl>\n            <SelectContent>\n              <SelectItem key=\",\" value=\",\">\n                {`${t(\"SettingsModal.comma\")} (1,234.56)`}\n              </SelectItem>\n              <SelectItem key=\".\" value=\".\">\n                {`${t(\"SettingsModal.period\")} (1.234,56)`}\n              </SelectItem>\n              <SelectItem key=\"'\" value=\"'\">\n                {`${t(\"SettingsModal.apostrophe\")} (1&apos;234.56)`}\n              </SelectItem>\n              <SelectItem key=\"space\" value=\" \">\n                {`${t(\"SettingsModal.space\")} (1 234.56)`}\n              </SelectItem>\n            </SelectContent>\n          </Select>\n          <FormDescription>\n            {t(\"SettingsModal.thousandsSeparatorDescription\")}\n          </FormDescription>\n          <FormMessage />\n        </FormItem>\n      )}\n    />\n  );\n}\n","\"use client\";\n\nimport {\n  DEFAULT_SEPARATOR,\n  validateDecimalPlaces,\n  validateRoundingPrecision,\n} from \"./form-schema\";\nimport {\n  Dialog,\n  DialogClose,\n  DialogContent,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n  DialogDescription as UiDialogDescription,\n} from \"@/components/ui/dialog\";\nimport {\n  FormSchema,\n  FormValues,\n  SettingsModalProps\n} from \"./types\";\nimport { useEffect, useState } from \"react\";\n\nimport { Button } from \"@/components/ui/button\";\nimport { Form } from \"@/components/ui/form\";\nimport { LocaleSelect } from \"./locale-select\";\nimport { NumberField } from \"./number-field\";\nimport { SeparatorSelect } from \"./separator-select\";\nimport { Settings } from \"lucide-react\";\nimport { useForm } from \"react-hook-form\";\nimport { useSettings } from \"@/context/settings-context\";\nimport { useTranslation } from \"@/translations\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\n\nexport function SettingsModal({\n  isOpen: externalIsOpen,\n  onOpenChange: externalOnOpenChange,\n  variant = \"ghost\",\n  size = \"icon\",\n  className,\n}: SettingsModalProps) {\n  const { settings, saveSettings } = useSettings();\n  const { t } = useTranslation();\n  const [internalIsOpen, setInternalIsOpen] = useState(false);\n  const [isMounted, setIsMounted] = useState(false);\n\n  // Use either the external state or internal state\n  const isOpen = externalIsOpen !== undefined ? externalIsOpen : internalIsOpen;\n  const onOpenChange = externalOnOpenChange || setInternalIsOpen;\n\n  // Track form validity state\n  const [isValid, setIsValid] = useState(true);\n\n  // Fix the form type to match form values\n  const form = useForm<FormValues>({\n    resolver: zodResolver(FormSchema),\n    defaultValues: {\n      decimalPlaces: settings.decimalPlaces?.toString() || \"\",\n      roundingPrecision: settings.roundingPrecision?.toString() || \"0.01\",\n      thousandsSeparator: settings.thousandsSeparator || DEFAULT_SEPARATOR,\n      locale: \"en-US\",\n    },\n    mode: \"onChange\", // Validate on every change\n  });\n\n  // Reset form when dialog opens or settings change\n  useEffect(() => {\n    if (isOpen) {\n      // Ensure we're using the latest settings from context\n      form.reset({\n        decimalPlaces: settings.decimalPlaces?.toString() || \"\",\n        roundingPrecision: settings.roundingPrecision?.toString() || \"0.01\",\n        thousandsSeparator: settings.thousandsSeparator || DEFAULT_SEPARATOR,\n        locale: \"en-US\",\n      });\n    }\n  }, [isOpen, settings, form]);\n\n  // Update isValid when form state changes\n  useEffect(() => {\n    const subscription = form.watch(() => {\n      const hasErrors = !!Object.keys(form.formState.errors).length;\n      const formValues = form.getValues();\n      const isDecimalEmpty =\n        !formValues.decimalPlaces || formValues.decimalPlaces === \"\";\n\n      setIsValid(!hasErrors && !isDecimalEmpty);\n    });\n    return () => subscription.unsubscribe();\n  }, [form]);\n\n  useEffect(() => {\n    setIsMounted(true);\n  }, [settings]);\n\n  // Handle dialog close - ensure unsaved changes are discarded\n  const handleOpenChange = (open: boolean) => {\n    if (!open) {\n      // Reset form when dialog is closed without saving\n      form.reset({\n        decimalPlaces: settings.decimalPlaces?.toString() || \"\",\n        roundingPrecision: settings.roundingPrecision?.toString() || \"0.01\",\n        thousandsSeparator: settings.thousandsSeparator || DEFAULT_SEPARATOR,\n        locale: \"en-US\",\n      });\n    }\n    onOpenChange(open);\n  };\n\n  function onSubmit(data: FormValues) {\n    // Validate decimal places\n    const decimalPlacesResult = validateDecimalPlaces(data.decimalPlaces);\n    if (!decimalPlacesResult.valid) {\n      form.setError(\"decimalPlaces\", {\n        type: \"manual\",\n        message: decimalPlacesResult.message || \"Invalid decimal places\",\n      });\n      return;\n    }\n\n    // Validate rounding precision\n    const roundingPrecisionResult = validateRoundingPrecision(\n      data.roundingPrecision,\n    );\n    if (!roundingPrecisionResult.valid) {\n      form.setError(\"roundingPrecision\", {\n        type: \"manual\",\n        message:\n          roundingPrecisionResult.message || \"Invalid rounding precision\",\n      });\n      return;\n    }\n\n    // Only save settings when user submits the form and all validations pass\n    const updatedSettings = {\n      decimalPlaces: Number(data.decimalPlaces),\n      roundingPrecision: Number(data.roundingPrecision.replace(\",\", \".\")),\n      thousandsSeparator: data.thousandsSeparator || DEFAULT_SEPARATOR,\n      locale: data.locale,\n    };\n\n    // Handle the locale/language change\n    const newLocale = data.locale;\n    if (newLocale && \"en-US\" !== newLocale) {\n      // Implement language change logic here\n    }\n\n    // Save all settings at once after form submission\n    saveSettings(updatedSettings);\n\n    // Dispatch a custom event to notify the application that settings have changed\n    if (typeof window !== \"undefined\") {\n      window.dispatchEvent(\n        new CustomEvent(\"settingsChanged\", {\n          detail: { settings: updatedSettings },\n        }),\n      );\n    }\n\n    onOpenChange(false);\n  }\n\n  // Always ensure we have a valid separator value for the dropdown\n  const currentSeparator =\n    form.watch(\"thousandsSeparator\") || DEFAULT_SEPARATOR;\n\n  // Determine labels based on mounted state\n  const triggerLabel = isMounted\n    ? t(\"SettingsModal.settingsModalTitle\")\n    : \"Number Formatting Settings\";\n  const dialogTitle = isMounted\n    ? t(\"SettingsModal.settingsModalTitle\")\n    : \"Number Formatting Settings\";\n  const dialogDescription = isMounted\n    ? t(\"SettingsModal.settingsModalDescription\")\n    : \"Adjust your preferred number formatting for allocations and reports.\";\n  const saveLabel = isMounted ? t(\"SettingsModal.saveButton\") : \"Save Settings\";\n  const cancelLabel = isMounted\n    ? t(\"SettingsModal.cancelButton\", \"Cancel\")\n    : \"Cancel\";\n\n  return (\n    <>\n      {!externalIsOpen && !externalOnOpenChange && (\n        <Button\n          variant={variant}\n          size={size}\n          onClick={() => setInternalIsOpen(true)}\n          className={className}\n          aria-label={triggerLabel}\n        >\n          <Settings className=\"size-4\" />\n          {size !== \"icon\" && t(\"SettingsModal.settingsButtonText\", \"Settings\")}\n        </Button>\n      )}\n\n      <Dialog open={isOpen} onOpenChange={handleOpenChange}>\n        <DialogContent className=\"sm:max-w-[425px]\">\n          <DialogHeader>\n            <DialogTitle>{dialogTitle}</DialogTitle>\n            <UiDialogDescription>{dialogDescription}</UiDialogDescription>\n          </DialogHeader>\n          <Form {...form}>\n            <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-6\">\n              <NumberField\n                form={form}\n                name=\"decimalPlaces\"\n                label={t(\"SettingsModal.decimalPlacesLabel\")}\n                description={t(\"SettingsModal.decimalPlacesDescription\")}\n              />\n\n              <NumberField\n                form={form}\n                name=\"roundingPrecision\"\n                label={t(\"SettingsModal.roundingPrecisionLabel\")}\n                description={t(\"SettingsModal.roundingPrecisionDescription\")}\n              />\n\n              <SeparatorSelect\n                form={form}\n                currentSeparator={currentSeparator}\n              />\n\n              <LocaleSelect form={form} />\n\n              <DialogFooter className=\"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2 gap-2 sm:gap-0\">\n                <DialogClose asChild>\n                  <Button\n                    type=\"button\"\n                    variant=\"outline\"\n                    className=\"w-full sm:w-auto\"\n                  >\n                    {cancelLabel}\n                  </Button>\n                </DialogClose>\n                <Button\n                  type=\"submit\"\n                  disabled={!isValid}\n                  className=\"w-full sm:w-auto\"\n                >\n                  {saveLabel}\n                </Button>\n              </DialogFooter>\n            </form>\n          </Form>\n        </DialogContent>\n      </Dialog>\n    </>\n  );\n}\n","\"use client\";\n\n// This file is now just a barrel file that re-exports from the new location\nexport { SettingsModal } from \"./settings-modal/index\";\nexport type { SettingsModalProps } from \"./settings-modal/types\";\n","import {\n  formatDateForDisplay,\n  formatNumForDisplay,\n  formatPeriodIdForDisplay,\n  getPeriodHeader,\n} from \"./utils\";\n\nimport { AppSettings } from \"@/context/settings-context\";\nimport { CalculationResult } from \"@/lib/calculations\";\nimport { InputDataForDisplay } from \"./types\";\nimport { format } from \"date-fns\";\n\nexport async function exportToExcel(\n  results: CalculationResult,\n  inputData: InputDataForDisplay,\n  settings: AppSettings,\n  totalInputAmount: number,\n  totalDurationDays: number,\n  totalAggregatedAmount: number,\n  splitPeriodUsed: \"yearly\" | \"quarterly\" | \"monthly\",\n  currentLocale: string,\n  t: (key: string, options?: { defaultValue?: string; values?: Record<string, string | number> }) => string,\n): Promise<void> {\n  try {\n    const XLSX = await import(\"xlsx\");\n\n    // Create a single consolidated sheet for all data\n    const workbook = XLSX.utils.book_new();\n\n    // Prepare all data for a single sheet\n    const consolidatedData = [];\n\n    // 1. Title and Summary Section\n    consolidatedData.push([\n      t(\"ResultsDisplay.summaryTitle\", { defaultValue: \"Summary\" }),\n    ]);\n    consolidatedData.push([]);\n    consolidatedData.push([\n      t(\"ResultsDisplay.periodLabel\"),\n      `${formatDateForDisplay(inputData.startDate, currentLocale)} - ${formatDateForDisplay(inputData.endDate, currentLocale)}`,\n    ]);\n    consolidatedData.push([\n      t(\"ResultsDisplay.totalDurationLabel\", {\n        defaultValue: \"Total Duration (days)\",\n      }),\n      `${totalDurationDays} ${t(\"ResultsDisplay.daysLabel\")}`,\n    ]);\n    consolidatedData.push([\n      t(\"InvoiceForm.includeEndDateLabel\", {\n        defaultValue: \"Include Final Day in Service Period?\",\n      }),\n      inputData.includeEndDate\n        ? t(\"ResultsDisplay.yesLabel\", { defaultValue: \"Yes\" })\n        : t(\"ResultsDisplay.noLabel\", { defaultValue: \"No\" }),\n    ]);\n    consolidatedData.push([\n      t(\"InvoiceForm.splitPeriodLabel\", { defaultValue: \"Split Period\" }),\n      splitPeriodUsed === \"yearly\"\n        ? t(\"InvoiceForm.periodYearly\")\n        : splitPeriodUsed === \"quarterly\"\n          ? t(\"InvoiceForm.periodQuarterly\")\n          : t(\"InvoiceForm.periodMonthly\"),\n    ]);\n    consolidatedData.push([\n      t(\"ResultsDisplay.originalTotalLabel\", {\n        defaultValue: \"Total Input Amount:\",\n      }),\n      formatNumForDisplay(totalInputAmount, currentLocale, settings),\n    ]);\n    consolidatedData.push([]);\n\n    // 2. Allocation Results Section\n    consolidatedData.push([\n      t(\"ResultsDisplay.aggregatedTitle\", {\n        defaultValue: \"Allocation per Period\",\n      }),\n    ]);\n    consolidatedData.push([]);\n    consolidatedData.push([\n      getPeriodHeader(splitPeriodUsed, t),\n      t(\"ResultsDisplay.daysHeader\"),\n      t(\"ResultsDisplay.proportionHeader\"),\n      t(\"ResultsDisplay.amountHeader\"),\n    ]);\n\n    results.aggregatedSplits?.forEach((split) => {\n      consolidatedData.push([\n        formatPeriodIdForDisplay(\n          split.periodIdentifier,\n          splitPeriodUsed,\n          currentLocale,\n        ),\n        split.daysInPeriod,\n        split.proportion,\n        split.totalSplitAmount,\n      ]);\n    });\n\n    consolidatedData.push([\n      t(\"ResultsDisplay.totalLabel\", { defaultValue: \"Total\" }),\n      totalDurationDays,\n      1,\n      totalAggregatedAmount,\n    ]);\n    consolidatedData.push([]);\n    consolidatedData.push([]);\n\n    // 3. Detailed Calculation Section\n    if (results.calculationSteps) {\n      const steps = results.calculationSteps;\n      const { periodSegments, amountCalculations } = steps;\n\n      // a. Add title\n      consolidatedData.push([\n        t(\"ResultsDisplay.calculationStepsTitle\", {\n          defaultValue: \"View Full Split Calculation\",\n        }),\n      ]);\n      consolidatedData.push([]);\n\n      // b. Add total duration section\n      consolidatedData.push([t(\"ResultsDisplay.totalDuration\")]);\n      consolidatedData.push([\n        t(\"ResultsDisplay.periodLabel\"),\n        `${formatDateForDisplay(typeof steps.totalDuration.start === \"string\" ? new Date(steps.totalDuration.start) : steps.totalDuration.start, currentLocale)} - ${formatDateForDisplay(typeof steps.totalDuration.end === \"string\" ? new Date(steps.totalDuration.end) : steps.totalDuration.end, currentLocale)}`,\n      ]);\n      consolidatedData.push([\n        t(\"ResultsDisplay.totalDays\"),\n        `${steps.totalDuration.days} ${steps.totalDuration.included ? t(\"ResultsDisplay.inclusiveLabel\") : t(\"ResultsDisplay.exclusiveLabel\")}`,\n      ]);\n      consolidatedData.push([]);\n\n      // c. Add proportion calculation\n      consolidatedData.push([t(\"ResultsDisplay.proportionCalculation\")]);\n      for (const segment of periodSegments) {\n        const formattedProportion = segment.proportion.toLocaleString(\n          currentLocale,\n          {\n            style: \"percent\",\n            minimumFractionDigits: 2,\n            maximumFractionDigits: 2,\n          },\n        );\n        consolidatedData.push([\n          formatPeriodIdForDisplay(\n            segment.periodIdentifier,\n            splitPeriodUsed,\n            currentLocale,\n          ),\n          `${segment.days} / ${steps.totalDuration.days} = ${formattedProportion}`,\n        ]);\n      }\n      consolidatedData.push([]);\n\n      // d. Add amount calculations\n      consolidatedData.push([t(\"ResultsDisplay.splitCalculation\")]);\n      consolidatedData.push([]);\n\n      for (let i = 0; i < amountCalculations.length; i++) {\n        const amtCalc = amountCalculations[i];\n        consolidatedData.push([\n          `${t(\"ResultsDisplay.inputAmountLabel\")} #${i + 1}:`,\n          formatNumForDisplay(amtCalc.originalAmount, currentLocale, settings),\n        ]);\n\n        for (const split of amtCalc.periodSplits) {\n          const periodSeg = periodSegments.find(\n            (s) => s.periodIdentifier === split.periodIdentifier,\n          );\n          consolidatedData.push([\n            formatPeriodIdForDisplay(\n              split.periodIdentifier,\n              splitPeriodUsed,\n              currentLocale,\n            ),\n            `${formatNumForDisplay(amtCalc.originalAmount, currentLocale, settings)}  ${periodSeg?.proportion.toFixed(6)} = ${split.rawSplit.toFixed(6)}  ${formatNumForDisplay(split.roundedSplit, currentLocale, settings)}`,\n          ]);\n\n          if (split.adjustment !== 0) {\n            consolidatedData.push([\n              `  ${t(\"ResultsDisplay.adjustmentLabel\")}:`,\n              formatNumForDisplay(split.adjustment, currentLocale, settings),\n            ]);\n          }\n        }\n\n        consolidatedData.push([\n          t(\"ResultsDisplay.discrepancyLabel\"),\n          formatNumForDisplay(amtCalc.discrepancy, currentLocale, settings),\n        ]);\n\n        if (amtCalc.adjustmentAppliedToPeriod) {\n          consolidatedData.push([\n            t(\"ResultsDisplay.adjustedInYearLabel\", {\n              defaultValue: \"Applied in Year\",\n            }),\n            formatPeriodIdForDisplay(\n              amtCalc.adjustmentAppliedToPeriod,\n              splitPeriodUsed,\n              currentLocale,\n            ),\n          ]);\n        }\n\n        consolidatedData.push([\n          t(\"ResultsDisplay.finalSumLabel\"),\n          formatNumForDisplay(amtCalc.finalSum, currentLocale, settings),\n        ]);\n\n        consolidatedData.push([]);\n      }\n    }\n\n    // Create the consolidated worksheet with all data\n    const consolidatedSheet = XLSX.utils.aoa_to_sheet(consolidatedData);\n\n    // Apply cell formatting for numbers and percentages\n    // Find the row range for the allocation results table (skip headers)\n    const allocationTableStartRow = 12; // 0-based index for the first data row after headers\n    const allocationTableEndRow =\n      allocationTableStartRow + (results.aggregatedSplits?.length || 0);\n\n    // Format proportion column (index 2) as percentage\n    for (let R = allocationTableStartRow; R < allocationTableEndRow; R++) {\n      const propCellRef = XLSX.utils.encode_cell({ c: 2, r: R });\n      if (consolidatedSheet[propCellRef]) {\n        consolidatedSheet[propCellRef].t = \"n\";\n        consolidatedSheet[propCellRef].z = \"0.00%\";\n      }\n    }\n\n    // Format amount column (index 3) with proper decimal places\n    for (let R = allocationTableStartRow; R < allocationTableEndRow + 1; R++) {\n      // +1 to include total row\n      const amtCellRef = XLSX.utils.encode_cell({ c: 3, r: R });\n      if (consolidatedSheet[amtCellRef]) {\n        consolidatedSheet[amtCellRef].t = \"n\";\n        consolidatedSheet[amtCellRef].z =\n          `#,##0.${\"0\".repeat(settings.decimalPlaces || 2)}`;\n      }\n    }\n\n    // Add the consolidated sheet to the workbook with a meaningful name\n    XLSX.utils.book_append_sheet(\n      workbook,\n      consolidatedSheet,\n      t(\"ResultsDisplay.consolidatedSheetName\", {\n        defaultValue: \"Invoice Split Report\",\n      }),\n    );\n\n    const filename = `InvoiceSplit_${format(new Date(), \"yyyyMMdd\")}.xlsx`;\n    XLSX.writeFile(workbook, filename);\n  } catch (error) {\n    console.error(\"Failed to load xlsx library or export Excel:\", error);\n    throw new Error(\"Failed to export Excel. Please try again.\");\n  }\n}\n","import { InputDataForDisplay, JsPDFWithInternal } from \"./types\";\nimport { de, enUS } from \"date-fns/locale\";\nimport {\n  formatDateLocale,\n  formatNumber,\n  formatPercent,\n} from \"@/lib/formattingUtils\";\nimport {\n  formatPeriodIdForDisplay,\n  getPeriodHeader,\n} from \"./utils\";\n\nimport { AppSettings } from \"@/context/settings-context\";\nimport { CalculationResult } from \"@/lib/calculations\";\nimport type { CellHookData } from \"jspdf-autotable\";\nimport { format } from \"date-fns\";\n\nexport async function exportToPdf(\n  results: CalculationResult,\n  inputData: InputDataForDisplay,\n  settings: Omit<AppSettings, \"locale\">,\n  totalInputAmount: number,\n  totalDurationDays: number,\n  totalAggregatedAmount: number,\n  splitPeriodUsed: \"yearly\" | \"quarterly\" | \"monthly\",\n  currentLocale: string,\n  t: (key: string, options?: { defaultValue?: string; values?: Record<string, string | number> }) => string,\n): Promise<void> {\n  try {\n    const [{ jsPDF }, { default: autoTable }] = await Promise.all([\n      import(\"jspdf\"),\n      import(\"jspdf-autotable\"),\n    ]);\n\n    const doc = new jsPDF() as JsPDFWithInternal;\n    let yPos = 20;\n    const filename = `InvoiceSplit_${format(new Date(), \"yyyyMMdd\")}.pdf`;\n\n    // Summary Section\n    doc.text(\n      `${t(\"ResultsDisplay.periodLabel\")}: ${formatDateLocale(inputData.startDate, currentLocale)} - ${formatDateLocale(inputData.endDate, currentLocale)}`,\n      14,\n      yPos,\n    );\n    yPos += 5;\n    doc.text(\n      `${t(\"ResultsDisplay.originalTotalLabel\", { defaultValue: \"Total Input Amount:\" })}: ${formatNumber(totalInputAmount, currentLocale, settings)}`,\n      14,\n      yPos,\n    );\n    yPos += 15;\n    doc.text(\n      `${t(\"ResultsDisplay.totalDurationLabel\", { defaultValue: \"Total Duration (days)\" })}: ${totalDurationDays} ${t(\"ResultsDisplay.daysLabel\")}`,\n      14,\n      yPos,\n    );\n    yPos += 5;\n    doc.text(\n      `${t(\"InvoiceForm.includeEndDateLabel\", { defaultValue: \"Include Final Day in Service Period?\" })}: ${inputData.includeEndDate ? t(\"ResultsDisplay.yesLabel\", { defaultValue: \"Yes\" }) : t(\"ResultsDisplay.noLabel\", { defaultValue: \"No\" })}`,\n      14,\n      yPos,\n    );\n    yPos += 5;\n    doc.text(\n      `${t(\"InvoiceForm.splitPeriodLabel\", { defaultValue: \"Split Period\" })}: ${splitPeriodUsed === \"yearly\" ? t(\"InvoiceForm.periodYearly\") : splitPeriodUsed === \"quarterly\" ? t(\"InvoiceForm.periodQuarterly\") : t(\"InvoiceForm.periodMonthly\")}`,\n      14,\n      yPos,\n    );\n    yPos += 5;\n\n    // Allocation Table\n    const tableRowsData =\n      results.aggregatedSplits?.map((split) => [\n        formatPeriodIdForDisplay(\n          split.periodIdentifier,\n          splitPeriodUsed,\n          currentLocale,\n        ),\n        split.daysInPeriod,\n        formatPercent(split.proportion, currentLocale),\n        formatNumber(split.totalSplitAmount, currentLocale, settings),\n      ]) || [];\n\n    autoTable(doc, {\n      head: [\n        [\n          getPeriodHeader(splitPeriodUsed, t),\n          t(\"ResultsDisplay.daysHeader\"),\n          t(\"ResultsDisplay.proportionHeader\"),\n          t(\"ResultsDisplay.amountHeader\"),\n        ],\n      ],\n      body: tableRowsData,\n      foot: [\n        [\n          t(\"ResultsDisplay.totalLabel\", { defaultValue: \"Total\" }),\n          totalDurationDays,\n          formatPercent(1, currentLocale),\n          formatNumber(totalAggregatedAmount, currentLocale, settings),\n        ],\n      ],\n      startY: yPos,\n      theme: \"grid\",\n      headStyles: {\n        // Convert primary color to RGB for PDF\n        fillColor: getComputedStyle(document.documentElement)\n          .getPropertyValue(\"--primary\")\n          .trim()\n          .split(\" \")\n          .map((v, i) => (i === 0 ? parseInt(v) : parseFloat(v) * 2.55))\n          .filter((_, i) => i < 3) as [number, number, number],\n      },\n      footStyles: {\n        // Convert muted color to RGB for PDF\n        fillColor: getComputedStyle(document.documentElement)\n          .getPropertyValue(\"--muted\")\n          .trim()\n          .split(\" \")\n          .map((v, i) => (i === 0 ? parseInt(v) : parseFloat(v) * 2.55))\n          .filter((_, i) => i < 3) as [number, number, number],\n        textColor:\n          getComputedStyle(document.documentElement)\n            .getPropertyValue(\"--foreground\")\n            .trim()\n            .split(\" \")\n            .map((v, i) => (i === 0 ? parseInt(v) : parseFloat(v) * 2.55))\n            .filter((_, i) => i < 3)\n            .reduce((sum, c) => sum + c, 0) / 3,\n        fontStyle: \"bold\",\n      },\n      didParseCell: function (data: CellHookData) {\n        if (\n          data.column.index !== undefined &&\n          [1, 2, 3].includes(data.column.index)\n        ) {\n          data.cell.styles.halign = \"right\";\n        }\n      },\n    });\n\n    // Calculation Steps Section\n    if (results.calculationSteps) {\n      const steps = results.calculationSteps;\n      const { periodSegments, amountCalculations } = steps;\n      yPos = doc.lastAutoTable?.finalY\n        ? doc.lastAutoTable.finalY + 15\n        : yPos + 50;\n\n      doc.text(\n        t(\"ResultsDisplay.calculationStepsTitle\", {\n          defaultValue: \"View Full Split Calculation\",\n        }),\n        14,\n        yPos,\n      );\n      yPos += 10;\n\n      doc.text(t(\"ResultsDisplay.totalDuration\"), 14, yPos);\n      yPos += 7;\n\n      // Use type assertions to handle the string dates from the API\n      const startDate = steps.totalDuration.start as string;\n      const endDate = steps.totalDuration.end as string;\n\n      doc.text(\n        `${t(\"ResultsDisplay.periodLabel\")}: ${formatDateLocale(startDate, currentLocale)} - ${formatDateLocale(endDate, currentLocale)}`,\n        20,\n        yPos,\n      );\n      yPos += 5;\n      doc.text(\n        `${t(\"ResultsDisplay.totalDays\")}: ${steps.totalDuration.days} ${steps.totalDuration.included ? t(\"ResultsDisplay.inclusiveLabel\") : t(\"ResultsDisplay.exclusiveLabel\")}`,\n        20,\n        yPos,\n      );\n      yPos += 10;\n\n      doc.text(t(\"ResultsDisplay.proportionCalculation\"), 14, yPos);\n      yPos += 7;\n      doc.setFontSize(10);\n\n      if (yPos > doc.internal.pageSize.height - 50) {\n        doc.addPage();\n        yPos = 20;\n      }\n\n      for (const segment of periodSegments) {\n        doc.text(\n          `${formatPeriodIdForDisplay(segment.periodIdentifier, splitPeriodUsed, currentLocale)}: ${segment.days} / ${steps.totalDuration.days} = ${formatPercent(segment.proportion, currentLocale)}`,\n          20,\n          yPos,\n        );\n        yPos += 5;\n        if (yPos > doc.internal.pageSize.height - 30) {\n          doc.addPage();\n          yPos = 20;\n        }\n      }\n      yPos += 5;\n\n      doc.text(t(\"ResultsDisplay.splitCalculation\"), 14, yPos);\n      yPos += 7;\n\n      for (let i = 0; i < amountCalculations.length; i++) {\n        const amtCalc = amountCalculations[i];\n        if (yPos > doc.internal.pageSize.height - 70) {\n          doc.addPage();\n          yPos = 20;\n        }\n        doc.setFontSize(11);\n        doc.text(\n          `${t(\"ResultsDisplay.inputAmountLabel\")} #${i + 1}: ${formatNumber(amtCalc.originalAmount, currentLocale, settings)}`,\n          20,\n          yPos,\n        );\n        yPos += 7;\n        doc.setFontSize(10);\n\n        for (const split of amtCalc.periodSplits) {\n          const periodSeg = periodSegments.find(\n            (s) => s.periodIdentifier === split.periodIdentifier,\n          );\n          doc.text(\n            `${formatPeriodIdForDisplay(split.periodIdentifier, splitPeriodUsed, currentLocale)}:`,\n            25,\n            yPos,\n          );\n          yPos += 5;\n          doc.text(\n            `${formatNumber(amtCalc.originalAmount, currentLocale, settings)}  ${periodSeg?.proportion.toFixed(6)} = ${split.rawSplit.toFixed(6)}`,\n            30,\n            yPos,\n          );\n          yPos += 5;\n          doc.text(\n            ` ${t(\"ResultsDisplay.roundedLabel\")}: ${formatNumber(split.roundedSplit, currentLocale, settings)}`,\n            30,\n            yPos,\n          );\n          yPos += 5;\n          if (split.adjustment !== 0) {\n            doc.text(\n              `${t(\"ResultsDisplay.adjustmentLabel\")}: ${formatNumber(split.adjustment, currentLocale, settings)}`,\n              30,\n              yPos,\n            );\n            yPos += 5;\n          }\n          if (yPos > doc.internal.pageSize.height - 40) {\n            doc.addPage();\n            yPos = 20;\n          }\n        }\n        doc.text(\n          `${t(\"ResultsDisplay.discrepancyLabel\")}: ${formatNumber(amtCalc.discrepancy, currentLocale, settings)}`,\n          25,\n          yPos,\n        );\n        yPos += 5;\n        if (amtCalc.adjustmentAppliedToPeriod) {\n          doc.text(\n            `${t(\"ResultsDisplay.adjustedInYearLabel\", { defaultValue: \"Applied in Year\" })}: ${formatPeriodIdForDisplay(amtCalc.adjustmentAppliedToPeriod, splitPeriodUsed, currentLocale)}`,\n            25,\n            yPos,\n          );\n          yPos += 5;\n        }\n        doc.text(\n          `${t(\"ResultsDisplay.finalSumLabel\")}: ${formatNumber(amtCalc.finalSum, currentLocale, settings)}`,\n          25,\n          yPos,\n        );\n        yPos += 10;\n        if (\n          yPos > doc.internal.pageSize.height - 50 &&\n          i < amountCalculations.length - 1\n        ) {\n          doc.addPage();\n          yPos = 20;\n        }\n      }\n    }\n\n    const pageCount = doc.internal.getNumberOfPages();\n    doc.setFontSize(8);\n    for (let i = 1; i <= pageCount; i++) {\n      doc.setPage(i);\n      doc.text(\n        `Generated by BillSplitter - ${format(new Date(), \"PPpp\", { locale: currentLocale === \"de\" ? de : enUS })}`,\n        14,\n        doc.internal.pageSize.height - 10,\n      );\n      doc.text(\n        `Page ${i} of ${pageCount}`,\n        doc.internal.pageSize.width - 35,\n        doc.internal.pageSize.height - 10,\n      );\n    }\n    doc.save(filename);\n  } catch (error) {\n    console.error(\"Error generating PDF:\", error);\n    throw new Error(\"Failed to generate PDF. Please try again.\");\n  }\n}\n","\"use client\";\n\nimport {\n  Accordion,\n  AccordionContent,\n  AccordionItem,\n  AccordionTrigger,\n} from \"@/components/ui/accordion\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport React, { useState } from \"react\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableFooter,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport {\n  formatDateForDisplay,\n  formatNumForDisplay,\n  formatPctForDisplay,\n  formatPeriodIdForDisplay,\n  getPeriodHeader,\n} from \"./utils\";\n\nimport { Button } from \"@/components/ui/button\";\nimport { CalculationStepsDisplay } from \"./calculation-steps-display\";\nimport { ResultsDisplayProps } from \"./types\";\nimport { SettingsModal } from \"@/components/settings-modal\";\nimport { exportToExcel } from \"./export-excel\";\nimport { exportToPdf } from \"./export-pdf\";\nimport { useSettings } from \"@/context/settings-context\";\nimport { useTranslation } from \"@/translations\";\n\n// Internal component function\nfunction ResultsDisplayComponent({ results, inputData }: ResultsDisplayProps) {\n  const { t, i18n } = useTranslation();\n  const { settings } = useSettings();\n  const [isSettingsOpen, setIsSettingsOpen] = useState(false);\n  const currentLocale = i18n.language;\n\n  // Ensure we use the splitPeriod from the inputData if available\n  const splitPeriodUsed = inputData.splitPeriod || \"yearly\";\n\n  // Calculate derived values with checks\n  const totalDurationDays = results.calculationSteps?.totalDuration?.days ?? 0;\n  const totalInputAmount = inputData.amounts.reduce(\n    (sum, val) => sum + (isNaN(val) ? 0 : val),\n    0,\n  );\n  const totalAggregatedAmount =\n    results.aggregatedSplits?.reduce(\n      (sum, s) => sum + (s.totalSplitAmount ?? 0),\n      0,\n    ) ?? 0;\n\n  // Handler functions for export\n  function handleExportExcel() {\n    exportToExcel(\n      results,\n      inputData,\n      settings,\n      totalInputAmount,\n      totalDurationDays,\n      totalAggregatedAmount,\n      splitPeriodUsed,\n      currentLocale,\n      t,\n    ).catch((error) => {\n      console.error(\"Failed to export Excel:\", error);\n      alert(\"Failed to export Excel. Please try again.\");\n    });\n  }\n\n  function handleExportPdf() {\n    exportToPdf(\n      results,\n      inputData,\n      settings,\n      totalInputAmount,\n      totalDurationDays,\n      totalAggregatedAmount,\n      splitPeriodUsed,\n      currentLocale,\n      t,\n    ).catch((error) => {\n      console.error(\"Failed to generate PDF:\", error);\n      alert(\"Failed to generate PDF. Please try again.\");\n    });\n  }\n\n  return (\n    <div className=\"w-full animate-fadeIn\">\n      {/* Wrap everything except the modal in a single card */}\n      <Card className=\"shadow-lg border border-border/50\">\n        <CardContent className=\"p-6 space-y-8\">\n          <Card className=\"shadow-md border border-border/40 overflow-hidden\">\n            <CardContent className=\"p-6\">\n              <div className=\"flex justify-between items-center mb-6 pb-4 border-b\">\n                <h3 className=\"text-xl font-semibold text-primary\">\n                  {t(\"ResultsDisplay.summaryTitle\")}\n                </h3>\n                <button\n                  onClick={() => setIsSettingsOpen(true)}\n                  className=\"p-1.5 rounded-md text-muted-foreground hover:text-primary-foreground hover:bg-primary transition-colors cursor-pointer\"\n                  aria-label={t(\"ResultsDisplay.settingsLabel\")}\n                >\n                  <svg\n                    xmlns=\"http://www.w3.org/2000/svg\"\n                    width=\"18\"\n                    height=\"18\"\n                    viewBox=\"0 0 24 24\"\n                    fill=\"none\"\n                    stroke=\"currentColor\"\n                    strokeWidth=\"2\"\n                    strokeLinecap=\"round\"\n                    strokeLinejoin=\"round\"\n                  >\n                    <path d=\"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.38a2 2 0 0 0-.73-2.73l-.15-.09a2 2 0 0 1-1-1.74v-.51a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z\" />\n                    <circle cx=\"12\" cy=\"12\" r=\"3\" />\n                  </svg>\n                </button>\n              </div>\n              <div className=\"space-y-2 text-sm text-muted-foreground\">\n                <div className=\"flex justify-between\">\n                  <span>{t(\"ResultsDisplay.periodLabel\")}</span>\n                  <span className=\"font-medium text-foreground\">\n                    {formatDateForDisplay(inputData.startDate, currentLocale)} -{\" \"}\n                    {formatDateForDisplay(inputData.endDate, currentLocale)}\n                  </span>\n                </div>\n                <div className=\"flex justify-between\">\n                  <span>\n                    {t(\"ResultsDisplay.totalDurationLabel\", {\n                      defaultValue: \"Total Duration (days)\",\n                    })}\n                  </span>\n                  <span className=\"font-medium text-foreground\">\n                    {totalDurationDays} {t(\"ResultsDisplay.daysLabel\")}\n                  </span>\n                </div>\n                <div className=\"flex justify-between\">\n                  <span>\n                    {t(\"InvoiceForm.includeEndDateLabel\", {\n                      defaultValue: \"Include Final Day in Service Period?\",\n                    })}\n                  </span>\n                  <span className=\"font-medium text-foreground\">\n                    {inputData.includeEndDate\n                      ? t(\"ResultsDisplay.yesLabel\", { defaultValue: \"Yes\" })\n                      : t(\"ResultsDisplay.noLabel\", { defaultValue: \"No\" })}\n                  </span>\n                </div>\n                <div className=\"flex justify-between\">\n                  <span>\n                    {t(\"InvoiceForm.splitPeriodLabel\", {\n                      defaultValue: \"Split Period\",\n                    })}\n                  </span>\n                  <span className=\"font-medium text-foreground\">\n                    {splitPeriodUsed === \"yearly\" &&\n                      t(\"InvoiceForm.periodYearly\")}\n                    {splitPeriodUsed === \"quarterly\" &&\n                      t(\"InvoiceForm.periodQuarterly\")}\n                    {splitPeriodUsed === \"monthly\" &&\n                      t(\"InvoiceForm.periodMonthly\")}\n                  </span>\n                </div>\n                <div className=\"flex justify-between pt-2 border-t border-border/30\">\n                  <span className=\"font-semibold text-foreground\">\n                    {t(\"ResultsDisplay.originalTotalLabel\", {\n                      defaultValue: \"Total Input Amount:\",\n                    })}\n                  </span>\n                  <span className=\"font-semibold text-foreground\">\n                    {formatNumForDisplay(\n                      totalInputAmount,\n                      currentLocale,\n                      settings,\n                    )}\n                  </span>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card className=\"shadow-md border border-border/40 overflow-hidden\">\n            <CardContent className=\"p-6\">\n              <h3 className=\"text-xl font-semibold mb-6 pb-4 border-b text-primary\">\n                {t(\"ResultsDisplay.aggregatedTitle\", {\n                  defaultValue: \"Allocation per Period\",\n                })}\n              </h3>\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>{getPeriodHeader(splitPeriodUsed, t)}</TableHead>\n                    <TableHead className=\"text-right\">\n                      {t(\"ResultsDisplay.daysHeader\")}\n                    </TableHead>\n                    <TableHead className=\"text-right\">\n                      {t(\"ResultsDisplay.proportionHeader\")}\n                    </TableHead>\n                    <TableHead className=\"text-right\">\n                      {t(\"ResultsDisplay.amountHeader\")}\n                    </TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {results.aggregatedSplits?.map((split, index) => (\n                    <TableRow key={index}>\n                      <TableCell className=\"font-medium text-foreground whitespace-nowrap\">\n                        {formatPeriodIdForDisplay(\n                          split.periodIdentifier,\n                          splitPeriodUsed,\n                          currentLocale,\n                        )}\n                      </TableCell>\n                      <TableCell className=\"text-right text-muted-foreground\">\n                        {split.daysInPeriod}\n                      </TableCell>\n                      <TableCell className=\"text-right text-muted-foreground\">\n                        {formatPctForDisplay(split.proportion, currentLocale)}\n                      </TableCell>\n                      <TableCell className=\"text-right font-medium text-foreground\">\n                        {formatNumForDisplay(\n                          split.totalSplitAmount,\n                          currentLocale,\n                          settings,\n                        )}\n                      </TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n                <TableFooter>\n                  <TableRow>\n                    <TableCell>\n                      {t(\"ResultsDisplay.totalLabel\", {\n                        defaultValue: \"Total\",\n                      })}\n                    </TableCell>\n                    <TableCell className=\"text-right font-semibold text-foreground\">\n                      {totalDurationDays}\n                    </TableCell>\n                    <TableCell className=\"text-right font-semibold text-foreground\">\n                      {formatPctForDisplay(1, currentLocale)}\n                    </TableCell>\n                    <TableCell className=\"text-right font-semibold text-foreground\">\n                      {formatNumForDisplay(\n                        totalAggregatedAmount,\n                        currentLocale,\n                        settings,\n                      )}\n                    </TableCell>\n                  </TableRow>\n                </TableFooter>\n              </Table>\n            </CardContent>\n          </Card>\n\n          {/* Calculation Details Accordion */}\n          <Accordion type=\"single\" collapsible className=\"w-full\">\n            <AccordionItem\n              value=\"item-1\"\n              className=\"border rounded-lg shadow-md bg-card\"\n            >\n              <AccordionTrigger className=\"px-6 py-4 text-lg font-semibold text-primary hover:bg-muted/40\">\n                {t(\"ResultsDisplay.calculationStepsTitle\", {\n                  defaultValue: \"View Full Split Calculation\",\n                })}\n              </AccordionTrigger>\n              <AccordionContent className=\"px-6 py-4 bg-background border-t\">\n                {results.calculationSteps ? (\n                  <CalculationStepsDisplay\n                    steps={results.calculationSteps}\n                    settings={settings}\n                    splitPeriodUsed={splitPeriodUsed}\n                  />\n                ) : (\n                  <p>{t(\"ResultsDisplay.noStepsAvailable\")}</p>\n                )}\n              </AccordionContent>\n            </AccordionItem>\n          </Accordion>\n\n          {/* Export Buttons Section */}\n          <div className=\"mt-8 w-full flex flex-col items-center sm:flex-row sm:justify-center gap-4 px-4 sm:px-0\">\n            <Button\n              variant=\"outline\"\n              onClick={handleExportExcel}\n              className=\"w-full sm:w-auto\"\n            >\n              <svg\n                className=\"mr-2 h-4 w-4\"\n                xmlns=\"http://www.w3.org/2000/svg\"\n                viewBox=\"0 0 24 24\"\n                fill=\"none\"\n                stroke=\"currentColor\"\n                strokeWidth=\"2\"\n                strokeLinecap=\"round\"\n                strokeLinejoin=\"round\"\n              >\n                <path d=\"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z\" />\n                <polyline points=\"14 2 14 8 20 8\" />\n                <line x1=\"16\" y1=\"13\" x2=\"8\" y2=\"13\" />\n                <line x1=\"16\" y1=\"17\" x2=\"8\" y2=\"17\" />\n                <polyline points=\"10 9 9 9 8 9\" />\n              </svg>\n              {t(\"ResultsDisplay.exportExcelButton\")}\n            </Button>\n            <Button\n              variant=\"outline\"\n              onClick={handleExportPdf}\n              className=\"w-full sm:w-auto\"\n            >\n              <svg\n                className=\"mr-2 h-4 w-4\"\n                xmlns=\"http://www.w3.org/2000/svg\"\n                viewBox=\"0 0 24 24\"\n                fill=\"none\"\n                stroke=\"currentColor\"\n                strokeWidth=\"2\"\n                strokeLinecap=\"round\"\n                strokeLinejoin=\"round\"\n              >\n                <path d=\"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z\" />\n                <polyline points=\"14 2 14 8 20 8\" />\n                <line x1=\"16\" y1=\"13\" x2=\"8\" y2=\"13\" />\n                <line x1=\"16\" y1=\"17\" x2=\"8\" y2=\"17\" />\n                <polyline points=\"10 9 9 9 8 9\" />\n              </svg>\n              {t(\"ResultsDisplay.exportPdfButton\")}\n            </Button>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Settings Modal remains outside the main card */}\n      <SettingsModal isOpen={isSettingsOpen} onOpenChange={setIsSettingsOpen} />\n    </div>\n  );\n}\n\n// Wrapper component to export\nexport function ResultsDisplay(props: ResultsDisplayProps) {\n  return <ResultsDisplayComponent {...props} />;\n}\n","// This file is a compatibility layer that re-exports from the modular implementation\nexport * from \"./results-display/index\";\n","import { ERROR_CODES, InputValidationError } from \"@/lib/errors\";\n\nimport { CalculationError } from \"@/lib/calculations\";\nimport { CalculationErrorType } from \"./types\";\n\ntype ErrorHandlerProps = {\n  error: CalculationErrorType;\n  t: (key: string, options?: Record<string, unknown> | string) => string;\n};\n\nexport function handleCalculationError({\n  error,\n  t,\n}: ErrorHandlerProps): string | null {\n  if (!error) return null;\n\n  const baseErrorTitle = t(\"Errors.calculationErrorTitle\");\n\n  if (error instanceof InputValidationError) {\n    switch (error.code) {\n      case ERROR_CODES.NO_AMOUNTS:\n        return baseErrorTitle + \": \" + t(\"InvoiceForm.errorAmountRequired\");\n      case ERROR_CODES.INVALID_AMOUNT:\n        return baseErrorTitle + \": \" + t(\"InvoiceForm.errorAmountPositive\");\n      case ERROR_CODES.END_BEFORE_START:\n        return baseErrorTitle + \": \" + t(\"InvoiceForm.errorEndDateBeforeStart\");\n      case ERROR_CODES.INVALID_DATES:\n        return (\n          baseErrorTitle +\n          \": \" +\n          t(\"InvoiceForm.errorInvalidDates\", {\n            defaultValue: \"Valid start and end dates are required\",\n          })\n        );\n      case ERROR_CODES.ZERO_DURATION:\n        return (\n          baseErrorTitle +\n          \": \" +\n          t(\"InvoiceForm.errorZeroDuration\", {\n            defaultValue: \"The date range must result in a positive duration\",\n          })\n        );\n      default:\n        console.warn(`Input validation error: ${error.code}`, error.details);\n        return baseErrorTitle + \": \" + error.message;\n    }\n  }\n\n  if (error instanceof CalculationError) {\n    console.error(\n      `Calculation error: ${error.code} (${error.category})`,\n      error.details,\n    );\n    return baseErrorTitle + \": \" + error.message;\n  }\n\n  if (typeof error === \"string\") {\n    if (error.includes(\"At least one amount is required\")) {\n      return baseErrorTitle + \": \" + t(\"InvoiceForm.errorAmountRequired\");\n    } else if (error.includes(\"Start date must be before\")) {\n      return baseErrorTitle + \": \" + t(\"InvoiceForm.errorEndDateBeforeStart\");\n    } else {\n      return baseErrorTitle + \": \" + error;\n    }\n  }\n\n  if (error instanceof Error) {\n    console.error(\"Error object received:\", error);\n    return baseErrorTitle + \": \" + error.message;\n  }\n\n  if (error && typeof error === \"object\") {\n    console.error(\"Error object received:\", error);\n    if (\"message\" in error && typeof error.message === \"string\") {\n      return baseErrorTitle + \": \" + error.message;\n    } else {\n      try {\n        const stringifiedError = JSON.stringify(error);\n        return (\n          baseErrorTitle +\n          \": \" +\n          (stringifiedError !== \"{}\"\n            ? stringifiedError\n            : t(\"Errors.unexpectedError\"))\n        );\n      } catch {\n        return baseErrorTitle + \": \" + t(\"Errors.unexpectedError\");\n      }\n    }\n  }\n\n  console.error(\"An unexpected or non-standard error was received:\", error);\n  return baseErrorTitle + \": \" + t(\"Errors.unexpectedError\");\n}\n","import { useCallback, useEffect, useRef, useState } from \"react\";\n\nimport { DemoDataType } from \"./form-schema\";\n\nexport function useDemoDataHandler() {\n  const [initialDemoData, setInitialDemoData] = useState<DemoDataType>(null);\n  const demoDataProcessedRef = useRef(false);\n\n  useEffect(() => {\n    if (demoDataProcessedRef.current) {\n      return;\n    }\n\n    if (typeof window !== \"undefined\") {\n      const demoDataString = sessionStorage.getItem(\"billSplitterDemoData\");\n      console.log(\n        \"Reading sessionStorage billSplitterDemoData:\",\n        demoDataString,\n      );\n\n      if (demoDataString) {\n        try {\n          const parsedDemoData = JSON.parse(demoDataString);\n          if (parsedDemoData && parsedDemoData.isDemo) {\n            localStorage.removeItem(\"invoiceFormDataCache\");\n            console.log(\n              \"Cleared localStorage cache to ensure demo data is used\",\n            );\n\n            console.log(\"Setting initialDemoData state:\", parsedDemoData);\n            setInitialDemoData(parsedDemoData);\n\n            sessionStorage.removeItem(\"billSplitterDemoData\");\n            console.log(\"Removed billSplitterDemoData from sessionStorage\");\n\n            demoDataProcessedRef.current = true;\n          } else {\n            sessionStorage.removeItem(\"billSplitterDemoData\");\n          }\n        } catch (error) {\n          console.error(\"Error parsing demo data:\", error);\n          sessionStorage.removeItem(\"billSplitterDemoData\");\n        }\n      }\n    }\n  }, []);\n\n  const handleDemoDataApplied = useCallback(() => {\n    console.log(\"Demo data processed by InvoiceForm, clearing state\");\n    setInitialDemoData(null);\n  }, []);\n\n  return {\n    initialDemoData,\n    handleDemoDataApplied,\n  };\n}\n","\"use client\";\n\nimport { Alert, AlertDescription, AlertTitle } from \"@/components/ui/alert\";\nimport { CalculationInput, CalculationResult } from \"@/lib/calculations\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Suspense, useEffect, useRef, useState } from \"react\";\n\nimport { CalculationCallbackData } from \"@/components/invoice-form\";\nimport { CalculationErrorType } from \"./invoice-form/types\";\nimport Cookies from \"js-cookie\";\nimport { GoogleAnalytics } from \"@next/third-parties/google\";\nimport { Loader2 } from \"lucide-react\";\nimport { ResultsDisplay } from \"@/components/results-display\";\nimport { SettingsModal } from \"@/components/settings-modal\";\nimport { Terminal } from \"lucide-react\";\nimport dynamic from \"next/dynamic\";\nimport { handleCalculationError } from \"./invoice-form/error-handler\";\nimport { safeText } from \"@/lib/utils\";\nimport { useDemoDataHandler } from \"./invoice-form/demo-data-handler\";\nimport { useTranslation } from \"@/translations\";\n\nconst InvoiceForm = dynamic(\n  () =>\n    import(\"@/components/invoice-form\").then((mod) => ({\n      default: mod.InvoiceForm,\n    })),\n  {\n    ssr: false,\n    loading: () => (\n      <div className=\"space-y-6 animate-pulse\">\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n          <div className=\"h-24 bg-muted/60 rounded-lg\"></div>\n          <div className=\"h-24 bg-muted/60 rounded-lg\"></div>\n        </div>\n        <div className=\"h-20 bg-muted/60 rounded-lg\"></div>\n        <div className=\"h-48 bg-muted/60 rounded-lg\"></div>\n        <div className=\"h-10 bg-muted/60 rounded-lg\"></div>\n      </div>\n    ),\n  },\n);\n\ntype InputDataForDisplay = Pick<\n  CalculationInput,\n  \"startDate\" | \"endDate\" | \"includeEndDate\" | \"amounts\" | \"splitPeriod\"\n>;\n\ninterface InvoiceCalculatorClientProps {\n  pageTitle: string;\n}\n\nexport default function InvoiceCalculatorClient({\n  pageTitle,\n}: InvoiceCalculatorClientProps) {\n  const { t } = useTranslation();\n  const [mounted, setMounted] = useState(false);\n  const [calculationResult, setCalculationResult] =\n    useState<CalculationResult | null>(null);\n  const [calculationError, setCalculationError] = useState<string | null>(null);\n  const [storedInputData, setStoredInputData] =\n    useState<CalculationCallbackData>(null);\n  const [isSettingsOpen, setIsSettingsOpen] = useState(false);\n  const resultsSectionRef = useRef<HTMLDivElement>(null);\n\n  const { initialDemoData, handleDemoDataApplied } = useDemoDataHandler();\n\n  const gaMeasurementId = \"G-9H2KTHX5YK\";\n  const consentCookieName = \"siempiBillSplitterConsent\";\n  const [hasConsent, setHasConsent] = useState(false);\n\n  useEffect(() => {\n    return () => {\n      if (typeof window !== \"undefined\") {\n        const hasDemoData =\n          sessionStorage.getItem(\"billSplitterDemoData\") !== null;\n        const hasFormCache =\n          sessionStorage.getItem(\"invoiceFormDataCache\") !== null;\n\n        try {\n          sessionStorage.removeItem(\"invoiceFormDataCache\");\n          console.log(\n            \"[InvoiceCalculatorClient] Cleaned up sessionStorage on unmount\",\n            {\n              hadDemoData: hasDemoData,\n              hadFormCache: hasFormCache,\n            },\n          );\n        } catch (error) {\n          console.error(\n            \"[InvoiceCalculatorClient] Error clearing sessionStorage on unmount:\",\n            error,\n          );\n        }\n      }\n    };\n  }, []);\n\n  useEffect(() => {\n    setMounted(true);\n    const consentGiven = Cookies.get(consentCookieName) === \"true\";\n    setHasConsent(consentGiven);\n  }, []);\n\n  const handleCalculation = (\n    formData: CalculationCallbackData,\n    results: CalculationResult | null,\n    error?: CalculationErrorType,\n  ) => {\n    setCalculationResult(results);\n    const displayError = error ? handleCalculationError({ error, t }) : null;\n    setCalculationError(displayError);\n\n    if (formData && results && !displayError) {\n      setStoredInputData(formData);\n      setTimeout(() => {\n        requestAnimationFrame(() => {\n          if (resultsSectionRef.current) {\n            resultsSectionRef.current.scrollIntoView({\n              behavior: \"smooth\",\n              block: \"start\",\n            });\n          }\n        });\n      }, 200);\n    } else {\n      setStoredInputData(null);\n      if (displayError) {\n        setCalculationResult(null);\n      }\n    }\n  };\n\n  const description1 =\n    pageTitle === \"Rechnungsperioden-Rechner\"\n      ? \"Teilen Sie Rechnungen ber Geschftsjahre auf. Konform mit IFRS, HGB und OR  keine Anmeldung, keine Datenspeicherung. Einfach, schnell, przise.\"\n      : \"Split invoices across fiscal years. Stay compliant with IFRS, HGB, and OR  no login, no data storage. Simple, fast, precise.\";\n\n  const description2 =\n    pageTitle === \"Rechnungsperioden-Rechner\"\n      ? \"Ideal fr Buchhalter bei der Erstellung von Gewinn- und Verlustrechnungen und Bilanzen, fr Finanzfachleute bei der Budgetverwaltung oder fr alle, die eine klare finanzielle Aufschlsselung fr das Reporting bentigen.\"\n      : \"Ideal for accountants preparing income statements and balance sheets, financial professionals managing budgets, or anyone needing a clear financial breakdown for reporting.\";\n\n  return (\n    <>\n      {hasConsent && gaMeasurementId && (\n        <GoogleAnalytics gaId={gaMeasurementId} />\n      )}\n\n      <div className=\"container mx-auto px-4 py-8 max-w-4xl grow overflow-hidden w-full\">\n        <div className=\"text-center mb-8\">\n          <h1 className=\"text-3xl font-bold text-center mb-4\">{pageTitle}</h1>\n          <div className=\"max-w-2xl mx-auto space-y-2 px-4\">\n            <p>{mounted ? t(\"InvoiceForm.description_p1\") : description1}</p>\n            <p>{mounted ? t(\"InvoiceForm.description_p2\") : description2}</p>\n          </div>\n        </div>\n\n        {!mounted && (\n          <div className=\"flex items-center gap-2 justify-center text-muted-foreground text-sm mb-6\">\n            <Loader2 className=\"animate-spin h-4 w-4 text-primary\" />\n            <span>Loading calculator...</span>\n          </div>\n        )}\n\n        <div className=\"mx-auto\" style={{ maxWidth: \"768px\" }}>\n          <Card\n            className=\"mb-12 shadow-md w-full transition-opacity duration-300 ease-in-out\"\n            data-loaded={mounted ? \"true\" : \"false\"}\n            style={{ opacity: mounted ? 1 : 0.85 }}\n          >\n            <CardContent className=\"pt-6\">\n              <div className=\"w-full\">\n                <Suspense\n                  fallback={\n                    <div className=\"space-y-6 animate-pulse\">\n                      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                        <div className=\"h-24 bg-muted/60 rounded-lg\"></div>\n                        <div className=\"h-24 bg-muted/60 rounded-lg\"></div>\n                      </div>\n                      <div className=\"h-20 bg-muted/60 rounded-lg\"></div>\n                      <div className=\"h-48 bg-muted/60 rounded-lg\"></div>\n                      <div className=\"h-10 bg-muted/60 rounded-lg\"></div>\n                    </div>\n                  }\n                >\n                  <InvoiceForm\n                    onCalculateAction={handleCalculation}\n                    initialDemoData={initialDemoData}\n                    onDemoDataApplied={handleDemoDataApplied}\n                  />\n                </Suspense>\n              </div>\n            </CardContent>\n          </Card>\n\n          <div ref={resultsSectionRef} className=\"mt-12 w-full\">\n            {mounted && calculationError && (\n              <Alert variant=\"destructive\" className=\"w-full\">\n                <Terminal className=\"h-4 w-4\" />\n                <AlertTitle>{t(\"Errors.calculationErrorTitle\")}</AlertTitle>\n                <AlertDescription>\n                  {safeText(calculationError)}\n                </AlertDescription>\n              </Alert>\n            )}\n            {mounted &&\n              calculationResult &&\n              storedInputData &&\n              !calculationError && (\n                <ResultsDisplay\n                  results={calculationResult}\n                  inputData={storedInputData as InputDataForDisplay}\n                />\n              )}\n            {!mounted && calculationResult === null && (\n              <Card className=\"shadow-md w-full h-64 flex items-center justify-center\">\n                <div className=\"space-y-4 p-6 w-full\">\n                  <div className=\"h-6 bg-muted/60 rounded-md animate-pulse w-3/4 mx-auto mb-8\" />\n                  <div className=\"grid grid-cols-4 gap-4 mb-6\">\n                    <div className=\"h-4 bg-muted/60 rounded-sm animate-pulse\" />\n                    <div className=\"h-4 bg-muted/60 rounded-sm animate-pulse\" />\n                    <div className=\"h-4 bg-muted/60 rounded-sm animate-pulse\" />\n                    <div className=\"h-4 bg-muted/60 rounded-sm animate-pulse\" />\n                  </div>\n                  <div className=\"h-24 bg-muted/60 rounded-md animate-pulse\" />\n                </div>\n              </Card>\n            )}\n          </div>\n        </div>\n      </div>\n\n      {mounted && (\n        <SettingsModal\n          isOpen={isSettingsOpen}\n          onOpenChange={setIsSettingsOpen}\n        />\n      )}\n    </>\n  );\n}\n","import * as React from \"react\";\n\nimport { cn } from \"@/lib/utils\";\n\ninterface InputProps extends React.ComponentProps<\"input\"> {\n  helperText?: string;\n  error?: string;\n  id?: string;\n  onDoubleClick?: (e: React.MouseEvent<HTMLInputElement>) => void;\n}\n\nfunction Input(\n  {\n    className,\n    type,\n    helperText,\n    error,\n    id,\n    onDoubleClick,\n    ...props\n  }: InputProps,\n  ref: React.Ref<HTMLInputElement>,\n) {\n  const errorId = error ? `${id}-error` : undefined;\n\n  const handleDoubleClick = (e: React.MouseEvent<HTMLInputElement>) => {\n    e.currentTarget.select();\n\n    if (onDoubleClick) {\n      onDoubleClick(e);\n    }\n  };\n\n  return (\n    <div className=\"w-full\">\n      <input\n        id={id}\n        ref={ref}\n        type={type}\n        data-slot=\"input\"\n        aria-invalid={!!error}\n        aria-describedby={errorId}\n        onDoubleClick={handleDoubleClick}\n        className={cn(\n          \"flex h-10 w-full rounded-lg border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n          \"shadow-sm\",\n          \"selection:bg-primary selection:text-primary-foreground\",\n          error\n            ? \"border-destructive ring-destructive/40 focus-visible:ring-destructive\"\n            : \"\",\n          className,\n        )}\n        {...props}\n      />\n      {helperText && (\n        <p className=\"text-xs text-muted-foreground mt-1 mb-3 pl-3\">\n          {helperText}\n        </p>\n      )}\n      {error && (\n        <p id={errorId} role=\"alert\" className=\"form-error-message\">\n          {error}\n        </p>\n      )}\n    </div>\n  );\n}\n\nconst ForwardedInput = React.forwardRef(Input);\n\nexport { ForwardedInput as Input };\n","import * as React from \"react\";\n\n/**\n * VisuallyHidden component hides its children visually but keeps them accessible to screen readers.\n */\nfunction VisuallyHidden({ children }: { children: React.ReactNode }) {\n  return (\n    <span\n      className=\"absolute w-px h-px p-0 -m-px overflow-hidden whitespace-nowrap border-0\"\n      style={{ clip: \"rect(0, 0, 0, 0)\" }}\n    >\n      {children}\n    </span>\n  );\n}\n\nexport { VisuallyHidden };\n","import * as React from \"react\";\n\nimport { VisuallyHidden } from \"@/components/ui/visually-hidden\";\n\ninterface AccessibleIconProps {\n  label: string;\n  children: React.ReactNode;\n}\n\n/**\n * AccessibleIcon component wraps an icon and provides a visually hidden label for screen readers.\n */\nfunction AccessibleIcon({ label, children }: AccessibleIconProps) {\n  return (\n    <span className=\"inline-flex items-center justify-center\">\n      {children}\n      <VisuallyHidden>{label}</VisuallyHidden>\n    </span>\n  );\n}\n\nexport { AccessibleIcon };\n","\"use client\";\n\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\";\nimport * as React from \"react\";\n\nimport { AccessibleIcon } from \"@/components/ui/accessible-icon\";\nimport { XIcon } from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\n\nfunction Dialog({\n  ...props\n}: React.ComponentProps<typeof DialogPrimitive.Root>) {\n  return <DialogPrimitive.Root data-slot=\"dialog\" {...props} />;\n}\n\nfunction DialogTrigger({\n  ...props\n}: React.ComponentProps<typeof DialogPrimitive.Trigger>) {\n  return <DialogPrimitive.Trigger data-slot=\"dialog-trigger\" {...props} />;\n}\n\nfunction DialogPortal({\n  ...props\n}: React.ComponentProps<typeof DialogPrimitive.Portal>) {\n  return <DialogPrimitive.Portal data-slot=\"dialog-portal\" {...props} />;\n}\n\nfunction DialogClose({\n  ...props\n}: React.ComponentProps<typeof DialogPrimitive.Close>) {\n  return <DialogPrimitive.Close data-slot=\"dialog-close\" {...props} />;\n}\n\nfunction DialogOverlay({\n  className,\n  ...props\n}: React.ComponentProps<typeof DialogPrimitive.Overlay>) {\n  return (\n    <DialogPrimitive.Overlay\n      data-slot=\"dialog-overlay\"\n      className={cn(\n        \"data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 backdrop-blur-sm bg-black/30\",\n        className,\n      )}\n      {...props}\n    />\n  );\n}\n\nfunction DialogContent({\n  className,\n  children,\n  ...props\n}: React.ComponentProps<typeof DialogPrimitive.Content>) {\n  const [isMounted, setIsMounted] = React.useState(false);\n  const isMountedRef = React.useRef(true);\n\n  React.useEffect(() => {\n    isMountedRef.current = true;\n    const mountTimer = setTimeout(() => {\n      if (isMountedRef.current) {\n        setIsMounted(true);\n      }\n    }, 10);\n\n    return () => {\n      isMountedRef.current = false;\n      clearTimeout(mountTimer);\n    };\n  }, []);\n\n  if (!isMounted) {\n    return null;\n  }\n\n  return (\n    <DialogPortal data-slot=\"dialog-portal\">\n      <DialogOverlay />\n      <DialogPrimitive.Content\n        data-slot=\"dialog-content\"\n        className={cn(\n          \"bg-card data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-xl duration-200 sm:max-w-lg mx-auto\",\n          className,\n        )}\n        style={{ backgroundColor: \"hsl(var(--card))\", opacity: 1 }}\n        {...props}\n      >\n        {children}\n        <DialogPrimitive.Close\n          aria-label=\"Close dialog\"\n          className=\"ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-sm opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-none disabled:pointer-events-none cursor-pointer\"\n        >\n          <AccessibleIcon label=\"Close\">\n            <XIcon className=\"size-4\" />\n          </AccessibleIcon>\n        </DialogPrimitive.Close>\n      </DialogPrimitive.Content>\n    </DialogPortal>\n  );\n}\n\nfunction DialogHeader({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"dialog-header\"\n      className={cn(\"flex flex-col gap-2 text-center sm:text-left\", className)}\n      {...props}\n    />\n  );\n}\n\nfunction DialogFooter({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"dialog-footer\"\n      className={cn(\n        \"flex flex-col-reverse gap-2 sm:flex-row sm:justify-end\",\n        className,\n      )}\n      {...props}\n    />\n  );\n}\n\nfunction DialogTitle({\n  className,\n  ...props\n}: React.ComponentProps<typeof DialogPrimitive.Title>) {\n  return (\n    <DialogPrimitive.Title\n      data-slot=\"dialog-title\"\n      className={cn(\"text-lg leading-none font-semibold\", className)}\n      {...props}\n    />\n  );\n}\n\nfunction DialogDescription({\n  className,\n  ...props\n}: React.ComponentProps<typeof DialogPrimitive.Description>) {\n  return (\n    <DialogPrimitive.Description\n      data-slot=\"dialog-description\"\n      className={cn(\"text-muted-foreground text-sm\", className)}\n      {...props}\n    />\n  );\n}\n\nexport {\n  Dialog,\n  DialogClose,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogOverlay,\n  DialogPortal,\n  DialogTitle,\n  DialogTrigger,\n};\n","import * as React from \"react\";\n\nimport { cn } from \"@/lib/utils\";\n\nfunction Card({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"card\"\n      className={cn(\n        \"bg-card text-card-foreground flex flex-col gap-6 rounded-lg border py-6 shadow-sm\",\n        className,\n      )}\n      {...props}\n    />\n  );\n}\n\nfunction CardHeader({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"card-header\"\n      className={cn(\n        \"@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-2 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6\",\n        className,\n      )}\n      {...props}\n    />\n  );\n}\n\nfunction CardTitle({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"card-title\"\n      className={cn(\"leading-none font-semibold\", className)}\n      {...props}\n    />\n  );\n}\n\nfunction CardDescription({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"card-description\"\n      className={cn(\"text-muted-foreground text-sm\", className)}\n      {...props}\n    />\n  );\n}\n\nfunction CardAction({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"card-action\"\n      className={cn(\n        \"col-start-2 row-span-2 row-start-1 self-start justify-self-end\",\n        className,\n      )}\n      {...props}\n    />\n  );\n}\n\nfunction CardContent({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"card-content\"\n      className={cn(\"px-6\", className)}\n      {...props}\n    />\n  );\n}\n\nfunction CardFooter({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"card-footer\"\n      className={cn(\"flex items-center px-6 [.border-t]:pt-6\", className)}\n      {...props}\n    />\n  );\n}\n\nexport {\n  Card,\n  CardHeader,\n  CardFooter,\n  CardTitle,\n  CardAction,\n  CardDescription,\n  CardContent,\n};\n","\"use client\";\n\nimport * as React from \"react\";\nimport * as LabelPrimitive from \"@radix-ui/react-label\";\nimport { Slot } from \"@radix-ui/react-slot\";\nimport {\n  Controller,\n  FormProvider,\n  useFormContext,\n  useFormState,\n  type ControllerProps,\n  type FieldPath,\n  type FieldValues,\n} from \"react-hook-form\";\n\nimport { cn } from \"@/lib/utils\";\nimport { Label } from \"@/components/ui/label\";\n\nexport const Form = FormProvider;\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>,\n> = {\n  name: TName;\n};\n\nexport const FormFieldContext = React.createContext<FormFieldContextValue>(\n  {} as FormFieldContextValue,\n);\n\nexport const FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>,\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  );\n};\n\nexport const useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext);\n  const itemContext = React.useContext(FormItemContext);\n  const { getFieldState } = useFormContext();\n  const formState = useFormState({ name: fieldContext.name });\n  const fieldState = getFieldState(fieldContext.name, formState);\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\");\n  }\n\n  const { id } = itemContext;\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  };\n};\n\ntype FormItemContextValue = {\n  id: string;\n};\n\nexport const FormItemContext = React.createContext<FormItemContextValue>(\n  {} as FormItemContextValue,\n);\n\nexport function FormItem({ className, ...props }: React.ComponentProps<\"div\">) {\n  const id = React.useId();\n\n  return (\n    <FormItemContext.Provider value={{ id }}>\n      <div\n        data-slot=\"form-item\"\n        className={cn(\"grid gap-2\", className)}\n        {...props}\n      />\n    </FormItemContext.Provider>\n  );\n}\n\nfunction FormLabelInternal({\n  fieldContext,\n  itemContext,\n  className,\n  htmlFor: explicitHtmlFor,\n  ...props\n}: React.ComponentProps<typeof LabelPrimitive.Root> & {\n  fieldContext: FormFieldContextValue;\n  itemContext: FormItemContextValue;\n  htmlFor?: string;\n}) {\n  const { getFieldState } = useFormContext();\n  const formState = useFormState({ name: fieldContext.name });\n  const fieldState = getFieldState(fieldContext.name, formState);\n\n  const formItemId = `${itemContext.id}-form-item`;\n  const hasError = !!fieldState.error;\n  const derivedHtmlFor = explicitHtmlFor || formItemId;\n\n  return (\n    <Label\n      data-slot=\"form-label\"\n      data-error={hasError}\n      className={cn(\"data-[error=true]:text-destructive\", className)}\n      htmlFor={derivedHtmlFor}\n      {...props}\n    />\n  );\n}\n\nexport function FormLabel({\n  className,\n  htmlFor,\n  ...props\n}: React.ComponentProps<typeof LabelPrimitive.Root>) {\n  const fieldContext = React.useContext(FormFieldContext);\n  const itemContext = React.useContext(FormItemContext);\n\n  const hasContext =\n    fieldContext &&\n    Object.keys(fieldContext).length > 0 &&\n    itemContext &&\n    itemContext.id;\n\n  if (hasContext) {\n    return (\n      <FormLabelInternal\n        fieldContext={fieldContext}\n        itemContext={itemContext}\n        className={className}\n        htmlFor={htmlFor}\n        {...props}\n      />\n    );\n  }\n\n  return (\n    <Label\n      data-slot=\"form-label\"\n      data-error={false}\n      className={cn(\"data-[error=true]:text-destructive\", className)}\n      htmlFor={htmlFor}\n      {...props}\n    />\n  );\n}\n\nexport function FormControl({ ...props }: React.ComponentProps<typeof Slot>) {\n  const { error, formItemId, formDescriptionId, formMessageId } =\n    useFormField();\n\n  return (\n    <Slot\n      data-slot=\"form-control\"\n      id={formItemId}\n      aria-describedby={\n        !error\n          ? `${formDescriptionId}`\n          : `${formDescriptionId} ${formMessageId}`\n      }\n      aria-invalid={!!error}\n      {...props}\n    />\n  );\n}\n\nexport function FormDescription({\n  className,\n  ...props\n}: React.ComponentProps<\"p\">) {\n  const { formDescriptionId } = useFormField();\n\n  return (\n    <p\n      data-slot=\"form-description\"\n      id={formDescriptionId}\n      className={cn(\"text-muted-foreground text-sm\", className)}\n      {...props}\n    />\n  );\n}\n\nexport function FormMessage({\n  className,\n  ...props\n}: React.ComponentProps<\"p\">) {\n  const { error, formMessageId } = useFormField();\n  const body = error ? String(error?.message ?? \"\") : props.children;\n\n  if (!body) {\n    return null;\n  }\n\n  return (\n    <p\n      data-slot=\"form-message\"\n      id={formMessageId}\n      className={cn(\"form-error-message\", className)}\n      {...props}\n    >\n      {body}\n    </p>\n  );\n}\n","\"use client\";\n\nimport * as React from \"react\";\nimport * as SelectPrimitive from \"@radix-ui/react-select\";\n\nimport { CheckIcon, ChevronDownIcon, ChevronUpIcon } from \"lucide-react\";\n\nimport { cn } from \"@/lib/utils\";\n\nfunction Select({\n  ...props\n}: React.ComponentProps<typeof SelectPrimitive.Root>) {\n  return <SelectPrimitive.Root data-slot=\"select\" {...props} />;\n}\n\nfunction SelectGroup({\n  ...props\n}: React.ComponentProps<typeof SelectPrimitive.Group>) {\n  return <SelectPrimitive.Group data-slot=\"select-group\" {...props} />;\n}\n\nfunction SelectValue({\n  ...props\n}: React.ComponentProps<typeof SelectPrimitive.Value>) {\n  return <SelectPrimitive.Value data-slot=\"select-value\" {...props} />;\n}\n\nfunction SelectTrigger({\n  className,\n  size = \"default\",\n  children,\n  id,\n  name,\n  ...props\n}: React.ComponentProps<typeof SelectPrimitive.Trigger> & {\n  size?: \"sm\" | \"default\";\n  id?: string;\n  name?: string;\n}) {\n  return (\n    <SelectPrimitive.Trigger\n      data-slot=\"select-trigger\"\n      data-size={size}\n      id={id}\n      name={name}\n      className={cn(\n        \"border-input data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 dark:hover:bg-input/50 flex w-fit items-center justify-between gap-2 rounded-md border bg-transparent px-3 py-2 text-sm whitespace-nowrap shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 data-[size=default]:h-9 data-[size=sm]:h-8 *:data-[slot=select-value]:line-clamp-1 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4\",\n        className,\n      )}\n      {...props}\n    >\n      {children}\n      <SelectPrimitive.Icon asChild>\n        <ChevronDownIcon className=\"size-4 opacity-50\" />\n      </SelectPrimitive.Icon>\n    </SelectPrimitive.Trigger>\n  );\n}\n\nfunction SelectContent({\n  className,\n  children,\n  position = \"popper\",\n  ...props\n}: React.ComponentProps<typeof SelectPrimitive.Content>) {\n  return (\n    <SelectPrimitive.Portal>\n      <SelectPrimitive.Content\n        data-slot=\"select-content\"\n        className={cn(\n          \"bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 relative z-[9999] min-w-[8rem] rounded-md border shadow-md\",\n          position === \"popper\" &&\n            \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n          className,\n        )}\n        style={{ backgroundColor: \"hsl(var(--popover))\", opacity: 1 }}\n        position=\"popper\"\n        sideOffset={5}\n        avoidCollisions={true}\n        collisionPadding={20}\n        {...props}\n      >\n        <SelectScrollUpButton />\n        <SelectPrimitive.Viewport\n          className={cn(\n            \"p-1 h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)] overflow-y-auto\",\n            position === \"popper\"\n              ? \"max-h-[var(--radix-select-content-available-height)]\"\n              : \"max-h-[200px]\",\n          )}\n        >\n          {children}\n        </SelectPrimitive.Viewport>\n        <SelectScrollDownButton />\n      </SelectPrimitive.Content>\n    </SelectPrimitive.Portal>\n  );\n}\n\nfunction SelectLabel({\n  className,\n  ...props\n}: React.ComponentProps<typeof SelectPrimitive.Label>) {\n  return (\n    <SelectPrimitive.Label\n      data-slot=\"select-label\"\n      className={cn(\"text-muted-foreground px-2 py-1.5 text-xs\", className)}\n      {...props}\n    />\n  );\n}\n\nfunction SelectItem({\n  className,\n  children,\n  id,\n  value,\n  ...props\n}: React.ComponentProps<typeof SelectPrimitive.Item> & { key?: React.Key }) {\n  const { key, ...restProps } = props;\n\n  return (\n    <SelectPrimitive.Item\n      key={key}\n      data-slot=\"select-item\"\n      id={id || (value ? `select-item-${value}` : undefined)}\n      className={cn(\n        \"select-item relative flex w-full cursor-pointer items-center gap-2 rounded-sm py-1.5 pr-8 pl-2 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n        className,\n      )}\n      value={value}\n      {...restProps}\n    >\n      <span className=\"absolute right-2 flex size-3.5 items-center justify-center\">\n        <SelectPrimitive.ItemIndicator>\n          <CheckIcon className=\"size-4\" />\n        </SelectPrimitive.ItemIndicator>\n      </span>\n      <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n    </SelectPrimitive.Item>\n  );\n}\n\nfunction SelectSeparator({\n  className,\n  ...props\n}: React.ComponentProps<typeof SelectPrimitive.Separator>) {\n  return (\n    <SelectPrimitive.Separator\n      data-slot=\"select-separator\"\n      className={cn(\"bg-border pointer-events-none -mx-1 my-1 h-px\", className)}\n      {...props}\n    />\n  );\n}\n\nfunction SelectScrollUpButton({\n  className,\n  ...props\n}: React.ComponentProps<typeof SelectPrimitive.ScrollUpButton>) {\n  return (\n    <SelectPrimitive.ScrollUpButton\n      data-slot=\"select-scroll-up-button\"\n      className={cn(\n        \"flex cursor-default items-center justify-center py-1\",\n        className,\n      )}\n      {...props}\n    >\n      <ChevronUpIcon className=\"size-4\" />\n    </SelectPrimitive.ScrollUpButton>\n  );\n}\n\nfunction SelectScrollDownButton({\n  className,\n  ...props\n}: React.ComponentProps<typeof SelectPrimitive.ScrollDownButton>) {\n  return (\n    <SelectPrimitive.ScrollDownButton\n      data-slot=\"select-scroll-down-button\"\n      className={cn(\n        \"flex cursor-default items-center justify-center py-1\",\n        className,\n      )}\n      {...props}\n    >\n      <ChevronDownIcon className=\"size-4\" />\n    </SelectPrimitive.ScrollDownButton>\n  );\n}\n\nexport {\n  Select,\n  SelectContent,\n  SelectGroup,\n  SelectItem,\n  SelectLabel,\n  SelectScrollDownButton,\n  SelectScrollUpButton,\n  SelectSeparator,\n  SelectTrigger,\n  SelectValue,\n};\n","// Add ESLint disable comments for unused imports that are kept for future use\n\nimport {\n  CalculationError,\n  CalculationProcessingError,\n  ERROR_CODES,\n  InputValidationError,\n} from \"./errors\";\nimport {\n  addDays,\n  differenceInDays,\n  endOfMonth,\n  endOfQuarter,\n  endOfYear,\n  format,\n  getQuarter,\n  getYear,\n  startOfDay,\n} from \"date-fns\";\n\nimport { roundToDecimals } from \"./utils\";\n\n// Re-export error types so they can be imported from calculations.ts\nexport {\n  CalculationError,\n  CalculationProcessingError,\n  InputValidationError,\n  ERROR_CODES,\n} from \"./errors\";\n\n// Helper function for rounding to a specific number of decimal places\n// REMOVED: Replaced with centralized utility function roundToDecimals\n// function round(value: number, decimals: number): number {\n//   return Number(Math.round(Number(value + \"e\" + decimals)) + \"e-\" + decimals);\n// }\n\n// Updated Input: Accepts an array of amounts and split period type\nexport interface CalculationInput {\n  startDate: Date;\n  endDate: Date;\n  includeEndDate: boolean;\n  amounts: number[]; // Array of amounts to be summed and split\n  splitPeriod?: \"yearly\" | \"quarterly\" | \"monthly\"; // Replaced daily with monthly\n}\n\n// Represents the split portion of a SINGLE original amount for a specific period (year, quarter, or day)\ninterface SingleAmountPeriodSplit {\n  splitAmount: number; // Rounded split portion for this period\n}\n\n// Represents the split results for ONE original input amount across all periods\nexport interface AmountSplitResult {\n  originalAmount: number;\n  adjustedTotalAmount: number; // Sum of splits for this amount after adjustment\n  splits: { [periodIdentifier: string]: SingleAmountPeriodSplit }; // Map period identifier (YYYY, YYYY-Qn, YYYY-MM) to its split portion\n}\n\n// Represents the aggregated results per period across ALL input amounts\nexport interface AggregatedPeriodSplit {\n  periodIdentifier: string; // YYYY, YYYY-Qn, or YYYY-MM\n  daysInPeriod: number;\n  proportion: number;\n  totalSplitAmount: number; // Sum of all individual amount splits for this period\n  year?: number; // For backwards compatibility with tests\n  daysInYear?: number; // For backwards compatibility with tests\n}\n\n// Updated CalculationResult structure\nexport interface CalculationResult {\n  totalDays: number;\n  originalTotalAmount: number; // Sum of all input amounts\n  adjustedTotalAmount: number; // Sum of all adjusted split amounts\n  resultsPerAmount: AmountSplitResult[]; // Detailed results for each input amount\n  aggregatedSplits: AggregatedPeriodSplit[]; // Aggregated results per period\n  calculationSteps: CalculationStepDetails;\n  splitPeriodUsed: \"yearly\" | \"quarterly\" | \"monthly\"; // Replaced daily with monthly\n}\n\n// --- Helper for structuring calculation steps ---\nexport interface CalculationStepDetails {\n  totalDuration: {\n    days: number;\n    start: string;\n    end: string;\n    included: boolean;\n  };\n  periodSegments: {\n    periodIdentifier: string;\n    days: number;\n    proportion: number;\n  }[]; // Renamed from yearSegments\n  amountCalculations: {\n    originalAmount: number;\n    periodSplits: {\n      // Renamed from yearSplits\n      periodIdentifier: string;\n      rawSplit: number;\n      roundedSplit: number;\n      adjustment: number;\n    }[];\n    adjustmentAppliedToPeriod?: string; // Renamed from adjustmentAppliedToYear\n    discrepancy: number;\n    finalSum: number;\n  }[];\n  error?: string | CalculationError;\n}\n// --- End Helper ---\n\n// New return types for calculateInvoiceSplit\ninterface CalculateInvoiceSplitSuccess\n  extends Omit<CalculationResult, \"calculationSteps\"> {\n  success: true;\n  calculationSteps: Omit<CalculationStepDetails, \"error\"> & {\n    error?: undefined;\n  };\n}\n\ninterface CalculateInvoiceSplitFailure {\n  success: false;\n  error: CalculationError;\n  calculationSteps: CalculationStepDetails; // Contains the error details\n  originalTotalAmount: number;\n  splitPeriodUsed: \"yearly\" | \"quarterly\" | \"monthly\";\n  // Minimal fields for consistency with createErrorResult's context\n  totalDays: 0;\n  adjustedTotalAmount: 0;\n  resultsPerAmount: [];\n  aggregatedSplits: [];\n}\n\nexport type CalculateInvoiceSplitReturnType =\n  | CalculateInvoiceSplitSuccess\n  | CalculateInvoiceSplitFailure;\n\n// Helper function to get the end of the next period based on the type\nfunction getNextPeriodBoundary(\n  currentDate: Date,\n  periodType: \"yearly\" | \"quarterly\" | \"monthly\",\n): Date {\n  switch (periodType) {\n    case \"monthly\":\n      return startOfDay(addDays(endOfMonth(currentDate), 1));\n    case \"quarterly\":\n      return startOfDay(addDays(endOfQuarter(currentDate), 1));\n    case \"yearly\":\n    default:\n      return startOfDay(addDays(endOfYear(currentDate), 1));\n  }\n}\n\n// Helper function to generate a period identifier string\nfunction getPeriodIdentifier(\n  date: Date,\n  periodType: \"yearly\" | \"quarterly\" | \"monthly\",\n): string {\n  const year = getYear(date);\n  switch (periodType) {\n    case \"monthly\":\n      return format(date, \"yyyy-MM\");\n    case \"quarterly\":\n      const quarter = getQuarter(date);\n      return `${year}-Q${quarter}`;\n    case \"yearly\":\n    default:\n      return year.toString();\n  }\n}\n\n/**\n * Calculates the proportional split of invoice amounts across specified periods.\n * Applies rounding and adjustment for precision.\n *\n * @throws {InputValidationError} When input data is invalid\n * @throws {CalculationProcessingError} When calculation can't be completed successfully\n */\nexport function calculateInvoiceSplit(\n  input: CalculationInput,\n): CalculateInvoiceSplitReturnType {\n  const splitPeriod = input.splitPeriod || \"yearly\"; // Default to yearly if not provided\n  const calcSteps: CalculationStepDetails = {\n    totalDuration: {\n      days: 0,\n      start: \"\",\n      end: \"\",\n      included: input.includeEndDate,\n    },\n    periodSegments: [], // Renamed\n    amountCalculations: [],\n  };\n\n  // Validate inputs with clear error messages\n  if (!input.amounts || input.amounts.length === 0) {\n    const error = new InputValidationError(\n      \"At least one invoice amount is required.\",\n      ERROR_CODES.NO_AMOUNTS,\n    );\n    calcSteps.error = error;\n    return {\n      success: false,\n      error: error,\n      calculationSteps: calcSteps,\n      originalTotalAmount: 0, // No amounts processed yet\n      splitPeriodUsed: splitPeriod,\n      totalDays: 0,\n      adjustedTotalAmount: 0,\n      resultsPerAmount: [],\n      aggregatedSplits: [],\n    };\n  }\n\n  if (input.amounts.some((a) => isNaN(a) || a === null || a <= 0)) {\n    const invalidAmounts = input.amounts.filter(\n      (a) => isNaN(a) || a === null || a <= 0,\n    );\n    const error = new InputValidationError(\n      \"All amounts must be valid positive numbers.\",\n      ERROR_CODES.INVALID_AMOUNT,\n      { invalidAmounts },\n    );\n    calcSteps.error = error;\n    return {\n      success: false,\n      error: error,\n      calculationSteps: calcSteps,\n      originalTotalAmount: 0, // Or sum of amounts if calculated before this check\n      splitPeriodUsed: splitPeriod,\n      totalDays: 0,\n      adjustedTotalAmount: 0,\n      resultsPerAmount: [],\n      aggregatedSplits: [],\n    };\n  }\n\n  const originalTotalAmount = roundToDecimals(\n    input.amounts.reduce((sum, a) => sum + a, 0),\n    2,\n  );\n\n  // Start date and end date validation\n  if (\n    !input.startDate ||\n    !input.endDate ||\n    !(input.startDate instanceof Date) ||\n    !(input.endDate instanceof Date)\n  ) {\n    const error = new InputValidationError(\n      \"Valid start and end dates are required.\",\n      ERROR_CODES.INVALID_DATES,\n      { startDate: input.startDate, endDate: input.endDate },\n    );\n    calcSteps.error = error;\n    return {\n      success: false,\n      error: error,\n      calculationSteps: calcSteps,\n      originalTotalAmount: originalTotalAmount,\n      splitPeriodUsed: splitPeriod,\n      totalDays: 0,\n      adjustedTotalAmount: 0,\n      resultsPerAmount: [],\n      aggregatedSplits: [],\n    };\n  }\n\n  const cleanStartDate = startOfDay(input.startDate);\n  let cleanEffectiveEndDate = startOfDay(input.endDate);\n  if (input.includeEndDate) {\n    cleanEffectiveEndDate = addDays(cleanEffectiveEndDate, 1);\n  }\n  calcSteps.totalDuration.start = format(cleanStartDate, \"yyyy-MM-dd\");\n  // Use original end date for display if included, otherwise the day before effective end\n  calcSteps.totalDuration.end = format(\n    input.includeEndDate ? input.endDate : addDays(cleanEffectiveEndDate, -1),\n    \"yyyy-MM-dd\",\n  );\n\n  if (cleanStartDate >= cleanEffectiveEndDate) {\n    const error = new InputValidationError(\n      \"Start date must be before the end date.\",\n      ERROR_CODES.END_BEFORE_START,\n      {\n        startDate: format(cleanStartDate, \"yyyy-MM-dd\"),\n        endDate: format(cleanEffectiveEndDate, \"yyyy-MM-dd\"),\n        includeEndDate: input.includeEndDate,\n      },\n    );\n    calcSteps.error = error;\n    return {\n      success: false,\n      error: error,\n      calculationSteps: calcSteps,\n      originalTotalAmount: originalTotalAmount,\n      splitPeriodUsed: splitPeriod,\n      totalDays: 0,\n      adjustedTotalAmount: 0,\n      resultsPerAmount: [],\n      aggregatedSplits: [],\n    };\n  }\n\n  const totalDurationDays = differenceInDays(\n    cleanEffectiveEndDate,\n    cleanStartDate,\n  );\n  calcSteps.totalDuration.days = totalDurationDays;\n\n  if (totalDurationDays <= 0) {\n    const error = new InputValidationError(\n      \"The date range must result in a positive duration.\",\n      ERROR_CODES.ZERO_DURATION,\n      {\n        startDate: format(cleanStartDate, \"yyyy-MM-dd\"),\n        endDate: format(cleanEffectiveEndDate, \"yyyy-MM-dd\"),\n        calculatedDays: totalDurationDays,\n      },\n    );\n    calcSteps.error = error;\n    return {\n      success: false,\n      error: error,\n      calculationSteps: calcSteps,\n      originalTotalAmount: originalTotalAmount,\n      splitPeriodUsed: splitPeriod,\n      totalDays: 0,\n      adjustedTotalAmount: 0,\n      resultsPerAmount: [],\n      aggregatedSplits: [],\n    };\n  }\n\n  try {\n    // --- Calculate days and proportions per period segment ---\n    const periodSegmentMap: {\n      [periodIdentifier: string]: { days: number; proportion: number };\n    } = {};\n    let currentDate = cleanStartDate;\n    while (currentDate < cleanEffectiveEndDate) {\n      const periodIdentifier = getPeriodIdentifier(currentDate, splitPeriod);\n      const nextPeriodBoundary = getNextPeriodBoundary(\n        currentDate,\n        splitPeriod,\n      );\n      const segmentEndDate =\n        cleanEffectiveEndDate < nextPeriodBoundary\n          ? cleanEffectiveEndDate\n          : nextPeriodBoundary;\n      const daysInSegment = differenceInDays(segmentEndDate, currentDate);\n\n      if (daysInSegment > 0) {\n        const proportion = daysInSegment / totalDurationDays;\n        if (!periodSegmentMap[periodIdentifier]) {\n          periodSegmentMap[periodIdentifier] = { days: 0, proportion: 0 };\n        }\n        periodSegmentMap[periodIdentifier].days += daysInSegment;\n        periodSegmentMap[periodIdentifier].proportion += proportion;\n      }\n      currentDate = segmentEndDate;\n    }\n    // Store period segment details for calculation steps display\n    calcSteps.periodSegments = Object.entries(periodSegmentMap)\n      .map(([identifier, data]) => ({\n        periodIdentifier: identifier,\n        days: data.days,\n        proportion: data.proportion,\n      }))\n      // Custom sort needed: Year > Quarter > Month\n      .sort((a, b) => {\n        // Sort YYYY, YYYY-Qn, YYYY-MM correctly\n        return a.periodIdentifier.localeCompare(b.periodIdentifier);\n      });\n    // --- End Segment Calculation ---\n\n    const resultsPerAmount: AmountSplitResult[] = [];\n\n    // --- Process each amount individually ---\n    for (const amount of input.amounts) {\n      const amountCalcStep: CalculationStepDetails[\"amountCalculations\"][0] = {\n        originalAmount: amount,\n        periodSplits: [], // Renamed\n        discrepancy: 0,\n        finalSum: 0,\n      };\n\n      const rawSplits: { periodIdentifier: string; rawSplit: number }[] = [];\n      for (const identifier in periodSegmentMap) {\n        const segment = periodSegmentMap[identifier];\n        const rawSplitAmount = amount * segment.proportion;\n        rawSplits.push({\n          periodIdentifier: identifier,\n          rawSplit: rawSplitAmount,\n        });\n        amountCalcStep.periodSplits.push({\n          periodIdentifier: identifier,\n          rawSplit: rawSplitAmount,\n          roundedSplit: 0,\n          adjustment: 0,\n        }); // Initialize step details\n      }\n\n      // Round initial splits for this amount\n      const roundedSplits = rawSplits.map((split) => ({\n        ...split,\n        roundedSplit: roundToDecimals(split.rawSplit, 2),\n      }));\n\n      // Update steps with rounded values\n      roundedSplits.forEach((rs) => {\n        const step = amountCalcStep.periodSplits.find(\n          (s) => s.periodIdentifier === rs.periodIdentifier,\n        );\n        if (step) step.roundedSplit = rs.roundedSplit;\n      });\n\n      // Calculate discrepancy for this amount\n      const currentTotal = roundToDecimals(\n        roundedSplits.reduce((sum, s) => sum + s.roundedSplit, 0),\n        2,\n      );\n      const discrepancy = roundToDecimals(amount - currentTotal, 2);\n      amountCalcStep.discrepancy = discrepancy;\n\n      // Apply rounding adjustment to the period with the largest raw amount\n      if (discrepancy !== 0 && roundedSplits.length > 0) {\n        // Find the period with the max *raw* split amount to minimize impact of rounding intermediate values\n        const periodToAdjustDetails = rawSplits.reduce((max, current) =>\n          Math.abs(current.rawSplit) > Math.abs(max.rawSplit) ? current : max,\n        );\n        const periodIdentifierToAdjust = periodToAdjustDetails.periodIdentifier;\n\n        // Find the corresponding entry in roundedSplits to apply the adjustment\n        const splitToAdjust = roundedSplits.find(\n          (s) => s.periodIdentifier === periodIdentifierToAdjust,\n        );\n        if (splitToAdjust) {\n          splitToAdjust.roundedSplit = roundToDecimals(\n            splitToAdjust.roundedSplit + discrepancy,\n            2,\n          );\n\n          // Update calculation steps with the adjustment detail\n          const step = amountCalcStep.periodSplits.find(\n            (s) => s.periodIdentifier === periodIdentifierToAdjust,\n          );\n          if (step) {\n            step.roundedSplit = splitToAdjust.roundedSplit; // Ensure step reflects adjusted rounded value\n            step.adjustment = discrepancy;\n          }\n          amountCalcStep.adjustmentAppliedToPeriod = periodIdentifierToAdjust;\n        } else {\n          throw new CalculationProcessingError(\n            \"Calculation error: Unable to apply rounding adjustment.\",\n            ERROR_CODES.ROUNDING_ERROR,\n            { discrepancy, periodToAdjust: periodIdentifierToAdjust },\n          );\n        }\n      }\n\n      // Store final splits for this amount\n      const finalAmountSplits: {\n        [periodIdentifier: string]: SingleAmountPeriodSplit;\n      } = {};\n      roundedSplits.forEach((s) => {\n        finalAmountSplits[s.periodIdentifier] = { splitAmount: s.roundedSplit };\n      });\n\n      const adjustedTotalForThisAmount = roundToDecimals(\n        roundedSplits.reduce((sum, s) => sum + s.roundedSplit, 0),\n        2,\n      );\n      amountCalcStep.finalSum = adjustedTotalForThisAmount;\n\n      resultsPerAmount.push({\n        originalAmount: amount,\n        adjustedTotalAmount: adjustedTotalForThisAmount,\n        splits: finalAmountSplits,\n      });\n      calcSteps.amountCalculations.push(amountCalcStep);\n    }\n    // --- End Amount Processing ---\n\n    // --- Aggregate results per period ---\n    const aggregatedSplits: AggregatedPeriodSplit[] = Object.entries(\n      periodSegmentMap,\n    )\n      .map(([identifier, segment]) => {\n        const periodIdentifier = identifier;\n        let totalSplitForPeriod = 0;\n        resultsPerAmount.forEach((amountResult) => {\n          totalSplitForPeriod +=\n            amountResult.splits[periodIdentifier]?.splitAmount || 0;\n        });\n        \n        // Extract year from periodIdentifier (format is YYYY, YYYY-Qn, or YYYY-MM)\n        const yearString = periodIdentifier.split(\"-\")[0];\n        const year = parseInt(yearString, 10);\n        \n        return {\n          periodIdentifier: periodIdentifier,\n          daysInPeriod: segment.days,\n          proportion: segment.proportion,\n          totalSplitAmount: roundToDecimals(totalSplitForPeriod, 2),\n          year: year, // For backward compatibility with tests\n          daysInYear: segment.days, // For backward compatibility with tests\n        };\n      })\n      // Use the same sort as periodSegments\n      .sort((a, b) => a.periodIdentifier.localeCompare(b.periodIdentifier));\n    // --- End Aggregation ---\n\n    const finalAdjustedTotalAmount = roundToDecimals(\n      aggregatedSplits.reduce((sum, s) => sum + s.totalSplitAmount, 0),\n      2,\n    );\n\n    // Final sanity check: does adjusted total match original total?\n    const finalDiscrepancy = roundToDecimals(\n      originalTotalAmount - finalAdjustedTotalAmount,\n      2,\n    );\n    if (Math.abs(finalDiscrepancy) > 0.01 * input.amounts.length) {\n      // Allow small tolerance per amount\n      console.warn(\n        `Potential rounding discrepancy: Original ${originalTotalAmount}, Adjusted ${finalAdjustedTotalAmount}, Diff ${finalDiscrepancy}`,\n      );\n      // Do not throw here, but we could add a warning to the result\n    }\n\n    // MODIFIED: Ensure calcSteps.error is undefined for success case\n    const successCalcSteps: Omit<CalculationStepDetails, \"error\"> & {\n      error?: undefined;\n    } = { ...calcSteps, error: undefined };\n\n    return {\n      success: true,\n      totalDays: totalDurationDays,\n      originalTotalAmount: originalTotalAmount,\n      adjustedTotalAmount: finalAdjustedTotalAmount,\n      resultsPerAmount: resultsPerAmount,\n      aggregatedSplits: aggregatedSplits,\n      calculationSteps: successCalcSteps,\n      splitPeriodUsed: splitPeriod,\n    };\n  } catch (error) {\n    // Handle unexpected errors or re-throw known errors\n    let caughtError: CalculationError;\n    if (error instanceof CalculationError) {\n      caughtError = error;\n    } else {\n      // Convert unknown errors to CalculationError\n      caughtError = new CalculationProcessingError(\n        error instanceof Error\n          ? error.message\n          : \"An unexpected error occurred during calculation.\",\n        ERROR_CODES.UNEXPECTED_ERROR,\n        { originalError: error },\n      );\n    }\n    calcSteps.error = caughtError; // Ensure calcSteps has the error for the failure object\n\n    // MODIFIED: Return CalculateInvoiceSplitFailure\n    return {\n      success: false,\n      error: caughtError,\n      calculationSteps: calcSteps,\n      originalTotalAmount: originalTotalAmount,\n      splitPeriodUsed: splitPeriod,\n      totalDays: 0,\n      adjustedTotalAmount: 0,\n      resultsPerAmount: [],\n      aggregatedSplits: [],\n    };\n  }\n}\n","\"use client\";\n\nimport * as React from \"react\";\nimport * as LabelPrimitive from \"@radix-ui/react-label\";\n\nimport { cn } from \"@/lib/utils\";\n\nfunction Label({\n  className,\n  ...props\n}: React.ComponentProps<typeof LabelPrimitive.Root>) {\n  return (\n    <LabelPrimitive.Root\n      data-slot=\"label\"\n      className={cn(\n        \"flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50\",\n        className,\n      )}\n      {...props}\n    />\n  );\n}\n\nexport { Label };\n","/**\n * Custom error classes for the application\n * These classes provide structured error handling with error codes and categorization\n */\n\n/**\n * Base calculation error class that all specific calculation errors inherit from\n */\nexport class CalculationError extends Error {\n  code: string;\n  category: \"input\" | \"calculation\" | \"system\";\n  details?: Record<string, unknown>;\n\n  constructor(\n    message: string,\n    code: string,\n    category: \"input\" | \"calculation\" | \"system\" = \"calculation\",\n    details?: Record<string, unknown>,\n  ) {\n    super(message);\n    this.name = \"CalculationError\";\n    this.code = code;\n    this.category = category;\n    this.details = details;\n\n    // This is needed for instanceof to work properly with custom errors\n    Object.setPrototypeOf(this, CalculationError.prototype);\n  }\n}\n\n/**\n * Error for invalid input data\n */\nexport class InputValidationError extends CalculationError {\n  constructor(\n    message: string,\n    code: string,\n    details?: Record<string, unknown>,\n  ) {\n    super(message, code, \"input\", details);\n    this.name = \"InputValidationError\";\n\n    // This is needed for instanceof to work properly with custom errors\n    Object.setPrototypeOf(this, InputValidationError.prototype);\n  }\n}\n\n/**\n * Error that occurs during calculation processing\n */\nexport class CalculationProcessingError extends CalculationError {\n  constructor(\n    message: string,\n    code: string,\n    details?: Record<string, unknown>,\n  ) {\n    super(message, code, \"calculation\", details);\n    this.name = \"CalculationProcessingError\";\n\n    // This is needed for instanceof to work properly with custom errors\n    Object.setPrototypeOf(this, CalculationProcessingError.prototype);\n  }\n}\n\n/**\n * System-level errors (unexpected failures)\n */\nexport class SystemError extends CalculationError {\n  constructor(\n    message: string,\n    code: string,\n    details?: Record<string, unknown>,\n  ) {\n    super(message, code, \"system\", details);\n    this.name = \"SystemError\";\n\n    // This is needed for instanceof to work properly with custom errors\n    Object.setPrototypeOf(this, SystemError.prototype);\n  }\n}\n\n// Error codes for consistent identification\nexport const ERROR_CODES = {\n  // Input validation error codes\n  NO_AMOUNTS: \"ERR_NO_AMOUNTS\",\n  INVALID_AMOUNT: \"ERR_INVALID_AMOUNT\",\n  INVALID_DATES: \"ERR_INVALID_DATES\",\n  END_BEFORE_START: \"ERR_END_BEFORE_START\",\n  ZERO_DURATION: \"ERR_ZERO_DURATION\",\n\n  // Calculation processing error codes\n  ROUNDING_ERROR: \"ERR_ROUNDING\",\n  PERIOD_ALLOCATION_ERROR: \"ERR_PERIOD_ALLOCATION\",\n\n  // System error codes\n  UNEXPECTED_ERROR: \"ERR_UNEXPECTED\",\n};\n","\"use client\";\n\nimport { Loader2 } from \"lucide-react\";\nimport React from \"react\";\nimport { useTranslation } from \"@/translations\";\n\nexport default function Loading() {\n  const { t } = useTranslation();\n\n  return (\n    <div className=\"flex items-center gap-2 justify-center text-muted-foreground text-sm py-6\">\n      <Loader2 className=\"animate-spin h-4 w-4 text-primary\" />\n      <span>{t(\"General.loading\", \"Loading calculator...\")}</span>\n    </div>\n  );\n}\n"],"names":["createUTCDate","dateStr","Date","parseDate","formats","includes","date","isValid","format","formatPattern","parsedDate","parse","formatDateForDisplay","locale","dateObj","Intl","DateTimeFormat","year","month","day","timeZone","error","console","match","toISOString","split","AppSeoContent","mounted","setMounted","useState","pathname","usePathname","isAppPage","isGerman","useEffect","div","className","script","type","dangerouslySetInnerHTML","__html","JSON","stringify","name","applicationCategory","operatingSystem","offers","price","priceCurrency","description","Accordion","props","AccordionPrimitive","data-slot","AccordionItem","cn","AccordionTrigger","children","ChevronDownIcon","AccordionContent","SETTINGS_STORAGE_KEY","decimalPlaces","roundingPrecision","thousandsSeparator","loadSettings","savedSettings","localStorage","getItem","DEFAULT_SETTINGS","safeJsonParse","parsed","warn","SettingsContext","createContext","undefined","SettingsProvider","settings","setSettings","isLoaded","setIsLoaded","loadedSettings","Provider","value","saveSettings","updatedSettings","newSettings","saveSettingsToStorage","currentSettings","cleanSettings","setItem","context","useContext","buttonVariants","cva","variants","variant","default","destructive","outline","secondary","ghost","link","size","sm","lg","icon","defaultVariants","Button","asChild","Comp","Slot","alertVariants","Alert","role","AlertTitle","AlertDescription","Table","table","TableHeader","thead","TableBody","tbody","TableFooter","tfoot","TableRow","tr","TableHead","th","TableCell","td","formatNumber","NumberFormat","minimumFractionDigits","maximumFractionDigits","toFixed","formatDateLocale","dateInput","formatPercent","style","getPeriodHeader","splitPeriodUsed","t","formatNumForDisplay","formatPctForDisplay","formatPeriodIdForDisplay","id","periodType","identifier","parseInt","de","enUS","CalculationStepsDisplay","steps","i18n","useTranslation","currentLocale","language","errorMessage","message","p","periodSegments","amountCalculations","fmtNum","num","fmtPeriod","fmtDate","fmtPct","val","section","h4","totalDuration","start","end","days","included","map","seg","periodIdentifier","proportion","amtCalc","index","originalAmount","periodSplits","ps","periodIndex","length","span","find","s","rawSplit","roundedSplit","adjustment","Math","abs","discrepancy","adjustmentAppliedToPeriod","defaultValue","finalSum","FormSchema","z","nonempty","LocaleSelect","form","FormField","control","render","field","FormItem","FormLabel","Select","onValueChange","onChange","FormControl","SelectTrigger","SelectValue","placeholder","SelectContent","SelectItem","FormDescription","FormMessage","NumberField","label","Input","required","SeparatorSelect","currentSeparator","DEFAULT_SEPARATOR","SettingsModal","isOpen","externalIsOpen","onOpenChange","externalOnOpenChange","useSettings","internalIsOpen","setInternalIsOpen","isMounted","setIsMounted","setIsValid","useForm","resolver","zodResolver","defaultValues","toString","mode","reset","subscription","watch","hasErrors","Object","keys","formState","errors","formValues","getValues","isDecimalEmpty","unsubscribe","triggerLabel","dialogTitle","dialogDescription","saveLabel","cancelLabel","onClick","aria-label","Settings","Dialog","open","handleOpenChange","DialogContent","DialogHeader","DialogTitle","UiDialogDescription","Form","onSubmit","handleSubmit","decimalPlacesResult","validateDecimalPlaces","Number","valid","data","setError","roundingPrecisionResult","validateRoundingPrecision","replace","newLocale","window","dispatchEvent","CustomEvent","detail","DialogFooter","DialogClose","disabled","exportToExcel","results","inputData","totalInputAmount","totalDurationDays","totalAggregatedAmount","XLSX","workbook","utils","book_new","consolidatedData","push","startDate","endDate","includeEndDate","aggregatedSplits","forEach","daysInPeriod","totalSplitAmount","calculationSteps","segment","formattedProportion","toLocaleString","i","periodSeg","consolidatedSheet","aoa_to_sheet","allocationTableEndRow","allocationTableStartRow","R","propCellRef","encode_cell","c","r","amtCellRef","repeat","book_append_sheet","filename","writeFile","exportToPdf","jsPDF","autoTable","Promise","all","doc","yPos","text","tableRowsData","head","body","foot","startY","theme","headStyles","fillColor","getComputedStyle","document","documentElement","getPropertyValue","trim","v","filter","_","footStyles","parseFloat","textColor","reduce","sum","fontStyle","didParseCell","column","cell","styles","halign","lastAutoTable","finalY","setFontSize","internal","pageSize","height","addPage","pageCount","getNumberOfPages","setPage","width","save","ResultsDisplayComponent","isSettingsOpen","setIsSettingsOpen","splitPeriod","amounts","isNaN","Card","CardContent","h3","button","svg","xmlns","viewBox","fill","stroke","strokeWidth","strokeLinecap","strokeLinejoin","path","d","circle","cx","cy","collapsible","handleExportExcel","catch","alert","polyline","points","line","x1","y1","x2","y2","handleExportPdf","ResultsDisplay","InvoiceForm","dynamic","then","mod","ssr","loading","InvoiceCalculatorClient","pageTitle","calculationResult","setCalculationResult","calculationError","setCalculationError","storedInputData","setStoredInputData","resultsSectionRef","useRef","initialDemoData","handleDemoDataApplied","useDemoDataHandler","setInitialDemoData","demoDataProcessedRef","current","demoDataString","sessionStorage","log","parsedDemoData","isDemo","removeItem","useCallback","gaMeasurementId","hasConsent","setHasConsent","hasDemoData","hasFormCache","hadDemoData","hadFormCache","Cookies","get","consentCookieName","GoogleAnalytics","gaId","h1","description1","description2","Loader2","maxWidth","data-loaded","opacity","Suspense","fallback","onCalculateAction","handleCalculation","displayError","handleCalculationError","baseErrorTitle","InputValidationError","code","ERROR_CODES","NO_AMOUNTS","INVALID_AMOUNT","END_BEFORE_START","INVALID_DATES","ZERO_DURATION","details","CalculationError","category","Error","stringifiedError","formData","setTimeout","requestAnimationFrame","scrollIntoView","behavior","block","onDemoDataApplied","ref","Terminal","safeText","ForwardedInput","React","helperText","onDoubleClick","errorId","input","aria-invalid","aria-describedby","handleDoubleClick","e","currentTarget","select","VisuallyHidden","clip","AccessibleIcon","DialogPrimitive","DialogPortal","DialogOverlay","isMountedRef","mountTimer","clearTimeout","backgroundColor","XIcon","DialogDescription","CardHeader","CardTitle","FormProvider","FormFieldContext","Controller","fieldContext","itemContext","FormItemContext","getFieldState","useFormContext","useFormState","fieldState","formItemId","formDescriptionId","formMessageId","FormLabelInternal","htmlFor","explicitHtmlFor","hasError","Label","data-error","derivedHtmlFor","hasContext","useFormField","String","SelectPrimitive","data-size","position","sideOffset","avoidCollisions","collisionPadding","SelectScrollUpButton","SelectScrollDownButton","key","restProps","CheckIcon","ChevronUpIcon","calculateInvoiceSplit","calcSteps","success","originalTotalAmount","totalDays","adjustedTotalAmount","resultsPerAmount","some","a","invalidAmounts","roundToDecimals","cleanStartDate","startOfDay","cleanEffectiveEndDate","addDays","differenceInDays","calculatedDays","periodSegmentMap","currentDate","getPeriodIdentifier","getYear","quarter","getQuarter","nextPeriodBoundary","getNextPeriodBoundary","endOfMonth","endOfQuarter","endOfYear","segmentEndDate","daysInSegment","entries","sort","b","localeCompare","amount","amountCalcStep","rawSplits","rawSplitAmount","roundedSplits","step","rs","currentTotal","periodIdentifierToAdjust","periodToAdjustDetails","max","splitToAdjust","CalculationProcessingError","ROUNDING_ERROR","periodToAdjust","finalAmountSplits","splitAmount","adjustedTotalForThisAmount","splits","totalSplitForPeriod","amountResult","yearString","daysInYear","finalAdjustedTotalAmount","finalDiscrepancy","successCalcSteps","caughtError","UNEXPECTED_ERROR","originalError","LabelPrimitive","constructor","setPrototypeOf","prototype","PERIOD_ALLOCATION_ERROR","Loading"],"sourceRoot":""}