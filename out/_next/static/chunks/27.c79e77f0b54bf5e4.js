"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[27],{424:(e,t,s)=>{s.d(t,{Z:()=>n,t:()=>o});var a=s(92237),l=s(99481);let i={decimalPlaces:2,roundingPrecision:.01,thousandsSeparator:","},r=(0,l.createContext)(void 0),n=e=>{let{children:t}=e,[s,n]=(0,l.useState)(()=>{let e=localStorage.getItem("appSettings"),t=e?JSON.parse(e):{};return"locale"in t&&delete t.locale,{...i,...t}}),[o,d]=(0,l.useState)(!1);return(0,l.useEffect)(()=>{if(!o){try{let e=localStorage.getItem("appSettings");if(e){let t=JSON.parse(e);"locale"in t&&delete t.locale,"number"==typeof t.decimalPlaces&&"number"==typeof t.roundingPrecision&&t.roundingPrecision>0&&"string"==typeof t.thousandsSeparator&&[",",".","'"," "].includes(t.thousandsSeparator)?n(e=>({...i,...e,...t})):(console.warn("Loaded settings from localStorage are invalid or incomplete (excluding locale). Using defaults."),n(i),localStorage.removeItem("appSettings"))}else n(i)}catch(e){console.error("Failed to load settings from localStorage:",e),n(i)}d(!0)}},[o]),(0,a.jsx)(r.Provider,{value:{settings:s,saveSettings:e=>{try{let t={...void 0!==e.decimalPlaces&&{decimalPlaces:e.decimalPlaces},...void 0!==e.roundingPrecision&&{roundingPrecision:e.roundingPrecision},...void 0!==e.thousandsSeparator&&{thousandsSeparator:e.thousandsSeparator}},a={...s,...t};n(a),localStorage.setItem("appSettings",JSON.stringify(a))}catch(e){console.error("Failed to save settings to localStorage:",e)}}},children:t})},o=()=>{let e=(0,l.useContext)(r);if(!e)throw Error("useSettings must be used within a SettingsProvider");return e}},91027:(e,t,s)=>{s.r(t),s.d(t,{default:()=>H});var a=s(92237),l=s(55365),i=s(66695),r=s(99481),n=s(57383),o=s(65125),d=s(51154),c=s(10549),u=s(85127),p=s(62713),m=s(83039);function x(e,t,s){try{return new Intl.NumberFormat(t,{minimumFractionDigits:s.decimalPlaces,maximumFractionDigits:s.decimalPlaces}).format(e)}catch(t){return console.error("Error formatting number:",t),e.toFixed(s.decimalPlaces)}}function h(e,t){if(!e)return"N/A";try{let s;return s="string"==typeof e?new Date(e.includes("T")?e:e+"T00:00:00Z"):e,new Intl.DateTimeFormat(t,{year:"numeric",month:"short",day:"numeric"}).format(s)}catch(t){return console.error("Error formatting date:",t),"string"==typeof e?e:e.toISOString().split("T")[0]}}function g(e,t){try{return new Intl.NumberFormat(t,{style:"percent",minimumFractionDigits:2,maximumFractionDigits:2}).format(e)}catch(t){return console.error("Error formatting percent:",t),(100*e).toFixed(2)+"%"}}var y=s(30285),f=s(55594),j=s(66056),b=s(17759),v=s(59409),D=s(46121),S=s(62523),N=s(381),R=s(62177),w=s(424),P=s(94219),I=s(90221);let $=f.Ik({decimalPlaces:f.Yj().nonempty("Decimal places is required"),roundingPrecision:f.Yj().nonempty("Rounding precision is required"),thousandsSeparator:f.Yj(),locale:f.Yj()});function C(e){let{isOpen:t,onOpenChange:s,variant:l="ghost",size:i="icon",className:r}=e,{settings:n,saveSettings:o}=(0,w.t)(),{t:d}=(0,P.Bd)(),[c,u]=(0,D.J0)(!1),[p,m]=(0,D.J0)(!1),x=void 0!==t?t:c,h=s||u,[g,f]=(0,D.J0)(!0),C=(0,R.mN)({resolver:(0,I.u)($),defaultValues:{decimalPlaces:n.decimalPlaces?.toString()||"",roundingPrecision:n.roundingPrecision?.toString()||"0.01",thousandsSeparator:n.thousandsSeparator||",",locale:"en-US"},mode:"onChange"});(0,D.vJ)(()=>{x&&C.reset({decimalPlaces:n.decimalPlaces?.toString()||"",roundingPrecision:n.roundingPrecision?.toString()||"0.01",thousandsSeparator:n.thousandsSeparator||",",locale:"en-US"})},[x,n,C,","]),(0,D.vJ)(()=>{let e=C.watch(()=>{let e=!!Object.keys(C.formState.errors).length,t=C.getValues(),s=!t.decimalPlaces||""===t.decimalPlaces;f(!e&&!s)});return()=>e.unsubscribe()},[C]),(0,D.vJ)(()=>{m(!0)},[n]);let F=C.watch("thousandsSeparator")||",",L=p?d("SettingsModal.settingsModalTitle"):"Number Formatting Settings",A=p?d("SettingsModal.settingsModalTitle"):"Number Formatting Settings",V=p?d("SettingsModal.settingsModalDescription"):"Adjust your preferred number formatting for allocations and reports.",E=p?d("SettingsModal.saveButton"):"Save Settings";return(0,a.jsxs)(a.Fragment,{children:[!t&&!s&&(0,a.jsxs)(y.$,{variant:l,size:i,onClick:()=>u(!0),className:r,"aria-label":L,children:[(0,a.jsx)(N.A,{className:"size-4"}),"icon"!==i&&d("SettingsModal.settingsButtonText","Settings")]}),(0,a.jsx)(j.lG,{open:x,onOpenChange:e=>{e||C.reset({decimalPlaces:n.decimalPlaces?.toString()||"",roundingPrecision:n.roundingPrecision?.toString()||"0.01",thousandsSeparator:n.thousandsSeparator||",",locale:"en-US"}),h(e)},children:(0,a.jsxs)(j.Cf,{className:"sm:max-w-[425px]",children:[(0,a.jsxs)(j.c7,{children:[(0,a.jsx)(j.L3,{children:A}),(0,a.jsx)(j.rr,{children:V})]}),(0,a.jsx)(b.lV,{...C,children:(0,a.jsxs)("form",{onSubmit:C.handleSubmit(function(e){let t=Number(e.decimalPlaces);if(isNaN(t)||t<0||t>6)return void C.setError("decimalPlaces",{type:"manual",message:"Decimal places must be between 0 and 6"});let s=Number(e.roundingPrecision.replace(",","."));if(isNaN(s)||s<1e-4||s>100)return void C.setError("roundingPrecision",{type:"manual",message:"Rounding precision must be between 0.0001 and 100"});let a={decimalPlaces:t,roundingPrecision:s,thousandsSeparator:e.thousandsSeparator||",",locale:e.locale},l=e.locale;o(a),window.dispatchEvent(new CustomEvent("settingsChanged",{detail:{settings:a}})),h(!1)}),className:"space-y-6",children:[(0,a.jsx)(b.zB,{control:C.control,name:"decimalPlaces",render:e=>{let{field:t}=e;return(0,a.jsxs)(b.eI,{children:[(0,a.jsx)(b.lR,{children:d("SettingsModal.decimalPlacesLabel")}),(0,a.jsx)(b.MJ,{children:(0,a.jsx)(S.p,{required:!0,...t})}),(0,a.jsx)(b.Rr,{children:d("SettingsModal.decimalPlacesDescription")}),(0,a.jsx)(b.C5,{})]})}}),(0,a.jsx)(b.zB,{control:C.control,name:"roundingPrecision",render:e=>{let{field:t}=e;return(0,a.jsxs)(b.eI,{children:[(0,a.jsx)(b.lR,{children:d("SettingsModal.roundingPrecisionLabel")}),(0,a.jsx)(b.MJ,{children:(0,a.jsx)(S.p,{required:!0,...t})}),(0,a.jsx)(b.Rr,{children:d("SettingsModal.roundingPrecisionDescription")}),(0,a.jsx)(b.C5,{})]})}}),(0,a.jsx)(b.zB,{control:C.control,name:"thousandsSeparator",render:e=>{let{field:t}=e;return(0,a.jsxs)(b.eI,{children:[(0,a.jsx)(b.lR,{children:d("SettingsModal.thousandsSeparatorLabel")}),(0,a.jsxs)(v.l6,{onValueChange:e=>{t.onChange(e||",")},value:F,children:[(0,a.jsx)(b.MJ,{children:(0,a.jsx)(v.bq,{children:(0,a.jsx)(v.yv,{children:","===F?`${d("SettingsModal.comma")} (1,234.56)`:"."===F?`${d("SettingsModal.period")} (1.234,56)`:"'"===F?`${d("SettingsModal.apostrophe")} (1&apos;234.56)`:" "===F?`${d("SettingsModal.space")} (1 234.56)`:d("SettingsModal.comma")})})}),(0,a.jsxs)(v.gC,{children:[(0,a.jsx)(v.eb,{value:",",children:`${d("SettingsModal.comma")} (1,234.56)`},","),(0,a.jsx)(v.eb,{value:".",children:`${d("SettingsModal.period")} (1.234,56)`},"."),(0,a.jsx)(v.eb,{value:"'",children:`${d("SettingsModal.apostrophe")} (1&apos;234.56)`},"'"),(0,a.jsx)(v.eb,{value:" ",children:`${d("SettingsModal.space")} (1 234.56)`},"space")]})]}),(0,a.jsx)(b.Rr,{children:d("SettingsModal.thousandsSeparatorDescription")}),(0,a.jsx)(b.C5,{})]})}}),(0,a.jsx)(j.Es,{className:"pt-4",children:(0,a.jsx)(y.$,{type:"submit",className:"bg-[#0284C7] hover:bg-[#0284C7]/90 text-white",disabled:!g||C.formState.isSubmitting||Object.keys(C.formState.errors).length>0,children:E})})]})})]})})]})}var F=s(26681);function L(e,t,s){if("monthly"!==t)return e;try{let[t,a]=e.split("-"),l=new Date(parseInt(t),parseInt(a)-1,1);return(0,F.GP)(l,"MMMM yyyy",{locale:"de"===s?p.de:m.c})}catch{return e}}let A=e=>{let{steps:t,settings:s,splitPeriodUsed:l}=e,{t:i,i18n:r}=(0,P.Bd)(),n=r.language;if(t.error)return(0,a.jsx)("p",{className:"text-destructive",children:t.error});let{periodSegments:o,amountCalculations:d}=t,c=e=>x(e,n,s),u=e=>L(e,l,n),p=e=>h(e,n),m=e=>g(e,n);return(0,a.jsxs)("div",{className:"text-sm space-y-6",children:[(0,a.jsxs)("section",{className:"bg-muted/40 rounded-lg p-4 space-y-4",children:[(0,a.jsx)("h4",{className:"font-semibold text-foreground",children:i("ResultsDisplay.totalDuration")}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-2 text-xs border-b pb-2 mb-2",children:[(0,a.jsx)("div",{children:i("ResultsDisplay.periodLabel")})," ",(0,a.jsxs)("div",{className:"text-right",children:[p(t.totalDuration.start)," - ",p(t.totalDuration.end)]}),(0,a.jsx)("div",{children:i("ResultsDisplay.totalDays")})," ",(0,a.jsxs)("div",{className:"text-right",children:[t.totalDuration.days," (",t.totalDuration.included?i("ResultsDisplay.inclusiveLabel"):i("ResultsDisplay.exclusiveLabel"),")"]})]}),(0,a.jsx)("h4",{className:"font-semibold text-foreground",children:i("ResultsDisplay.proportionCalculation")}),(0,a.jsx)("div",{className:"space-y-1",children:o.map(e=>(0,a.jsxs)("div",{className:"grid grid-cols-3 gap-2 text-xs",children:[(0,a.jsxs)("div",{className:"font-medium",children:[u(e.periodIdentifier),":"]}),(0,a.jsxs)("div",{className:"text-muted-foreground text-center",children:[e.days," / ",t.totalDuration.days," ",i("ResultsDisplay.daysLabel")]}),(0,a.jsx)("div",{className:"text-muted-foreground text-right",children:m(e.proportion)})]},e.periodIdentifier))})]}),(0,a.jsxs)("section",{className:"bg-muted/40 rounded-lg p-4",children:[(0,a.jsx)("h4",{className:"font-semibold text-foreground mb-4",children:i("ResultsDisplay.splitCalculation")}),(0,a.jsx)("div",{className:"space-y-6",children:d.map((e,t)=>(0,a.jsxs)("div",{className:"rounded-md border bg-background p-4 space-y-2 transition-shadow hover:shadow-md",children:[(0,a.jsxs)("div",{className:"font-bold text-[15px] text-primary mb-3 pb-1 border-b border-primary/20 bg-primary/[0.08] -mx-4 px-4 py-2 rounded-t-md",children:[i("ResultsDisplay.inputAmountLabel")," #",t+1,":"," ",c(e.originalAmount)]}),(0,a.jsx)("div",{className:"space-y-3",children:e.periodSplits.map((t,s)=>(0,a.jsxs)("div",{className:`pl-2 text-xs space-y-0.5 ${s<e.periodSplits.length-1?"border-b border-muted/30 pb-2":""}`,children:[(0,a.jsxs)("div",{className:"font-medium shrink-0 text-foreground",children:[u(t.periodIdentifier),":"]}),(0,a.jsxs)("div",{className:"text-muted-foreground ml-2",children:[(0,a.jsxs)("span",{children:[c(e.originalAmount)," *"," ",o.find(e=>e.periodIdentifier===t.periodIdentifier)?.proportion.toFixed(6)]}),(0,a.jsxs)("span",{className:"block sm:inline",children:[" ","= ",t.rawSplit.toFixed(6)]})]}),(0,a.jsxs)("div",{className:"ml-2 flex items-center gap-x-2",children:[(0,a.jsx)("span",{children:"→"}),(0,a.jsxs)("span",{className:"font-medium text-foreground",children:[i("ResultsDisplay.roundedLabel"),":"," ",c(t.roundedSplit)]}),0!==t.adjustment&&(0,a.jsxs)("span",{className:"text-muted-foreground text-xs",children:["(",i("ResultsDisplay.adjustmentLabel"),":"," ",c(t.adjustment),")"]})]})]},t.periodIdentifier))}),(0,a.jsxs)("div",{className:"border-t pt-2 mt-2 space-y-1 text-xs",children:[(0,a.jsxs)("p",{children:[(0,a.jsxs)("span",{className:"font-medium text-foreground",children:[i("ResultsDisplay.discrepancyLabel"),":"]}),(0,a.jsxs)("span",{className:`${Math.abs(e.discrepancy)>.001?"text-amber-600 dark:text-amber-500":"text-muted-foreground/70"}`,children:[" ",c(e.discrepancy)]}),e.adjustmentAppliedToPeriod&&(0,a.jsxs)("span",{className:"text-muted-foreground",children:["(",i("ResultsDisplay.adjustedInYearLabel",{defaultValue:"Applied in Year"})," ",u(e.adjustmentAppliedToPeriod),")"]})]}),(0,a.jsxs)("p",{className:"font-semibold text-sm text-foreground pt-1",children:[i("ResultsDisplay.finalSumLabel"),":"," ",(0,a.jsx)("span",{className:"text-primary",children:c(e.finalSum)})]})]})]},t))})]})]})};function V(e){let{results:t,inputData:l}=e,{t:n,i18n:o}=(0,P.Bd)(),{settings:d}=(0,w.t)(),[f,j]=(0,r.useState)(!1),b=o.language,v=l.splitPeriod||"yearly",D=e=>void 0!==e?x(e,b,d):"",S=e=>void 0!==e?g(e,b):"",N=e=>e?h(e,b):"",R=e=>L(e,v,b),I=()=>{switch(v){case"monthly":return n("ResultsDisplay.monthHeader");case"quarterly":return n("ResultsDisplay.quarterHeader");default:return n("ResultsDisplay.yearHeader")}},$=t.calculationSteps?.totalDuration?.days??0,V=l.amounts.reduce((e,t)=>e+(isNaN(t)?0:t),0),E=t.aggregatedSplits?.reduce((e,t)=>e+(t.totalSplitAmount??0),0)??0;return(0,a.jsxs)("div",{className:"w-full animate-fadeIn",children:[(0,a.jsx)(i.Zp,{className:"shadow-lg border border-border/50",children:(0,a.jsxs)(i.Wu,{className:"p-6 space-y-8",children:[(0,a.jsx)(i.Zp,{className:"shadow-md border border-border/40 overflow-hidden",children:(0,a.jsxs)(i.Wu,{className:"p-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-6 pb-4 border-b",children:[(0,a.jsx)("h3",{className:"text-xl font-semibold text-primary",children:n("ResultsDisplay.summaryTitle")}),(0,a.jsx)("button",{onClick:()=>j(!0),className:"p-1.5 rounded-md text-muted-foreground hover:text-white hover:bg-[#0284C7] transition-colors cursor-pointer","aria-label":n("ResultsDisplay.settingsLabel"),children:(0,a.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,a.jsx)("path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.38a2 2 0 0 0-.73-2.73l-.15-.09a2 2 0 0 1-1-1.74v-.51a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"}),(0,a.jsx)("circle",{cx:"12",cy:"12",r:"3"})]})})]}),(0,a.jsxs)("div",{className:"space-y-2 text-sm text-muted-foreground",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:n("ResultsDisplay.periodLabel")}),(0,a.jsxs)("span",{className:"font-medium text-foreground",children:[N(l.startDate)," - "," ",N(l.endDate)]})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:n("ResultsDisplay.totalDurationLabel",{defaultValue:"Total Duration (days)"})}),(0,a.jsxs)("span",{className:"font-medium text-foreground",children:[$," ",n("ResultsDisplay.daysLabel")]})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:n("InvoiceForm.includeEndDateLabel",{defaultValue:"Include Final Day in Service Period?"})}),(0,a.jsx)("span",{className:"font-medium text-foreground",children:l.includeEndDate?n("ResultsDisplay.yesLabel",{defaultValue:"Yes"}):n("ResultsDisplay.noLabel",{defaultValue:"No"})})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:n("InvoiceForm.splitPeriodLabel",{defaultValue:"Split Period"})}),(0,a.jsxs)("span",{className:"font-medium text-foreground",children:["yearly"===v&&n("InvoiceForm.periodYearly"),"quarterly"===v&&n("InvoiceForm.periodQuarterly"),"monthly"===v&&n("InvoiceForm.periodMonthly")]})]}),(0,a.jsxs)("div",{className:"flex justify-between pt-2 border-t border-border/30",children:[(0,a.jsx)("span",{className:"font-semibold text-foreground",children:n("ResultsDisplay.originalTotalLabel",{defaultValue:"Total Input Amount:"})}),(0,a.jsx)("span",{className:"font-semibold text-foreground",children:D(V)})]})]})]})}),(0,a.jsx)(i.Zp,{className:"shadow-md border border-border/40 overflow-hidden",children:(0,a.jsxs)(i.Wu,{className:"p-6",children:[(0,a.jsx)("h3",{className:"text-xl font-semibold mb-6 pb-4 border-b text-primary",children:n("ResultsDisplay.aggregatedTitle",{defaultValue:"Allocation per Period"})}),(0,a.jsxs)(u.XI,{children:[(0,a.jsx)(u.A0,{children:(0,a.jsxs)(u.Hj,{children:[(0,a.jsx)(u.nd,{children:I()}),(0,a.jsx)(u.nd,{className:"text-right",children:n("ResultsDisplay.daysHeader")}),(0,a.jsx)(u.nd,{className:"text-right",children:n("ResultsDisplay.proportionHeader")}),(0,a.jsx)(u.nd,{className:"text-right",children:n("ResultsDisplay.amountHeader")})]})}),(0,a.jsx)(u.BF,{children:t.aggregatedSplits?.map((e,t)=>(0,a.jsxs)(u.Hj,{children:[(0,a.jsx)(u.nA,{className:"font-medium text-foreground whitespace-nowrap",children:R(e.periodIdentifier)}),(0,a.jsx)(u.nA,{className:"text-right text-muted-foreground",children:e.daysInPeriod}),(0,a.jsx)(u.nA,{className:"text-right text-muted-foreground",children:S(e.proportion)}),(0,a.jsx)(u.nA,{className:"text-right font-medium text-foreground",children:D(e.totalSplitAmount)})]},t))}),(0,a.jsx)(u.Gg,{children:(0,a.jsxs)(u.Hj,{children:[(0,a.jsx)(u.nA,{children:n("ResultsDisplay.totalLabel",{defaultValue:"Total"})}),(0,a.jsx)(u.nA,{className:"text-right font-semibold text-foreground",children:$}),(0,a.jsx)(u.nA,{className:"text-right font-semibold text-foreground",children:S(1)}),(0,a.jsx)(u.nA,{className:"text-right font-semibold text-foreground",children:D(E)})]})})]})]})}),(0,a.jsx)(c.nD,{type:"single",collapsible:!0,className:"w-full",children:(0,a.jsxs)(c.As,{value:"item-1",className:"border rounded-lg shadow-md bg-card",children:[(0,a.jsx)(c.$m,{className:"px-6 py-4 text-lg font-semibold text-primary hover:bg-muted/40",children:n("ResultsDisplay.calculationStepsTitle",{defaultValue:"View Full Split Calculation"})}),(0,a.jsx)(c.ub,{className:"px-6 py-4 bg-background border-t",children:t.calculationSteps?(0,a.jsx)(A,{steps:t.calculationSteps,settings:d,splitPeriodUsed:v}):(0,a.jsx)("p",{children:n("ResultsDisplay.noStepsAvailable")})})]})}),(0,a.jsxs)("div",{className:"mt-8 w-full flex flex-col items-center sm:flex-row sm:justify-center gap-4 px-4 sm:px-0",children:[(0,a.jsxs)(y.$,{variant:"outline",onClick:function(){Promise.all([s.e(96),s.e(436)]).then(s.bind(s,3925)).then(e=>{let s=e.utils.book_new(),a=[];if(a.push([n("ResultsDisplay.summaryTitle",{defaultValue:"Summary"})]),a.push([]),a.push([n("ResultsDisplay.periodLabel"),`${N(l.startDate)} - ${N(l.endDate)}`]),a.push([n("ResultsDisplay.totalDurationLabel",{defaultValue:"Total Duration (days)"}),`${$} ${n("ResultsDisplay.daysLabel")}`]),a.push([n("InvoiceForm.includeEndDateLabel",{defaultValue:"Include Final Day in Service Period?"}),l.includeEndDate?n("ResultsDisplay.yesLabel",{defaultValue:"Yes"}):n("ResultsDisplay.noLabel",{defaultValue:"No"})]),a.push([n("InvoiceForm.splitPeriodLabel",{defaultValue:"Split Period"}),"yearly"===v?n("InvoiceForm.periodYearly"):"quarterly"===v?n("InvoiceForm.periodQuarterly"):n("InvoiceForm.periodMonthly")]),a.push([n("ResultsDisplay.originalTotalLabel",{defaultValue:"Total Input Amount:"}),D(V)]),a.push([]),a.push([n("ResultsDisplay.aggregatedTitle",{defaultValue:"Allocation per Period"})]),a.push([]),a.push([I(),n("ResultsDisplay.daysHeader"),n("ResultsDisplay.proportionHeader"),n("ResultsDisplay.amountHeader")]),t.aggregatedSplits?.forEach(e=>{a.push([R(e.periodIdentifier),e.daysInPeriod,e.proportion,e.totalSplitAmount])}),a.push([n("ResultsDisplay.totalLabel",{defaultValue:"Total"}),$,1,E]),a.push([]),a.push([]),t.calculationSteps){let e=t.calculationSteps,{periodSegments:s,amountCalculations:l}=e;for(let t of(a.push([n("ResultsDisplay.calculationStepsTitle",{defaultValue:"View Full Split Calculation"})]),a.push([]),a.push([n("ResultsDisplay.totalDuration")]),a.push([n("ResultsDisplay.periodLabel"),`${N("string"==typeof e.totalDuration.start?new Date(e.totalDuration.start):e.totalDuration.start)} - ${N("string"==typeof e.totalDuration.end?new Date(e.totalDuration.end):e.totalDuration.end)}`]),a.push([n("ResultsDisplay.totalDays"),`${e.totalDuration.days} ${e.totalDuration.included?n("ResultsDisplay.inclusiveLabel"):n("ResultsDisplay.exclusiveLabel")}`]),a.push([]),a.push([n("ResultsDisplay.proportionCalculation")]),s))a.push([R(t.periodIdentifier),`${t.days} / ${e.totalDuration.days} = ${g(t.proportion,b)}`]);a.push([]),a.push([n("ResultsDisplay.splitCalculation")]),a.push([]);for(let e=0;e<l.length;e++){let t=l[e];for(let l of(a.push([`${n("ResultsDisplay.inputAmountLabel")} #${e+1}:`,D(t.originalAmount)]),t.periodSplits)){let e=s.find(e=>e.periodIdentifier===l.periodIdentifier);a.push([R(l.periodIdentifier),`${D(t.originalAmount)} \xd7 ${e?.proportion.toFixed(6)} = ${l.rawSplit.toFixed(6)} → ${D(l.roundedSplit)}`]),0!==l.adjustment&&a.push([`  ${n("ResultsDisplay.adjustmentLabel")}:`,D(l.adjustment)])}a.push([n("ResultsDisplay.discrepancyLabel"),D(t.discrepancy)]),t.adjustmentAppliedToPeriod&&a.push([n("ResultsDisplay.adjustedInYearLabel",{defaultValue:"Applied in Year"}),R(t.adjustmentAppliedToPeriod)]),a.push([n("ResultsDisplay.finalSumLabel"),D(t.finalSum)]),a.push([])}}let i=e.utils.aoa_to_sheet(a),r=12+(t.aggregatedSplits?.length||0);for(let t=12;t<r;t++){let s=e.utils.encode_cell({c:2,r:t});i[s]&&(i[s].t="n",i[s].z="0.00%")}for(let t=12;t<r+1;t++){let s=e.utils.encode_cell({c:3,r:t});i[s]&&(i[s].t="n",i[s].z=`#,##0.${"0".repeat(d.decimalPlaces||2)}`)}e.utils.book_append_sheet(s,i,n("ResultsDisplay.consolidatedSheetName",{defaultValue:"Invoice Split Report"}));let o=`InvoiceSplit_${(0,F.GP)(new Date,"yyyyMMdd")}.xlsx`;e.writeFile(s,o)}).catch(e=>{console.error("Failed to load xlsx library or export Excel:",e),alert("Failed to export Excel. Please try again.")})},className:"w-full sm:w-auto",children:[(0,a.jsxs)("svg",{className:"mr-2 h-4 w-4",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,a.jsx)("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),(0,a.jsx)("polyline",{points:"14 2 14 8 20 8"}),(0,a.jsx)("line",{x1:"16",y1:"13",x2:"8",y2:"13"}),(0,a.jsx)("line",{x1:"16",y1:"17",x2:"8",y2:"17"}),(0,a.jsx)("polyline",{points:"10 9 9 9 8 9"})]}),n("ResultsDisplay.exportExcelButton")]}),(0,a.jsxs)(y.$,{variant:"outline",onClick:function(){Promise.all([s.e(96).then(s.bind(s,40978)),s.e(96).then(s.bind(s,76118))]).then(e=>{let[{jsPDF:s},{default:a}]=e;try{let e=new s,i=20,r=`InvoiceSplit_${(0,F.GP)(new Date,"yyyyMMdd")}.pdf`;e.text(`${n("ResultsDisplay.periodLabel")}: ${h(l.startDate,b)} - ${h(l.endDate,b)}`,14,i),i+=5,e.text(`${n("ResultsDisplay.originalTotalLabel",{defaultValue:"Total Input Amount:"})}: ${x(V,b,d)}`,14,i),i+=15,e.text(`${n("ResultsDisplay.totalDurationLabel",{defaultValue:"Total Duration (days)"})}: ${$} ${n("ResultsDisplay.daysLabel")}`,14,i),i+=5,e.text(`${n("InvoiceForm.includeEndDateLabel",{defaultValue:"Include Final Day in Service Period?"})}: ${l.includeEndDate?n("ResultsDisplay.yesLabel",{defaultValue:"Yes"}):n("ResultsDisplay.noLabel",{defaultValue:"No"})}`,14,i),i+=5,e.text(`${n("InvoiceForm.splitPeriodLabel",{defaultValue:"Split Period"})}: ${"yearly"===v?n("InvoiceForm.periodYearly"):"quarterly"===v?n("InvoiceForm.periodQuarterly"):n("InvoiceForm.periodMonthly")}`,14,i),i+=5;let o=t.aggregatedSplits?.map(e=>[L(e.periodIdentifier,v,b),e.daysInPeriod,g(e.proportion,b),x(e.totalSplitAmount,b,d)])||[];if(a(e,{head:[[I(),n("ResultsDisplay.daysHeader"),n("ResultsDisplay.proportionHeader"),n("ResultsDisplay.amountHeader")]],body:o,foot:[[n("ResultsDisplay.totalLabel",{defaultValue:"Total"}),$,g(1,b),x(E,b,d)]],startY:i,theme:"grid",headStyles:{fillColor:[46,90,140]},footStyles:{fillColor:[240,240,240],textColor:40,fontStyle:"bold"},didParseCell:function(e){void 0!==e.column.index&&[1,2,3].includes(e.column.index)&&(e.cell.styles.halign="right")}}),t.calculationSteps){let s=t.calculationSteps,{periodSegments:a,amountCalculations:l}=s;i=e.lastAutoTable?.finalY?e.lastAutoTable.finalY+15:i+50,e.text(n("ResultsDisplay.calculationStepsTitle",{defaultValue:"View Full Split Calculation"}),14,i),i+=10,e.text(n("ResultsDisplay.totalDuration"),14,i),i+=7;let r=s.totalDuration.start,o=s.totalDuration.end;for(let t of(e.text(`${n("ResultsDisplay.periodLabel")}: ${h(r,b)} - ${h(o,b)}`,20,i),i+=5,e.text(`${n("ResultsDisplay.totalDays")}: ${s.totalDuration.days} ${s.totalDuration.included?n("ResultsDisplay.inclusiveLabel"):n("ResultsDisplay.exclusiveLabel")}`,20,i),i+=10,e.text(n("ResultsDisplay.proportionCalculation"),14,i),i+=7,e.setFontSize(10),i>e.internal.pageSize.height-50&&(e.addPage(),i=20),a))e.text(`${L(t.periodIdentifier,v,b)}: ${t.days} / ${s.totalDuration.days} = ${g(t.proportion,b)}`,20,i),(i+=5)>e.internal.pageSize.height-30&&(e.addPage(),i=20);i+=5,e.text(n("ResultsDisplay.splitCalculation"),14,i),i+=7;for(let t=0;t<l.length;t++){let s=l[t];for(let l of(i>e.internal.pageSize.height-70&&(e.addPage(),i=20),e.setFontSize(11),e.text(`${n("ResultsDisplay.inputAmountLabel")} #${t+1}: ${x(s.originalAmount,b,d)}`,20,i),i+=7,e.setFontSize(10),s.periodSplits)){let t=a.find(e=>e.periodIdentifier===l.periodIdentifier);e.text(`${L(l.periodIdentifier,v,b)}:`,25,i),i+=5,e.text(`${x(s.originalAmount,b,d)} \xd7 ${t?.proportion.toFixed(6)} = ${l.rawSplit.toFixed(6)}`,30,i),i+=5,e.text(`→ ${n("ResultsDisplay.roundedLabel")}: ${x(l.roundedSplit,b,d)}`,30,i),i+=5,0!==l.adjustment&&(e.text(`${n("ResultsDisplay.adjustmentLabel")}: ${x(l.adjustment,b,d)}`,30,i),i+=5),i>e.internal.pageSize.height-40&&(e.addPage(),i=20)}e.text(`${n("ResultsDisplay.discrepancyLabel")}: ${x(s.discrepancy,b,d)}`,25,i),i+=5,s.adjustmentAppliedToPeriod&&(e.text(`${n("ResultsDisplay.adjustedInYearLabel",{defaultValue:"Applied in Year"})}: ${L(s.adjustmentAppliedToPeriod,v,b)}`,25,i),i+=5),e.text(`${n("ResultsDisplay.finalSumLabel")}: ${x(s.finalSum,b,d)}`,25,i),(i+=10)>e.internal.pageSize.height-50&&t<l.length-1&&(e.addPage(),i=20)}}let c=e.internal.getNumberOfPages();e.setFontSize(8);for(let t=1;t<=c;t++)e.setPage(t),e.text(`Generated by BillSplitter - ${(0,F.GP)(new Date,"PPpp",{locale:"de"===b?p.de:m.c})}`,14,e.internal.pageSize.height-10),e.text(`Page ${t} of ${c}`,e.internal.pageSize.width-35,e.internal.pageSize.height-10);e.save(r)}catch(e){console.error("Error generating PDF:",e),alert("Failed to generate PDF. Please try again.")}}).catch(e=>{console.error("Failed to load PDF generation libraries:",e),alert("Failed to load PDF generation libraries. Please try again.")})},className:"w-full sm:w-auto",children:[(0,a.jsxs)("svg",{className:"mr-2 h-4 w-4",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,a.jsx)("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),(0,a.jsx)("polyline",{points:"14 2 14 8 20 8"}),(0,a.jsx)("line",{x1:"16",y1:"13",x2:"8",y2:"13"}),(0,a.jsx)("line",{x1:"16",y1:"17",x2:"8",y2:"17"}),(0,a.jsx)("polyline",{points:"10 9 9 9 8 9"})]}),n("ResultsDisplay.exportPdfButton")]})]})]})}),(0,a.jsx)(C,{isOpen:f,onOpenChange:j})]})}function E(e){return(0,a.jsx)(V,{...e})}var M=s(41684),T=s(55028),k=s(59434);let z=(0,T.default)(()=>Promise.all([s.e(274),s.e(96),s.e(754)]).then(s.bind(s,18754)).then(e=>({default:e.InvoiceForm})),{loadableGenerated:{webpack:()=>[18754]},ssr:!1,loading:()=>(0,a.jsxs)("div",{className:"space-y-6 animate-pulse",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,a.jsx)("div",{className:"h-24 bg-muted/60 rounded-lg"}),(0,a.jsx)("div",{className:"h-24 bg-muted/60 rounded-lg"})]}),(0,a.jsx)("div",{className:"h-20 bg-muted/60 rounded-lg"}),(0,a.jsx)("div",{className:"h-48 bg-muted/60 rounded-lg"}),(0,a.jsx)("div",{className:"h-10 bg-muted/60 rounded-lg"})]})});function H(e){let{pageTitle:t}=e,{t:s}=(0,P.Bd)(),[c,u]=(0,r.useState)(!1),[p,m]=(0,r.useState)(null),[x,h]=(0,r.useState)(null),[g,y]=(0,r.useState)(null),[f,j]=(0,r.useState)(!1),b=(0,r.useRef)(null),[v,D]=(0,r.useState)(null),S=(0,r.useRef)(!1),N="G-9H2KTHX5YK",[R,w]=(0,r.useState)(!1);(0,r.useEffect)(()=>()=>{{let e=null!==sessionStorage.getItem("billSplitterDemoData"),t=null!==sessionStorage.getItem("invoiceFormDataCache");try{sessionStorage.removeItem("invoiceFormDataCache"),console.log("[InvoiceCalculatorClient] Cleaned up sessionStorage on unmount",{hadDemoData:e,hadFormCache:t})}catch(e){console.error("[InvoiceCalculatorClient] Error clearing sessionStorage on unmount:",e)}}},[]),(0,r.useEffect)(()=>{u(!0),w("true"===n.A.get("siempiBillSplitterConsent"))},[]),(0,r.useEffect)(()=>{if(!S.current){let e=sessionStorage.getItem("billSplitterDemoData");if(console.log("[InvoiceCalculatorClient] Reading sessionStorage billSplitterDemoData:",e),e)try{let t=JSON.parse(e);t&&t.isDemo?(localStorage.removeItem("invoiceFormDataCache"),console.log("[InvoiceCalculatorClient] Cleared localStorage cache to ensure demo data is used"),console.log("[InvoiceCalculatorClient] Setting initialDemoData state:",t),D(t),sessionStorage.removeItem("billSplitterDemoData"),console.log("[InvoiceCalculatorClient] Removed billSplitterDemoData from sessionStorage"),S.current=!0):sessionStorage.removeItem("billSplitterDemoData")}catch(e){console.error("[InvoiceCalculatorClient] Error parsing demo data:",e),sessionStorage.removeItem("billSplitterDemoData")}}},[]);let I=(0,r.useCallback)(()=>{console.log("[InvoiceCalculatorClient] Demo data processed by InvoiceForm, clearing state"),D(null)},[]);return(0,a.jsxs)(a.Fragment,{children:[R&&N&&(0,a.jsx)(o.GoogleAnalytics,{gaId:N}),(0,a.jsxs)("div",{className:"container mx-auto px-4 py-8 max-w-4xl grow overflow-hidden w-full",children:[(0,a.jsxs)("div",{className:"text-center mb-8",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-center mb-4",children:t}),(0,a.jsxs)("div",{className:"max-w-2xl mx-auto space-y-2 px-4",children:[(0,a.jsx)("p",{children:s("InvoiceForm.description_p1")}),(0,a.jsx)("p",{children:s("InvoiceForm.description_p2")})]})]}),!c&&(0,a.jsxs)("div",{className:"flex items-center gap-2 justify-center text-muted-foreground text-sm mb-6",children:[(0,a.jsx)(d.A,{className:"animate-spin h-4 w-4 text-primary"}),(0,a.jsx)("span",{children:"Loading calculator..."})]}),(0,a.jsxs)("div",{className:"mx-auto",style:{maxWidth:"768px"},children:[(0,a.jsx)(i.Zp,{className:"mb-12 shadow-md w-full transition-opacity duration-300 ease-in-out","data-loaded":c?"true":"false",style:{opacity:c?1:.85},children:(0,a.jsx)(i.Wu,{className:"pt-6",children:(0,a.jsx)("div",{className:"w-full",children:(0,a.jsx)(r.Suspense,{fallback:(0,a.jsxs)("div",{className:"space-y-6 animate-pulse",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,a.jsx)("div",{className:"h-24 bg-muted/60 rounded-lg"}),(0,a.jsx)("div",{className:"h-24 bg-muted/60 rounded-lg"})]}),(0,a.jsx)("div",{className:"h-20 bg-muted/60 rounded-lg"}),(0,a.jsx)("div",{className:"h-48 bg-muted/60 rounded-lg"}),(0,a.jsx)("div",{className:"h-10 bg-muted/60 rounded-lg"})]}),children:(0,a.jsx)(z,{onCalculateAction:(e,t,a)=>{m(t);let l=null;if(a){let e=s("Errors.calculationErrorTitle");if("string"==typeof a)l=a.includes("At least one amount is required")?e+": "+s("InvoiceForm.errorAmountRequired"):a.includes("Start date must be before")?e+": "+s("InvoiceForm.errorEndDateBeforeStart"):e+": "+a;else if(a instanceof Error)l=e+": "+a.message,console.error("[InvoiceCalculatorClient] Error object received:",a);else if(a&&"object"==typeof a){if("message"in a&&"string"==typeof a.message)l=e+": "+a.message;else try{let t=JSON.stringify(a);l=e+": "+("{}"!==t?t:s("Errors.unexpectedError"))}catch{l=e+": "+s("Errors.unexpectedError")}console.error("[InvoiceCalculatorClient] Error object received:",a)}else l=e+": "+s("Errors.unexpectedError"),console.error("[InvoiceCalculatorClient] An unexpected or non-standard error was received:",a)}h(l),e&&t&&!l?(y(e),setTimeout(()=>{requestAnimationFrame(()=>{b.current&&b.current.scrollIntoView({behavior:"smooth",block:"start"})})},200)):(y(null),l&&m(null))},initialDemoData:v,onDemoDataApplied:I})})})})}),(0,a.jsxs)("div",{ref:b,className:"mt-12 w-full",children:[c&&x&&(0,a.jsxs)(l.Fc,{variant:"destructive",className:"w-full",children:[(0,a.jsx)(M.A,{className:"h-4 w-4"}),(0,a.jsx)(l.XL,{children:s("Errors.calculationErrorTitle")}),(0,a.jsx)(l.TN,{children:(0,k.H)(x)})]}),c&&p&&g&&!x&&(0,a.jsx)(E,{results:p,inputData:g}),!c&&null===p&&(0,a.jsx)(i.Zp,{className:"shadow-md w-full h-64 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"space-y-4 p-6 w-full",children:[(0,a.jsx)("div",{className:"h-6 bg-muted/60 rounded-md animate-pulse w-3/4 mx-auto mb-8"}),(0,a.jsxs)("div",{className:"grid grid-cols-4 gap-4 mb-6",children:[(0,a.jsx)("div",{className:"h-4 bg-muted/60 rounded-sm animate-pulse"}),(0,a.jsx)("div",{className:"h-4 bg-muted/60 rounded-sm animate-pulse"}),(0,a.jsx)("div",{className:"h-4 bg-muted/60 rounded-sm animate-pulse"}),(0,a.jsx)("div",{className:"h-4 bg-muted/60 rounded-sm animate-pulse"})]}),(0,a.jsx)("div",{className:"h-24 bg-muted/60 rounded-md animate-pulse"})]})})]})]})]}),c&&(0,a.jsx)(C,{isOpen:f,onOpenChange:j})]})}}}]);