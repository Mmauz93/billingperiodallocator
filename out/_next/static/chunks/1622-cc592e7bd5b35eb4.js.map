{"version":3,"file":"static/chunks/1622-cc592e7bd5b35eb4.js","mappings":"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","sources":["webpack://_N_E/./src/context/settings-context.tsx","webpack://_N_E/?ec90","webpack://_N_E/./src/lib/date-utils.ts","webpack://_N_E/./src/components/app-seo-content.tsx","webpack://_N_E/./src/components/ui/accordion.tsx","webpack://_N_E/./src/components/ui/alert.tsx","webpack://_N_E/./src/components/ui/table.tsx","webpack://_N_E/./src/lib/formattingUtils.ts","webpack://_N_E/./src/components/settings-modal.tsx","webpack://_N_E/./src/components/results-display.tsx","webpack://_N_E/./src/components/invoice-calculator-client.tsx","webpack://_N_E/./src/components/ui/form.tsx","webpack://_N_E/./src/components/ui/button.tsx","webpack://_N_E/./src/components/ui/select.tsx","webpack://_N_E/./src/components/ui/input.tsx","webpack://_N_E/./src/components/ui/visually-hidden.tsx","webpack://_N_E/./src/components/ui/accessible-icon.tsx","webpack://_N_E/./src/components/ui/dialog.tsx","webpack://_N_E/./src/components/ui/card.tsx","webpack://_N_E/./src/lib/calculations.ts","webpack://_N_E/./src/components/ui/label.tsx","webpack://_N_E/./src/lib/errors.ts","webpack://_N_E/./src/components/loading.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport React, {\r\n  ReactNode,\r\n  createContext,\r\n  useContext,\r\n  useEffect,\r\n  useState,\r\n} from \"react\";\r\n\r\nexport type Locale = \"en\" | \"de\";\r\n\r\nexport type AppSettings = {\r\n  decimalPlaces: number; // 0-6\r\n  roundingPrecision: number; // e.g., 0.01, 0.05, 1\r\n  thousandsSeparator: string; // Values: ',', '.', \"'\", ' '\r\n};\r\n\r\ninterface SettingsContextProps {\r\n  settings: Omit<AppSettings, \"locale\">;\r\n  saveSettings: (newSettings: Partial<Omit<AppSettings, \"locale\">>) => void; // Allow partial updates\r\n}\r\n\r\nconst defaultSettings: Omit<AppSettings, \"locale\"> = {\r\n  decimalPlaces: 2, // Default decimal places\r\n  roundingPrecision: 0.01, // Default rounding\r\n  thousandsSeparator: \",\", // Default separator is comma\r\n};\r\n\r\nconst SettingsContext = createContext<SettingsContextProps | undefined>(\r\n  undefined,\r\n);\r\n\r\nexport const SettingsProvider = ({ children }: { children: ReactNode }) => {\r\n  const [settings, setSettings] = useState<Omit<AppSettings, \"locale\">>(() => {\r\n    const loadedSettings =\r\n      typeof window !== \"undefined\"\r\n        ? localStorage.getItem(\"appSettings\")\r\n        : null;\r\n    const initialSettings = loadedSettings ? JSON.parse(loadedSettings) : {};\r\n    // Remove locale if it exists in loaded settings\r\n    if (\"locale\" in initialSettings) {\r\n      delete initialSettings.locale;\r\n    }\r\n    return { ...defaultSettings, ...initialSettings }; // Merge defaults with loaded\r\n  });\r\n  const [isLoaded, setIsLoaded] = useState(false); // Flag to ensure localStorage is read only once\r\n\r\n  // Effect to load settings from localStorage on initial client mount\r\n  useEffect(() => {\r\n    if (typeof window !== \"undefined\" && !isLoaded) {\r\n      // Check if running on client and not already loaded\r\n      try {\r\n        const savedSettings = localStorage.getItem(\"appSettings\");\r\n        if (savedSettings) {\r\n          const parsed = JSON.parse(savedSettings);\r\n          // Remove locale before validation/setting\r\n          if (\"locale\" in parsed) {\r\n            delete parsed.locale;\r\n          }\r\n\r\n          if (\r\n            typeof parsed.decimalPlaces === \"number\" &&\r\n            typeof parsed.roundingPrecision === \"number\" &&\r\n            parsed.roundingPrecision > 0 &&\r\n            typeof parsed.thousandsSeparator === \"string\" &&\r\n            [\",\", \".\", \"'\", \" \"].includes(parsed.thousandsSeparator) // Accept all valid separators\r\n          ) {\r\n            setSettings((prev) => ({ ...defaultSettings, ...prev, ...parsed })); // Ensure defaults are applied\r\n          } else {\r\n            console.warn(\r\n              \"Loaded settings from localStorage are invalid or incomplete (excluding locale). Using defaults.\",\r\n            );\r\n            // Set merged defaults if loaded is bad\r\n            setSettings(defaultSettings);\r\n            localStorage.removeItem(\"appSettings\"); // Clear invalid storage\r\n          }\r\n        } else {\r\n          setSettings(defaultSettings); // Ensure defaults if nothing is loaded\r\n        }\r\n      } catch (error) {\r\n        console.error(\"Failed to load settings from localStorage:\", error);\r\n        setSettings(defaultSettings); // Fallback to defaults on error\r\n      }\r\n      setIsLoaded(true); // Mark as loaded to prevent re-running\r\n    }\r\n  }, [isLoaded]); // Dependency array ensures it runs once after initial mount\r\n\r\n  // Save settings to localStorage whenever they change\r\n  const saveSettings = (newSettings: Partial<Omit<AppSettings, \"locale\">>) => {\r\n    if (typeof window !== \"undefined\") {\r\n      // Ensure running on client\r\n      try {\r\n        // Create a clean copy without any potential 'locale' property\r\n        const cleanSettings = {\r\n          ...(newSettings.decimalPlaces !== undefined && {\r\n            decimalPlaces: newSettings.decimalPlaces,\r\n          }),\r\n          ...(newSettings.roundingPrecision !== undefined && {\r\n            roundingPrecision: newSettings.roundingPrecision,\r\n          }),\r\n          ...(newSettings.thousandsSeparator !== undefined && {\r\n            thousandsSeparator: newSettings.thousandsSeparator,\r\n          }),\r\n        };\r\n\r\n        const updatedSettings = { ...settings, ...cleanSettings };\r\n        setSettings(updatedSettings);\r\n\r\n        // Save to localStorage\r\n        localStorage.setItem(\"appSettings\", JSON.stringify(updatedSettings));\r\n      } catch (error) {\r\n        console.error(\"Failed to save settings to localStorage:\", error);\r\n      }\r\n    }\r\n  };\r\n\r\n  // The direct useEffect sync might cause issues with initial load, rely on saveSettings\r\n  // useEffect(() => { ... }, [settings]); // Remove this redundant effect\r\n\r\n  return (\r\n    // Pass down saveSettings instead of raw setSettings\r\n    <SettingsContext.Provider value={{ settings, saveSettings }}>\r\n      {children}\r\n    </SettingsContext.Provider>\r\n  );\r\n};\r\n\r\nexport const useSettings = (): SettingsContextProps => {\r\n  const context = useContext(SettingsContext);\r\n  if (!context) {\r\n    throw new Error(\"useSettings must be used within a SettingsProvider\");\r\n  }\r\n  return context;\r\n};\r\n","import(/* webpackMode: \"eager\", webpackExports: [\"__esModule\",\"default\"] */ \"C:\\\\Users\\\\Mauro\\\\Repos\\\\Siempi\\\\Saas\\\\billingperiodallocator\\\\node_modules\\\\next\\\\dist\\\\client\\\\app-dir\\\\link.js\");\n;\nimport(/* webpackMode: \"eager\", webpackExports: [\"default\"] */ \"C:\\\\Users\\\\Mauro\\\\Repos\\\\Siempi\\\\Saas\\\\billingperiodallocator\\\\src\\\\components\\\\app-seo-content.tsx\");\n;\nimport(/* webpackMode: \"eager\" */ \"C:\\\\Users\\\\Mauro\\\\Repos\\\\Siempi\\\\Saas\\\\billingperiodallocator\\\\src\\\\components\\\\invoice-calculator-client.tsx\");\n;\nimport(/* webpackMode: \"eager\", webpackExports: [\"default\"] */ \"C:\\\\Users\\\\Mauro\\\\Repos\\\\Siempi\\\\Saas\\\\billingperiodallocator\\\\src\\\\components\\\\loading.tsx\");\n;\nimport(/* webpackMode: \"eager\", webpackExports: [\"TranslationContext\"] */ \"C:\\\\Users\\\\Mauro\\\\Repos\\\\Siempi\\\\Saas\\\\billingperiodallocator\\\\src\\\\components\\\\translation-provider.tsx\");\n","/**\r\n * @fileoverview Date Utility Functions\r\n *\r\n * Timezone Strategy:\r\n * 1. Input Parsing: User-entered date strings (e.g., \"YYYY-MM-DD\") are parsed by `parseDate`\r\n *    into JavaScript `Date` objects representing **midnight UTC** of that calendar day.\r\n *    This is achieved by `createUTCDate` which appends 'T00:00:00Z'.\r\n * 2. Calculations: All core date calculations (e.g., in `calculations.ts`) operate on these\r\n *    UTC-normalized `Date` objects.\r\n * 3. Display: Dates are formatted for display by `formatDateForDisplay` using `Intl.DateTimeFormat`\r\n *    with the `timeZone: 'UTC'` option. This ensures that the displayed day, month, and year\r\n *    correspond to the UTC date, preventing shifts due to the user's local timezone.\r\n * 4. General Timestamps: Non-critical timestamps (e.g., \"Generated on\") may use local time.\r\n */\r\n\r\nimport { format, isValid, parse } from \"date-fns\";\r\n\r\n/**\r\n * Creates a Date object that's timezone-agnostic by setting time to midnight UTC.\r\n * This ensures consistent behavior regardless of user's timezone.\r\n * \r\n * @param dateStr - A date string in the format YYYY-MM-DD\r\n * @returns A Date object set to midnight UTC\r\n */\r\nexport function createUTCDate(dateStr: string): Date {\r\n  // Append T00:00:00Z to ensure UTC timezone\r\n  return new Date(`${dateStr}T00:00:00Z`);\r\n}\r\n\r\n/**\r\n * Parse a date from various formats with timezone consistency.\r\n * The returned date will be normalized to midnight UTC time.\r\n * \r\n * @param dateStr - A date string in various supported formats\r\n * @param formats - An array of formats to try (date-fns format patterns)\r\n * @returns A Date object or null if parsing fails\r\n */\r\nexport function parseDate(dateStr: string, formats: string[] = [\"yyyy-MM-dd\", \"dd.MM.yyyy\"]): Date | null {\r\n  if (!dateStr) return null;\r\n  \r\n  // Try direct ISO parsing first\r\n  if (dateStr.includes(\"T\")) {\r\n    const date = new Date(dateStr);\r\n    if (isValid(date)) {\r\n      // Normalize to midnight UTC\r\n      return createUTCDate(format(date, \"yyyy-MM-dd\"));\r\n    }\r\n  }\r\n  \r\n  // Try each format\r\n  for (const formatPattern of formats) {\r\n    try {\r\n      const parsedDate = parse(dateStr, formatPattern, new Date());\r\n      if (isValid(parsedDate)) {\r\n        // Normalize to midnight UTC\r\n        return createUTCDate(format(parsedDate, \"yyyy-MM-dd\"));\r\n      }\r\n    } catch {\r\n      // Continue to next format\r\n    }\r\n  }\r\n  \r\n  return null;\r\n}\r\n\r\n/**\r\n * Format a date for display, taking into account the locale\r\n * \r\n * @param date - A Date object or ISO date string\r\n * @param locale - The locale to use for formatting (e.g., 'en', 'de')\r\n * @returns A formatted date string\r\n */\r\nexport function formatDateForDisplay(date: Date | string | undefined, locale: string): string {\r\n  if (!date) return \"N/A\";\r\n  \r\n  try {\r\n    const dateObj = typeof date === \"string\" ? \r\n      (date.includes(\"T\") ? new Date(date) : createUTCDate(date)) : \r\n      date;\r\n    \r\n    // Format in UTC to display the date as it is, ignoring local timezone conversion for date parts\r\n    return new Intl.DateTimeFormat(locale, {\r\n      year: \"numeric\",\r\n      month: \"short\",\r\n      day: \"numeric\",\r\n      timeZone: \"UTC\"\r\n    }).format(dateObj);\r\n  } catch (error) {\r\n    console.error(\"Error formatting date:\", error);\r\n    // Fallback should also ideally respect UTC if possible\r\n    if (typeof date === \"string\") {\r\n        // Attempt to return YYYY-MM-DD if it's a simple date string, otherwise indicate error\r\n        return date.match(/^\\d{4}-\\d{2}-\\d{2}$/) ? date : \"Invalid Date String\";\r\n    }\r\n    return date.toISOString().split(\"T\")[0]; // This gives YYYY-MM-DD from UTC date\r\n  }\r\n} \r\n","\"use client\";\n\nimport { useEffect, useState } from 'react';\n\nimport { usePathname } from 'next/navigation';\n\n/**\n * Client-only SEO content component.\n * Renders JSON-LD structured data only on the client to avoid hydration mismatches.\n */\nexport default function AppSeoContent() {\n  const [mounted, setMounted] = useState(false);\n  const pathname = usePathname();\n  const isAppPage = pathname?.includes('/app');\n  \n  // Determine language from URL path instead of i18n hooks to avoid hydration issues\n  const isGerman = pathname?.includes('/de/');\n  \n  // Always run this effect at top level\n  useEffect(() => {\n    setMounted(true);\n  }, []);\n  \n  // Don't render during SSR\n  if (!mounted || !isAppPage) {\n    return null;\n  }\n  \n  // Hardcoded content by language for reliable rendering\n  const description = isGerman\n    ? \"Teilen Sie Rechnungen przise auf Geschftsjahre, Quartale oder Monate auf.\"\n    : \"Split invoices across fiscal years, quarters, or months with precision.\";\n  \n  return (\n    <div className=\"hidden\">\n      <script\n        type=\"application/ld+json\"\n        dangerouslySetInnerHTML={{\n          __html: JSON.stringify({\n            \"@context\": \"https://schema.org\",\n            \"@type\": \"SoftwareApplication\",\n            \"name\": \"BillSplitter\",\n            \"applicationCategory\": \"FinanceApplication\",\n            \"operatingSystem\": \"Web\",\n            \"offers\": {\n              \"@type\": \"Offer\",\n              \"price\": \"0\",\n              \"priceCurrency\": \"USD\"\n            },\n            \"description\": description\n          })\n        }}\n      />\n    </div>\n  );\n} \n","\"use client\";\r\n\r\nimport * as AccordionPrimitive from \"@radix-ui/react-accordion\";\r\nimport * as React from \"react\";\r\n\r\nimport { ChevronDownIcon } from \"lucide-react\";\r\nimport { cn } from \"@/lib/utils\";\r\n\r\nfunction Accordion({\r\n  ...props\r\n}: React.ComponentProps<typeof AccordionPrimitive.Root>) {\r\n  return <AccordionPrimitive.Root data-slot=\"accordion\" {...props} />;\r\n}\r\n\r\nfunction AccordionItem({\r\n  className,\r\n  ...props\r\n}: React.ComponentProps<typeof AccordionPrimitive.Item>) {\r\n  return (\r\n    <AccordionPrimitive.Item\r\n      data-slot=\"accordion-item\"\r\n      className={cn(\"\", className)}\r\n      {...props}\r\n    />\r\n  );\r\n}\r\n\r\nfunction AccordionTrigger({\r\n  className,\r\n  children,\r\n  ...props\r\n}: React.ComponentProps<typeof AccordionPrimitive.Trigger>) {\r\n  return (\r\n    <AccordionPrimitive.Header className=\"flex\">\r\n      <AccordionPrimitive.Trigger\r\n        data-slot=\"accordion-trigger\"\r\n        className={cn(\r\n          \"focus-visible:border-ring focus-visible:ring-ring/50 flex flex-1 items-start justify-between gap-4 rounded-md py-4 text-left text-sm font-medium transition-all outline-none hover:underline focus-visible:ring-[3px] disabled:pointer-events-none disabled:opacity-50 [&[data-state=open]>svg]:rotate-180\",\r\n          \"cursor-pointer select-none\",\r\n          className,\r\n        )}\r\n        {...props}\r\n      >\r\n        {children}\r\n        <ChevronDownIcon className=\"text-muted-foreground pointer-events-none size-4 shrink-0 translate-y-0.5 transition-transform duration-200\" />\r\n      </AccordionPrimitive.Trigger>\r\n    </AccordionPrimitive.Header>\r\n  );\r\n}\r\n\r\nfunction AccordionContent({\r\n  className,\r\n  children,\r\n  ...props\r\n}: React.ComponentProps<typeof AccordionPrimitive.Content>) {\r\n  return (\r\n    <AccordionPrimitive.Content\r\n      data-slot=\"accordion-content\"\r\n      className={cn(\r\n        \"data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down overflow-hidden text-sm\",\r\n        className\r\n      )}\r\n      {...props}\r\n    >\r\n      <div className={cn(\"pt-0 pb-4\", className)}>{children}</div>\r\n    </AccordionPrimitive.Content>\r\n  );\r\n}\r\n\r\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent };\r\n","import * as React from \"react\";\r\nimport { cva, type VariantProps } from \"class-variance-authority\";\r\n\r\nimport { cn } from \"@/lib/utils\";\r\n\r\nconst alertVariants = cva(\r\n  \"relative w-full rounded-lg border px-4 py-3 text-sm grid has-[>svg]:grid-cols-[calc(var(--spacing)*4)_1fr] grid-cols-[0_1fr] has-[>svg]:gap-x-3 gap-y-0.5 items-start [&>svg]:size-4 [&>svg]:translate-y-0.5 [&>svg]:text-current\",\r\n  {\r\n    variants: {\r\n      variant: {\r\n        default: \"bg-card text-card-foreground\",\r\n        destructive:\r\n          \"text-destructive bg-card [&>svg]:text-current *:data-[slot=alert-description]:text-destructive/90\",\r\n      },\r\n    },\r\n    defaultVariants: {\r\n      variant: \"default\",\r\n    },\r\n  },\r\n);\r\n\r\nfunction Alert({\r\n  className,\r\n  variant,\r\n  ...props\r\n}: React.ComponentProps<\"div\"> & VariantProps<typeof alertVariants>) {\r\n  return (\r\n    <div\r\n      data-slot=\"alert\"\r\n      role=\"alert\"\r\n      className={cn(alertVariants({ variant }), className)}\r\n      {...props}\r\n    />\r\n  );\r\n}\r\n\r\nfunction AlertTitle({ className, ...props }: React.ComponentProps<\"div\">) {\r\n  return (\r\n    <div\r\n      data-slot=\"alert-title\"\r\n      className={cn(\r\n        \"col-start-2 line-clamp-1 min-h-4 font-medium tracking-tight\",\r\n        className,\r\n      )}\r\n      {...props}\r\n    />\r\n  );\r\n}\r\n\r\nfunction AlertDescription({\r\n  className,\r\n  ...props\r\n}: React.ComponentProps<\"div\">) {\r\n  return (\r\n    <div\r\n      data-slot=\"alert-description\"\r\n      className={cn(\r\n        \"text-muted-foreground col-start-2 grid justify-items-start gap-1 text-sm [&_p]:leading-relaxed\",\r\n        className,\r\n      )}\r\n      {...props}\r\n    />\r\n  );\r\n}\r\n\r\nexport { Alert, AlertTitle, AlertDescription };\r\n","\"use client\";\r\n\r\nimport * as React from \"react\";\r\n\r\nimport { cn } from \"@/lib/utils\";\r\n\r\nfunction Table({ className, ...props }: React.ComponentProps<\"table\">) {\r\n  return (\r\n    <div\r\n      data-slot=\"table-container\"\r\n      className=\"relative w-full overflow-x-auto\"\r\n    >\r\n      <table\r\n        data-slot=\"table\"\r\n        className={cn(\"w-full caption-bottom text-sm\", className)}\r\n        {...props}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction TableHeader({ className, ...props }: React.ComponentProps<\"thead\">) {\r\n  return (\r\n    <thead\r\n      data-slot=\"table-header\"\r\n      className={cn(\"[&_tr]:border-b\", className)}\r\n      {...props}\r\n    />\r\n  );\r\n}\r\n\r\nfunction TableBody({ className, ...props }: React.ComponentProps<\"tbody\">) {\r\n  return (\r\n    <tbody\r\n      data-slot=\"table-body\"\r\n      className={cn(\"[&_tr:last-child]:border-0\", className)}\r\n      {...props}\r\n    />\r\n  );\r\n}\r\n\r\nfunction TableFooter({ className, ...props }: React.ComponentProps<\"tfoot\">) {\r\n  return (\r\n    <tfoot\r\n      data-slot=\"table-footer\"\r\n      className={cn(\r\n        \"bg-muted/50 border-t font-medium [&>tr]:last:border-b-0\",\r\n        className,\r\n      )}\r\n      {...props}\r\n    />\r\n  );\r\n}\r\n\r\nfunction TableRow({ className, ...props }: React.ComponentProps<\"tr\">) {\r\n  return (\r\n    <tr\r\n      data-slot=\"table-row\"\r\n      className={cn(\r\n        \"hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors\",\r\n        className,\r\n      )}\r\n      {...props}\r\n    />\r\n  );\r\n}\r\n\r\nfunction TableHead({ className, ...props }: React.ComponentProps<\"th\">) {\r\n  return (\r\n    <th\r\n      data-slot=\"table-head\"\r\n      className={cn(\r\n        \"text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]\",\r\n        className,\r\n      )}\r\n      {...props}\r\n    />\r\n  );\r\n}\r\n\r\nfunction TableCell({ className, ...props }: React.ComponentProps<\"td\">) {\r\n  return (\r\n    <td\r\n      data-slot=\"table-cell\"\r\n      className={cn(\r\n        \"p-2 align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]\",\r\n        className,\r\n      )}\r\n      {...props}\r\n    />\r\n  );\r\n}\r\n\r\nfunction TableCaption({\r\n  className,\r\n  ...props\r\n}: React.ComponentProps<\"caption\">) {\r\n  return (\r\n    <caption\r\n      data-slot=\"table-caption\"\r\n      className={cn(\"text-muted-foreground mt-4 text-sm\", className)}\r\n      {...props}\r\n    />\r\n  );\r\n}\r\n\r\nexport {\r\n  Table,\r\n  TableHeader,\r\n  TableBody,\r\n  TableFooter,\r\n  TableHead,\r\n  TableRow,\r\n  TableCell,\r\n  TableCaption,\r\n};\r\n","import { AppSettings } from \"@/context/settings-context\";\r\nimport { formatDateForDisplay } from \"./date-utils\";\r\n\r\n/**\r\n * Formats a number according to the application settings using Intl.NumberFormat.\r\n * @param value The number to format.\r\n * @param locale The locale string.\r\n * @param settings The current application settings.\r\n * @returns Formatted number string.\r\n */\r\nexport function formatNumber(\r\n  value: number,\r\n  locale: string,\r\n  settings: Omit<AppSettings, \"locale\">,\r\n): string {\r\n  try {\r\n    return new Intl.NumberFormat(locale, {\r\n      minimumFractionDigits: settings.decimalPlaces,\r\n      maximumFractionDigits: settings.decimalPlaces,\r\n    }).format(value);\r\n  } catch (error) {\r\n    console.error(\"Error formatting number:\", error);\r\n    // Fallback to simple formatting\r\n    return value.toFixed(settings.decimalPlaces);\r\n  }\r\n}\r\n\r\n/**\r\n * Rounds a number based on the specified rounding precision factor.\r\n * @param value The number to round.\r\n * @param precision The rounding factor (e.g., 0.01, 0.05, 1). Must be > 0.\r\n * @returns Rounded number.\r\n */\r\nexport function roundValue(value: number, precision: number): number {\r\n  if (precision <= 0) {\r\n    console.warn(`Invalid rounding precision: ${precision}. Using 0.01.`);\r\n    precision = 0.01;\r\n  }\r\n  const multiplier = 1 / precision;\r\n  return Math.round(value * multiplier) / multiplier;\r\n}\r\n\r\n/**\r\n * Formats a date according to locale. Accepts either a Date object or a string in YYYY-MM-DD format.\r\n * @param dateInput Date as a string in 'yyyy-MM-dd' format or as a Date object.\r\n * @param locale Locale string (e.g., 'en', 'de').\r\n * @returns Formatted date string.\r\n */\r\nexport function formatDateLocale(dateInput: string | Date | undefined, locale: string): string {\r\n  // Use the improved date formatting function from date-utils.ts\r\n  return formatDateForDisplay(dateInput, locale);\r\n}\r\n\r\n/**\r\n * Formats a percentage value according to locale.\r\n * @param value The percentage value (0 to 1).\r\n * @param locale The locale string.\r\n * @returns Formatted percentage string.\r\n */\r\nexport function formatPercent(value: number, locale: string): string {\r\n  try {\r\n    return new Intl.NumberFormat(locale, {\r\n      style: \"percent\",\r\n      minimumFractionDigits: 2, // Usually keep 2 decimals for percentages\r\n      maximumFractionDigits: 2,\r\n    }).format(value);\r\n  } catch (error) {\r\n    console.error(\"Error formatting percent:\", error);\r\n    // Fallback\r\n    return (value * 100).toFixed(2) + \"%\";\r\n  }\r\n}\r\n","\"use client\";\r\n\r\nimport * as z from \"zod\";\r\n\r\nimport {\r\n  Dialog,\r\n  DialogClose,\r\n  DialogContent,\r\n  DialogFooter,\r\n  DialogHeader,\r\n  DialogTitle,\r\n  DialogDescription as UiDialogDescription,\r\n} from \"@/components/ui/dialog\";\r\nimport {\r\n  Form,\r\n  FormControl,\r\n  FormDescription,\r\n  FormField,\r\n  FormItem,\r\n  FormLabel,\r\n  FormMessage,\r\n} from \"@/components/ui/form\";\r\nimport {\r\n  Select,\r\n  SelectContent,\r\n  SelectItem,\r\n  SelectTrigger,\r\n  SelectValue,\r\n} from \"@/components/ui/select\";\r\nimport { useEffect, useState } from \"react\";\r\n\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport React from \"react\";\r\nimport { Settings } from \"lucide-react\";\r\nimport { useForm } from \"react-hook-form\";\r\nimport { useSettings } from \"@/context/settings-context\";\r\nimport { useTranslation } from \"@/translations\";\r\nimport { zodResolver } from \"@hookform/resolvers/zod\";\r\n\r\n// Define a simpler form schema without transforms to avoid type issues\r\nconst FormSchema = z.object({\r\n  decimalPlaces: z.string().nonempty(\"Decimal places is required\"),\r\n  roundingPrecision: z.string().nonempty(\"Rounding precision is required\"),\r\n  thousandsSeparator: z.string(),\r\n  locale: z.string(),\r\n});\r\n\r\n// Our form is typed based on this schema\r\ntype FormValues = z.infer<typeof FormSchema>;\r\n\r\ninterface SettingsModalProps {\r\n  isOpen?: boolean;\r\n  onOpenChange?: (isOpen: boolean) => void;\r\n  variant?: React.ComponentProps<typeof Button>[\"variant\"];\r\n  size?: React.ComponentProps<typeof Button>[\"size\"];\r\n  className?: string;\r\n}\r\n\r\nexport function SettingsModal({ \r\n  isOpen: externalIsOpen, \r\n  onOpenChange: externalOnOpenChange,\r\n  variant = \"ghost\",\r\n  size = \"icon\",\r\n  className\r\n}: SettingsModalProps) {\r\n  const { settings, saveSettings } = useSettings();\r\n  const { t } = useTranslation();\r\n  const [internalIsOpen, setInternalIsOpen] = useState(false);\r\n  const [isMounted, setIsMounted] = useState(false);\r\n\r\n  // Use either the external state or internal state\r\n  const isOpen = externalIsOpen !== undefined ? externalIsOpen : internalIsOpen;\r\n  const onOpenChange = externalOnOpenChange || setInternalIsOpen;\r\n\r\n  // Always ensure there's a default separator\r\n  const defaultSeparator = \",\";\r\n\r\n  // Track form validity state\r\n  const [isValid, setIsValid] = useState(true);\r\n\r\n  // Fix the form type to match form values\r\n  const form = useForm<FormValues>({\r\n    resolver: zodResolver(FormSchema),\r\n    defaultValues: {\r\n      decimalPlaces: settings.decimalPlaces?.toString() || \"\",\r\n      roundingPrecision: settings.roundingPrecision?.toString() || \"0.01\",\r\n      thousandsSeparator: settings.thousandsSeparator || defaultSeparator,\r\n      locale: \"en-US\",\r\n    },\r\n    mode: \"onChange\", // Validate on every change\r\n  });\r\n\r\n  // Reset form when dialog opens or settings change\r\n  useEffect(() => {\r\n    if (isOpen) {\r\n      // Ensure we're using the latest settings from context\r\n      form.reset({\r\n        decimalPlaces: settings.decimalPlaces?.toString() || \"\",\r\n        roundingPrecision: settings.roundingPrecision?.toString() || \"0.01\",\r\n        thousandsSeparator: settings.thousandsSeparator || defaultSeparator,\r\n        locale: \"en-US\",\r\n      });\r\n    }\r\n  }, [isOpen, settings, form, defaultSeparator]);\r\n\r\n  // Update isValid when form state changes\r\n  useEffect(() => {\r\n    const subscription = form.watch(() => {\r\n      const hasErrors = !!Object.keys(form.formState.errors).length;\r\n      const formValues = form.getValues();\r\n      const isDecimalEmpty =\r\n        !formValues.decimalPlaces || formValues.decimalPlaces === \"\";\r\n\r\n      setIsValid(!hasErrors && !isDecimalEmpty);\r\n    });\r\n    return () => subscription.unsubscribe();\r\n  }, [form]);\r\n\r\n  useEffect(() => {\r\n    setIsMounted(true);\r\n  }, [settings]);\r\n\r\n  // Handle dialog close - ensure unsaved changes are discarded\r\n  const handleOpenChange = (open: boolean) => {\r\n    if (!open) {\r\n      // Reset form when dialog is closed without saving\r\n      form.reset({\r\n        decimalPlaces: settings.decimalPlaces?.toString() || \"\",\r\n        roundingPrecision: settings.roundingPrecision?.toString() || \"0.01\",\r\n        thousandsSeparator: settings.thousandsSeparator || defaultSeparator,\r\n        locale: \"en-US\",\r\n      });\r\n    }\r\n    onOpenChange(open);\r\n  };\r\n\r\n  function onSubmit(data: FormValues) {\r\n    // Validate decimal places\r\n    const decimalPlaces = Number(data.decimalPlaces);\r\n    if (isNaN(decimalPlaces) || decimalPlaces < 0 || decimalPlaces > 6) {\r\n      form.setError(\"decimalPlaces\", {\r\n        type: \"manual\",\r\n        message: \"Decimal places must be between 0 and 6\",\r\n      });\r\n      return;\r\n    }\r\n\r\n    // Validate rounding precision\r\n    const normalized = data.roundingPrecision.replace(\",\", \".\");\r\n    const roundingPrecision = Number(normalized);\r\n    if (\r\n      isNaN(roundingPrecision) ||\r\n      roundingPrecision < 0.0001 ||\r\n      roundingPrecision > 100\r\n    ) {\r\n      form.setError(\"roundingPrecision\", {\r\n        type: \"manual\",\r\n        message: \"Rounding precision must be between 0.0001 and 100\",\r\n      });\r\n      return;\r\n    }\r\n\r\n    // Only save settings when user submits the form and all validations pass\r\n    const updatedSettings = {\r\n      decimalPlaces: decimalPlaces,\r\n      roundingPrecision: roundingPrecision,\r\n      thousandsSeparator: data.thousandsSeparator || defaultSeparator,\r\n      locale: data.locale,\r\n    };\r\n\r\n    // Handle the locale/language change\r\n    const newLocale = data.locale;\r\n    if (newLocale && \"en-US\" !== newLocale) {\r\n      // Implement language change logic here\r\n    }\r\n\r\n    // Save all settings at once after form submission\r\n    saveSettings(updatedSettings);\r\n\r\n    // Dispatch a custom event to notify the application that settings have changed\r\n    if (typeof window !== \"undefined\") {\r\n      window.dispatchEvent(\r\n        new CustomEvent(\"settingsChanged\", {\r\n          detail: { settings: updatedSettings },\r\n        }),\r\n      );\r\n    }\r\n\r\n    onOpenChange(false);\r\n  }\r\n\r\n  // Always ensure we have a valid separator value for the dropdown\r\n  const currentSeparator = form.watch(\"thousandsSeparator\") || defaultSeparator;\r\n\r\n  // Determine labels based on mounted state\r\n  const triggerLabel = isMounted ? t(\"SettingsModal.settingsModalTitle\") : \"Number Formatting Settings\";\r\n  const dialogTitle = isMounted ? t(\"SettingsModal.settingsModalTitle\") : \"Number Formatting Settings\";\r\n  const dialogDescription = isMounted ? t(\"SettingsModal.settingsModalDescription\") : \"Adjust your preferred number formatting for allocations and reports.\";\r\n  const saveLabel = isMounted ? t(\"SettingsModal.saveButton\") : \"Save Settings\";\r\n  const cancelLabel = isMounted ? t(\"SettingsModal.cancelButton\", \"Cancel\") : \"Cancel\";\r\n\r\n  return (\r\n    <>\r\n      {!externalIsOpen && !externalOnOpenChange && (\r\n        <Button\r\n          variant={variant}\r\n          size={size}\r\n          onClick={() => setInternalIsOpen(true)}\r\n          className={className}\r\n          aria-label={triggerLabel}\r\n        >\r\n          <Settings className=\"size-4\" />\r\n          {size !== \"icon\" && t(\"SettingsModal.settingsButtonText\", \"Settings\")}\r\n        </Button>\r\n      )}\r\n\r\n      <Dialog open={isOpen} onOpenChange={handleOpenChange}>\r\n        <DialogContent className=\"sm:max-w-[425px]\">\r\n          <DialogHeader>\r\n            <DialogTitle>{dialogTitle}</DialogTitle>\r\n            <UiDialogDescription>{dialogDescription}</UiDialogDescription>\r\n          </DialogHeader>\r\n          <Form {...form}>\r\n            <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-6\">\r\n              <FormField\r\n                control={form.control}\r\n                name=\"decimalPlaces\"\r\n                render={({ field }) => (\r\n                  <FormItem>\r\n                    <FormLabel>{t(\"SettingsModal.decimalPlacesLabel\")}</FormLabel>\r\n                    <FormControl>\r\n                      <Input required {...field} />\r\n                    </FormControl>\r\n                    <FormDescription>\r\n                      {t(\"SettingsModal.decimalPlacesDescription\")}\r\n                    </FormDescription>\r\n                    <FormMessage />\r\n                  </FormItem>\r\n                )}\r\n              />\r\n              <FormField\r\n                control={form.control}\r\n                name=\"roundingPrecision\"\r\n                render={({ field }) => (\r\n                  <FormItem>\r\n                    <FormLabel>\r\n                      {t(\"SettingsModal.roundingPrecisionLabel\")}\r\n                    </FormLabel>\r\n                    <FormControl>\r\n                      <Input required {...field} />\r\n                    </FormControl>\r\n                    <FormDescription>\r\n                      {t(\"SettingsModal.roundingPrecisionDescription\")}\r\n                    </FormDescription>\r\n                    <FormMessage />\r\n                  </FormItem>\r\n                )}\r\n              />\r\n              <FormField\r\n                control={form.control}\r\n                name=\"thousandsSeparator\"\r\n                render={({ field }) => (\r\n                  <FormItem>\r\n                    <FormLabel>\r\n                      {t(\"SettingsModal.thousandsSeparatorLabel\")}\r\n                    </FormLabel>\r\n                    <Select\r\n                      onValueChange={(value) => {\r\n                        field.onChange(value || defaultSeparator);\r\n                      }}\r\n                      value={currentSeparator}\r\n                    >\r\n                      <FormControl>\r\n                        <SelectTrigger>\r\n                          <SelectValue>\r\n                            {currentSeparator === \",\"\r\n                              ? `${t(\"SettingsModal.comma\")} (1,234.56)`\r\n                              : currentSeparator === \".\"\r\n                                ? `${t(\"SettingsModal.period\")} (1.234,56)`\r\n                                : currentSeparator === \"'\"\r\n                                  ? `${t(\"SettingsModal.apostrophe\")} (1&apos;234.56)`\r\n                                  : currentSeparator === \" \"\r\n                                    ? `${t(\"SettingsModal.space\")} (1 234.56)`\r\n                                    : t(\"SettingsModal.comma\")}\r\n                          </SelectValue>\r\n                        </SelectTrigger>\r\n                      </FormControl>\r\n                      <SelectContent>\r\n                        <SelectItem key=\",\" value=\",\">\r\n                          {`${t(\"SettingsModal.comma\")} (1,234.56)`}\r\n                        </SelectItem>\r\n                        <SelectItem key=\".\" value=\".\">\r\n                          {`${t(\"SettingsModal.period\")} (1.234,56)`}\r\n                        </SelectItem>\r\n                        <SelectItem key=\"'\" value=\"'\">\r\n                          {`${t(\"SettingsModal.apostrophe\")} (1&apos;234.56)`}\r\n                        </SelectItem>\r\n                        <SelectItem key=\"space\" value=\" \">\r\n                          {`${t(\"SettingsModal.space\")} (1 234.56)`}\r\n                        </SelectItem>\r\n                      </SelectContent>\r\n                    </Select>\r\n                    <FormDescription>\r\n                      {t(\"SettingsModal.thousandsSeparatorDescription\")}\r\n                    </FormDescription>\r\n                    <FormMessage />\r\n                  </FormItem>\r\n                )}\r\n              />\r\n              <FormField\r\n                control={form.control}\r\n                name=\"locale\"\r\n                render={({ field }) => (\r\n                  <FormItem>\r\n                    <FormLabel>{t(\"SettingsModal.localeLabel\")}</FormLabel>\r\n                    <Select onValueChange={field.onChange} defaultValue={field.value}>\r\n                      <FormControl>\r\n                        <SelectTrigger>\r\n                          <SelectValue placeholder={t(\"SettingsModal.localePlaceholder\")} />\r\n                        </SelectTrigger>\r\n                      </FormControl>\r\n                      <SelectContent>\r\n                        <SelectItem value=\"en-US\">English (United States)</SelectItem>\r\n                        <SelectItem value=\"de-DE\">Deutsch (Deutschland)</SelectItem>\r\n                        {/* Add other locales as needed */}\r\n                      </SelectContent>\r\n                    </Select>\r\n                    <FormDescription>\r\n                      {t(\"SettingsModal.localeDescription\")}\r\n                    </FormDescription>\r\n                    <FormMessage />\r\n                  </FormItem>\r\n                )}\r\n              />\r\n              <DialogFooter className=\"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2 gap-2 sm:gap-0\">\r\n                <DialogClose asChild>\r\n                  <Button type=\"button\" variant=\"outline\" className=\"w-full sm:w-auto\">\r\n                    {cancelLabel}\r\n                  </Button>\r\n                </DialogClose>\r\n                <Button type=\"submit\" disabled={!isValid} className=\"w-full sm:w-auto\">\r\n                  {saveLabel}\r\n                </Button>\r\n              </DialogFooter>\r\n            </form>\r\n          </Form>\r\n        </DialogContent>\r\n      </Dialog>\r\n    </>\r\n  );\r\n}\r\n","\"use client\";\r\n\r\nimport {\r\n  Accordion,\r\n  AccordionContent,\r\n  AccordionItem,\r\n  AccordionTrigger,\r\n} from \"@/components/ui/accordion\";\r\nimport {\r\n  CalculationInput,\r\n  CalculationResult,\r\n  CalculationStepDetails,\r\n} from \"@/lib/calculations\";\r\nimport { Card, CardContent } from \"@/components/ui/card\";\r\nimport React, { useState } from \"react\";\r\nimport {\r\n  Table,\r\n  TableBody,\r\n  TableCell,\r\n  TableFooter,\r\n  TableHead,\r\n  TableHeader,\r\n  TableRow,\r\n} from \"@/components/ui/table\";\r\nimport { de, enUS } from 'date-fns/locale';\r\nimport {\r\n  formatDateLocale as utilFormatDateLocale,\r\n  formatNumber as utilFormatNumber,\r\n  formatPercent as utilFormatPercent,\r\n} from \"@/lib/formattingUtils\";\r\n\r\nimport { AppSettings } from \"@/context/settings-context\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport type { CellHookData } from 'jspdf-autotable';\r\nimport { SettingsModal } from \"@/components/settings-modal\";\r\nimport { format } from \"date-fns\";\r\nimport type { jsPDF } from 'jspdf';\r\nimport { useSettings } from \"@/context/settings-context\";\r\nimport { useTranslation } from \"@/translations\";\r\n\r\n// Define a type for the jsPDF internal object with just the properties we need\r\ntype JsPDFWithInternal = jsPDF & {\r\n  internal: {\r\n    getNumberOfPages: () => number;\r\n    pageSize: {\r\n      width: number;\r\n      height: number;\r\n    }\r\n  };\r\n  // Add lastAutoTable property for autoTable plugin\r\n  lastAutoTable?: {\r\n    finalY: number;\r\n  };\r\n};\r\n\r\n// eslint-disable-next-line @typescript-eslint/no-empty-object-type -- Interface inherits members via Pick\r\ninterface InputDataForDisplay\r\n  extends Pick<\r\n    CalculationInput,\r\n    \"startDate\" | \"endDate\" | \"includeEndDate\" | \"amounts\" | \"splitPeriod\"\r\n  > {}\r\n\r\ninterface ResultsDisplayProps {\r\n  results: CalculationResult;\r\n  inputData: InputDataForDisplay;\r\n}\r\n\r\n// --- Period Formatting Helper ---\r\nfunction formatPeriodIdentifier(\r\n  identifier: string,\r\n  periodType: 'yearly' | 'quarterly' | 'monthly',\r\n  locale: string\r\n): string {\r\n  switch (periodType) {\r\n    case 'monthly':\r\n      try {\r\n        const [year, month] = identifier.split('-');\r\n        const date = new Date(parseInt(year), parseInt(month) - 1, 1);\r\n        return format(date, 'MMMM yyyy', { locale: locale === 'de' ? de : enUS });\r\n      } catch { \r\n        return identifier; \r\n      }\r\n    case 'quarterly':\r\n      return identifier;\r\n    case 'yearly':\r\n    default:\r\n      return identifier;\r\n  }\r\n}\r\n\r\n// --- Calculation Steps Renderer Component ---\r\nconst CalculationStepsDisplay = ({\r\n  steps,\r\n  settings,\r\n  splitPeriodUsed,\r\n}: {\r\n  steps: CalculationStepDetails;\r\n  settings: Omit<AppSettings, \"locale\">;\r\n  splitPeriodUsed: 'yearly' | 'quarterly' | 'monthly';\r\n}) => {\r\n  const { t, i18n } = useTranslation();\r\n  const currentLocale = i18n.language;\r\n\r\n  if (steps.error) {\r\n    // Convert the error to a string representation\r\n    const errorMessage = typeof steps.error === 'string' \r\n      ? steps.error \r\n      : (steps.error.message || 'Unknown error');\r\n      \r\n    return <p className=\"text-destructive\">{errorMessage}</p>;\r\n  }\r\n\r\n  const { periodSegments, amountCalculations } = steps;\r\n\r\n  const fmtNum = (num: number) => utilFormatNumber(num, currentLocale, settings);\r\n  const fmtPeriod = (id: string) => formatPeriodIdentifier(id, splitPeriodUsed, currentLocale);\r\n  const fmtDate = (dateStr: string) => utilFormatDateLocale(dateStr, currentLocale);\r\n  const fmtPct = (val: number) => utilFormatPercent(val, currentLocale);\r\n\r\n  return (\r\n    <div className=\"text-sm space-y-6\">\r\n       {/* Total Duration and Period Breakdown Section */}\r\n      <section className=\"bg-muted/40 rounded-lg p-4 space-y-4\">\r\n        <h4 className=\"font-semibold text-foreground\">{t('ResultsDisplay.totalDuration')}</h4>\r\n        <div className=\"grid grid-cols-2 gap-2 text-xs border-b pb-2 mb-2\">\r\n          <div>{t('ResultsDisplay.periodLabel')}</div> <div className=\"text-right\">{fmtDate(steps.totalDuration.start)} - {fmtDate(steps.totalDuration.end)}</div>\r\n          <div>{t('ResultsDisplay.totalDays')}</div> <div className=\"text-right\">{steps.totalDuration.days} ({steps.totalDuration.included ? t('ResultsDisplay.inclusiveLabel') : t('ResultsDisplay.exclusiveLabel')})</div>\r\n        </div>\r\n        <h4 className=\"font-semibold text-foreground\">{t('ResultsDisplay.proportionCalculation')}</h4>\r\n        <div className=\"space-y-1\">\r\n          {periodSegments.map((seg) => (\r\n            <div key={seg.periodIdentifier} className=\"grid grid-cols-3 gap-2 text-xs\">\r\n              <div className=\"font-medium\">{fmtPeriod(seg.periodIdentifier)}:</div>\r\n              <div className=\"text-muted-foreground text-center\">{seg.days} / {steps.totalDuration.days} {t('ResultsDisplay.daysLabel')}</div>\r\n              <div className=\"text-muted-foreground text-right\">{fmtPct(seg.proportion)}</div>\r\n            </div>\r\n          ))}\r\n        </div>\r\n      </section>\r\n\r\n      {/* Split Calculation per Input Amount Section */}\r\n      <section className=\"bg-muted/40 rounded-lg p-4\">\r\n        <h4 className=\"font-semibold text-foreground mb-4\">{t('ResultsDisplay.splitCalculation')}</h4>\r\n        <div className=\"space-y-6\">\r\n          {amountCalculations.map((amtCalc, index) => (\r\n            <div\r\n              key={index}\r\n              className=\"rounded-md border bg-background p-4 space-y-2 transition-shadow hover:shadow-md\"\r\n            >\r\n              <div className=\"font-bold text-[15px] text-primary mb-3 pb-1 border-b border-primary/20 bg-primary/[0.08] -mx-4 px-4 py-2 rounded-t-md\">\r\n                {t(\"ResultsDisplay.inputAmountLabel\")} #{index + 1}:{\" \"}\r\n                {fmtNum(amtCalc.originalAmount)}\r\n              </div>\r\n              <div className=\"space-y-3\">\r\n                {amtCalc.periodSplits.map((ps, periodIndex) => (\r\n                  <div\r\n                    key={ps.periodIdentifier}\r\n                    className={`pl-2 text-xs space-y-0.5 ${periodIndex < amtCalc.periodSplits.length - 1 ? \"border-b border-muted/30 pb-2\" : \"\"}`}\r\n                  >\r\n                    <div className=\"font-medium shrink-0 text-foreground\">\r\n                      {fmtPeriod(ps.periodIdentifier)}:\r\n                    </div>\r\n                    <div className=\"text-muted-foreground ml-2\">\r\n                      <span>\r\n                        {fmtNum(amtCalc.originalAmount)} *{\" \"}\r\n                        {periodSegments\r\n                          .find((s) => s.periodIdentifier === ps.periodIdentifier)\r\n                          ?.proportion.toFixed(6)}\r\n                      </span>\r\n                      <span className=\"block sm:inline\">\r\n                        {\" \"}\r\n                        = {ps.rawSplit.toFixed(6)}\r\n                      </span>\r\n                    </div>\r\n                    <div className=\"ml-2 flex items-center gap-x-2\">\r\n                      <span></span>\r\n                      <span className=\"font-medium text-foreground\">\r\n                        {t(\"ResultsDisplay.roundedLabel\")}:{\" \"}\r\n                        {fmtNum(ps.roundedSplit)}\r\n                      </span>\r\n                      {ps.adjustment !== 0 && (\r\n                        <span className=\"text-muted-foreground text-xs\">\r\n                          ({t(\"ResultsDisplay.adjustmentLabel\")}:{\" \"}\r\n                          {fmtNum(ps.adjustment)})\r\n                        </span>\r\n                      )}\r\n                    </div>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n              <div className=\"border-t pt-2 mt-2 space-y-1 text-xs\">\r\n                <p>\r\n                  <span className=\"font-medium text-foreground\">\r\n                    {t(\"ResultsDisplay.discrepancyLabel\")}:\r\n                  </span>\r\n                  <span\r\n                    className={`${Math.abs(amtCalc.discrepancy) > 0.001 ? \"text-warning dark:text-warning\" : \"text-muted-foreground/70\"}`}\r\n                  >\r\n                    {\" \"}\r\n                    {fmtNum(amtCalc.discrepancy)}\r\n                  </span>\r\n                  {amtCalc.adjustmentAppliedToPeriod && (\r\n                    <span className=\"text-muted-foreground\">\r\n                      ({t(\"ResultsDisplay.adjustedInYearLabel\", { defaultValue: \"Applied in Year\" })}{\" \"}\r\n                      {fmtPeriod(amtCalc.adjustmentAppliedToPeriod)})\r\n                    </span>\r\n                  )}\r\n                </p>\r\n                <p className=\"font-semibold text-sm text-foreground pt-1\">\r\n                  {t(\"ResultsDisplay.finalSumLabel\")}:{\" \"}\r\n                  <span className=\"text-primary\">\r\n                    {fmtNum(amtCalc.finalSum)}\r\n                  </span>\r\n                </p>\r\n              </div>\r\n            </div>\r\n          ))}\r\n        </div>\r\n      </section>\r\n    </div>\r\n  );\r\n};\r\n// --- End Calculation Steps Renderer ---\r\n\r\n// Original component function\r\nfunction ResultsDisplayComponent({ results, inputData }: ResultsDisplayProps) {\r\n  const { t, i18n } = useTranslation();\r\n  const { settings } = useSettings();\r\n  const [isSettingsOpen, setIsSettingsOpen] = useState(false);\r\n  const currentLocale = i18n.language;\r\n\r\n  // Ensure we use the splitPeriod from the inputData if available\r\n  const splitPeriodUsed = inputData.splitPeriod || 'yearly';\r\n\r\n  // Memoized formatting functions based on current settings and locale\r\n  const formatNumForDisplay = (value: number | undefined) =>\r\n    value !== undefined ? utilFormatNumber(value, currentLocale, settings) : \"\";\r\n  const formatPctForDisplay = (value: number | undefined) => \r\n    value !== undefined ? utilFormatPercent(value, currentLocale) : \"\";\r\n  const formatDateForDisplay = (dateObj: Date | string | undefined) =>\r\n    dateObj ? utilFormatDateLocale(dateObj, currentLocale) : \"\";\r\n  const formatPeriodIdForDisplay = (id: string) => formatPeriodIdentifier(id, splitPeriodUsed, currentLocale);\r\n\r\n  // Function to get appropriate header for the allocation table\r\n  const getPeriodHeader = () => {\r\n      switch (splitPeriodUsed) {\r\n        case 'monthly': return t('ResultsDisplay.monthHeader');\r\n          case 'quarterly': return t('ResultsDisplay.quarterHeader');\r\n          case 'yearly':\r\n          default: return t('ResultsDisplay.yearHeader');\r\n      }\r\n  };\r\n\r\n  // Calculate derived values with checks\r\n  const totalDurationDays = results.calculationSteps?.totalDuration?.days ?? 0;\r\n  const totalInputAmount = inputData.amounts.reduce((sum, val) => sum + (isNaN(val) ? 0 : val), 0);\r\n  // Assuming AggregatedPeriodSplit has totalSplitAmount based on previous potential structure\r\n  const totalAggregatedAmount = results.aggregatedSplits?.reduce((sum, s) => sum + (s.totalSplitAmount ?? 0), 0) ?? 0;\r\n\r\n  // Export functions (keep implementations as they were)\r\n  function handleExportExcel() { \r\n      import('xlsx').then(XLSX => {\r\n          // Create a single consolidated sheet for all data\r\n          const workbook = XLSX.utils.book_new();\r\n          \r\n          // Prepare all data for a single sheet\r\n          const consolidatedData = [];\r\n          \r\n          // 1. Title and Summary Section\r\n          consolidatedData.push([t(\"ResultsDisplay.summaryTitle\", { defaultValue: \"Summary\" })]);\r\n          consolidatedData.push([]);\r\n          consolidatedData.push([t(\"ResultsDisplay.periodLabel\"), `${formatDateForDisplay(inputData.startDate)} - ${formatDateForDisplay(inputData.endDate)}`]);\r\n          consolidatedData.push([t(\"ResultsDisplay.totalDurationLabel\", { defaultValue: \"Total Duration (days)\" }), `${totalDurationDays} ${t(\"ResultsDisplay.daysLabel\")}`]);\r\n          consolidatedData.push([t(\"InvoiceForm.includeEndDateLabel\", { defaultValue: \"Include Final Day in Service Period?\" }), inputData.includeEndDate ? t(\"ResultsDisplay.yesLabel\", { defaultValue: \"Yes\" }) : t(\"ResultsDisplay.noLabel\", { defaultValue: \"No\" })]);\r\n          consolidatedData.push([t(\"InvoiceForm.splitPeriodLabel\", { defaultValue: \"Split Period\" }), splitPeriodUsed === 'yearly' ? t('InvoiceForm.periodYearly') : splitPeriodUsed === 'quarterly' ? t('InvoiceForm.periodQuarterly') : t('InvoiceForm.periodMonthly')]);\r\n          consolidatedData.push([t(\"ResultsDisplay.originalTotalLabel\", { defaultValue: \"Total Input Amount:\" }), formatNumForDisplay(totalInputAmount)]);\r\n          consolidatedData.push([]);\r\n          \r\n          // 2. Allocation Results Section\r\n          consolidatedData.push([t(\"ResultsDisplay.aggregatedTitle\", { defaultValue: \"Allocation per Period\" })]);\r\n          consolidatedData.push([]);\r\n          consolidatedData.push([getPeriodHeader(), t(\"ResultsDisplay.daysHeader\"), t(\"ResultsDisplay.proportionHeader\"), t(\"ResultsDisplay.amountHeader\")]);\r\n          \r\n          results.aggregatedSplits?.forEach(split => {\r\n              consolidatedData.push([\r\n                  formatPeriodIdForDisplay(split.periodIdentifier),\r\n                  split.daysInPeriod,\r\n                  split.proportion,\r\n                  split.totalSplitAmount\r\n              ]);\r\n          });\r\n          \r\n          consolidatedData.push([t(\"ResultsDisplay.totalLabel\", { defaultValue: \"Total\" }), totalDurationDays, 1, totalAggregatedAmount]);\r\n          consolidatedData.push([]);\r\n          consolidatedData.push([]);\r\n          \r\n          // 3. Detailed Calculation Section\r\n          if (results.calculationSteps) {\r\n              const steps = results.calculationSteps;\r\n              const { periodSegments, amountCalculations } = steps;\r\n              \r\n              // a. Add title\r\n              consolidatedData.push([t('ResultsDisplay.calculationStepsTitle', { defaultValue: \"View Full Split Calculation\" })]);\r\n              consolidatedData.push([]);\r\n              \r\n              // b. Add total duration section\r\n              consolidatedData.push([t('ResultsDisplay.totalDuration')]);\r\n              consolidatedData.push([\r\n                  t('ResultsDisplay.periodLabel'), \r\n                  `${formatDateForDisplay(typeof steps.totalDuration.start === 'string' ? new Date(steps.totalDuration.start) : steps.totalDuration.start)} - ${formatDateForDisplay(typeof steps.totalDuration.end === 'string' ? new Date(steps.totalDuration.end) : steps.totalDuration.end)}`\r\n              ]);\r\n              consolidatedData.push([\r\n                  t('ResultsDisplay.totalDays'),\r\n                  `${steps.totalDuration.days} ${steps.totalDuration.included ? t('ResultsDisplay.inclusiveLabel') : t('ResultsDisplay.exclusiveLabel')}`\r\n              ]);\r\n              consolidatedData.push([]);\r\n\r\n              // c. Add proportion calculation\r\n              consolidatedData.push([t('ResultsDisplay.proportionCalculation')]);\r\n              for (const segment of periodSegments) {\r\n                  consolidatedData.push([\r\n                      formatPeriodIdForDisplay(segment.periodIdentifier),\r\n                      `${segment.days} / ${steps.totalDuration.days} = ${utilFormatPercent(segment.proportion, currentLocale)}`\r\n                  ]);\r\n              }\r\n              consolidatedData.push([]);\r\n              \r\n              // d. Add amount calculations\r\n              consolidatedData.push([t('ResultsDisplay.splitCalculation')]);\r\n              consolidatedData.push([]);\r\n              \r\n              for (let i = 0; i < amountCalculations.length; i++) {\r\n                  const amtCalc = amountCalculations[i];\r\n                  consolidatedData.push([`${t(\"ResultsDisplay.inputAmountLabel\")} #${i + 1}:`, formatNumForDisplay(amtCalc.originalAmount)]);\r\n                  \r\n                  for (const split of amtCalc.periodSplits) {\r\n                      const periodSeg = periodSegments.find(s => s.periodIdentifier === split.periodIdentifier);\r\n                      consolidatedData.push([\r\n                          formatPeriodIdForDisplay(split.periodIdentifier),\r\n                          `${formatNumForDisplay(amtCalc.originalAmount)}  ${periodSeg?.proportion.toFixed(6)} = ${split.rawSplit.toFixed(6)}  ${formatNumForDisplay(split.roundedSplit)}`\r\n                      ]);\r\n                      \r\n                      if (split.adjustment !== 0) {\r\n                          consolidatedData.push([\r\n                              `  ${t(\"ResultsDisplay.adjustmentLabel\")}:`,\r\n                              formatNumForDisplay(split.adjustment)\r\n                          ]);\r\n                      }\r\n                  }\r\n                  \r\n                  consolidatedData.push([\r\n                      t(\"ResultsDisplay.discrepancyLabel\"),\r\n                      formatNumForDisplay(amtCalc.discrepancy)\r\n                  ]);\r\n                  \r\n                  if (amtCalc.adjustmentAppliedToPeriod) {\r\n                      consolidatedData.push([\r\n                          t(\"ResultsDisplay.adjustedInYearLabel\", { defaultValue: \"Applied in Year\" }),\r\n                          formatPeriodIdForDisplay(amtCalc.adjustmentAppliedToPeriod)\r\n                      ]);\r\n                  }\r\n                  \r\n                  consolidatedData.push([\r\n                      t(\"ResultsDisplay.finalSumLabel\"),\r\n                      formatNumForDisplay(amtCalc.finalSum)\r\n                  ]);\r\n                  \r\n                  consolidatedData.push([]);\r\n              }\r\n          }\r\n          \r\n          // Create the consolidated worksheet with all data\r\n          const consolidatedSheet = XLSX.utils.aoa_to_sheet(consolidatedData);\r\n          \r\n          // Apply cell formatting for numbers and percentages\r\n          // Find the row range for the allocation results table (skip headers)\r\n          const allocationTableStartRow = 12; // 0-based index for the first data row after headers\r\n          const allocationTableEndRow = allocationTableStartRow + (results.aggregatedSplits?.length || 0);\r\n          \r\n          // Format proportion column (index 2) as percentage\r\n          for (let R = allocationTableStartRow; R < allocationTableEndRow; R++) {\r\n              const propCellRef = XLSX.utils.encode_cell({ c: 2, r: R });\r\n              if (consolidatedSheet[propCellRef]) {\r\n                  consolidatedSheet[propCellRef].t = 'n';\r\n                  consolidatedSheet[propCellRef].z = '0.00%';\r\n              }\r\n          }\r\n          \r\n          // Format amount column (index 3) with proper decimal places\r\n          for (let R = allocationTableStartRow; R < allocationTableEndRow + 1; R++) { // +1 to include total row\r\n              const amtCellRef = XLSX.utils.encode_cell({ c: 3, r: R });\r\n              if (consolidatedSheet[amtCellRef]) {\r\n                  consolidatedSheet[amtCellRef].t = 'n';\r\n                  consolidatedSheet[amtCellRef].z = `#,##0.${'0'.repeat(settings.decimalPlaces || 2)}`;\r\n              }\r\n          }\r\n          \r\n          // Add the consolidated sheet to the workbook with a meaningful name\r\n          XLSX.utils.book_append_sheet(\r\n              workbook, \r\n              consolidatedSheet, \r\n              t(\"ResultsDisplay.consolidatedSheetName\", { defaultValue: \"Invoice Split Report\" })\r\n          );\r\n          \r\n          const filename = `InvoiceSplit_${format(new Date(), 'yyyyMMdd')}.xlsx`;\r\n          XLSX.writeFile(workbook, filename);\r\n      }).catch(error => {\r\n          console.error(\"Failed to load xlsx library or export Excel:\", error);\r\n          alert(\"Failed to export Excel. Please try again.\");\r\n      });\r\n  }\r\n\r\n  function handleExportPdf() {\r\n      Promise.all([import('jspdf'), import('jspdf-autotable')]).then(([{ jsPDF }, { default: autoTable }]) => {\r\n          try {\r\n              const doc = new jsPDF() as JsPDFWithInternal;\r\n              let yPos = 20;\r\n              const filename = `InvoiceSplit_${format(new Date(), 'yyyyMMdd')}.pdf`;\r\n\r\n              // Summary Section\r\n              doc.text(`${t(\"ResultsDisplay.periodLabel\")}: ${utilFormatDateLocale(inputData.startDate, currentLocale)} - ${utilFormatDateLocale(inputData.endDate, currentLocale)}`, 14, yPos); yPos += 5;\r\n              doc.text(`${t(\"ResultsDisplay.originalTotalLabel\", { defaultValue: \"Total Input Amount:\" })}: ${utilFormatNumber(totalInputAmount, currentLocale, settings)}`, 14, yPos); yPos += 15;\r\n              doc.text(`${t(\"ResultsDisplay.totalDurationLabel\", { defaultValue: \"Total Duration (days)\" })}: ${totalDurationDays} ${t(\"ResultsDisplay.daysLabel\")}`, 14, yPos); yPos += 5;\r\n              doc.text(`${t(\"InvoiceForm.includeEndDateLabel\", { defaultValue: \"Include Final Day in Service Period?\" })}: ${inputData.includeEndDate ? t(\"ResultsDisplay.yesLabel\", { defaultValue: \"Yes\" }) : t(\"ResultsDisplay.noLabel\", { defaultValue: \"No\" })}`, 14, yPos); yPos += 5;\r\n              doc.text(`${t(\"InvoiceForm.splitPeriodLabel\", { defaultValue: \"Split Period\" })}: ${splitPeriodUsed === 'yearly' ? t('InvoiceForm.periodYearly') : splitPeriodUsed === 'quarterly' ? t('InvoiceForm.periodQuarterly') : t('InvoiceForm.periodMonthly')}`, 14, yPos); yPos += 5;\r\n\r\n              // Allocation Table\r\n              const tableRowsData = results.aggregatedSplits?.map(split => [\r\n                  formatPeriodIdentifier(split.periodIdentifier, splitPeriodUsed, currentLocale),\r\n                  split.daysInPeriod,\r\n                  utilFormatPercent(split.proportion, currentLocale),\r\n                  utilFormatNumber(split.totalSplitAmount, currentLocale, settings)\r\n              ]) || [];\r\n              autoTable(doc, {\r\n                  head: [[getPeriodHeader(), t(\"ResultsDisplay.daysHeader\"), t(\"ResultsDisplay.proportionHeader\"), t(\"ResultsDisplay.amountHeader\")]],\r\n                  body: tableRowsData,\r\n                  foot: [[t(\"ResultsDisplay.totalLabel\", { defaultValue: \"Total\" }), totalDurationDays, utilFormatPercent(1, currentLocale), utilFormatNumber(totalAggregatedAmount, currentLocale, settings)]],\r\n                  startY: yPos, \r\n                  theme: 'grid', \r\n                  headStyles: { \r\n                      // Convert primary color to RGB for PDF\r\n                      fillColor: getComputedStyle(document.documentElement)\r\n                          .getPropertyValue('--primary')\r\n                          .trim()\r\n                          .split(' ')\r\n                          .map((v, i) => i === 0 ? parseInt(v) : parseFloat(v) * 2.55)\r\n                          .filter((_, i) => i < 3) as [number, number, number]\r\n                  }, \r\n                  footStyles: { \r\n                      // Convert muted color to RGB for PDF\r\n                      fillColor: getComputedStyle(document.documentElement)\r\n                          .getPropertyValue('--muted')\r\n                          .trim()\r\n                          .split(' ')\r\n                          .map((v, i) => i === 0 ? parseInt(v) : parseFloat(v) * 2.55)\r\n                          .filter((_, i) => i < 3) as [number, number, number], \r\n                      textColor: getComputedStyle(document.documentElement)\r\n                          .getPropertyValue('--foreground')\r\n                          .trim()\r\n                          .split(' ')\r\n                          .map((v, i) => i === 0 ? parseInt(v) : parseFloat(v) * 2.55)\r\n                          .filter((_, i) => i < 3)\r\n                          .reduce((sum, c) => sum + c, 0) / 3, \r\n                      fontStyle: 'bold' \r\n                  },\r\n                  didParseCell: function (data: CellHookData) { \r\n                      if (data.column.index !== undefined && [1, 2, 3].includes(data.column.index)) {\r\n                          data.cell.styles.halign = 'right';\r\n                      }\r\n                  }\r\n              });\r\n              \r\n              // Calculation Steps Section\r\n              if (results.calculationSteps) {\r\n                  const steps = results.calculationSteps;\r\n                  const { periodSegments, amountCalculations } = steps;\r\n                  yPos = doc.lastAutoTable?.finalY ? doc.lastAutoTable.finalY + 15 : yPos + 50;\r\n                  \r\n                  doc.text(t('ResultsDisplay.calculationStepsTitle', { defaultValue: \"View Full Split Calculation\" }), 14, yPos);\r\n                  yPos += 10;\r\n                  \r\n                  doc.text(t('ResultsDisplay.totalDuration'), 14, yPos);\r\n                  yPos += 7;\r\n                  \r\n                  // Use type assertions to handle the string dates from the API\r\n                  const startDate = steps.totalDuration.start as string;\r\n                  const endDate = steps.totalDuration.end as string;\r\n                  \r\n                  doc.text(`${t('ResultsDisplay.periodLabel')}: ${utilFormatDateLocale(startDate, currentLocale)} - ${utilFormatDateLocale(endDate, currentLocale)}`, 20, yPos);\r\n                  yPos += 5;\r\n                  doc.text(`${t('ResultsDisplay.totalDays')}: ${steps.totalDuration.days} ${steps.totalDuration.included ? t('ResultsDisplay.inclusiveLabel') : t('ResultsDisplay.exclusiveLabel')}`, 20, yPos);\r\n                  yPos += 10;\r\n                  \r\n                  doc.text(t('ResultsDisplay.proportionCalculation'), 14, yPos);\r\n                  yPos += 7;\r\n                  doc.setFontSize(10);\r\n                  \r\n                  if (yPos > doc.internal.pageSize.height - 50) { doc.addPage(); yPos = 20; }\r\n                  \r\n                  for (const segment of periodSegments) {\r\n                      doc.text(`${formatPeriodIdentifier(segment.periodIdentifier, splitPeriodUsed, currentLocale)}: ${segment.days} / ${steps.totalDuration.days} = ${utilFormatPercent(segment.proportion, currentLocale)}`, 20, yPos);\r\n                      yPos += 5;\r\n                      if (yPos > doc.internal.pageSize.height - 30) { doc.addPage(); yPos = 20; }\r\n                  }\r\n                  yPos += 5;\r\n                  \r\n                  doc.text(t('ResultsDisplay.splitCalculation'), 14, yPos);\r\n                  yPos += 7;\r\n                  \r\n                  for (let i = 0; i < amountCalculations.length; i++) {\r\n                      const amtCalc = amountCalculations[i];\r\n                      if (yPos > doc.internal.pageSize.height - 70) { doc.addPage(); yPos = 20; }\r\n                      doc.setFontSize(11);\r\n                      doc.text(`${t(\"ResultsDisplay.inputAmountLabel\")} #${i + 1}: ${utilFormatNumber(amtCalc.originalAmount, currentLocale, settings)}`, 20, yPos);\r\n                      yPos += 7;\r\n                      doc.setFontSize(10);\r\n                      \r\n                      for (const split of amtCalc.periodSplits) {\r\n                          const periodSeg = periodSegments.find(s => s.periodIdentifier === split.periodIdentifier);\r\n                          doc.text(`${formatPeriodIdentifier(split.periodIdentifier, splitPeriodUsed, currentLocale)}:`, 25, yPos);\r\n                          yPos += 5;\r\n                          doc.text(`${utilFormatNumber(amtCalc.originalAmount, currentLocale, settings)}  ${periodSeg?.proportion.toFixed(6)} = ${split.rawSplit.toFixed(6)}`, 30, yPos);\r\n                          yPos += 5;\r\n                          doc.text(` ${t(\"ResultsDisplay.roundedLabel\")}: ${utilFormatNumber(split.roundedSplit, currentLocale, settings)}`, 30, yPos);\r\n                          yPos += 5;\r\n                          if (split.adjustment !== 0) { doc.text(`${t(\"ResultsDisplay.adjustmentLabel\")}: ${utilFormatNumber(split.adjustment, currentLocale, settings)}`, 30, yPos); yPos += 5; }\r\n                          if (yPos > doc.internal.pageSize.height - 40) { doc.addPage(); yPos = 20; }\r\n                      }\r\n                      doc.text(`${t(\"ResultsDisplay.discrepancyLabel\")}: ${utilFormatNumber(amtCalc.discrepancy, currentLocale, settings)}`, 25, yPos);\r\n                      yPos += 5;\r\n                      if (amtCalc.adjustmentAppliedToPeriod) {\r\n                          doc.text(`${t(\"ResultsDisplay.adjustedInYearLabel\", { defaultValue: \"Applied in Year\" })}: ${formatPeriodIdentifier(amtCalc.adjustmentAppliedToPeriod, splitPeriodUsed, currentLocale)}`, 25, yPos);\r\n                          yPos += 5;\r\n                      }\r\n                      doc.text(`${t(\"ResultsDisplay.finalSumLabel\")}: ${utilFormatNumber(amtCalc.finalSum, currentLocale, settings)}`, 25, yPos);\r\n                      yPos += 10;\r\n                      if (yPos > doc.internal.pageSize.height - 50 && i < amountCalculations.length - 1) { doc.addPage(); yPos = 20; }\r\n                  }\r\n              }\r\n              \r\n              const pageCount = doc.internal.getNumberOfPages();\r\n              doc.setFontSize(8);\r\n              for (let i = 1; i <= pageCount; i++) {\r\n                  doc.setPage(i);\r\n                  doc.text(`Generated by BillSplitter - ${format(new Date(), 'PPpp', { locale: currentLocale === 'de' ? de : enUS })}`, 14, doc.internal.pageSize.height - 10);\r\n                  doc.text(`Page ${i} of ${pageCount}`, doc.internal.pageSize.width - 35, doc.internal.pageSize.height - 10);\r\n              }\r\n              doc.save(filename);\r\n          } catch (error) {\r\n              console.error(\"Error generating PDF:\", error);\r\n              alert(\"Failed to generate PDF. Please try again.\");\r\n          }\r\n      }).catch(error => {\r\n          console.error(\"Failed to load PDF generation libraries:\", error);\r\n          alert(\"Failed to load PDF generation libraries. Please try again.\");\r\n      });\r\n  }\r\n\r\n                  return (\r\n    <div className=\"w-full animate-fadeIn\">\r\n      {/* Wrap everything except the modal in a single card */}\r\n      <Card className=\"shadow-lg border border-border/50\">\r\n        <CardContent className=\"p-6 space-y-8\">\r\n          <Card className=\"shadow-md border border-border/40 overflow-hidden\">\r\n            <CardContent className=\"p-6\">\r\n              <div className=\"flex justify-between items-center mb-6 pb-4 border-b\">\r\n                <h3 className=\"text-xl font-semibold text-primary\">\r\n                  {t(\"ResultsDisplay.summaryTitle\")}\r\n                </h3>\r\n                <button\r\n                  onClick={() => setIsSettingsOpen(true)}\r\n                  className=\"p-1.5 rounded-md text-muted-foreground hover:text-primary-foreground hover:bg-primary transition-colors cursor-pointer\"\r\n                  aria-label={t(\"ResultsDisplay.settingsLabel\")}\r\n                >\r\n                  <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\">\r\n                    <path d=\"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.38a2 2 0 0 0-.73-2.73l-.15-.09a2 2 0 0 1-1-1.74v-.51a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z\"/>\r\n                    <circle cx=\"12\" cy=\"12\" r=\"3\"/>\r\n                  </svg>\r\n                </button>\r\n              </div>\r\n              <div className=\"space-y-2 text-sm text-muted-foreground\">\r\n                <div className=\"flex justify-between\">\r\n                  <span>{t(\"ResultsDisplay.periodLabel\")}</span>\r\n                  <span className=\"font-medium text-foreground\">\r\n                    {formatDateForDisplay(inputData.startDate)} - {\" \"}\r\n                    {formatDateForDisplay(inputData.endDate)}\r\n                  </span>\r\n            </div>\r\n                <div className=\"flex justify-between\">\r\n                  <span>{t(\"ResultsDisplay.totalDurationLabel\", { defaultValue: \"Total Duration (days)\" })}</span>\r\n                  <span className=\"font-medium text-foreground\">\r\n                    {totalDurationDays} {t(\"ResultsDisplay.daysLabel\")}\r\n                  </span>\r\n              </div>\r\n                <div className=\"flex justify-between\">\r\n                  <span>{t(\"InvoiceForm.includeEndDateLabel\", { defaultValue: \"Include Final Day in Service Period?\" })}</span>\r\n                  <span className=\"font-medium text-foreground\">\r\n                    {inputData.includeEndDate ? t(\"ResultsDisplay.yesLabel\", { defaultValue: \"Yes\" }) : t(\"ResultsDisplay.noLabel\", { defaultValue: \"No\" })}\r\n                </span>\r\n                </div>\r\n                <div className=\"flex justify-between\">\r\n                  <span>{t(\"InvoiceForm.splitPeriodLabel\", { defaultValue: \"Split Period\" })}</span>\r\n                  <span className=\"font-medium text-foreground\">\r\n                     {splitPeriodUsed === 'yearly' && t('InvoiceForm.periodYearly')}\r\n                     {splitPeriodUsed === 'quarterly' && t('InvoiceForm.periodQuarterly')}\r\n                     {splitPeriodUsed === 'monthly' && t('InvoiceForm.periodMonthly')}\r\n                </span>\r\n                  </div>\r\n                 <div className=\"flex justify-between pt-2 border-t border-border/30\">\r\n                  <span className=\"font-semibold text-foreground\">{t(\"ResultsDisplay.originalTotalLabel\", { defaultValue: \"Total Input Amount:\" })}</span>\r\n                  <span className=\"font-semibold text-foreground\">\r\n                    {formatNumForDisplay(totalInputAmount)}\r\n                </span>\r\n              </div>\r\n            </div>\r\n            </CardContent>\r\n          </Card>\r\n\r\n          <Card className=\"shadow-md border border-border/40 overflow-hidden\">\r\n            <CardContent className=\"p-6\">\r\n              <h3 className=\"text-xl font-semibold mb-6 pb-4 border-b text-primary\">\r\n                {t(\"ResultsDisplay.aggregatedTitle\", { defaultValue: \"Allocation per Period\" })}\r\n              </h3>\r\n          <Table>\r\n            <TableHeader>\r\n              <TableRow>\r\n                    <TableHead>{getPeriodHeader()}</TableHead>\r\n                <TableHead className=\"text-right\">{t(\"ResultsDisplay.daysHeader\")}</TableHead>\r\n                <TableHead className=\"text-right\">{t(\"ResultsDisplay.proportionHeader\")}</TableHead>\r\n                    <TableHead className=\"text-right\">{t(\"ResultsDisplay.amountHeader\")}</TableHead>\r\n              </TableRow>\r\n            </TableHeader>\r\n            <TableBody>\r\n                  {results.aggregatedSplits?.map((split, index) => (\r\n                    <TableRow key={index}>\r\n                      <TableCell className=\"font-medium text-foreground whitespace-nowrap\">\r\n                        {formatPeriodIdForDisplay(split.periodIdentifier)}\r\n                  </TableCell>\r\n                      {/* Assuming AggregatedPeriodSplit has daysInPeriod */}\r\n                      <TableCell className=\"text-right text-muted-foreground\">{split.daysInPeriod}</TableCell>\r\n                      <TableCell className=\"text-right text-muted-foreground\">{formatPctForDisplay(split.proportion)}</TableCell>\r\n                      {/* Assuming AggregatedPeriodSplit has totalSplitAmount */}\r\n                      <TableCell className=\"text-right font-medium text-foreground\">{formatNumForDisplay(split.totalSplitAmount)}</TableCell>\r\n                </TableRow>\r\n              ))}\r\n            </TableBody>\r\n            <TableFooter>\r\n                  <TableRow>\r\n                    <TableCell>{t(\"ResultsDisplay.totalLabel\", { defaultValue: \"Total\" })}</TableCell>\r\n                    <TableCell className=\"text-right font-semibold text-foreground\">{totalDurationDays}</TableCell>\r\n                    <TableCell className=\"text-right font-semibold text-foreground\">{formatPctForDisplay(1)}</TableCell>\r\n                    <TableCell className=\"text-right font-semibold text-foreground\">{formatNumForDisplay(totalAggregatedAmount)}</TableCell>\r\n              </TableRow>\r\n            </TableFooter>\r\n          </Table>\r\n            </CardContent>\r\n          </Card>\r\n\r\n          {/* Calculation Details Accordion */}\r\n          <Accordion type=\"single\" collapsible className=\"w-full\">\r\n              <AccordionItem value=\"item-1\" className=\"border rounded-lg shadow-md bg-card\">\r\n                  <AccordionTrigger className=\"px-6 py-4 text-lg font-semibold text-primary hover:bg-muted/40\">\r\n                      {t('ResultsDisplay.calculationStepsTitle', { defaultValue: \"View Full Split Calculation\" })}\r\n            </AccordionTrigger>\r\n                  <AccordionContent className=\"px-6 py-4 bg-background border-t\">\r\n                      {results.calculationSteps ? (\r\n                          <CalculationStepsDisplay steps={results.calculationSteps} settings={settings} splitPeriodUsed={splitPeriodUsed}/>\r\n                      ) : (\r\n                          <p>{t('ResultsDisplay.noStepsAvailable')}</p>\r\n                      )}\r\n            </AccordionContent>\r\n          </AccordionItem>\r\n        </Accordion>\r\n\r\n          {/* Export Buttons Section */}\r\n          <div className=\"mt-8 w-full flex flex-col items-center sm:flex-row sm:justify-center gap-4 px-4 sm:px-0\">\r\n            <Button\r\n                variant=\"outline\"\r\n                onClick={handleExportExcel}\r\n                className=\"w-full sm:w-auto\"\r\n            >\r\n                 <svg className=\"mr-2 h-4 w-4\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\">\r\n                    <path d=\"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z\"/>\r\n                    <polyline points=\"14 2 14 8 20 8\"/>\r\n                    <line x1=\"16\" y1=\"13\" x2=\"8\" y2=\"13\"/>\r\n                    <line x1=\"16\" y1=\"17\" x2=\"8\" y2=\"17\"/>\r\n                    <polyline points=\"10 9 9 9 8 9\"/>\r\n                </svg>\r\n                {t('ResultsDisplay.exportExcelButton')}\r\n            </Button>\r\n            <Button\r\n                variant=\"outline\"\r\n                onClick={handleExportPdf}\r\n                className=\"w-full sm:w-auto\"\r\n            >\r\n                <svg className=\"mr-2 h-4 w-4\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\">\r\n                    <path d=\"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z\"/>\r\n                    <polyline points=\"14 2 14 8 20 8\"/>\r\n                    <line x1=\"16\" y1=\"13\" x2=\"8\" y2=\"13\"/>\r\n                    <line x1=\"16\" y1=\"17\" x2=\"8\" y2=\"17\"/>\r\n                    <polyline points=\"10 9 9 9 8 9\"/>\r\n                </svg>\r\n                {t('ResultsDisplay.exportPdfButton')}\r\n            </Button>\r\n          </div>\r\n        </CardContent>\r\n      </Card>\r\n\r\n      {/* Settings Modal remains outside the main card */}\r\n      <SettingsModal isOpen={isSettingsOpen} onOpenChange={setIsSettingsOpen} />\r\n    </div>\r\n  );\r\n}\r\n\r\n// Wrapper component to provide context\r\nexport function ResultsDisplay(props: ResultsDisplayProps) {\r\n  return <ResultsDisplayComponent {...props} />;\r\n}\r\n","\"use client\";\r\n\r\nimport { Alert, AlertDescription, AlertTitle } from \"@/components/ui/alert\";\r\nimport { CalculationError, CalculationInput, CalculationResult } from \"@/lib/calculations\";\r\nimport { Card, CardContent } from \"@/components/ui/card\";\r\nimport { ERROR_CODES, InputValidationError } from \"@/lib/errors\";\r\nimport { Suspense, useCallback, useEffect, useRef, useState } from \"react\";\r\n\r\nimport { CalculationCallbackData } from \"@/components/invoice-form\";\r\nimport Cookies from 'js-cookie';\r\nimport { GoogleAnalytics } from '@next/third-parties/google';\r\nimport { Loader2 } from \"lucide-react\";\r\nimport { ResultsDisplay } from \"@/components/results-display\";\r\nimport { SettingsModal } from \"@/components/settings-modal\";\r\nimport { Terminal } from \"lucide-react\";\r\nimport dynamic from 'next/dynamic';\r\nimport { safeText } from \"@/lib/utils\";\r\nimport { useTranslation } from '@/translations';\r\n\r\n// Import the CalculationCallbackData type from InvoiceForm\r\n\r\n// Update the error type definition\r\ntype CalculationErrorType = string | Error | CalculationError | { message?: string; [key: string]: unknown } | null | undefined;\r\n\r\n// Define a type for the demo data that matches the one in InvoiceForm\r\ntype DemoDataType = {\r\n  startDateString?: string;\r\n  endDateString?: string;\r\n  amount?: string;\r\n  includeEndDate?: boolean;\r\n  splitPeriod?: 'yearly' | 'quarterly' | 'monthly';\r\n  isDemo?: boolean;\r\n} | null;\r\n\r\n// Dynamic import of the InvoiceForm component with SSR disabled for faster loading\r\nconst InvoiceForm = dynamic(\r\n  () => import('@/components/invoice-form').then(mod => ({ default: mod.InvoiceForm })),\r\n  { \r\n    ssr: false,\r\n    loading: () => (\r\n      <div className=\"space-y-6 animate-pulse\">\r\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n          <div className=\"h-24 bg-muted/60 rounded-lg\"></div>\r\n          <div className=\"h-24 bg-muted/60 rounded-lg\"></div>\r\n        </div>\r\n        <div className=\"h-20 bg-muted/60 rounded-lg\"></div>\r\n        <div className=\"h-48 bg-muted/60 rounded-lg\"></div>\r\n        <div className=\"h-10 bg-muted/60 rounded-lg\"></div>\r\n      </div>\r\n    )\r\n  }\r\n);\r\n\r\n// Define a type alias that matches ResultsDisplay's expected inputData type\r\ntype InputDataForDisplay = Pick<\r\n  CalculationInput,\r\n  \"startDate\" | \"endDate\" | \"includeEndDate\" | \"amounts\" | \"splitPeriod\"\r\n>;\r\n\r\ninterface InvoiceCalculatorClientProps {\r\n  pageTitle: string; // Add pageTitle prop\r\n}\r\n\r\nexport default function InvoiceCalculatorClient({ pageTitle }: InvoiceCalculatorClientProps) {\r\n  const { t } = useTranslation();\r\n  const [mounted, setMounted] = useState(false);\r\n  const [calculationResult, setCalculationResult] = useState<CalculationResult | null>(null);\r\n  const [calculationError, setCalculationError] = useState<string | null>(null);\r\n  const [storedInputData, setStoredInputData] = useState<CalculationCallbackData>(null);\r\n  const [isSettingsOpen, setIsSettingsOpen] = useState(false);\r\n  const resultsSectionRef = useRef<HTMLDivElement>(null);\r\n  // State for holding demo data to pass as prop\r\n  const [initialDemoData, setInitialDemoData] = useState<DemoDataType>(null);\r\n  // Ref to track if we've already processed demo data to avoid duplicate processing\r\n  const demoDataProcessedRef = useRef(false);\r\n\r\n  // --- Consent Management State and Logic --- \r\n  const gaMeasurementId = \"G-9H2KTHX5YK\"; \r\n  const consentCookieName = \"siempiBillSplitterConsent\";\r\n  const [hasConsent, setHasConsent] = useState(false);\r\n\r\n  // Add cleanup effect that runs on component unmount\r\n  useEffect(() => {\r\n    // This cleanup will run when the component unmounts\r\n    return () => {\r\n      if (typeof window !== 'undefined') {\r\n        // Safely capture current values for logging (useful for debugging)\r\n        const hasDemoData = sessionStorage.getItem('billSplitterDemoData') !== null;\r\n        const hasFormCache = sessionStorage.getItem('invoiceFormDataCache') !== null;\r\n        \r\n        // Safely remove only the form cache on unmount.\r\n        // Let InvoiceForm handle clearing billSplitterDemoData after processing.\r\n        try {\r\n          // sessionStorage.removeItem('billSplitterDemoData'); // REMOVED\r\n          sessionStorage.removeItem('invoiceFormDataCache');\r\n          console.log('[InvoiceCalculatorClient] Cleaned up sessionStorage on unmount', { \r\n            hadDemoData: hasDemoData, \r\n            hadFormCache: hasFormCache, \r\n            // Note: billSplitterDemoData is no longer removed here.\r\n          });\r\n        } catch (error) {\r\n          console.error('[InvoiceCalculatorClient] Error clearing sessionStorage on unmount:', error);\r\n        }\r\n      }\r\n    };\r\n  }, []); // Empty dependency array means this runs only on mount/unmount\r\n\r\n  // Effect just for setting mounted state and title\r\n  useEffect(() => {\r\n    setMounted(true);\r\n\r\n    // Check consent cookie\r\n    const consentGiven = Cookies.get(consentCookieName) === \"true\";\r\n    setHasConsent(consentGiven);\r\n  }, []);\r\n\r\n  // Separate effect ONLY for reading demo data\r\n  useEffect(() => {\r\n    // Only process sessionStorage once per component lifecycle\r\n    if (demoDataProcessedRef.current) {\r\n      return;\r\n    }\r\n\r\n    // Read demo data from sessionStorage\r\n    if (typeof window !== 'undefined') {\r\n      const demoDataString = sessionStorage.getItem('billSplitterDemoData');\r\n      console.log(\"[InvoiceCalculatorClient] Reading sessionStorage billSplitterDemoData:\", demoDataString);\r\n      \r\n      if (demoDataString) {\r\n        try {\r\n          const parsedDemoData = JSON.parse(demoDataString);\r\n          if (parsedDemoData && parsedDemoData.isDemo) {\r\n            // Clear localStorage cache first to ensure it doesn't override demo data\r\n            localStorage.removeItem('invoiceFormDataCache');\r\n            console.log(\"[InvoiceCalculatorClient] Cleared localStorage cache to ensure demo data is used\");\r\n            \r\n            console.log(\"[InvoiceCalculatorClient] Setting initialDemoData state:\", parsedDemoData);\r\n            setInitialDemoData(parsedDemoData);\r\n            \r\n            // Clear sessionStorage immediately\r\n            sessionStorage.removeItem('billSplitterDemoData');\r\n            console.log(\"[InvoiceCalculatorClient] Removed billSplitterDemoData from sessionStorage\");\r\n            \r\n            // Mark as processed to prevent re-reading\r\n            demoDataProcessedRef.current = true;\r\n          } else {\r\n            sessionStorage.removeItem('billSplitterDemoData');\r\n          }\r\n        } catch (error) {\r\n          console.error(\"[InvoiceCalculatorClient] Error parsing demo data:\", error);\r\n          sessionStorage.removeItem('billSplitterDemoData');\r\n        }\r\n      }\r\n    }\r\n  }, []); // No dependencies - runs once on mount\r\n\r\n  // Callback for InvoiceForm to signal demo data has been processed\r\n  const handleDemoDataApplied = useCallback(() => {\r\n    console.log(\"[InvoiceCalculatorClient] Demo data processed by InvoiceForm, clearing state\");\r\n    setInitialDemoData(null);\r\n  }, []);\r\n\r\n  // Updated function to handle the new error structure\r\n  const handleCalculation = (\r\n    formData: CalculationCallbackData,\r\n    results: CalculationResult | null,\r\n    error?: CalculationErrorType\r\n  ) => {\r\n    setCalculationResult(results);\r\n    let displayError: string | null = null;\r\n    \r\n    if (error) {\r\n      const baseErrorTitle = t('Errors.calculationErrorTitle');\r\n      \r\n      // Handle the new CalculationError types specifically\r\n      if (error instanceof InputValidationError) {\r\n        // Map specific error codes to translated messages\r\n        switch (error.code) {\r\n          case ERROR_CODES.NO_AMOUNTS:\r\n            displayError = baseErrorTitle + \": \" + t('InvoiceForm.errorAmountRequired');\r\n            break;\r\n          case ERROR_CODES.INVALID_AMOUNT:\r\n            displayError = baseErrorTitle + \": \" + t('InvoiceForm.errorAmountPositive');\r\n            break;\r\n          case ERROR_CODES.END_BEFORE_START:\r\n            displayError = baseErrorTitle + \": \" + t('InvoiceForm.errorEndDateBeforeStart');\r\n            break;\r\n          case ERROR_CODES.INVALID_DATES:\r\n            displayError = baseErrorTitle + \": \" + t('InvoiceForm.errorInvalidDates', { defaultValue: \"Valid start and end dates are required\" });\r\n            break;\r\n          case ERROR_CODES.ZERO_DURATION:\r\n            displayError = baseErrorTitle + \": \" + t('InvoiceForm.errorZeroDuration', { defaultValue: \"The date range must result in a positive duration\" });\r\n            break;\r\n          default:\r\n            displayError = baseErrorTitle + \": \" + error.message;\r\n        }\r\n        \r\n        // Log with additional details\r\n        console.warn(`[InvoiceCalculatorClient] Input validation error: ${error.code}`, error.details);\r\n      } \r\n      else if (error instanceof CalculationError) {\r\n        // Generic handling for other calculation errors\r\n        displayError = baseErrorTitle + \": \" + error.message;\r\n        \r\n        // Detailed logging of calculation errors\r\n        console.error(`[InvoiceCalculatorClient] Calculation error: ${error.code} (${error.category})`, error.details);\r\n      }\r\n      else if (typeof error === 'string') {\r\n        // Backward compatibility for string errors\r\n        if (error.includes(\"At least one amount is required\")) {\r\n          displayError = baseErrorTitle + \": \" + t('InvoiceForm.errorAmountRequired');\r\n        } else if (error.includes(\"Start date must be before\")) {\r\n          displayError = baseErrorTitle + \": \" + t('InvoiceForm.errorEndDateBeforeStart');\r\n        } else {\r\n          displayError = baseErrorTitle + \": \" + error;\r\n        }\r\n      } \r\n      else if (error instanceof Error) {\r\n        // Standard Error objects\r\n        displayError = baseErrorTitle + \": \" + error.message;\r\n        console.error(\"[InvoiceCalculatorClient] Error object received:\", error);\r\n      } \r\n      else if (error && typeof error === 'object') {\r\n        // Object errors (fallback)\r\n        if ('message' in error && typeof error.message === 'string') {\r\n          displayError = baseErrorTitle + \": \" + error.message;\r\n        } else {\r\n          try {\r\n            const stringifiedError = JSON.stringify(error);\r\n            displayError = baseErrorTitle + \": \" + (stringifiedError !== \"{}\" ? stringifiedError : t('Errors.unexpectedError'));\r\n          } catch {\r\n            displayError = baseErrorTitle + \": \" + t('Errors.unexpectedError');\r\n          }\r\n        }\r\n        console.error(\"[InvoiceCalculatorClient] Error object received:\", error);\r\n      } \r\n      else {\r\n        // Fallback for unknown error types\r\n        displayError = baseErrorTitle + \": \" + t('Errors.unexpectedError');\r\n        console.error(\"[InvoiceCalculatorClient] An unexpected or non-standard error was received:\", error);\r\n      }\r\n    }\r\n    \r\n    setCalculationError(displayError);\r\n\r\n    // If there was any kind of error, we should ensure results are not processed as successful\r\n    if (formData && results && !displayError) {\r\n      setStoredInputData(formData);\r\n      // Use requestAnimationFrame + timeout to ensure the layout is stable before scrolling\r\n      setTimeout(() => {\r\n        requestAnimationFrame(() => {\r\n          if (resultsSectionRef.current) {\r\n            resultsSectionRef.current.scrollIntoView({ \r\n              behavior: 'smooth', \r\n              block: 'start' \r\n            });\r\n          }\r\n        });\r\n      }, 200); // Slightly longer delay to ensure layout is fully settled\r\n    } else {\r\n      setStoredInputData(null);\r\n      // If there was an error, but results were somehow passed, clear them too\r\n      if (displayError) {\r\n        setCalculationResult(null);\r\n      }\r\n    }\r\n  };\r\n\r\n  // Determine static description text based on pageTitle to avoid hydration mismatch\r\n  // IMPORTANT: This must exactly match the text in the translation files\r\n  const description1 = pageTitle === \"Rechnungsperioden-Rechner\" \r\n    ? \"Teilen Sie Rechnungen ber Geschftsjahre auf. Konform mit IFRS, HGB und OR  keine Anmeldung, keine Datenspeicherung. Einfach, schnell, przise.\"\r\n    : \"Split invoices across fiscal years. Stay compliant with IFRS, HGB, and OR  no login, no data storage. Simple, fast, precise.\";\r\n    \r\n  const description2 = pageTitle === \"Rechnungsperioden-Rechner\"\r\n    ? \"Ideal fr Buchhalter bei der Erstellung von Gewinn- und Verlustrechnungen und Bilanzen, fr Finanzfachleute bei der Budgetverwaltung oder fr alle, die eine klare finanzielle Aufschlsselung fr das Reporting bentigen.\"\r\n    : \"Ideal for accountants preparing income statements and balance sheets, financial professionals managing budgets, or anyone needing a clear financial breakdown for reporting.\";\r\n\r\n  return (\r\n    <>\r\n      {/* Conditionally render Google Analytics only if consent is given */}\r\n      {hasConsent && gaMeasurementId && <GoogleAnalytics gaId={gaMeasurementId} />}\r\n\r\n      <div className=\"container mx-auto px-4 py-8 max-w-4xl grow overflow-hidden w-full\">\r\n        {/* Title and description moved outside the card - Render directly */}\r\n        <div className=\"text-center mb-8\">\r\n          <h1 className=\"text-3xl font-bold text-center mb-4\">\r\n            {pageTitle}\r\n          </h1>\r\n          <div className=\"max-w-2xl mx-auto space-y-2 px-4\">\r\n            {/* Use static text for initial render, then t() after mounting */}\r\n            <p>{mounted ? t('InvoiceForm.description_p1') : description1}</p>\r\n            <p>{mounted ? t('InvoiceForm.description_p2') : description2}</p>\r\n          </div>\r\n        </div>\r\n        \r\n        {/* Only show loading indicator for the form when component is not mounted (InvoiceForm itself has a more detailed skeleton via dynamic import) */}\r\n        {!mounted && (\r\n          <div className=\"flex items-center gap-2 justify-center text-muted-foreground text-sm mb-6\">\r\n            <Loader2 className=\"animate-spin h-4 w-4 text-primary\" />\r\n            <span>Loading calculator...</span>\r\n          </div>\r\n        )}\r\n        \r\n        {/* Fixed-width container for consistent card sizes */}\r\n        <div className=\"mx-auto\" style={{ maxWidth: \"768px\" }}>\r\n          {/* Form Card */}\r\n          <Card className=\"mb-12 shadow-md w-full transition-opacity duration-300 ease-in-out\" \r\n                data-loaded={mounted ? \"true\" : \"false\"}\r\n                style={{ opacity: mounted ? 1 : 0.85 }}>\r\n            <CardContent className=\"pt-6\">\r\n              <div className=\"w-full\">\r\n                <Suspense fallback={\r\n                  <div className=\"space-y-6 animate-pulse\">\r\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n                      <div className=\"h-24 bg-muted/60 rounded-lg\"></div>\r\n                      <div className=\"h-24 bg-muted/60 rounded-lg\"></div>\r\n                    </div>\r\n                    <div className=\"h-20 bg-muted/60 rounded-lg\"></div>\r\n                    <div className=\"h-48 bg-muted/60 rounded-lg\"></div>\r\n                    <div className=\"h-10 bg-muted/60 rounded-lg\"></div>\r\n                  </div>\r\n                }>\r\n                  <InvoiceForm \r\n                    onCalculateAction={handleCalculation} \r\n                    initialDemoData={initialDemoData} // Pass state as prop\r\n                    onDemoDataApplied={handleDemoDataApplied} // Pass callback prop\r\n                  />\r\n                </Suspense>\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n\r\n          {/* Results Section */}\r\n          <div ref={resultsSectionRef} className=\"mt-12 w-full\">\r\n            {mounted && calculationError && (\r\n              <Alert variant=\"destructive\" className=\"w-full\">\r\n                <Terminal className=\"h-4 w-4\" />\r\n                <AlertTitle>{t('Errors.calculationErrorTitle')}</AlertTitle>\r\n                <AlertDescription>{safeText(calculationError)}</AlertDescription>\r\n              </Alert>\r\n            )}\r\n            {mounted && calculationResult && storedInputData && !calculationError && (\r\n              <ResultsDisplay \r\n                results={calculationResult} \r\n                inputData={storedInputData as InputDataForDisplay}\r\n              />\r\n            )}\r\n            {!mounted && calculationResult === null && (\r\n              <Card className=\"shadow-md w-full h-64 flex items-center justify-center\">\r\n                <div className=\"space-y-4 p-6 w-full\">\r\n                  <div className=\"h-6 bg-muted/60 rounded-md animate-pulse w-3/4 mx-auto mb-8\" />\r\n                  <div className=\"grid grid-cols-4 gap-4 mb-6\">\r\n                    <div className=\"h-4 bg-muted/60 rounded-sm animate-pulse\" />\r\n                    <div className=\"h-4 bg-muted/60 rounded-sm animate-pulse\" />\r\n                    <div className=\"h-4 bg-muted/60 rounded-sm animate-pulse\" />\r\n                    <div className=\"h-4 bg-muted/60 rounded-sm animate-pulse\" />\r\n                  </div>\r\n                  <div className=\"h-24 bg-muted/60 rounded-md animate-pulse\" />\r\n                </div>\r\n              </Card>\r\n            )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {mounted && <SettingsModal isOpen={isSettingsOpen} onOpenChange={setIsSettingsOpen} />}\r\n    </>\r\n  );\r\n}\r\n","\"use client\";\r\n\r\nimport * as React from \"react\";\r\nimport * as LabelPrimitive from \"@radix-ui/react-label\";\r\nimport { Slot } from \"@radix-ui/react-slot\";\r\nimport {\r\n  Controller,\r\n  FormProvider,\r\n  useFormContext,\r\n  useFormState,\r\n  type ControllerProps,\r\n  type FieldPath,\r\n  type FieldValues,\r\n} from \"react-hook-form\";\r\n\r\nimport { cn } from \"@/lib/utils\";\r\nimport { Label } from \"@/components/ui/label\";\r\n\r\nconst Form = FormProvider;\r\n\r\ntype FormFieldContextValue<\r\n  TFieldValues extends FieldValues = FieldValues,\r\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>,\r\n> = {\r\n  name: TName;\r\n};\r\n\r\nconst FormFieldContext = React.createContext<FormFieldContextValue>(\r\n  {} as FormFieldContextValue,\r\n);\r\n\r\nconst FormField = <\r\n  TFieldValues extends FieldValues = FieldValues,\r\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>,\r\n>({\r\n  ...props\r\n}: ControllerProps<TFieldValues, TName>) => {\r\n  return (\r\n    <FormFieldContext.Provider value={{ name: props.name }}>\r\n      <Controller {...props} />\r\n    </FormFieldContext.Provider>\r\n  );\r\n};\r\n\r\nconst useFormField = () => {\r\n  const fieldContext = React.useContext(FormFieldContext);\r\n  const itemContext = React.useContext(FormItemContext);\r\n  const { getFieldState } = useFormContext();\r\n  const formState = useFormState({ name: fieldContext.name });\r\n  const fieldState = getFieldState(fieldContext.name, formState);\r\n\r\n  if (!fieldContext) {\r\n    throw new Error(\"useFormField should be used within <FormField>\");\r\n  }\r\n\r\n  const { id } = itemContext;\r\n\r\n  return {\r\n    id,\r\n    name: fieldContext.name,\r\n    formItemId: `${id}-form-item`,\r\n    formDescriptionId: `${id}-form-item-description`,\r\n    formMessageId: `${id}-form-item-message`,\r\n    ...fieldState,\r\n  };\r\n};\r\n\r\ntype FormItemContextValue = {\r\n  id: string;\r\n};\r\n\r\nconst FormItemContext = React.createContext<FormItemContextValue>(\r\n  {} as FormItemContextValue,\r\n);\r\n\r\nfunction FormItem({ className, ...props }: React.ComponentProps<\"div\">) {\r\n  const id = React.useId();\r\n\r\n  return (\r\n    <FormItemContext.Provider value={{ id }}>\r\n      <div\r\n        data-slot=\"form-item\"\r\n        className={cn(\"grid gap-2\", className)}\r\n        {...props}\r\n      />\r\n    </FormItemContext.Provider>\r\n  );\r\n}\r\n\r\n// Helper component that assumes context is available\r\nfunction FormLabelInternal({ \r\n  fieldContext,\r\n  itemContext,\r\n  className,\r\n  htmlFor: explicitHtmlFor, // Rename explicit prop\r\n  ...props\r\n}: React.ComponentProps<typeof LabelPrimitive.Root> & {\r\n  fieldContext: FormFieldContextValue;\r\n  itemContext: FormItemContextValue;\r\n  htmlFor?: string;\r\n}) {\r\n  // Hooks are safe to call unconditionally here\r\n  const { getFieldState } = useFormContext();\r\n  const formState = useFormState({ name: fieldContext.name });\r\n  const fieldState = getFieldState(fieldContext.name, formState);\r\n\r\n  const formItemId = `${itemContext.id}-form-item`;\r\n  const hasError = !!fieldState.error;\r\n  // Prioritize explicit htmlFor prop if provided\r\n  const derivedHtmlFor = explicitHtmlFor || formItemId;\r\n\r\n  return (\r\n    <Label\r\n      data-slot=\"form-label\"\r\n      data-error={hasError}\r\n      className={cn(\"data-[error=true]:text-destructive\", className)}\r\n      htmlFor={derivedHtmlFor}\r\n      {...props}\r\n    />\r\n  );\r\n}\r\n\r\nfunction FormLabel({\r\n  className,\r\n  htmlFor,\r\n  ...props\r\n}: React.ComponentProps<typeof LabelPrimitive.Root>) {\r\n  // Get contexts unconditionally\r\n  const fieldContext = React.useContext(FormFieldContext);\r\n  const itemContext = React.useContext(FormItemContext);\r\n\r\n  // Check if contexts are valid (simple non-empty check for fieldContext)\r\n  const hasContext = fieldContext && Object.keys(fieldContext).length > 0 && itemContext && itemContext.id;\r\n\r\n  if (hasContext) {\r\n    // Render internal component only when context is available\r\n    return (\r\n      <FormLabelInternal \r\n        fieldContext={fieldContext}\r\n        itemContext={itemContext}\r\n        className={className}\r\n        htmlFor={htmlFor} // Pass explicit htmlFor\r\n        {...props} \r\n      />\r\n    );\r\n  }\r\n\r\n  // Render basic label if no context\r\n  return (\r\n    <Label\r\n      data-slot=\"form-label\"\r\n      data-error={false} // No context means no error state derived from it\r\n      className={cn(\"data-[error=true]:text-destructive\", className)} // Keep class for consistency if needed\r\n      htmlFor={htmlFor} // Use explicit htmlFor\r\n      {...props}\r\n    />\r\n  );\r\n}\r\n\r\nfunction FormControl({ ...props }: React.ComponentProps<typeof Slot>) {\r\n  const { error, formItemId, formDescriptionId, formMessageId } =\r\n    useFormField();\r\n\r\n  return (\r\n    <Slot\r\n      data-slot=\"form-control\"\r\n      id={formItemId}\r\n      aria-describedby={\r\n        !error\r\n          ? `${formDescriptionId}`\r\n          : `${formDescriptionId} ${formMessageId}`\r\n      }\r\n      aria-invalid={!!error}\r\n      {...props}\r\n    />\r\n  );\r\n}\r\n\r\nfunction FormDescription({ className, ...props }: React.ComponentProps<\"p\">) {\r\n  const { formDescriptionId } = useFormField();\r\n\r\n  return (\r\n    <p\r\n      data-slot=\"form-description\"\r\n      id={formDescriptionId}\r\n      className={cn(\"text-muted-foreground text-sm\", className)}\r\n      {...props}\r\n    />\r\n  );\r\n}\r\n\r\nfunction FormMessage({ className, ...props }: React.ComponentProps<\"p\">) {\r\n  const { error, formMessageId } = useFormField();\r\n  const body = error ? String(error?.message ?? \"\") : props.children;\r\n\r\n  if (!body) {\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <p\r\n      data-slot=\"form-message\"\r\n      id={formMessageId}\r\n      className={cn(\"form-error-message\", className)}\r\n      {...props}\r\n    >\r\n      {body}\r\n    </p>\r\n  );\r\n}\r\n\r\nexport {\r\n  useFormField,\r\n  Form,\r\n  FormItem,\r\n  FormLabel,\r\n  FormControl,\r\n  FormDescription,\r\n  FormMessage,\r\n  FormField,\r\n};\r\n","import * as React from \"react\";\nimport { Slot } from \"@radix-ui/react-slot\";\nimport { cva, type VariantProps } from \"class-variance-authority\";\n\nimport { cn } from \"@/lib/utils\";\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 ring-offset-background aria-[invalid=true]:ring-destructive/20 dark:aria-[invalid=true]:ring-destructive/40 cursor-pointer hover:transform hover:translate-y-[-2px] hover:scale-[1.015] select-none\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"bg-primary text-primary-foreground shadow-md hover:bg-primary/90 hover:shadow-md\",\n        destructive:\n          \"bg-destructive text-destructive-foreground shadow-md hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 hover:shadow-md\",\n        outline:\n          \"border bg-background shadow-md hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50 hover:shadow-md\",\n        secondary:\n          \"bg-secondary text-secondary-foreground shadow-md hover:bg-secondary/80 hover:shadow-md\",\n        ghost:\n          \"\",\n        link: \"text-primary underline-offset-4 hover:underline hover:text-[#F5A623]\",\n      },\n      size: {\n        default: \"h-10 px-4 py-2\",\n        sm: \"h-8 rounded-md px-3 py-1\",\n        lg: \"h-12 px-6 py-3\",\n        icon: \"size-10\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  },\n);\n\nfunction Button({\n  className,\n  variant,\n  size,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"button\"> &\n  VariantProps<typeof buttonVariants> & {\n    asChild?: boolean;\n  }) {\n  const Comp = asChild ? Slot : \"button\";\n\n  return (\n    <Comp\n      data-slot=\"button\"\n      className={cn(buttonVariants({ variant, size, className }))}\n      {...props}\n    />\n  );\n}\n\nexport { Button, buttonVariants };\n","\"use client\";\n\nimport * as React from \"react\";\nimport * as SelectPrimitive from \"@radix-ui/react-select\";\n\nimport { CheckIcon, ChevronDownIcon, ChevronUpIcon } from \"lucide-react\";\n\nimport { cn } from \"@/lib/utils\";\n\nfunction Select({\n  ...props\n}: React.ComponentProps<typeof SelectPrimitive.Root>) {\n  return <SelectPrimitive.Root data-slot=\"select\" {...props} />;\n}\n\nfunction SelectGroup({\n  ...props\n}: React.ComponentProps<typeof SelectPrimitive.Group>) {\n  return <SelectPrimitive.Group data-slot=\"select-group\" {...props} />;\n}\n\nfunction SelectValue({\n  ...props\n}: React.ComponentProps<typeof SelectPrimitive.Value>) {\n  return <SelectPrimitive.Value data-slot=\"select-value\" {...props} />;\n}\n\nfunction SelectTrigger({\n  className,\n  size = \"default\",\n  children,\n  id,\n  name,\n  ...props\n}: React.ComponentProps<typeof SelectPrimitive.Trigger> & {\n  size?: \"sm\" | \"default\";\n  id?: string;\n  name?: string;\n}) {\n  return (\n    <SelectPrimitive.Trigger\n      data-slot=\"select-trigger\"\n      data-size={size}\n      id={id}\n      name={name}\n      className={cn(\n        \"border-input data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 dark:hover:bg-input/50 flex w-fit items-center justify-between gap-2 rounded-md border bg-transparent px-3 py-2 text-sm whitespace-nowrap shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 data-[size=default]:h-9 data-[size=sm]:h-8 *:data-[slot=select-value]:line-clamp-1 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4\",\n        className,\n      )}\n      {...props}\n    >\n      {children}\n      <SelectPrimitive.Icon asChild>\n        <ChevronDownIcon className=\"size-4 opacity-50\" />\n      </SelectPrimitive.Icon>\n    </SelectPrimitive.Trigger>\n  );\n}\n\nfunction SelectContent({\n  className,\n  children,\n  position = \"popper\",\n  ...props\n}: React.ComponentProps<typeof SelectPrimitive.Content>) {\n  return (\n    <SelectPrimitive.Portal>\n      <SelectPrimitive.Content\n        data-slot=\"select-content\"\n        className={cn(\n          \"bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 relative z-[9999] min-w-[8rem] rounded-md border shadow-md\",\n          position === \"popper\" &&\n            \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n          className,\n        )}\n        style={{ backgroundColor: 'hsl(var(--popover))', opacity: 1 }}\n        position=\"popper\"\n        sideOffset={5}\n        avoidCollisions={true}\n        collisionPadding={20}\n        {...props}\n      >\n        <SelectScrollUpButton />\n        <SelectPrimitive.Viewport\n          className={cn(\n            \"p-1 h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)] overflow-y-auto\",\n            position === \"popper\" ? \"max-h-[var(--radix-select-content-available-height)]\" : \"max-h-[200px]\"\n          )}\n        >\n          {children}\n        </SelectPrimitive.Viewport>\n        <SelectScrollDownButton />\n      </SelectPrimitive.Content>\n    </SelectPrimitive.Portal>\n  );\n}\n\nfunction SelectLabel({\n  className,\n  ...props\n}: React.ComponentProps<typeof SelectPrimitive.Label>) {\n  return (\n    <SelectPrimitive.Label\n      data-slot=\"select-label\"\n      className={cn(\"text-muted-foreground px-2 py-1.5 text-xs\", className)}\n      {...props}\n    />\n  );\n}\n\nfunction SelectItem({\n  className,\n  children,\n  id,\n  value,\n  ...props\n}: React.ComponentProps<typeof SelectPrimitive.Item> & { key?: React.Key }) {\n  const { key, ...restProps } = props;\n\n  return (\n    <SelectPrimitive.Item\n      key={key}\n      data-slot=\"select-item\"\n      id={id || (value ? `select-item-${value}` : undefined)}\n      className={cn(\n        \"select-item relative flex w-full cursor-pointer items-center gap-2 rounded-sm py-1.5 pr-8 pl-2 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n        className,\n      )}\n      value={value}\n      {...restProps}\n    >\n      <span className=\"absolute right-2 flex size-3.5 items-center justify-center\">\n        <SelectPrimitive.ItemIndicator>\n          <CheckIcon className=\"size-4\" />\n        </SelectPrimitive.ItemIndicator>\n      </span>\n      <SelectPrimitive.ItemText>\n        {children}\n      </SelectPrimitive.ItemText>\n    </SelectPrimitive.Item>\n  );\n}\n\nfunction SelectSeparator({\n  className,\n  ...props\n}: React.ComponentProps<typeof SelectPrimitive.Separator>) {\n  return (\n    <SelectPrimitive.Separator\n      data-slot=\"select-separator\"\n      className={cn(\"bg-border pointer-events-none -mx-1 my-1 h-px\", className)}\n      {...props}\n    />\n  );\n}\n\nfunction SelectScrollUpButton({\n  className,\n  ...props\n}: React.ComponentProps<typeof SelectPrimitive.ScrollUpButton>) {\n  return (\n    <SelectPrimitive.ScrollUpButton\n      data-slot=\"select-scroll-up-button\"\n      className={cn(\n        \"flex cursor-default items-center justify-center py-1\",\n        className,\n      )}\n      {...props}\n    >\n      <ChevronUpIcon className=\"size-4\" />\n    </SelectPrimitive.ScrollUpButton>\n  );\n}\n\nfunction SelectScrollDownButton({\n  className,\n  ...props\n}: React.ComponentProps<typeof SelectPrimitive.ScrollDownButton>) {\n  return (\n    <SelectPrimitive.ScrollDownButton\n      data-slot=\"select-scroll-down-button\"\n      className={cn(\n        \"flex cursor-default items-center justify-center py-1\",\n        className,\n      )}\n      {...props}\n    >\n      <ChevronDownIcon className=\"size-4\" />\n    </SelectPrimitive.ScrollDownButton>\n  );\n}\n\nexport {\n  Select,\n  SelectContent,\n  SelectGroup,\n  SelectItem,\n  SelectLabel,\n  SelectScrollDownButton,\n  SelectScrollUpButton,\n  SelectSeparator,\n  SelectTrigger,\n  SelectValue,\n};\n","import * as React from \"react\";\r\n\r\nimport { cn } from \"@/lib/utils\";\r\n\r\ninterface InputProps extends React.ComponentProps<\"input\"> {\r\n  helperText?: string;\r\n  error?: string;\r\n  id?: string;\r\n  onDoubleClick?: (e: React.MouseEvent<HTMLInputElement>) => void;\r\n}\r\n\r\nfunction Input(\r\n  { className, type, helperText, error, id, onDoubleClick, ...props }: InputProps,\r\n  ref: React.Ref<HTMLInputElement>,\r\n) {\r\n  const errorId = error ? `${id}-error` : undefined;\r\n  \r\n  // Handle double click to select all text\r\n  const handleDoubleClick = (e: React.MouseEvent<HTMLInputElement>) => {\r\n    // Call the target's select method to select all text\r\n    e.currentTarget.select();\r\n    \r\n    // Also call any provided onDoubleClick handler (to maintain existing behavior)\r\n    if (onDoubleClick) {\r\n      onDoubleClick(e);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"w-full\">\r\n      <input\r\n        id={id}\r\n        ref={ref}\r\n        type={type}\r\n        data-slot=\"input\"\r\n        aria-invalid={!!error}\r\n        aria-describedby={errorId}\r\n        onDoubleClick={handleDoubleClick}\r\n        className={cn(\r\n          \"flex h-10 w-full rounded-lg border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\r\n          \"shadow-sm\",\r\n          \"selection:bg-primary selection:text-primary-foreground\",\r\n          error\r\n            ? \"border-destructive ring-destructive/40 focus-visible:ring-destructive\"\r\n            : \"\",\r\n          className,\r\n        )}\r\n        {...props}\r\n      />\r\n      {helperText && (\r\n        <p className=\"text-xs text-muted-foreground mt-1 mb-3 pl-3\">{helperText}</p>\r\n      )}\r\n      {error && (\r\n        <p\r\n          id={errorId}\r\n          role=\"alert\"\r\n          className=\"form-error-message\"\r\n        >\r\n          {error}\r\n        </p>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\nconst ForwardedInput = React.forwardRef(Input);\r\n\r\nexport { ForwardedInput as Input };\r\n","import * as React from \"react\";\r\n\r\n/**\r\n * VisuallyHidden component hides its children visually but keeps them accessible to screen readers.\r\n */\r\nfunction VisuallyHidden({ children }: { children: React.ReactNode }) {\r\n  return (\r\n    <span\r\n      className=\"absolute w-px h-px p-0 -m-px overflow-hidden whitespace-nowrap border-0\"\r\n      style={{ clip: \"rect(0, 0, 0, 0)\" }}\r\n    >\r\n      {children}\r\n    </span>\r\n  );\r\n}\r\n\r\nexport { VisuallyHidden };\r\n","import * as React from \"react\";\r\n\r\nimport { VisuallyHidden } from \"@/components/ui/visually-hidden\";\r\n\r\ninterface AccessibleIconProps {\r\n  label: string;\r\n  children: React.ReactNode;\r\n}\r\n\r\n/**\r\n * AccessibleIcon component wraps an icon and provides a visually hidden label for screen readers.\r\n */\r\nfunction AccessibleIcon({ label, children }: AccessibleIconProps) {\r\n  return (\r\n    <span className=\"inline-flex items-center justify-center\">\r\n      {children}\r\n      <VisuallyHidden>{label}</VisuallyHidden>\r\n    </span>\r\n  );\r\n}\r\n\r\nexport { AccessibleIcon };\r\n","\"use client\";\r\n\r\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\";\r\nimport * as React from \"react\";\r\n\r\nimport { AccessibleIcon } from \"@/components/ui/accessible-icon\";\r\nimport { XIcon } from \"lucide-react\";\r\nimport { cn } from \"@/lib/utils\";\r\n\r\nfunction Dialog({\r\n  ...props\r\n}: React.ComponentProps<typeof DialogPrimitive.Root>) {\r\n  return <DialogPrimitive.Root data-slot=\"dialog\" {...props} />;\r\n}\r\n\r\nfunction DialogTrigger({\r\n  ...props\r\n}: React.ComponentProps<typeof DialogPrimitive.Trigger>) {\r\n  return <DialogPrimitive.Trigger data-slot=\"dialog-trigger\" {...props} />;\r\n}\r\n\r\nfunction DialogPortal({\r\n  ...props\r\n}: React.ComponentProps<typeof DialogPrimitive.Portal>) {\r\n  return <DialogPrimitive.Portal data-slot=\"dialog-portal\" {...props} />;\r\n}\r\n\r\nfunction DialogClose({\r\n  ...props\r\n}: React.ComponentProps<typeof DialogPrimitive.Close>) {\r\n  return <DialogPrimitive.Close data-slot=\"dialog-close\" {...props} />;\r\n}\r\n\r\nfunction DialogOverlay({\r\n  className,\r\n  ...props\r\n}: React.ComponentProps<typeof DialogPrimitive.Overlay>) {\r\n  return (\r\n    <DialogPrimitive.Overlay\r\n      data-slot=\"dialog-overlay\"\r\n      className={cn(\r\n        \"data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 backdrop-blur-sm bg-black/30\",\r\n        className,\r\n      )}\r\n      {...props}\r\n    />\r\n  );\r\n}\r\n\r\nfunction DialogContent({\r\n  className,\r\n  children,\r\n  ...props\r\n}: React.ComponentProps<typeof DialogPrimitive.Content>) {\r\n  const [isMounted, setIsMounted] = React.useState(false);\r\n  const isMountedRef = React.useRef(true);\r\n\r\n  React.useEffect(() => {\r\n    isMountedRef.current = true;\r\n    const mountTimer = setTimeout(() => {\r\n      if (isMountedRef.current) {\r\n        setIsMounted(true);\r\n      }\r\n    }, 10); // Small delay to ensure DOM is ready for animations\r\n\r\n    return () => {\r\n      isMountedRef.current = false;\r\n      clearTimeout(mountTimer);\r\n      // No need to call setIsMounted(false) here.\r\n      // React will unmount the component and its contents naturally.\r\n      // The isMounted state is primarily for the initial mount animation.\r\n    };\r\n  }, []);\r\n\r\n  if (!isMounted) {\r\n    return null; // Render nothing until mounted (for entry animation)\r\n  }\r\n\r\n  return (\r\n    <DialogPortal data-slot=\"dialog-portal\">\r\n      <DialogOverlay />\r\n      <DialogPrimitive.Content\r\n        data-slot=\"dialog-content\"\r\n        className={cn(\r\n          \"bg-card data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-xl duration-200 sm:max-w-lg mx-auto\",\r\n          className,\r\n        )}\r\n        style={{ backgroundColor: 'hsl(var(--card))', opacity: 1 }}\r\n        {...props}\r\n      >\r\n        {children}\r\n        <DialogPrimitive.Close\r\n          aria-label=\"Close dialog\"\r\n          className=\"ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-sm opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-none disabled:pointer-events-none cursor-pointer\"\r\n        >\r\n          <AccessibleIcon label=\"Close\">\r\n            <XIcon className=\"size-4\" />\r\n          </AccessibleIcon>\r\n        </DialogPrimitive.Close>\r\n      </DialogPrimitive.Content>\r\n    </DialogPortal>\r\n  );\r\n}\r\n\r\nfunction DialogHeader({ className, ...props }: React.ComponentProps<\"div\">) {\r\n  return (\r\n    <div\r\n      data-slot=\"dialog-header\"\r\n      className={cn(\"flex flex-col gap-2 text-center sm:text-left\", className)}\r\n      {...props}\r\n    />\r\n  );\r\n}\r\n\r\nfunction DialogFooter({ className, ...props }: React.ComponentProps<\"div\">) {\r\n  return (\r\n    <div\r\n      data-slot=\"dialog-footer\"\r\n      className={cn(\r\n        \"flex flex-col-reverse gap-2 sm:flex-row sm:justify-end\",\r\n        className,\r\n      )}\r\n      {...props}\r\n    />\r\n  );\r\n}\r\n\r\nfunction DialogTitle({\r\n  className,\r\n  ...props\r\n}: React.ComponentProps<typeof DialogPrimitive.Title>) {\r\n  return (\r\n    <DialogPrimitive.Title\r\n      data-slot=\"dialog-title\"\r\n      className={cn(\"text-lg leading-none font-semibold\", className)}\r\n      {...props}\r\n    />\r\n  );\r\n}\r\n\r\nfunction DialogDescription({\r\n  className,\r\n  ...props\r\n}: React.ComponentProps<typeof DialogPrimitive.Description>) {\r\n  return (\r\n    <DialogPrimitive.Description\r\n      data-slot=\"dialog-description\"\r\n      className={cn(\"text-muted-foreground text-sm\", className)}\r\n      {...props}\r\n    />\r\n  );\r\n}\r\n\r\nexport {\r\n  Dialog,\r\n  DialogClose,\r\n  DialogContent,\r\n  DialogDescription,\r\n  DialogFooter,\r\n  DialogHeader,\r\n  DialogOverlay,\r\n  DialogPortal,\r\n  DialogTitle,\r\n  DialogTrigger,\r\n};\r\n","import * as React from \"react\";\r\n\r\nimport { cn } from \"@/lib/utils\";\r\n\r\nfunction Card({ className, ...props }: React.ComponentProps<\"div\">) {\r\n  return (\r\n    <div\r\n      data-slot=\"card\"\r\n      className={cn(\r\n        \"bg-card text-card-foreground flex flex-col gap-6 rounded-lg border py-6 shadow-sm\",\r\n        className,\r\n      )}\r\n      {...props}\r\n    />\r\n  );\r\n}\r\n\r\nfunction CardHeader({ className, ...props }: React.ComponentProps<\"div\">) {\r\n  return (\r\n    <div\r\n      data-slot=\"card-header\"\r\n      className={cn(\r\n        \"@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-2 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6\",\r\n        className,\r\n      )}\r\n      {...props}\r\n    />\r\n  );\r\n}\r\n\r\nfunction CardTitle({ className, ...props }: React.ComponentProps<\"div\">) {\r\n  return (\r\n    <div\r\n      data-slot=\"card-title\"\r\n      className={cn(\"leading-none font-semibold\", className)}\r\n      {...props}\r\n    />\r\n  );\r\n}\r\n\r\nfunction CardDescription({ className, ...props }: React.ComponentProps<\"div\">) {\r\n  return (\r\n    <div\r\n      data-slot=\"card-description\"\r\n      className={cn(\"text-muted-foreground text-sm\", className)}\r\n      {...props}\r\n    />\r\n  );\r\n}\r\n\r\nfunction CardAction({ className, ...props }: React.ComponentProps<\"div\">) {\r\n  return (\r\n    <div\r\n      data-slot=\"card-action\"\r\n      className={cn(\r\n        \"col-start-2 row-span-2 row-start-1 self-start justify-self-end\",\r\n        className,\r\n      )}\r\n      {...props}\r\n    />\r\n  );\r\n}\r\n\r\nfunction CardContent({ className, ...props }: React.ComponentProps<\"div\">) {\r\n  return (\r\n    <div\r\n      data-slot=\"card-content\"\r\n      className={cn(\"px-6\", className)}\r\n      {...props}\r\n    />\r\n  );\r\n}\r\n\r\nfunction CardFooter({ className, ...props }: React.ComponentProps<\"div\">) {\r\n  return (\r\n    <div\r\n      data-slot=\"card-footer\"\r\n      className={cn(\"flex items-center px-6 [.border-t]:pt-6\", className)}\r\n      {...props}\r\n    />\r\n  );\r\n}\r\n\r\nexport {\r\n  Card,\r\n  CardHeader,\r\n  CardFooter,\r\n  CardTitle,\r\n  CardAction,\r\n  CardDescription,\r\n  CardContent,\r\n};\r\n","// Add ESLint disable comments for unused imports that are kept for future use\r\n\r\nimport { CalculationError, CalculationProcessingError, ERROR_CODES, InputValidationError } from \"./errors\";\r\nimport {\r\n  addDays,\r\n  differenceInDays,\r\n  endOfMonth,\r\n  endOfQuarter,\r\n  endOfYear,\r\n  format,\r\n  getQuarter,\r\n  getYear,\r\n  startOfDay,\r\n} from \"date-fns\";\r\n\r\n// Re-export error types so they can be imported from calculations.ts\r\nexport { CalculationError, CalculationProcessingError, InputValidationError, ERROR_CODES } from \"./errors\";\r\n\r\n// Helper function for rounding to a specific number of decimal places\r\nfunction round(value: number, decimals: number): number {\r\n  return Number(Math.round(Number(value + \"e\" + decimals)) + \"e-\" + decimals);\r\n}\r\n\r\n// Updated Input: Accepts an array of amounts and split period type\r\nexport interface CalculationInput {\r\n  startDate: Date;\r\n  endDate: Date;\r\n  includeEndDate: boolean;\r\n  amounts: number[]; // Array of amounts to be summed and split\r\n  splitPeriod?: 'yearly' | 'quarterly' | 'monthly'; // Replaced daily with monthly\r\n}\r\n\r\n// Represents the split portion of a SINGLE original amount for a specific period (year, quarter, or day)\r\ninterface SingleAmountPeriodSplit {\r\n  splitAmount: number; // Rounded split portion for this period\r\n}\r\n\r\n// Represents the split results for ONE original input amount across all periods\r\nexport interface AmountSplitResult {\r\n  originalAmount: number;\r\n  adjustedTotalAmount: number; // Sum of splits for this amount after adjustment\r\n  splits: { [periodIdentifier: string]: SingleAmountPeriodSplit }; // Map period identifier (YYYY, YYYY-Qn, YYYY-MM) to its split portion\r\n}\r\n\r\n// Represents the aggregated results per period across ALL input amounts\r\nexport interface AggregatedPeriodSplit {\r\n  periodIdentifier: string; // YYYY, YYYY-Qn, or YYYY-MM\r\n  daysInPeriod: number;\r\n  proportion: number;\r\n  totalSplitAmount: number; // Sum of all individual amount splits for this period\r\n}\r\n\r\n// Updated CalculationResult structure\r\nexport interface CalculationResult {\r\n  totalDays: number;\r\n  originalTotalAmount: number; // Sum of all input amounts\r\n  adjustedTotalAmount: number; // Sum of all adjusted split amounts\r\n  resultsPerAmount: AmountSplitResult[]; // Detailed results for each input amount\r\n  aggregatedSplits: AggregatedPeriodSplit[]; // Aggregated results per period\r\n  calculationSteps: CalculationStepDetails;\r\n  splitPeriodUsed: 'yearly' | 'quarterly' | 'monthly'; // Replaced daily with monthly\r\n}\r\n\r\n// --- Helper for structuring calculation steps ---\r\nexport interface CalculationStepDetails {\r\n  totalDuration: {\r\n    days: number;\r\n    start: string;\r\n    end: string;\r\n    included: boolean;\r\n  };\r\n  periodSegments: { periodIdentifier: string; days: number; proportion: number }[]; // Renamed from yearSegments\r\n  amountCalculations: {\r\n    originalAmount: number;\r\n    periodSplits: { // Renamed from yearSplits\r\n      periodIdentifier: string;\r\n      rawSplit: number;\r\n      roundedSplit: number;\r\n      adjustment: number;\r\n    }[];\r\n    adjustmentAppliedToPeriod?: string; // Renamed from adjustmentAppliedToYear\r\n    discrepancy: number;\r\n    finalSum: number;\r\n  }[];\r\n  error?: string | CalculationError;\r\n}\r\n// --- End Helper ---\r\n\r\n// New return types for calculateInvoiceSplit\r\ninterface CalculateInvoiceSplitSuccess extends Omit<CalculationResult, 'calculationSteps'> {\r\n  success: true;\r\n  calculationSteps: Omit<CalculationStepDetails, 'error'> & { error?: undefined };\r\n}\r\n\r\ninterface CalculateInvoiceSplitFailure {\r\n  success: false;\r\n  error: CalculationError;\r\n  calculationSteps: CalculationStepDetails; // Contains the error details\r\n  originalTotalAmount: number;\r\n  splitPeriodUsed: 'yearly' | 'quarterly' | 'monthly';\r\n  // Minimal fields for consistency with createErrorResult's context\r\n  totalDays: 0;\r\n  adjustedTotalAmount: 0;\r\n  resultsPerAmount: [];\r\n  aggregatedSplits: [];\r\n}\r\n\r\nexport type CalculateInvoiceSplitReturnType =\r\n  | CalculateInvoiceSplitSuccess\r\n  | CalculateInvoiceSplitFailure;\r\n\r\n// Helper function to get the end of the next period based on the type\r\nfunction getNextPeriodBoundary(currentDate: Date, periodType: 'yearly' | 'quarterly' | 'monthly'): Date {\r\n  switch (periodType) {\r\n    case 'monthly':\r\n      return startOfDay(addDays(endOfMonth(currentDate), 1));\r\n    case 'quarterly':\r\n      return startOfDay(addDays(endOfQuarter(currentDate), 1));\r\n    case 'yearly':\r\n    default:\r\n      return startOfDay(addDays(endOfYear(currentDate), 1));\r\n  }\r\n}\r\n\r\n// Helper function to generate a period identifier string\r\nfunction getPeriodIdentifier(date: Date, periodType: 'yearly' | 'quarterly' | 'monthly'): string {\r\n  const year = getYear(date);\r\n  switch (periodType) {\r\n    case 'monthly':\r\n      return format(date, 'yyyy-MM');\r\n    case 'quarterly':\r\n      const quarter = getQuarter(date);\r\n      return `${year}-Q${quarter}`;\r\n    case 'yearly':\r\n    default:\r\n      return year.toString();\r\n  }\r\n}\r\n\r\n/**\r\n * Calculates the proportional split of invoice amounts across specified periods.\r\n * Applies rounding and adjustment for precision.\r\n * \r\n * @throws {InputValidationError} When input data is invalid\r\n * @throws {CalculationProcessingError} When calculation can't be completed successfully\r\n */\r\nexport function calculateInvoiceSplit(\r\n  input: CalculationInput,\r\n): CalculateInvoiceSplitReturnType {\r\n  const splitPeriod = input.splitPeriod || 'yearly'; // Default to yearly if not provided\r\n  const calcSteps: CalculationStepDetails = {\r\n    totalDuration: {\r\n      days: 0,\r\n      start: \"\",\r\n      end: \"\",\r\n      included: input.includeEndDate,\r\n    },\r\n    periodSegments: [], // Renamed\r\n    amountCalculations: [],\r\n  };\r\n\r\n  // Validate inputs with clear error messages\r\n  if (!input.amounts || input.amounts.length === 0) {\r\n    const error = new InputValidationError(\r\n      \"At least one invoice amount is required.\", \r\n      ERROR_CODES.NO_AMOUNTS\r\n    );\r\n    calcSteps.error = error;\r\n    return {\r\n      success: false,\r\n      error: error,\r\n      calculationSteps: calcSteps,\r\n      originalTotalAmount: 0, // No amounts processed yet\r\n      splitPeriodUsed: splitPeriod,\r\n      totalDays: 0,\r\n      adjustedTotalAmount: 0,\r\n      resultsPerAmount: [],\r\n      aggregatedSplits: [],\r\n    };\r\n  }\r\n  \r\n  if (input.amounts.some(a => isNaN(a) || a === null || a <= 0)) {\r\n    const invalidAmounts = input.amounts.filter(a => isNaN(a) || a === null || a <= 0);\r\n    const error = new InputValidationError(\r\n      \"All amounts must be valid positive numbers.\", \r\n      ERROR_CODES.INVALID_AMOUNT,\r\n      { invalidAmounts }\r\n    );\r\n    calcSteps.error = error;\r\n    return {\r\n      success: false,\r\n      error: error,\r\n      calculationSteps: calcSteps,\r\n      originalTotalAmount: 0, // Or sum of amounts if calculated before this check\r\n      splitPeriodUsed: splitPeriod,\r\n      totalDays: 0,\r\n      adjustedTotalAmount: 0,\r\n      resultsPerAmount: [],\r\n      aggregatedSplits: [],\r\n    };\r\n  }\r\n\r\n  const originalTotalAmount = round(\r\n    input.amounts.reduce((sum, a) => sum + a, 0),\r\n    2,\r\n  );\r\n\r\n  // Start date and end date validation\r\n  if (!input.startDate || !input.endDate || !(input.startDate instanceof Date) || !(input.endDate instanceof Date)) {\r\n    const error = new InputValidationError(\r\n      \"Valid start and end dates are required.\", \r\n      ERROR_CODES.INVALID_DATES,\r\n      { startDate: input.startDate, endDate: input.endDate }\r\n    );\r\n    calcSteps.error = error;\r\n    return {\r\n      success: false,\r\n      error: error,\r\n      calculationSteps: calcSteps,\r\n      originalTotalAmount: originalTotalAmount,\r\n      splitPeriodUsed: splitPeriod,\r\n      totalDays: 0,\r\n      adjustedTotalAmount: 0,\r\n      resultsPerAmount: [],\r\n      aggregatedSplits: [],\r\n    };\r\n  }\r\n\r\n  const cleanStartDate = startOfDay(input.startDate);\r\n  let cleanEffectiveEndDate = startOfDay(input.endDate);\r\n  if (input.includeEndDate) {\r\n    cleanEffectiveEndDate = addDays(cleanEffectiveEndDate, 1);\r\n  }\r\n  calcSteps.totalDuration.start = format(cleanStartDate, \"yyyy-MM-dd\");\r\n  // Use original end date for display if included, otherwise the day before effective end\r\n  calcSteps.totalDuration.end = format(input.includeEndDate ? input.endDate : addDays(cleanEffectiveEndDate, -1), \"yyyy-MM-dd\"); \r\n\r\n  if (cleanStartDate >= cleanEffectiveEndDate) {\r\n    const error = new InputValidationError(\r\n      \"Start date must be before the end date.\", \r\n      ERROR_CODES.END_BEFORE_START,\r\n      { \r\n        startDate: format(cleanStartDate, \"yyyy-MM-dd\"),\r\n        endDate: format(cleanEffectiveEndDate, \"yyyy-MM-dd\"),\r\n        includeEndDate: input.includeEndDate\r\n      }\r\n    );\r\n    calcSteps.error = error;\r\n    return {\r\n      success: false,\r\n      error: error,\r\n      calculationSteps: calcSteps,\r\n      originalTotalAmount: originalTotalAmount,\r\n      splitPeriodUsed: splitPeriod,\r\n      totalDays: 0,\r\n      adjustedTotalAmount: 0,\r\n      resultsPerAmount: [],\r\n      aggregatedSplits: [],\r\n    };\r\n  }\r\n\r\n  const totalDurationDays = differenceInDays(\r\n    cleanEffectiveEndDate,\r\n    cleanStartDate,\r\n  );\r\n  calcSteps.totalDuration.days = totalDurationDays;\r\n\r\n  if (totalDurationDays <= 0) {\r\n    const error = new InputValidationError(\r\n      \"The date range must result in a positive duration.\", \r\n      ERROR_CODES.ZERO_DURATION,\r\n      { \r\n        startDate: format(cleanStartDate, \"yyyy-MM-dd\"),\r\n        endDate: format(cleanEffectiveEndDate, \"yyyy-MM-dd\"),\r\n        calculatedDays: totalDurationDays\r\n      }\r\n    );\r\n    calcSteps.error = error;\r\n    return {\r\n      success: false,\r\n      error: error,\r\n      calculationSteps: calcSteps,\r\n      originalTotalAmount: originalTotalAmount,\r\n      splitPeriodUsed: splitPeriod,\r\n      totalDays: 0,\r\n      adjustedTotalAmount: 0,\r\n      resultsPerAmount: [],\r\n      aggregatedSplits: [],\r\n    };\r\n  }\r\n\r\n  try {\r\n    // --- Calculate days and proportions per period segment ---\r\n    const periodSegmentMap: {\r\n      [periodIdentifier: string]: { days: number; proportion: number };\r\n    } = {};\r\n    let currentDate = cleanStartDate;\r\n    while (currentDate < cleanEffectiveEndDate) {\r\n      const periodIdentifier = getPeriodIdentifier(currentDate, splitPeriod);\r\n      const nextPeriodBoundary = getNextPeriodBoundary(currentDate, splitPeriod);\r\n      const segmentEndDate =\r\n        cleanEffectiveEndDate < nextPeriodBoundary\r\n          ? cleanEffectiveEndDate\r\n          : nextPeriodBoundary;\r\n      const daysInSegment = differenceInDays(segmentEndDate, currentDate);\r\n\r\n      if (daysInSegment > 0) {\r\n        const proportion = daysInSegment / totalDurationDays;\r\n        if (!periodSegmentMap[periodIdentifier]) {\r\n          periodSegmentMap[periodIdentifier] = { days: 0, proportion: 0 };\r\n        }\r\n        periodSegmentMap[periodIdentifier].days += daysInSegment;\r\n        periodSegmentMap[periodIdentifier].proportion += proportion;\r\n      }\r\n      currentDate = segmentEndDate;\r\n    }\r\n    // Store period segment details for calculation steps display\r\n    calcSteps.periodSegments = Object.entries(periodSegmentMap)\r\n      .map(([identifier, data]) => ({\r\n        periodIdentifier: identifier,\r\n        days: data.days,\r\n        proportion: data.proportion,\r\n      }))\r\n      // Custom sort needed: Year > Quarter > Month\r\n      .sort((a, b) => {\r\n          // Sort YYYY, YYYY-Qn, YYYY-MM correctly\r\n          return a.periodIdentifier.localeCompare(b.periodIdentifier);\r\n      });\r\n    // --- End Segment Calculation ---\r\n\r\n    const resultsPerAmount: AmountSplitResult[] = [];\r\n\r\n    // --- Process each amount individually ---\r\n    for (const amount of input.amounts) {\r\n      const amountCalcStep: CalculationStepDetails[\"amountCalculations\"][0] = {\r\n        originalAmount: amount,\r\n        periodSplits: [], // Renamed\r\n        discrepancy: 0,\r\n        finalSum: 0,\r\n      };\r\n\r\n      const rawSplits: { periodIdentifier: string; rawSplit: number }[] = [];\r\n      for (const identifier in periodSegmentMap) {\r\n        const segment = periodSegmentMap[identifier];\r\n        const rawSplitAmount = amount * segment.proportion;\r\n        rawSplits.push({ periodIdentifier: identifier, rawSplit: rawSplitAmount });\r\n        amountCalcStep.periodSplits.push({\r\n          periodIdentifier: identifier,\r\n          rawSplit: rawSplitAmount,\r\n          roundedSplit: 0,\r\n          adjustment: 0,\r\n        }); // Initialize step details\r\n      }\r\n\r\n      // Round initial splits for this amount\r\n      const roundedSplits = rawSplits.map((split) => ({\r\n        ...split,\r\n        roundedSplit: round(split.rawSplit, 2),\r\n      }));\r\n\r\n      // Update steps with rounded values\r\n      roundedSplits.forEach((rs) => {\r\n        const step = amountCalcStep.periodSplits.find((s) => s.periodIdentifier === rs.periodIdentifier);\r\n        if (step) step.roundedSplit = rs.roundedSplit;\r\n      });\r\n\r\n      // Calculate discrepancy for this amount\r\n      const currentTotal = round(\r\n        roundedSplits.reduce((sum, s) => sum + s.roundedSplit, 0),\r\n        2,\r\n      );\r\n      const discrepancy = round(amount - currentTotal, 2);\r\n      amountCalcStep.discrepancy = discrepancy;\r\n\r\n      // Apply rounding adjustment to the period with the largest raw amount\r\n      if (discrepancy !== 0 && roundedSplits.length > 0) {\r\n        // Find the period with the max *raw* split amount to minimize impact of rounding intermediate values\r\n        const periodToAdjustDetails = rawSplits.reduce((max, current) => \r\n           Math.abs(current.rawSplit) > Math.abs(max.rawSplit) ? current : max\r\n        );\r\n        const periodIdentifierToAdjust = periodToAdjustDetails.periodIdentifier;\r\n\r\n        // Find the corresponding entry in roundedSplits to apply the adjustment\r\n        const splitToAdjust = roundedSplits.find(s => s.periodIdentifier === periodIdentifierToAdjust);\r\n        if(splitToAdjust) {\r\n          splitToAdjust.roundedSplit = round(splitToAdjust.roundedSplit + discrepancy, 2);\r\n          \r\n          // Update calculation steps with the adjustment detail\r\n          const step = amountCalcStep.periodSplits.find(s => s.periodIdentifier === periodIdentifierToAdjust);\r\n          if (step) {\r\n              step.roundedSplit = splitToAdjust.roundedSplit; // Ensure step reflects adjusted rounded value\r\n              step.adjustment = discrepancy;\r\n          }\r\n          amountCalcStep.adjustmentAppliedToPeriod = periodIdentifierToAdjust;\r\n        } else {\r\n          throw new CalculationProcessingError(\r\n            \"Calculation error: Unable to apply rounding adjustment.\",\r\n            ERROR_CODES.ROUNDING_ERROR,\r\n            { discrepancy, periodToAdjust: periodIdentifierToAdjust }\r\n          );\r\n        }\r\n      }\r\n\r\n      // Store final splits for this amount\r\n      const finalAmountSplits: { [periodIdentifier: string]: SingleAmountPeriodSplit } = {};\r\n      roundedSplits.forEach((s) => {\r\n        finalAmountSplits[s.periodIdentifier] = { splitAmount: s.roundedSplit };\r\n      });\r\n\r\n      const adjustedTotalForThisAmount = round(\r\n        roundedSplits.reduce((sum, s) => sum + s.roundedSplit, 0),\r\n        2,\r\n      );\r\n      amountCalcStep.finalSum = adjustedTotalForThisAmount;\r\n\r\n      resultsPerAmount.push({\r\n        originalAmount: amount,\r\n        adjustedTotalAmount: adjustedTotalForThisAmount,\r\n        splits: finalAmountSplits,\r\n      });\r\n      calcSteps.amountCalculations.push(amountCalcStep);\r\n    }\r\n    // --- End Amount Processing ---\r\n\r\n    // --- Aggregate results per period ---\r\n    const aggregatedSplits: AggregatedPeriodSplit[] = Object.entries(periodSegmentMap)\r\n      .map(([identifier, segment]) => {\r\n        const periodIdentifier = identifier;\r\n        let totalSplitForPeriod = 0;\r\n        resultsPerAmount.forEach((amountResult) => {\r\n          totalSplitForPeriod += amountResult.splits[periodIdentifier]?.splitAmount || 0;\r\n        });\r\n        return {\r\n          periodIdentifier: periodIdentifier,\r\n          daysInPeriod: segment.days,\r\n          proportion: segment.proportion,\r\n          totalSplitAmount: round(totalSplitForPeriod, 2),\r\n        };\r\n      })\r\n      // Use the same sort as periodSegments\r\n      .sort((a, b) => a.periodIdentifier.localeCompare(b.periodIdentifier));\r\n    // --- End Aggregation ---\r\n\r\n    const finalAdjustedTotalAmount = round(\r\n      aggregatedSplits.reduce((sum, s) => sum + s.totalSplitAmount, 0),\r\n      2,\r\n    );\r\n\r\n    // Final sanity check: does adjusted total match original total?\r\n    const finalDiscrepancy = round(originalTotalAmount - finalAdjustedTotalAmount, 2);\r\n    if (Math.abs(finalDiscrepancy) > 0.01 * input.amounts.length) { // Allow small tolerance per amount\r\n      console.warn(`Potential rounding discrepancy: Original ${originalTotalAmount}, Adjusted ${finalAdjustedTotalAmount}, Diff ${finalDiscrepancy}`);\r\n      // Do not throw here, but we could add a warning to the result\r\n    }\r\n\r\n    // MODIFIED: Ensure calcSteps.error is undefined for success case\r\n    const successCalcSteps: Omit<CalculationStepDetails, 'error'> & { error?: undefined } = { ...calcSteps, error: undefined };\r\n\r\n    return {\r\n      success: true,\r\n      totalDays: totalDurationDays,\r\n      originalTotalAmount: originalTotalAmount,\r\n      adjustedTotalAmount: finalAdjustedTotalAmount,\r\n      resultsPerAmount: resultsPerAmount,\r\n      aggregatedSplits: aggregatedSplits,\r\n      calculationSteps: successCalcSteps,\r\n      splitPeriodUsed: splitPeriod,\r\n    };\r\n  } catch (error) {\r\n    // Handle unexpected errors or re-throw known errors\r\n    let caughtError: CalculationError;\r\n    if (error instanceof CalculationError) {\r\n      caughtError = error;\r\n    } else {\r\n      // Convert unknown errors to CalculationError\r\n      caughtError = new CalculationProcessingError(\r\n        error instanceof Error ? error.message : \"An unexpected error occurred during calculation.\",\r\n        ERROR_CODES.UNEXPECTED_ERROR,\r\n        { originalError: error }\r\n      );\r\n    }\r\n    calcSteps.error = caughtError; // Ensure calcSteps has the error for the failure object\r\n\r\n    // MODIFIED: Return CalculateInvoiceSplitFailure\r\n    return {\r\n      success: false,\r\n      error: caughtError,\r\n      calculationSteps: calcSteps,\r\n      originalTotalAmount: originalTotalAmount,\r\n      splitPeriodUsed: splitPeriod,\r\n      totalDays: 0,\r\n      adjustedTotalAmount: 0,\r\n      resultsPerAmount: [],\r\n      aggregatedSplits: [],\r\n    };\r\n  }\r\n}\r\n","\"use client\";\r\n\r\nimport * as React from \"react\";\r\nimport * as LabelPrimitive from \"@radix-ui/react-label\";\r\n\r\nimport { cn } from \"@/lib/utils\";\r\n\r\nfunction Label({\r\n  className,\r\n  ...props\r\n}: React.ComponentProps<typeof LabelPrimitive.Root>) {\r\n  return (\r\n    <LabelPrimitive.Root\r\n      data-slot=\"label\"\r\n      className={cn(\r\n        \"flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50\",\r\n        className,\r\n      )}\r\n      {...props}\r\n    />\r\n  );\r\n}\r\n\r\nexport { Label };\r\n","/**\r\n * Custom error classes for the application\r\n * These classes provide structured error handling with error codes and categorization\r\n */\r\n\r\n/**\r\n * Base calculation error class that all specific calculation errors inherit from\r\n */\r\nexport class CalculationError extends Error {\r\n  code: string;\r\n  category: 'input' | 'calculation' | 'system';\r\n  details?: Record<string, unknown>;\r\n\r\n  constructor(\r\n    message: string, \r\n    code: string, \r\n    category: 'input' | 'calculation' | 'system' = 'calculation',\r\n    details?: Record<string, unknown>\r\n  ) {\r\n    super(message);\r\n    this.name = 'CalculationError';\r\n    this.code = code;\r\n    this.category = category;\r\n    this.details = details;\r\n    \r\n    // This is needed for instanceof to work properly with custom errors\r\n    Object.setPrototypeOf(this, CalculationError.prototype);\r\n  }\r\n}\r\n\r\n/**\r\n * Error for invalid input data\r\n */\r\nexport class InputValidationError extends CalculationError {\r\n  constructor(message: string, code: string, details?: Record<string, unknown>) {\r\n    super(message, code, 'input', details);\r\n    this.name = 'InputValidationError';\r\n    \r\n    // This is needed for instanceof to work properly with custom errors\r\n    Object.setPrototypeOf(this, InputValidationError.prototype);\r\n  }\r\n}\r\n\r\n/**\r\n * Error that occurs during calculation processing\r\n */\r\nexport class CalculationProcessingError extends CalculationError {\r\n  constructor(message: string, code: string, details?: Record<string, unknown>) {\r\n    super(message, code, 'calculation', details);\r\n    this.name = 'CalculationProcessingError';\r\n    \r\n    // This is needed for instanceof to work properly with custom errors\r\n    Object.setPrototypeOf(this, CalculationProcessingError.prototype);\r\n  }\r\n}\r\n\r\n/**\r\n * System-level errors (unexpected failures)\r\n */\r\nexport class SystemError extends CalculationError {\r\n  constructor(message: string, code: string, details?: Record<string, unknown>) {\r\n    super(message, code, 'system', details);\r\n    this.name = 'SystemError';\r\n    \r\n    // This is needed for instanceof to work properly with custom errors\r\n    Object.setPrototypeOf(this, SystemError.prototype);\r\n  }\r\n}\r\n\r\n// Error codes for consistent identification\r\nexport const ERROR_CODES = {\r\n  // Input validation error codes\r\n  NO_AMOUNTS: 'ERR_NO_AMOUNTS',\r\n  INVALID_AMOUNT: 'ERR_INVALID_AMOUNT',\r\n  INVALID_DATES: 'ERR_INVALID_DATES',\r\n  END_BEFORE_START: 'ERR_END_BEFORE_START',\r\n  ZERO_DURATION: 'ERR_ZERO_DURATION',\r\n  \r\n  // Calculation processing error codes\r\n  ROUNDING_ERROR: 'ERR_ROUNDING',\r\n  PERIOD_ALLOCATION_ERROR: 'ERR_PERIOD_ALLOCATION',\r\n  \r\n  // System error codes\r\n  UNEXPECTED_ERROR: 'ERR_UNEXPECTED'\r\n}; \r\n","\"use client\";\r\n\r\nimport { Loader2 } from \"lucide-react\";\r\nimport React from 'react';\r\nimport { useTranslation } from \"@/translations\";\r\n\r\nexport default function Loading() {\r\n  const { t } = useTranslation();\r\n\r\n  return (\r\n    <div className=\"flex items-center gap-2 justify-center text-muted-foreground text-sm py-6\">\r\n      <Loader2 className=\"animate-spin h-4 w-4 text-primary\" />\r\n      <span>{t('General.loading', 'Loading calculator...')}</span>\r\n    </div>\r\n  );\r\n} \r\n"],"names":["defaultSettings","decimalPlaces","roundingPrecision","thousandsSeparator","SettingsContext","createContext","undefined","SettingsProvider","children","settings","setSettings","useState","loadedSettings","localStorage","getItem","initialSettings","JSON","parse","locale","isLoaded","setIsLoaded","useEffect","savedSettings","parsed","includes","prev","console","warn","removeItem","error","Provider","value","saveSettings","cleanSettings","newSettings","updatedSettings","setItem","stringify","context","useContext","Error","createUTCDate","dateStr","Date","parseDate","formats","date","isValid","format","formatPattern","parsedDate","formatDateForDisplay","dateObj","Intl","DateTimeFormat","year","month","day","timeZone","match","toISOString","split","AppSeoContent","mounted","setMounted","pathname","usePathname","isAppPage","isGerman","div","className","script","type","dangerouslySetInnerHTML","__html","description","Accordion","props","AccordionPrimitive","data-slot","AccordionItem","cn","AccordionTrigger","ChevronDownIcon","AccordionContent","alertVariants","cva","variants","variant","default","destructive","defaultVariants","Alert","role","AlertTitle","AlertDescription","Table","table","TableHeader","thead","TableBody","tbody","TableFooter","tfoot","TableRow","tr","TableHead","th","TableCell","td","formatNumber","NumberFormat","minimumFractionDigits","maximumFractionDigits","toFixed","formatDateLocale","dateInput","formatPercent","style","FormSchema","z","nonempty","SettingsModal","isOpen","externalIsOpen","onOpenChange","externalOnOpenChange","size","useSettings","t","useTranslation","internalIsOpen","setInternalIsOpen","isMounted","setIsMounted","setIsValid","form","useForm","resolver","zodResolver","defaultValues","toString","defaultSeparator","mode","reset","subscription","watch","hasErrors","Object","keys","formState","errors","length","formValues","getValues","isDecimalEmpty","unsubscribe","currentSeparator","triggerLabel","dialogTitle","dialogDescription","saveLabel","cancelLabel","Button","onClick","aria-label","Settings","Dialog","open","handleOpenChange","DialogContent","DialogHeader","DialogTitle","UiDialogDescription","Form","onSubmit","handleSubmit","Number","data","isNaN","setError","message","replace","newLocale","window","dispatchEvent","CustomEvent","detail","FormField","control","name","render","field","FormItem","FormLabel","FormControl","Input","required","FormDescription","FormMessage","Select","onValueChange","onChange","SelectTrigger","SelectValue","SelectContent","SelectItem","defaultValue","placeholder","DialogFooter","DialogClose","asChild","disabled","formatPeriodIdentifier","identifier","periodType","parseInt","de","enUS","CalculationStepsDisplay","steps","splitPeriodUsed","i18n","currentLocale","language","errorMessage","p","periodSegments","amountCalculations","fmtNum","utilFormatNumber","num","fmtPeriod","id","fmtDate","utilFormatDateLocale","fmtPct","utilFormatPercent","val","section","h4","totalDuration","start","end","days","included","map","seg","periodIdentifier","proportion","amtCalc","index","originalAmount","periodSplits","ps","periodIndex","span","find","s","rawSplit","roundedSplit","adjustment","Math","abs","discrepancy","adjustmentAppliedToPeriod","finalSum","ResultsDisplayComponent","results","inputData","isSettingsOpen","setIsSettingsOpen","splitPeriod","formatNumForDisplay","formatPeriodIdForDisplay","getPeriodHeader","totalDurationDays","calculationSteps","totalInputAmount","amounts","reduce","sum","totalAggregatedAmount","aggregatedSplits","totalSplitAmount","Card","CardContent","h3","button","svg","xmlns","width","height","viewBox","fill","stroke","strokeWidth","strokeLinecap","strokeLinejoin","path","d","circle","cx","cy","r","startDate","endDate","includeEndDate","daysInPeriod","formatPctForDisplay","collapsible","handleExportExcel","then","XLSX","workbook","utils","book_new","consolidatedData","push","forEach","segment","i","periodSeg","consolidatedSheet","aoa_to_sheet","allocationTableEndRow","allocationTableStartRow","R","propCellRef","encode_cell","c","amtCellRef","repeat","book_append_sheet","filename","writeFile","catch","alert","polyline","points","line","x1","y1","x2","y2","handleExportPdf","Promise","all","jsPDF","autoTable","doc","yPos","text","tableRowsData","head","body","foot","startY","theme","headStyles","fillColor","getComputedStyle","document","documentElement","getPropertyValue","trim","v","parseFloat","filter","_","footStyles","textColor","fontStyle","didParseCell","column","cell","styles","halign","lastAutoTable","finalY","setFontSize","internal","pageSize","addPage","pageCount","getNumberOfPages","setPage","save","ResultsDisplay","InvoiceForm","dynamic","mod","ssr","loading","InvoiceCalculatorClient","pageTitle","calculationResult","setCalculationResult","calculationError","setCalculationError","storedInputData","setStoredInputData","resultsSectionRef","useRef","initialDemoData","setInitialDemoData","demoDataProcessedRef","gaMeasurementId","hasConsent","setHasConsent","hasDemoData","sessionStorage","hasFormCache","log","hadDemoData","hadFormCache","Cookies","consentGiven","get","current","demoDataString","parsedDemoData","isDemo","handleDemoDataApplied","useCallback","GoogleAnalytics","gaId","h1","description1","description2","Loader2","maxWidth","data-loaded","opacity","Suspense","fallback","onCalculateAction","formData","displayError","baseErrorTitle","InputValidationError","code","ERROR_CODES","NO_AMOUNTS","INVALID_AMOUNT","END_BEFORE_START","INVALID_DATES","ZERO_DURATION","details","CalculationError","category","stringifiedError","setTimeout","requestAnimationFrame","scrollIntoView","behavior","block","onDemoDataApplied","ref","Terminal","safeText","FormProvider","FormFieldContext","React","Controller","useFormField","fieldContext","itemContext","FormItemContext","getFieldState","useFormContext","useFormState","fieldState","formItemId","formDescriptionId","formMessageId","FormLabelInternal","htmlFor","explicitHtmlFor","hasError","Label","data-error","derivedHtmlFor","hasContext","Slot","aria-describedby","aria-invalid","String","buttonVariants","outline","secondary","ghost","link","sm","lg","icon","Comp","SelectPrimitive","data-size","position","backgroundColor","sideOffset","avoidCollisions","collisionPadding","SelectScrollUpButton","SelectScrollDownButton","key","restProps","CheckIcon","ChevronUpIcon","ForwardedInput","helperText","onDoubleClick","errorId","input","handleDoubleClick","e","currentTarget","select","VisuallyHidden","clip","AccessibleIcon","label","DialogPrimitive","DialogPortal","DialogOverlay","isMountedRef","mountTimer","clearTimeout","XIcon","DialogDescription","CardHeader","CardTitle","round","decimals","calculateInvoiceSplit","calcSteps","success","originalTotalAmount","totalDays","adjustedTotalAmount","resultsPerAmount","some","a","invalidAmounts","cleanStartDate","startOfDay","cleanEffectiveEndDate","addDays","differenceInDays","calculatedDays","periodSegmentMap","currentDate","getPeriodIdentifier","getYear","quarter","getQuarter","nextPeriodBoundary","getNextPeriodBoundary","endOfMonth","endOfQuarter","endOfYear","segmentEndDate","daysInSegment","entries","sort","b","localeCompare","amount","amountCalcStep","rawSplits","rawSplitAmount","roundedSplits","step","rs","currentTotal","periodIdentifierToAdjust","max","splitToAdjust","CalculationProcessingError","ROUNDING_ERROR","periodToAdjust","finalAmountSplits","splitAmount","adjustedTotalForThisAmount","splits","totalSplitForPeriod","amountResult","finalAdjustedTotalAmount","finalDiscrepancy","successCalcSteps","caughtError","UNEXPECTED_ERROR","originalError","LabelPrimitive","constructor","setPrototypeOf","prototype","PERIOD_ALLOCATION_ERROR","Loading"],"sourceRoot":""}