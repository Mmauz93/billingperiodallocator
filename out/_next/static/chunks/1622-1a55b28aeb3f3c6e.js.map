{"version":3,"file":"static/chunks/1622-1a55b28aeb3f3c6e.js","mappings":"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","sources":["webpack://_N_E/./src/context/settings-context.tsx","webpack://_N_E/","webpack://_N_E/./src/lib/date-utils.ts","webpack://_N_E/./src/components/app-seo-content.tsx","webpack://_N_E/./src/components/ui/accordion.tsx","webpack://_N_E/./src/components/ui/button.tsx","webpack://_N_E/./src/components/ui/select.tsx","webpack://_N_E/./src/components/ui/alert.tsx","webpack://_N_E/./src/components/ui/table.tsx","webpack://_N_E/./src/lib/formattingUtils.ts","webpack://_N_E/./src/components/results-display/utils.ts","webpack://_N_E/./src/components/results-display/calculation-steps-display.tsx","webpack://_N_E/./src/components/settings-modal/form-schema.ts","webpack://_N_E/./src/components/settings-modal/types.ts","webpack://_N_E/./src/components/settings-modal/locale-select.tsx","webpack://_N_E/./src/components/settings-modal/number-field.tsx","webpack://_N_E/./src/components/settings-modal/separator-select.tsx","webpack://_N_E/./src/components/settings-modal/index.tsx","webpack://_N_E/./src/components/settings-modal.tsx","webpack://_N_E/./src/components/results-display/export-excel.ts","webpack://_N_E/./src/components/results-display/export-pdf.ts","webpack://_N_E/./src/components/results-display/index.tsx","webpack://_N_E/./src/components/results-display.tsx","webpack://_N_E/./src/components/invoice-form/error-handler.ts","webpack://_N_E/./src/components/invoice-form/demo-data-handler.ts","webpack://_N_E/./src/components/invoice-calculator-client.tsx","webpack://_N_E/./src/components/ui/input.tsx","webpack://_N_E/./src/components/ui/visually-hidden.tsx","webpack://_N_E/./src/components/ui/accessible-icon.tsx","webpack://_N_E/./src/components/ui/dialog.tsx","webpack://_N_E/./src/components/ui/card.tsx","webpack://_N_E/./src/lib/calculations.ts","webpack://_N_E/./src/components/ui/label.tsx","webpack://_N_E/./src/components/ui/form/form-components.tsx","webpack://_N_E/./src/components/ui/form/index.tsx","webpack://_N_E/./src/lib/errors.ts","webpack://_N_E/./src/components/loading.tsx"],"sourcesContent":["\"use client\";\n\nimport React, {\n  ReactNode,\n  createContext,\n  useContext,\n  useEffect,\n  useState,\n} from \"react\";\n\nexport type Locale = \"en\" | \"de\";\n\nexport type AppSettings = {\n  decimalPlaces: number; // 0-6\n  roundingPrecision: number; // e.g., 0.01, 0.05, 1\n  thousandsSeparator: string; // Values: ',', '.', \"'\", ' '\n};\n\ninterface SettingsContextProps {\n  settings: Omit<AppSettings, \"locale\">;\n  saveSettings: (newSettings: Partial<Omit<AppSettings, \"locale\">>) => void; // Allow partial updates\n}\n\nconst defaultSettings: Omit<AppSettings, \"locale\"> = {\n  decimalPlaces: 2, // Default decimal places\n  roundingPrecision: 0.01, // Default rounding\n  thousandsSeparator: \",\", // Default separator is comma\n};\n\nconst SettingsContext = createContext<SettingsContextProps | undefined>(\n  undefined,\n);\n\nexport const SettingsProvider = ({ children }: { children: ReactNode }) => {\n  const [settings, setSettings] = useState<Omit<AppSettings, \"locale\">>(() => {\n    const loadedSettings =\n      typeof window !== \"undefined\"\n        ? localStorage.getItem(\"appSettings\")\n        : null;\n    const initialSettings = loadedSettings ? JSON.parse(loadedSettings) : {};\n    // Remove locale if it exists in loaded settings\n    if (\"locale\" in initialSettings) {\n      delete initialSettings.locale;\n    }\n    return { ...defaultSettings, ...initialSettings }; // Merge defaults with loaded\n  });\n  const [isLoaded, setIsLoaded] = useState(false); // Flag to ensure localStorage is read only once\n\n  // Effect to load settings from localStorage on initial client mount\n  useEffect(() => {\n    if (typeof window !== \"undefined\" && !isLoaded) {\n      // Check if running on client and not already loaded\n      try {\n        const savedSettings = localStorage.getItem(\"appSettings\");\n        if (savedSettings) {\n          const parsed = JSON.parse(savedSettings);\n          // Remove locale before validation/setting\n          if (\"locale\" in parsed) {\n            delete parsed.locale;\n          }\n\n          if (\n            typeof parsed.decimalPlaces === \"number\" &&\n            typeof parsed.roundingPrecision === \"number\" &&\n            parsed.roundingPrecision > 0 &&\n            typeof parsed.thousandsSeparator === \"string\" &&\n            [\",\", \".\", \"'\", \" \"].includes(parsed.thousandsSeparator) // Accept all valid separators\n          ) {\n            setSettings((prev) => ({ ...defaultSettings, ...prev, ...parsed })); // Ensure defaults are applied\n          } else {\n            console.warn(\n              \"Loaded settings from localStorage are invalid or incomplete (excluding locale). Using defaults.\",\n            );\n            // Set merged defaults if loaded is bad\n            setSettings(defaultSettings);\n            localStorage.removeItem(\"appSettings\"); // Clear invalid storage\n          }\n        } else {\n          setSettings(defaultSettings); // Ensure defaults if nothing is loaded\n        }\n      } catch (error) {\n        console.error(\"Failed to load settings from localStorage:\", error);\n        setSettings(defaultSettings); // Fallback to defaults on error\n      }\n      setIsLoaded(true); // Mark as loaded to prevent re-running\n    }\n  }, [isLoaded]); // Dependency array ensures it runs once after initial mount\n\n  // Save settings to localStorage whenever they change\n  const saveSettings = (newSettings: Partial<Omit<AppSettings, \"locale\">>) => {\n    if (typeof window !== \"undefined\") {\n      // Ensure running on client\n      try {\n        // Create a clean copy without any potential 'locale' property\n        const cleanSettings = {\n          ...(newSettings.decimalPlaces !== undefined && {\n            decimalPlaces: newSettings.decimalPlaces,\n          }),\n          ...(newSettings.roundingPrecision !== undefined && {\n            roundingPrecision: newSettings.roundingPrecision,\n          }),\n          ...(newSettings.thousandsSeparator !== undefined && {\n            thousandsSeparator: newSettings.thousandsSeparator,\n          }),\n        };\n\n        const updatedSettings = { ...settings, ...cleanSettings };\n        setSettings(updatedSettings);\n\n        // Save to localStorage\n        localStorage.setItem(\"appSettings\", JSON.stringify(updatedSettings));\n      } catch (error) {\n        console.error(\"Failed to save settings to localStorage:\", error);\n      }\n    }\n  };\n\n  // The direct useEffect sync might cause issues with initial load, rely on saveSettings\n  // useEffect(() => { ... }, [settings]); // Remove this redundant effect\n\n  return (\n    // Pass down saveSettings instead of raw setSettings\n    <SettingsContext.Provider value={{ settings, saveSettings }}>\n      {children}\n    </SettingsContext.Provider>\n  );\n};\n\nexport const useSettings = (): SettingsContextProps => {\n  const context = useContext(SettingsContext);\n  if (!context) {\n    throw new Error(\"useSettings must be used within a SettingsProvider\");\n  }\n  return context;\n};\n","import(/* webpackMode: \"eager\", webpackExports: [\"__esModule\",\"default\"] */ \"C:\\\\Users\\\\Mauro\\\\Repos\\\\Siempi\\\\Saas\\\\billingperiodallocator\\\\node_modules\\\\next\\\\dist\\\\client\\\\app-dir\\\\link.js\");\n;\nimport(/* webpackMode: \"eager\", webpackExports: [\"default\"] */ \"C:\\\\Users\\\\Mauro\\\\Repos\\\\Siempi\\\\Saas\\\\billingperiodallocator\\\\src\\\\components\\\\app-seo-content.tsx\");\n;\nimport(/* webpackMode: \"eager\" */ \"C:\\\\Users\\\\Mauro\\\\Repos\\\\Siempi\\\\Saas\\\\billingperiodallocator\\\\src\\\\components\\\\invoice-calculator-client.tsx\");\n;\nimport(/* webpackMode: \"eager\", webpackExports: [\"default\"] */ \"C:\\\\Users\\\\Mauro\\\\Repos\\\\Siempi\\\\Saas\\\\billingperiodallocator\\\\src\\\\components\\\\loading.tsx\");\n;\nimport(/* webpackMode: \"eager\", webpackExports: [\"TranslationContext\"] */ \"C:\\\\Users\\\\Mauro\\\\Repos\\\\Siempi\\\\Saas\\\\billingperiodallocator\\\\src\\\\components\\\\translation-provider.tsx\");\n","/**\n * @fileoverview Date Utility Functions\n *\n * Timezone Strategy:\n * 1. Input Parsing: User-entered date strings (e.g., \"YYYY-MM-DD\") are parsed by `parseDate`\n *    into JavaScript `Date` objects representing **midnight UTC** of that calendar day.\n *    This is achieved by `createUTCDate` which appends 'T00:00:00Z'.\n * 2. Calculations: All core date calculations (e.g., in `calculations.ts`) operate on these\n *    UTC-normalized `Date` objects.\n * 3. Display: Dates are formatted for display by `formatDateForDisplay` using `Intl.DateTimeFormat`\n *    with the `timeZone: 'UTC'` option. This ensures that the displayed day, month, and year\n *    correspond to the UTC date, preventing shifts due to the user's local timezone.\n * 4. General Timestamps: Non-critical timestamps (e.g., \"Generated on\") may use local time.\n */\n\nimport { format, isValid, parse } from \"date-fns\";\n\n/**\n * Creates a Date object that's timezone-agnostic by setting time to midnight UTC.\n * This ensures consistent behavior regardless of user's timezone.\n *\n * @param dateStr - A date string in the format YYYY-MM-DD\n * @returns A Date object set to midnight UTC\n */\nexport function createUTCDate(dateStr: string): Date {\n  // Append T00:00:00Z to ensure UTC timezone\n  return new Date(`${dateStr}T00:00:00Z`);\n}\n\n/**\n * Parse a date from various formats with timezone consistency.\n * The returned date will be normalized to midnight UTC time.\n *\n * @param dateStr - A date string in various supported formats\n * @param formats - An array of formats to try (date-fns format patterns)\n * @returns A Date object or null if parsing fails\n */\nexport function parseDate(\n  dateStr: string,\n  formats: string[] = [\"yyyy-MM-dd\", \"dd.MM.yyyy\"],\n): Date | null {\n  if (!dateStr) return null;\n\n  // Try direct ISO parsing first\n  if (dateStr.includes(\"T\")) {\n    const date = new Date(dateStr);\n    if (isValid(date)) {\n      // Normalize to midnight UTC\n      return createUTCDate(format(date, \"yyyy-MM-dd\"));\n    }\n  }\n\n  // Try each format\n  for (const formatPattern of formats) {\n    try {\n      const parsedDate = parse(dateStr, formatPattern, new Date());\n      if (isValid(parsedDate)) {\n        // Normalize to midnight UTC\n        return createUTCDate(format(parsedDate, \"yyyy-MM-dd\"));\n      }\n    } catch {\n      // Continue to next format\n    }\n  }\n\n  return null;\n}\n\n/**\n * Format a date for display, taking into account the locale\n *\n * @param date - A Date object or ISO date string\n * @param locale - The locale to use for formatting (e.g., 'en', 'de')\n * @returns A formatted date string\n */\nexport function formatDateForDisplay(\n  date: Date | string | undefined,\n  locale: string,\n): string {\n  if (!date) return \"N/A\";\n\n  try {\n    const dateObj =\n      typeof date === \"string\"\n        ? date.includes(\"T\")\n          ? new Date(date)\n          : createUTCDate(date)\n        : date;\n\n    // Format in UTC to display the date as it is, ignoring local timezone conversion for date parts\n    return new Intl.DateTimeFormat(locale, {\n      year: \"numeric\",\n      month: \"short\",\n      day: \"numeric\",\n      timeZone: \"UTC\",\n    }).format(dateObj);\n  } catch (error) {\n    console.error(\"Error formatting date:\", error);\n    // Fallback should also ideally respect UTC if possible\n    if (typeof date === \"string\") {\n      // Attempt to return YYYY-MM-DD if it's a simple date string, otherwise indicate error\n      return date.match(/^\\d{4}-\\d{2}-\\d{2}$/) ? date : \"Invalid Date String\";\n    }\n    return date.toISOString().split(\"T\")[0]; // This gives YYYY-MM-DD from UTC date\n  }\n}\n","\"use client\";\n\nimport { useEffect, useState } from \"react\";\n\nimport { usePathname } from \"next/navigation\";\n\n/**\n * Client-only SEO content component.\n * Renders JSON-LD structured data only on the client to avoid hydration mismatches.\n */\nexport default function AppSeoContent() {\n  const [mounted, setMounted] = useState(false);\n  const pathname = usePathname();\n  const isAppPage = pathname?.includes(\"/app\");\n\n  // Determine language from URL path instead of i18n hooks to avoid hydration issues\n  const isGerman = pathname?.includes(\"/de/\");\n\n  // Always run this effect at top level\n  useEffect(() => {\n    setMounted(true);\n  }, []);\n\n  // Don't render during SSR\n  if (!mounted || !isAppPage) {\n    return null;\n  }\n\n  // Hardcoded content by language for reliable rendering\n  const description = isGerman\n    ? \"Teilen Sie Rechnungen przise auf Geschftsjahre, Quartale oder Monate auf.\"\n    : \"Split invoices across fiscal years, quarters, or months with precision.\";\n\n  return (\n    <div className=\"hidden\">\n      <script\n        type=\"application/ld+json\"\n        dangerouslySetInnerHTML={{\n          __html: JSON.stringify({\n            \"@context\": \"https://schema.org\",\n            \"@type\": \"SoftwareApplication\",\n            name: \"BillSplitter\",\n            applicationCategory: \"FinanceApplication\",\n            operatingSystem: \"Web\",\n            offers: {\n              \"@type\": \"Offer\",\n              price: \"0\",\n              priceCurrency: \"USD\",\n            },\n            description: description,\n          }),\n        }}\n      />\n    </div>\n  );\n}\n","\"use client\";\n\nimport * as AccordionPrimitive from \"@radix-ui/react-accordion\";\nimport * as React from \"react\";\n\nimport { ChevronDownIcon } from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\n\nfunction Accordion({\n  ...props\n}: React.ComponentProps<typeof AccordionPrimitive.Root>) {\n  return <AccordionPrimitive.Root data-slot=\"accordion\" {...props} />;\n}\n\nfunction AccordionItem({\n  className,\n  ...props\n}: React.ComponentProps<typeof AccordionPrimitive.Item>) {\n  return (\n    <AccordionPrimitive.Item\n      data-slot=\"accordion-item\"\n      className={cn(\"\", className)}\n      {...props}\n    />\n  );\n}\n\nfunction AccordionTrigger({\n  className,\n  children,\n  ...props\n}: React.ComponentProps<typeof AccordionPrimitive.Trigger>) {\n  return (\n    <AccordionPrimitive.Header className=\"flex\">\n      <AccordionPrimitive.Trigger\n        data-slot=\"accordion-trigger\"\n        className={cn(\n          \"focus-visible:border-ring focus-visible:ring-ring/50 flex flex-1 items-start justify-between gap-4 rounded-md py-4 text-left text-sm font-medium transition-all outline-none hover:underline focus-visible:ring-[3px] disabled:pointer-events-none disabled:opacity-50 [&[data-state=open]>svg]:rotate-180\",\n          \"cursor-pointer select-none\",\n          className,\n        )}\n        {...props}\n      >\n        {children}\n        <ChevronDownIcon className=\"text-muted-foreground pointer-events-none size-4 shrink-0 translate-y-0.5 transition-transform duration-200\" />\n      </AccordionPrimitive.Trigger>\n    </AccordionPrimitive.Header>\n  );\n}\n\nfunction AccordionContent({\n  className,\n  children,\n  ...props\n}: React.ComponentProps<typeof AccordionPrimitive.Content>) {\n  return (\n    <AccordionPrimitive.Content\n      data-slot=\"accordion-content\"\n      className={cn(\n        \"data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down overflow-hidden text-sm\",\n        className,\n      )}\n      {...props}\n    >\n      <div className={cn(\"pt-0 pb-4\", className)}>{children}</div>\n    </AccordionPrimitive.Content>\n  );\n}\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent };\n","import * as React from \"react\";\nimport { Slot } from \"@radix-ui/react-slot\";\nimport { cva, type VariantProps } from \"class-variance-authority\";\n\nimport { cn } from \"@/lib/utils\";\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 ring-offset-background aria-[invalid=true]:ring-destructive/20 dark:aria-[invalid=true]:ring-destructive/40 cursor-pointer hover:transform hover:translate-y-[-2px] hover:scale-[1.015] select-none\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"bg-primary text-primary-foreground shadow-md hover:bg-primary/90 hover:shadow-md\",\n        destructive:\n          \"bg-destructive text-destructive-foreground shadow-md hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 hover:shadow-md\",\n        outline:\n          \"border bg-background shadow-md hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50 hover:shadow-md\",\n        secondary:\n          \"bg-secondary text-secondary-foreground shadow-md hover:bg-secondary/80 hover:shadow-md\",\n        ghost: \"\",\n        link: \"text-primary underline-offset-4 hover:underline hover:text-[#F5A623]\",\n      },\n      size: {\n        default: \"h-10 px-4 py-2\",\n        sm: \"h-8 rounded-md px-3 py-1\",\n        lg: \"h-12 px-6 py-3\",\n        icon: \"size-10\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  },\n);\n\nfunction Button({\n  className,\n  variant,\n  size,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"button\"> &\n  VariantProps<typeof buttonVariants> & {\n    asChild?: boolean;\n  }) {\n  const Comp = asChild ? Slot : \"button\";\n\n  return (\n    <Comp\n      data-slot=\"button\"\n      className={cn(buttonVariants({ variant, size, className }))}\n      {...props}\n    />\n  );\n}\n\nexport { Button, buttonVariants };\n","\"use client\";\n\nimport * as React from \"react\";\nimport * as SelectPrimitive from \"@radix-ui/react-select\";\n\nimport { CheckIcon, ChevronDownIcon, ChevronUpIcon } from \"lucide-react\";\n\nimport { cn } from \"@/lib/utils\";\n\nfunction Select({\n  ...props\n}: React.ComponentProps<typeof SelectPrimitive.Root>) {\n  return <SelectPrimitive.Root data-slot=\"select\" {...props} />;\n}\n\nfunction SelectGroup({\n  ...props\n}: React.ComponentProps<typeof SelectPrimitive.Group>) {\n  return <SelectPrimitive.Group data-slot=\"select-group\" {...props} />;\n}\n\nfunction SelectValue({\n  ...props\n}: React.ComponentProps<typeof SelectPrimitive.Value>) {\n  return <SelectPrimitive.Value data-slot=\"select-value\" {...props} />;\n}\n\nfunction SelectTrigger({\n  className,\n  size = \"default\",\n  children,\n  id,\n  name,\n  ...props\n}: React.ComponentProps<typeof SelectPrimitive.Trigger> & {\n  size?: \"sm\" | \"default\";\n  id?: string;\n  name?: string;\n}) {\n  return (\n    <SelectPrimitive.Trigger\n      data-slot=\"select-trigger\"\n      data-size={size}\n      id={id}\n      name={name}\n      className={cn(\n        \"border-input data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 dark:hover:bg-input/50 flex w-fit items-center justify-between gap-2 rounded-md border bg-transparent px-3 py-2 text-sm whitespace-nowrap shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 data-[size=default]:h-9 data-[size=sm]:h-8 *:data-[slot=select-value]:line-clamp-1 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4\",\n        className,\n      )}\n      {...props}\n    >\n      {children}\n      <SelectPrimitive.Icon asChild>\n        <ChevronDownIcon className=\"size-4 opacity-50\" />\n      </SelectPrimitive.Icon>\n    </SelectPrimitive.Trigger>\n  );\n}\n\nfunction SelectContent({\n  className,\n  children,\n  position = \"popper\",\n  ...props\n}: React.ComponentProps<typeof SelectPrimitive.Content>) {\n  return (\n    <SelectPrimitive.Portal>\n      <SelectPrimitive.Content\n        data-slot=\"select-content\"\n        className={cn(\n          \"bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 relative z-[9999] min-w-[8rem] rounded-md border shadow-md\",\n          position === \"popper\" &&\n            \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n          className,\n        )}\n        style={{ backgroundColor: \"hsl(var(--popover))\", opacity: 1 }}\n        position=\"popper\"\n        sideOffset={5}\n        avoidCollisions={true}\n        collisionPadding={20}\n        {...props}\n      >\n        <SelectScrollUpButton />\n        <SelectPrimitive.Viewport\n          className={cn(\n            \"p-1 h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)] overflow-y-auto\",\n            position === \"popper\"\n              ? \"max-h-[var(--radix-select-content-available-height)]\"\n              : \"max-h-[200px]\",\n          )}\n        >\n          {children}\n        </SelectPrimitive.Viewport>\n        <SelectScrollDownButton />\n      </SelectPrimitive.Content>\n    </SelectPrimitive.Portal>\n  );\n}\n\nfunction SelectLabel({\n  className,\n  ...props\n}: React.ComponentProps<typeof SelectPrimitive.Label>) {\n  return (\n    <SelectPrimitive.Label\n      data-slot=\"select-label\"\n      className={cn(\"text-muted-foreground px-2 py-1.5 text-xs\", className)}\n      {...props}\n    />\n  );\n}\n\nfunction SelectItem({\n  className,\n  children,\n  id,\n  value,\n  ...props\n}: React.ComponentProps<typeof SelectPrimitive.Item> & { key?: React.Key }) {\n  const { key, ...restProps } = props;\n\n  return (\n    <SelectPrimitive.Item\n      key={key}\n      data-slot=\"select-item\"\n      id={id || (value ? `select-item-${value}` : undefined)}\n      className={cn(\n        \"select-item relative flex w-full cursor-pointer items-center gap-2 rounded-sm py-1.5 pr-8 pl-2 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n        className,\n      )}\n      value={value}\n      {...restProps}\n    >\n      <span className=\"absolute right-2 flex size-3.5 items-center justify-center\">\n        <SelectPrimitive.ItemIndicator>\n          <CheckIcon className=\"size-4\" />\n        </SelectPrimitive.ItemIndicator>\n      </span>\n      <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n    </SelectPrimitive.Item>\n  );\n}\n\nfunction SelectSeparator({\n  className,\n  ...props\n}: React.ComponentProps<typeof SelectPrimitive.Separator>) {\n  return (\n    <SelectPrimitive.Separator\n      data-slot=\"select-separator\"\n      className={cn(\"bg-border pointer-events-none -mx-1 my-1 h-px\", className)}\n      {...props}\n    />\n  );\n}\n\nfunction SelectScrollUpButton({\n  className,\n  ...props\n}: React.ComponentProps<typeof SelectPrimitive.ScrollUpButton>) {\n  return (\n    <SelectPrimitive.ScrollUpButton\n      data-slot=\"select-scroll-up-button\"\n      className={cn(\n        \"flex cursor-default items-center justify-center py-1\",\n        className,\n      )}\n      {...props}\n    >\n      <ChevronUpIcon className=\"size-4\" />\n    </SelectPrimitive.ScrollUpButton>\n  );\n}\n\nfunction SelectScrollDownButton({\n  className,\n  ...props\n}: React.ComponentProps<typeof SelectPrimitive.ScrollDownButton>) {\n  return (\n    <SelectPrimitive.ScrollDownButton\n      data-slot=\"select-scroll-down-button\"\n      className={cn(\n        \"flex cursor-default items-center justify-center py-1\",\n        className,\n      )}\n      {...props}\n    >\n      <ChevronDownIcon className=\"size-4\" />\n    </SelectPrimitive.ScrollDownButton>\n  );\n}\n\nexport {\n  Select,\n  SelectContent,\n  SelectGroup,\n  SelectItem,\n  SelectLabel,\n  SelectScrollDownButton,\n  SelectScrollUpButton,\n  SelectSeparator,\n  SelectTrigger,\n  SelectValue,\n};\n","import * as React from \"react\";\nimport { cva, type VariantProps } from \"class-variance-authority\";\n\nimport { cn } from \"@/lib/utils\";\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border px-4 py-3 text-sm grid has-[>svg]:grid-cols-[calc(var(--spacing)*4)_1fr] grid-cols-[0_1fr] has-[>svg]:gap-x-3 gap-y-0.5 items-start [&>svg]:size-4 [&>svg]:translate-y-0.5 [&>svg]:text-current\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-card text-card-foreground\",\n        destructive:\n          \"text-destructive bg-card [&>svg]:text-current *:data-[slot=alert-description]:text-destructive/90\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  },\n);\n\nfunction Alert({\n  className,\n  variant,\n  ...props\n}: React.ComponentProps<\"div\"> & VariantProps<typeof alertVariants>) {\n  return (\n    <div\n      data-slot=\"alert\"\n      role=\"alert\"\n      className={cn(alertVariants({ variant }), className)}\n      {...props}\n    />\n  );\n}\n\nfunction AlertTitle({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"alert-title\"\n      className={cn(\n        \"col-start-2 line-clamp-1 min-h-4 font-medium tracking-tight\",\n        className,\n      )}\n      {...props}\n    />\n  );\n}\n\nfunction AlertDescription({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"alert-description\"\n      className={cn(\n        \"text-muted-foreground col-start-2 grid justify-items-start gap-1 text-sm [&_p]:leading-relaxed\",\n        className,\n      )}\n      {...props}\n    />\n  );\n}\n\nexport { Alert, AlertTitle, AlertDescription };\n","\"use client\";\n\nimport * as React from \"react\";\n\nimport { cn } from \"@/lib/utils\";\n\nfunction Table({ className, ...props }: React.ComponentProps<\"table\">) {\n  return (\n    <div\n      data-slot=\"table-container\"\n      className=\"relative w-full overflow-x-auto\"\n    >\n      <table\n        data-slot=\"table\"\n        className={cn(\"w-full caption-bottom text-sm\", className)}\n        {...props}\n      />\n    </div>\n  );\n}\n\nfunction TableHeader({ className, ...props }: React.ComponentProps<\"thead\">) {\n  return (\n    <thead\n      data-slot=\"table-header\"\n      className={cn(\"[&_tr]:border-b\", className)}\n      {...props}\n    />\n  );\n}\n\nfunction TableBody({ className, ...props }: React.ComponentProps<\"tbody\">) {\n  return (\n    <tbody\n      data-slot=\"table-body\"\n      className={cn(\"[&_tr:last-child]:border-0\", className)}\n      {...props}\n    />\n  );\n}\n\nfunction TableFooter({ className, ...props }: React.ComponentProps<\"tfoot\">) {\n  return (\n    <tfoot\n      data-slot=\"table-footer\"\n      className={cn(\n        \"bg-muted/50 border-t font-medium [&>tr]:last:border-b-0\",\n        className,\n      )}\n      {...props}\n    />\n  );\n}\n\nfunction TableRow({ className, ...props }: React.ComponentProps<\"tr\">) {\n  return (\n    <tr\n      data-slot=\"table-row\"\n      className={cn(\n        \"hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors\",\n        className,\n      )}\n      {...props}\n    />\n  );\n}\n\nfunction TableHead({ className, ...props }: React.ComponentProps<\"th\">) {\n  return (\n    <th\n      data-slot=\"table-head\"\n      className={cn(\n        \"text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]\",\n        className,\n      )}\n      {...props}\n    />\n  );\n}\n\nfunction TableCell({ className, ...props }: React.ComponentProps<\"td\">) {\n  return (\n    <td\n      data-slot=\"table-cell\"\n      className={cn(\n        \"p-2 align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]\",\n        className,\n      )}\n      {...props}\n    />\n  );\n}\n\nfunction TableCaption({\n  className,\n  ...props\n}: React.ComponentProps<\"caption\">) {\n  return (\n    <caption\n      data-slot=\"table-caption\"\n      className={cn(\"text-muted-foreground mt-4 text-sm\", className)}\n      {...props}\n    />\n  );\n}\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n};\n","import { AppSettings } from \"@/context/settings-context\";\nimport { formatDateForDisplay } from \"./date-utils\";\n\n/**\n * Formats a number according to the application settings using Intl.NumberFormat.\n * @param value The number to format.\n * @param locale The locale string.\n * @param settings The current application settings.\n * @returns Formatted number string.\n */\nexport function formatNumber(\n  value: number,\n  locale: string,\n  settings: Omit<AppSettings, \"locale\">,\n): string {\n  try {\n    return new Intl.NumberFormat(locale, {\n      minimumFractionDigits: settings.decimalPlaces,\n      maximumFractionDigits: settings.decimalPlaces,\n    }).format(value);\n  } catch (error) {\n    console.error(\"Error formatting number:\", error);\n    // Fallback to simple formatting\n    return value.toFixed(settings.decimalPlaces);\n  }\n}\n\n/**\n * Rounds a number based on the specified rounding precision factor.\n * @param value The number to round.\n * @param precision The rounding factor (e.g., 0.01, 0.05, 1). Must be > 0.\n * @returns Rounded number.\n */\nexport function roundValue(value: number, precision: number): number {\n  if (precision <= 0) {\n    console.warn(`Invalid rounding precision: ${precision}. Using 0.01.`);\n    precision = 0.01;\n  }\n  const multiplier = 1 / precision;\n  return Math.round(value * multiplier) / multiplier;\n}\n\n/**\n * Formats a date according to locale. Accepts either a Date object or a string in YYYY-MM-DD format.\n * @param dateInput Date as a string in 'yyyy-MM-dd' format or as a Date object.\n * @param locale Locale string (e.g., 'en', 'de').\n * @returns Formatted date string.\n */\nexport function formatDateLocale(\n  dateInput: string | Date | undefined,\n  locale: string,\n): string {\n  // Use the improved date formatting function from date-utils.ts\n  return formatDateForDisplay(dateInput, locale);\n}\n\n/**\n * Formats a percentage value according to locale.\n * @param value The percentage value (0 to 1).\n * @param locale The locale string.\n * @returns Formatted percentage string.\n */\nexport function formatPercent(value: number, locale: string): string {\n  try {\n    return new Intl.NumberFormat(locale, {\n      style: \"percent\",\n      minimumFractionDigits: 2, // Usually keep 2 decimals for percentages\n      maximumFractionDigits: 2,\n    }).format(value);\n  } catch (error) {\n    console.error(\"Error formatting percent:\", error);\n    // Fallback\n    return (value * 100).toFixed(2) + \"%\";\n  }\n}\n","import {\n  formatDateLocale,\n  formatNumber,\n  formatPercent,\n} from \"@/lib/formattingUtils\";\n\nimport { AppSettings } from \"@/context/settings-context\";\nimport { de } from \"date-fns/locale/de\";\nimport { enUS } from \"date-fns/locale/en-US\";\nimport { format } from \"date-fns\";\n\n// --- Period Formatting Helper ---\nexport function formatPeriodIdentifier(\n  identifier: string,\n  periodType: \"yearly\" | \"quarterly\" | \"monthly\",\n  locale: string,\n): string {\n  switch (periodType) {\n    case \"monthly\":\n      try {\n        const [year, month] = identifier.split(\"-\");\n        const date = new Date(parseInt(year), parseInt(month) - 1, 1);\n        return format(date, \"MMMM yyyy\", {\n          locale: locale === \"de\" ? de : enUS,\n        });\n      } catch {\n        return identifier;\n      }\n    case \"quarterly\":\n      return identifier;\n    case \"yearly\":\n    default:\n      return identifier;\n  }\n}\n\n// Function to get appropriate header for the allocation table\nexport function getPeriodHeader(\n  splitPeriodUsed: \"yearly\" | \"quarterly\" | \"monthly\",\n  t: (key: string, options?: { defaultValue?: string; values?: Record<string, string | number> }) => string,\n): string {\n  switch (splitPeriodUsed) {\n    case \"monthly\":\n      return t(\"ResultsDisplay.monthHeader\");\n    case \"quarterly\":\n      return t(\"ResultsDisplay.quarterHeader\");\n    case \"yearly\":\n    default:\n      return t(\"ResultsDisplay.yearHeader\");\n  }\n}\n\n// Formatting utility wrapper functions\nexport function formatNumForDisplay(\n  value: number | undefined,\n  locale: string,\n  settings: Omit<AppSettings, \"locale\">,\n): string {\n  return value !== undefined ? formatNumber(value, locale, settings) : \"\";\n}\n\nexport function formatPctForDisplay(\n  value: number | undefined,\n  locale: string,\n): string {\n  return value !== undefined ? formatPercent(value, locale) : \"\";\n}\n\nexport function formatDateForDisplay(\n  dateObj: Date | string | undefined,\n  locale: string,\n): string {\n  return dateObj ? formatDateLocale(dateObj, locale) : \"\";\n}\n\nexport function formatPeriodIdForDisplay(\n  id: string,\n  splitPeriodUsed: \"yearly\" | \"quarterly\" | \"monthly\",\n  locale: string,\n): string {\n  return formatPeriodIdentifier(id, splitPeriodUsed, locale);\n}\n","\"use client\";\n\nimport {\n  formatDateForDisplay,\n  formatNumForDisplay,\n  formatPctForDisplay,\n  formatPeriodIdForDisplay,\n} from \"./utils\";\n\nimport { CalculationStepsDisplayProps } from \"./types\";\nimport React from \"react\";\nimport { useTranslation } from \"@/translations\";\n\nexport function CalculationStepsDisplay({\n  steps,\n  settings,\n  splitPeriodUsed,\n}: CalculationStepsDisplayProps) {\n  const { t, i18n } = useTranslation();\n  const currentLocale = i18n.language;\n\n  if (steps.error) {\n    // Convert the error to a string representation\n    const errorMessage =\n      typeof steps.error === \"string\"\n        ? steps.error\n        : steps.error.message || \"Unknown error\";\n\n    return <p className=\"text-destructive\">{errorMessage}</p>;\n  }\n\n  const { periodSegments, amountCalculations } = steps;\n\n  const fmtNum = (num: number) =>\n    formatNumForDisplay(num, currentLocale, settings);\n  const fmtPeriod = (id: string) =>\n    formatPeriodIdForDisplay(id, splitPeriodUsed, currentLocale);\n  const fmtDate = (dateStr: string) =>\n    formatDateForDisplay(dateStr, currentLocale);\n  const fmtPct = (val: number) => formatPctForDisplay(val, currentLocale);\n\n  return (\n    <div className=\"text-sm space-y-6\">\n      {/* Total Duration and Period Breakdown Section */}\n      <section className=\"bg-muted/40 rounded-lg p-4 space-y-4\">\n        <h4 className=\"font-semibold text-foreground\">\n          {t(\"ResultsDisplay.totalDuration\")}\n        </h4>\n        <div className=\"grid grid-cols-2 gap-2 text-xs border-b pb-2 mb-2\">\n          <div>{t(\"ResultsDisplay.periodLabel\")}</div>{\" \"}\n          <div className=\"text-right\">\n            {fmtDate(steps.totalDuration.start)} -{\" \"}\n            {fmtDate(steps.totalDuration.end)}\n          </div>\n          <div>{t(\"ResultsDisplay.totalDays\")}</div>{\" \"}\n          <div className=\"text-right\">\n            {steps.totalDuration.days} (\n            {steps.totalDuration.included\n              ? t(\"ResultsDisplay.inclusiveLabel\")\n              : t(\"ResultsDisplay.exclusiveLabel\")}\n            )\n          </div>\n        </div>\n        <h4 className=\"font-semibold text-foreground\">\n          {t(\"ResultsDisplay.proportionCalculation\")}\n        </h4>\n        <div className=\"space-y-1\">\n          {periodSegments.map((seg) => (\n            <div\n              key={seg.periodIdentifier}\n              className=\"grid grid-cols-3 gap-2 text-xs\"\n            >\n              <div className=\"font-medium\">\n                {fmtPeriod(seg.periodIdentifier)}:\n              </div>\n              <div className=\"text-muted-foreground text-center\">\n                {seg.days} / {steps.totalDuration.days}{\" \"}\n                {t(\"ResultsDisplay.daysLabel\")}\n              </div>\n              <div className=\"text-muted-foreground text-right\">\n                {fmtPct(seg.proportion)}\n              </div>\n            </div>\n          ))}\n        </div>\n      </section>\n\n      {/* Split Calculation per Input Amount Section */}\n      <section className=\"bg-muted/40 rounded-lg p-4\">\n        <h4 className=\"font-semibold text-foreground mb-4\">\n          {t(\"ResultsDisplay.splitCalculation\")}\n        </h4>\n        <div className=\"space-y-6\">\n          {amountCalculations.map((amtCalc, index) => (\n            <div\n              key={index}\n              className=\"rounded-md border bg-background p-4 space-y-2 transition-shadow hover:shadow-md\"\n            >\n              <div className=\"font-bold text-[15px] text-primary mb-3 pb-1 border-b border-primary/20 bg-primary/[0.08] -mx-4 px-4 py-2 rounded-t-md\">\n                {t(\"ResultsDisplay.inputAmountLabel\")} #{index + 1}:{\" \"}\n                {fmtNum(amtCalc.originalAmount)}\n              </div>\n              <div className=\"space-y-3\">\n                {amtCalc.periodSplits.map((ps, periodIndex) => (\n                  <div\n                    key={ps.periodIdentifier}\n                    className={`pl-2 text-xs space-y-0.5 ${periodIndex < amtCalc.periodSplits.length - 1 ? \"border-b border-muted/30 pb-2\" : \"\"}`}\n                  >\n                    <div className=\"font-medium shrink-0 text-foreground\">\n                      {fmtPeriod(ps.periodIdentifier)}:\n                    </div>\n                    <div className=\"text-muted-foreground ml-2\">\n                      <span>\n                        {fmtNum(amtCalc.originalAmount)} *{\" \"}\n                        {periodSegments\n                          .find(\n                            (s) => s.periodIdentifier === ps.periodIdentifier,\n                          )\n                          ?.proportion.toFixed(6)}\n                      </span>\n                      <span className=\"block sm:inline\">\n                        {\" \"}\n                        = {ps.rawSplit.toFixed(6)}\n                      </span>\n                    </div>\n                    <div className=\"ml-2 flex items-center gap-x-2\">\n                      <span></span>\n                      <span className=\"font-medium text-foreground\">\n                        {t(\"ResultsDisplay.roundedLabel\")}:{\" \"}\n                        {fmtNum(ps.roundedSplit)}\n                      </span>\n                      {ps.adjustment !== 0 && (\n                        <span className=\"text-muted-foreground text-xs\">\n                          ({t(\"ResultsDisplay.adjustmentLabel\")}:{\" \"}\n                          {fmtNum(ps.adjustment)})\n                        </span>\n                      )}\n                    </div>\n                  </div>\n                ))}\n              </div>\n              <div className=\"border-t pt-2 mt-2 space-y-1 text-xs\">\n                <p>\n                  <span className=\"font-medium text-foreground\">\n                    {t(\"ResultsDisplay.discrepancyLabel\")}:\n                  </span>\n                  <span\n                    className={`${Math.abs(amtCalc.discrepancy) > 0.001 ? \"text-warning dark:text-warning\" : \"text-muted-foreground/70\"}`}\n                  >\n                    {\" \"}\n                    {fmtNum(amtCalc.discrepancy)}\n                  </span>\n                  {amtCalc.adjustmentAppliedToPeriod && (\n                    <span className=\"text-muted-foreground\">\n                      (\n                      {t(\"ResultsDisplay.adjustedInYearLabel\", {\n                        defaultValue: \"Applied in Year\",\n                      })}{\" \"}\n                      {fmtPeriod(amtCalc.adjustmentAppliedToPeriod)})\n                    </span>\n                  )}\n                </p>\n                <p className=\"font-semibold text-sm text-foreground pt-1\">\n                  {t(\"ResultsDisplay.finalSumLabel\")}:{\" \"}\n                  <span className=\"text-primary\">\n                    {fmtNum(amtCalc.finalSum)}\n                  </span>\n                </p>\n              </div>\n            </div>\n          ))}\n        </div>\n      </section>\n    </div>\n  );\n}\n","import { ValidationResult } from \"./types\";\n\n// Default separator\nexport const DEFAULT_SEPARATOR = \",\";\n\n// Validation functions\nexport function validateDecimalPlaces(value: string): ValidationResult {\n  const decimalPlaces = Number(value);\n  if (isNaN(decimalPlaces) || decimalPlaces < 0 || decimalPlaces > 6) {\n    return {\n      valid: false,\n      message: \"Decimal places must be between 0 and 6\",\n    };\n  }\n  return { valid: true };\n}\n\nexport function validateRoundingPrecision(value: string): ValidationResult {\n  const normalized = value.replace(\",\", \".\");\n  const roundingPrecision = Number(normalized);\n  if (\n    isNaN(roundingPrecision) ||\n    roundingPrecision < 0.0001 ||\n    roundingPrecision > 100\n  ) {\n    return {\n      valid: false,\n      message: \"Rounding precision must be between 0.0001 and 100\",\n    };\n  }\n  return { valid: true };\n}\n","\"use client\";\r\n\r\nimport * as z from \"zod\";\r\n\r\nimport { Button } from \"@/components/ui/button\";\r\n\r\n// Re-export FormSchema from here to avoid circular dependencies\r\nexport const FormSchema = z.object({\r\n  decimalPlaces: z.string().nonempty(\"Decimal places is required\"),\r\n  roundingPrecision: z.string().nonempty(\"Rounding precision is required\"),\r\n  thousandsSeparator: z.string(),\r\n  locale: z.string(),\r\n});\r\n\r\n// Form values type\r\nexport type FormValues = z.infer<typeof FormSchema>;\r\n\r\n// Validation result interface\r\nexport interface ValidationResult {\r\n  valid: boolean;\r\n  message?: string;\r\n}\r\n\r\n/**\r\n * Props for the SettingsModal component\r\n */\r\nexport interface SettingsModalProps {\r\n  /** If provided, controls the open state of the modal */\r\n  isOpen?: boolean;\r\n  /** Callback when the open state changes */\r\n  onOpenChange?: (isOpen: boolean) => void;\r\n  /** Variant of the button - only used when not controlled externally */\r\n  variant?: React.ComponentProps<typeof Button>[\"variant\"];\r\n  /** Size of the button - only used when not controlled externally */\r\n  size?: React.ComponentProps<typeof Button>[\"size\"];\r\n  /** Additional class name to apply to the button */\r\n  className?: string;\r\n} \r\n","\"use client\";\n\nimport {\n  FormControl,\n  FormDescription,\n  FormField,\n  FormItem,\n  FormLabel,\n  FormMessage,\n} from \"@/components/ui/form\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\n\nimport { FormValues } from \"./types\";\nimport { UseFormReturn } from \"react-hook-form\";\nimport { useTranslation } from \"@/translations\";\n\ninterface LocaleSelectProps {\n  form: UseFormReturn<FormValues>;\n}\n\nexport function LocaleSelect({ form }: LocaleSelectProps) {\n  const { t } = useTranslation();\n\n  return (\n    <FormField\n      control={form.control}\n      name=\"locale\"\n      render={({ field }) => (\n        <FormItem>\n          <FormLabel>{t(\"SettingsModal.localeLabel\")}</FormLabel>\n          <Select onValueChange={field.onChange} defaultValue={field.value}>\n            <FormControl>\n              <SelectTrigger>\n                <SelectValue\n                  placeholder={t(\"SettingsModal.localePlaceholder\")}\n                />\n              </SelectTrigger>\n            </FormControl>\n            <SelectContent>\n              <SelectItem value=\"en-US\">English (United States)</SelectItem>\n              <SelectItem value=\"de-DE\">Deutsch (Deutschland)</SelectItem>\n              {/* Add other locales as needed */}\n            </SelectContent>\n          </Select>\n          <FormDescription>\n            {t(\"SettingsModal.localeDescription\")}\n          </FormDescription>\n          <FormMessage />\n        </FormItem>\n      )}\n    />\n  );\n}\n","\"use client\";\n\nimport { ControllerRenderProps, UseFormReturn } from \"react-hook-form\";\nimport {\n  FormControl,\n  FormDescription,\n  FormField,\n  FormItem,\n  FormLabel,\n  FormMessage,\n} from \"@/components/ui/form\";\n\nimport { FormValues } from \"./types\";\nimport { Input } from \"@/components/ui/input\";\n\ninterface NumberFieldProps {\n  form: UseFormReturn<FormValues>;\n  name: \"decimalPlaces\" | \"roundingPrecision\";\n  label: string;\n  description: string;\n}\n\nexport function NumberField({\n  form,\n  name,\n  label,\n  description,\n}: NumberFieldProps) {\n  return (\n    <FormField\n      control={form.control}\n      name={name}\n      render={({ field }: { field: ControllerRenderProps<FormValues, \"decimalPlaces\" | \"roundingPrecision\"> }) => (\n        <FormItem>\n          <FormLabel>{label}</FormLabel>\n          <FormControl>\n            <Input required {...field} />\n          </FormControl>\n          <FormDescription>{description}</FormDescription>\n          <FormMessage />\n        </FormItem>\n      )}\n    />\n  );\n}\n","\"use client\";\n\nimport {\n  FormControl,\n  FormDescription,\n  FormField,\n  FormItem,\n  FormLabel,\n  FormMessage,\n} from \"@/components/ui/form\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\n\nimport { DEFAULT_SEPARATOR } from \"./form-schema\";\nimport { FormValues } from \"./types\";\nimport { UseFormReturn } from \"react-hook-form\";\nimport { useTranslation } from \"@/translations\";\n\ninterface SeparatorSelectProps {\n  form: UseFormReturn<FormValues>;\n  currentSeparator: string;\n}\n\nexport function SeparatorSelect({\n  form,\n  currentSeparator,\n}: SeparatorSelectProps) {\n  const { t } = useTranslation();\n\n  return (\n    <FormField\n      control={form.control}\n      name=\"thousandsSeparator\"\n      render={({ field }) => (\n        <FormItem>\n          <FormLabel>{t(\"SettingsModal.thousandsSeparatorLabel\")}</FormLabel>\n          <Select\n            onValueChange={(value) => {\n              field.onChange(value || DEFAULT_SEPARATOR);\n            }}\n            value={currentSeparator}\n          >\n            <FormControl>\n              <SelectTrigger>\n                <SelectValue>\n                  {currentSeparator === \",\"\n                    ? `${t(\"SettingsModal.comma\")} (1,234.56)`\n                    : currentSeparator === \".\"\n                      ? `${t(\"SettingsModal.period\")} (1.234,56)`\n                      : currentSeparator === \"'\"\n                        ? `${t(\"SettingsModal.apostrophe\")} (1&apos;234.56)`\n                        : currentSeparator === \" \"\n                          ? `${t(\"SettingsModal.space\")} (1 234.56)`\n                          : t(\"SettingsModal.comma\")}\n                </SelectValue>\n              </SelectTrigger>\n            </FormControl>\n            <SelectContent>\n              <SelectItem key=\",\" value=\",\">\n                {`${t(\"SettingsModal.comma\")} (1,234.56)`}\n              </SelectItem>\n              <SelectItem key=\".\" value=\".\">\n                {`${t(\"SettingsModal.period\")} (1.234,56)`}\n              </SelectItem>\n              <SelectItem key=\"'\" value=\"'\">\n                {`${t(\"SettingsModal.apostrophe\")} (1&apos;234.56)`}\n              </SelectItem>\n              <SelectItem key=\"space\" value=\" \">\n                {`${t(\"SettingsModal.space\")} (1 234.56)`}\n              </SelectItem>\n            </SelectContent>\n          </Select>\n          <FormDescription>\n            {t(\"SettingsModal.thousandsSeparatorDescription\")}\n          </FormDescription>\n          <FormMessage />\n        </FormItem>\n      )}\n    />\n  );\n}\n","\"use client\";\n\nimport {\n  DEFAULT_SEPARATOR,\n  validateDecimalPlaces,\n  validateRoundingPrecision,\n} from \"./form-schema\";\nimport {\n  Dialog,\n  DialogClose,\n  DialogContent,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n  DialogDescription as UiDialogDescription,\n} from \"@/components/ui/dialog\";\nimport {\n  FormSchema,\n  FormValues,\n  SettingsModalProps\n} from \"./types\";\nimport { useEffect, useState } from \"react\";\n\nimport { Button } from \"@/components/ui/button\";\nimport { Form } from \"@/components/ui/form\";\nimport { LocaleSelect } from \"./locale-select\";\nimport { NumberField } from \"./number-field\";\nimport { SeparatorSelect } from \"./separator-select\";\nimport { Settings } from \"lucide-react\";\nimport { useForm } from \"react-hook-form\";\nimport { useSettings } from \"@/context/settings-context\";\nimport { useTranslation } from \"@/translations\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\n\nexport function SettingsModal({\n  isOpen: externalIsOpen,\n  onOpenChange: externalOnOpenChange,\n  variant = \"ghost\",\n  size = \"icon\",\n  className,\n}: SettingsModalProps) {\n  const { settings, saveSettings } = useSettings();\n  const { t } = useTranslation();\n  const [internalIsOpen, setInternalIsOpen] = useState(false);\n  const [isMounted, setIsMounted] = useState(false);\n\n  // Use either the external state or internal state\n  const isOpen = externalIsOpen !== undefined ? externalIsOpen : internalIsOpen;\n  const onOpenChange = externalOnOpenChange || setInternalIsOpen;\n\n  // Track form validity state\n  const [isValid, setIsValid] = useState(true);\n\n  // Fix the form type to match form values\n  const form = useForm<FormValues>({\n    resolver: zodResolver(FormSchema),\n    defaultValues: {\n      decimalPlaces: settings.decimalPlaces?.toString() || \"\",\n      roundingPrecision: settings.roundingPrecision?.toString() || \"0.01\",\n      thousandsSeparator: settings.thousandsSeparator || DEFAULT_SEPARATOR,\n      locale: \"en-US\",\n    },\n    mode: \"onChange\", // Validate on every change\n  });\n\n  // Reset form when dialog opens or settings change\n  useEffect(() => {\n    if (isOpen) {\n      // Ensure we're using the latest settings from context\n      form.reset({\n        decimalPlaces: settings.decimalPlaces?.toString() || \"\",\n        roundingPrecision: settings.roundingPrecision?.toString() || \"0.01\",\n        thousandsSeparator: settings.thousandsSeparator || DEFAULT_SEPARATOR,\n        locale: \"en-US\",\n      });\n    }\n  }, [isOpen, settings, form]);\n\n  // Update isValid when form state changes\n  useEffect(() => {\n    const subscription = form.watch(() => {\n      const hasErrors = !!Object.keys(form.formState.errors).length;\n      const formValues = form.getValues();\n      const isDecimalEmpty =\n        !formValues.decimalPlaces || formValues.decimalPlaces === \"\";\n\n      setIsValid(!hasErrors && !isDecimalEmpty);\n    });\n    return () => subscription.unsubscribe();\n  }, [form]);\n\n  useEffect(() => {\n    setIsMounted(true);\n  }, [settings]);\n\n  // Handle dialog close - ensure unsaved changes are discarded\n  const handleOpenChange = (open: boolean) => {\n    if (!open) {\n      // Reset form when dialog is closed without saving\n      form.reset({\n        decimalPlaces: settings.decimalPlaces?.toString() || \"\",\n        roundingPrecision: settings.roundingPrecision?.toString() || \"0.01\",\n        thousandsSeparator: settings.thousandsSeparator || DEFAULT_SEPARATOR,\n        locale: \"en-US\",\n      });\n    }\n    onOpenChange(open);\n  };\n\n  function onSubmit(data: FormValues) {\n    // Validate decimal places\n    const decimalPlacesResult = validateDecimalPlaces(data.decimalPlaces);\n    if (!decimalPlacesResult.valid) {\n      form.setError(\"decimalPlaces\", {\n        type: \"manual\",\n        message: decimalPlacesResult.message || \"Invalid decimal places\",\n      });\n      return;\n    }\n\n    // Validate rounding precision\n    const roundingPrecisionResult = validateRoundingPrecision(\n      data.roundingPrecision,\n    );\n    if (!roundingPrecisionResult.valid) {\n      form.setError(\"roundingPrecision\", {\n        type: \"manual\",\n        message:\n          roundingPrecisionResult.message || \"Invalid rounding precision\",\n      });\n      return;\n    }\n\n    // Only save settings when user submits the form and all validations pass\n    const updatedSettings = {\n      decimalPlaces: Number(data.decimalPlaces),\n      roundingPrecision: Number(data.roundingPrecision.replace(\",\", \".\")),\n      thousandsSeparator: data.thousandsSeparator || DEFAULT_SEPARATOR,\n      locale: data.locale,\n    };\n\n    // Handle the locale/language change\n    const newLocale = data.locale;\n    if (newLocale && \"en-US\" !== newLocale) {\n      // Implement language change logic here\n    }\n\n    // Save all settings at once after form submission\n    saveSettings(updatedSettings);\n\n    // Dispatch a custom event to notify the application that settings have changed\n    if (typeof window !== \"undefined\") {\n      window.dispatchEvent(\n        new CustomEvent(\"settingsChanged\", {\n          detail: { settings: updatedSettings },\n        }),\n      );\n    }\n\n    onOpenChange(false);\n  }\n\n  // Always ensure we have a valid separator value for the dropdown\n  const currentSeparator =\n    form.watch(\"thousandsSeparator\") || DEFAULT_SEPARATOR;\n\n  // Determine labels based on mounted state\n  const triggerLabel = isMounted\n    ? t(\"SettingsModal.settingsModalTitle\")\n    : \"Number Formatting Settings\";\n  const dialogTitle = isMounted\n    ? t(\"SettingsModal.settingsModalTitle\")\n    : \"Number Formatting Settings\";\n  const dialogDescription = isMounted\n    ? t(\"SettingsModal.settingsModalDescription\")\n    : \"Adjust your preferred number formatting for allocations and reports.\";\n  const saveLabel = isMounted ? t(\"SettingsModal.saveButton\") : \"Save Settings\";\n  const cancelLabel = isMounted\n    ? t(\"SettingsModal.cancelButton\", \"Cancel\")\n    : \"Cancel\";\n\n  return (\n    <>\n      {!externalIsOpen && !externalOnOpenChange && (\n        <Button\n          variant={variant}\n          size={size}\n          onClick={() => setInternalIsOpen(true)}\n          className={className}\n          aria-label={triggerLabel}\n        >\n          <Settings className=\"size-4\" />\n          {size !== \"icon\" && t(\"SettingsModal.settingsButtonText\", \"Settings\")}\n        </Button>\n      )}\n\n      <Dialog open={isOpen} onOpenChange={handleOpenChange}>\n        <DialogContent className=\"sm:max-w-[425px]\">\n          <DialogHeader>\n            <DialogTitle>{dialogTitle}</DialogTitle>\n            <UiDialogDescription>{dialogDescription}</UiDialogDescription>\n          </DialogHeader>\n          <Form {...form}>\n            <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-6\">\n              <NumberField\n                form={form}\n                name=\"decimalPlaces\"\n                label={t(\"SettingsModal.decimalPlacesLabel\")}\n                description={t(\"SettingsModal.decimalPlacesDescription\")}\n              />\n\n              <NumberField\n                form={form}\n                name=\"roundingPrecision\"\n                label={t(\"SettingsModal.roundingPrecisionLabel\")}\n                description={t(\"SettingsModal.roundingPrecisionDescription\")}\n              />\n\n              <SeparatorSelect\n                form={form}\n                currentSeparator={currentSeparator}\n              />\n\n              <LocaleSelect form={form} />\n\n              <DialogFooter className=\"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2 gap-2 sm:gap-0\">\n                <DialogClose asChild>\n                  <Button\n                    type=\"button\"\n                    variant=\"outline\"\n                    className=\"w-full sm:w-auto\"\n                  >\n                    {cancelLabel}\n                  </Button>\n                </DialogClose>\n                <Button\n                  type=\"submit\"\n                  disabled={!isValid}\n                  className=\"w-full sm:w-auto\"\n                >\n                  {saveLabel}\n                </Button>\n              </DialogFooter>\n            </form>\n          </Form>\n        </DialogContent>\n      </Dialog>\n    </>\n  );\n}\n","\"use client\";\n\n// This file is now just a barrel file that re-exports from the new location\nexport { SettingsModal } from \"./settings-modal/index\";\nexport type { SettingsModalProps } from \"./settings-modal/types\";\n","import {\n  formatDateForDisplay,\n  formatNumForDisplay,\n  formatPeriodIdForDisplay,\n  getPeriodHeader,\n} from \"./utils\";\n\nimport { AppSettings } from \"@/context/settings-context\";\nimport { CalculationResult } from \"@/lib/calculations\";\nimport { InputDataForDisplay } from \"./types\";\nimport { format } from \"date-fns\";\n\nexport async function exportToExcel(\n  results: CalculationResult,\n  inputData: InputDataForDisplay,\n  settings: AppSettings,\n  totalInputAmount: number,\n  totalDurationDays: number,\n  totalAggregatedAmount: number,\n  splitPeriodUsed: \"yearly\" | \"quarterly\" | \"monthly\",\n  currentLocale: string,\n  t: (key: string, options?: { defaultValue?: string; values?: Record<string, string | number> }) => string,\n): Promise<void> {\n  try {\n    const XLSX = await import(\"xlsx\");\n\n    // Create a single consolidated sheet for all data\n    const workbook = XLSX.utils.book_new();\n\n    // Prepare all data for a single sheet\n    const consolidatedData = [];\n\n    // 1. Title and Summary Section\n    consolidatedData.push([\n      t(\"ResultsDisplay.summaryTitle\", { defaultValue: \"Summary\" }),\n    ]);\n    consolidatedData.push([]);\n    consolidatedData.push([\n      t(\"ResultsDisplay.periodLabel\"),\n      `${formatDateForDisplay(inputData.startDate, currentLocale)} - ${formatDateForDisplay(inputData.endDate, currentLocale)}`,\n    ]);\n    consolidatedData.push([\n      t(\"ResultsDisplay.totalDurationLabel\", {\n        defaultValue: \"Total Duration (days)\",\n      }),\n      `${totalDurationDays} ${t(\"ResultsDisplay.daysLabel\")}`,\n    ]);\n    consolidatedData.push([\n      t(\"InvoiceForm.includeEndDateLabel\", {\n        defaultValue: \"Include Final Day in Service Period?\",\n      }),\n      inputData.includeEndDate\n        ? t(\"ResultsDisplay.yesLabel\", { defaultValue: \"Yes\" })\n        : t(\"ResultsDisplay.noLabel\", { defaultValue: \"No\" }),\n    ]);\n    consolidatedData.push([\n      t(\"InvoiceForm.splitPeriodLabel\", { defaultValue: \"Split Period\" }),\n      splitPeriodUsed === \"yearly\"\n        ? t(\"InvoiceForm.periodYearly\")\n        : splitPeriodUsed === \"quarterly\"\n          ? t(\"InvoiceForm.periodQuarterly\")\n          : t(\"InvoiceForm.periodMonthly\"),\n    ]);\n    consolidatedData.push([\n      t(\"ResultsDisplay.originalTotalLabel\", {\n        defaultValue: \"Total Input Amount:\",\n      }),\n      formatNumForDisplay(totalInputAmount, currentLocale, settings),\n    ]);\n    consolidatedData.push([]);\n\n    // 2. Allocation Results Section\n    consolidatedData.push([\n      t(\"ResultsDisplay.aggregatedTitle\", {\n        defaultValue: \"Allocation per Period\",\n      }),\n    ]);\n    consolidatedData.push([]);\n    consolidatedData.push([\n      getPeriodHeader(splitPeriodUsed, t),\n      t(\"ResultsDisplay.daysHeader\"),\n      t(\"ResultsDisplay.proportionHeader\"),\n      t(\"ResultsDisplay.amountHeader\"),\n    ]);\n\n    results.aggregatedSplits?.forEach((split) => {\n      consolidatedData.push([\n        formatPeriodIdForDisplay(\n          split.periodIdentifier,\n          splitPeriodUsed,\n          currentLocale,\n        ),\n        split.daysInPeriod,\n        split.proportion,\n        split.totalSplitAmount,\n      ]);\n    });\n\n    consolidatedData.push([\n      t(\"ResultsDisplay.totalLabel\", { defaultValue: \"Total\" }),\n      totalDurationDays,\n      1,\n      totalAggregatedAmount,\n    ]);\n    consolidatedData.push([]);\n    consolidatedData.push([]);\n\n    // 3. Detailed Calculation Section\n    if (results.calculationSteps) {\n      const steps = results.calculationSteps;\n      const { periodSegments, amountCalculations } = steps;\n\n      // a. Add title\n      consolidatedData.push([\n        t(\"ResultsDisplay.calculationStepsTitle\", {\n          defaultValue: \"View Full Split Calculation\",\n        }),\n      ]);\n      consolidatedData.push([]);\n\n      // b. Add total duration section\n      consolidatedData.push([t(\"ResultsDisplay.totalDuration\")]);\n      consolidatedData.push([\n        t(\"ResultsDisplay.periodLabel\"),\n        `${formatDateForDisplay(typeof steps.totalDuration.start === \"string\" ? new Date(steps.totalDuration.start) : steps.totalDuration.start, currentLocale)} - ${formatDateForDisplay(typeof steps.totalDuration.end === \"string\" ? new Date(steps.totalDuration.end) : steps.totalDuration.end, currentLocale)}`,\n      ]);\n      consolidatedData.push([\n        t(\"ResultsDisplay.totalDays\"),\n        `${steps.totalDuration.days} ${steps.totalDuration.included ? t(\"ResultsDisplay.inclusiveLabel\") : t(\"ResultsDisplay.exclusiveLabel\")}`,\n      ]);\n      consolidatedData.push([]);\n\n      // c. Add proportion calculation\n      consolidatedData.push([t(\"ResultsDisplay.proportionCalculation\")]);\n      for (const segment of periodSegments) {\n        const formattedProportion = segment.proportion.toLocaleString(\n          currentLocale,\n          {\n            style: \"percent\",\n            minimumFractionDigits: 2,\n            maximumFractionDigits: 2,\n          },\n        );\n        consolidatedData.push([\n          formatPeriodIdForDisplay(\n            segment.periodIdentifier,\n            splitPeriodUsed,\n            currentLocale,\n          ),\n          `${segment.days} / ${steps.totalDuration.days} = ${formattedProportion}`,\n        ]);\n      }\n      consolidatedData.push([]);\n\n      // d. Add amount calculations\n      consolidatedData.push([t(\"ResultsDisplay.splitCalculation\")]);\n      consolidatedData.push([]);\n\n      for (let i = 0; i < amountCalculations.length; i++) {\n        const amtCalc = amountCalculations[i];\n        consolidatedData.push([\n          `${t(\"ResultsDisplay.inputAmountLabel\")} #${i + 1}:`,\n          formatNumForDisplay(amtCalc.originalAmount, currentLocale, settings),\n        ]);\n\n        for (const split of amtCalc.periodSplits) {\n          const periodSeg = periodSegments.find(\n            (s) => s.periodIdentifier === split.periodIdentifier,\n          );\n          consolidatedData.push([\n            formatPeriodIdForDisplay(\n              split.periodIdentifier,\n              splitPeriodUsed,\n              currentLocale,\n            ),\n            `${formatNumForDisplay(amtCalc.originalAmount, currentLocale, settings)}  ${periodSeg?.proportion.toFixed(6)} = ${split.rawSplit.toFixed(6)}  ${formatNumForDisplay(split.roundedSplit, currentLocale, settings)}`,\n          ]);\n\n          if (split.adjustment !== 0) {\n            consolidatedData.push([\n              `  ${t(\"ResultsDisplay.adjustmentLabel\")}:`,\n              formatNumForDisplay(split.adjustment, currentLocale, settings),\n            ]);\n          }\n        }\n\n        consolidatedData.push([\n          t(\"ResultsDisplay.discrepancyLabel\"),\n          formatNumForDisplay(amtCalc.discrepancy, currentLocale, settings),\n        ]);\n\n        if (amtCalc.adjustmentAppliedToPeriod) {\n          consolidatedData.push([\n            t(\"ResultsDisplay.adjustedInYearLabel\", {\n              defaultValue: \"Applied in Year\",\n            }),\n            formatPeriodIdForDisplay(\n              amtCalc.adjustmentAppliedToPeriod,\n              splitPeriodUsed,\n              currentLocale,\n            ),\n          ]);\n        }\n\n        consolidatedData.push([\n          t(\"ResultsDisplay.finalSumLabel\"),\n          formatNumForDisplay(amtCalc.finalSum, currentLocale, settings),\n        ]);\n\n        consolidatedData.push([]);\n      }\n    }\n\n    // Create the consolidated worksheet with all data\n    const consolidatedSheet = XLSX.utils.aoa_to_sheet(consolidatedData);\n\n    // Apply cell formatting for numbers and percentages\n    // Find the row range for the allocation results table (skip headers)\n    const allocationTableStartRow = 12; // 0-based index for the first data row after headers\n    const allocationTableEndRow =\n      allocationTableStartRow + (results.aggregatedSplits?.length || 0);\n\n    // Format proportion column (index 2) as percentage\n    for (let R = allocationTableStartRow; R < allocationTableEndRow; R++) {\n      const propCellRef = XLSX.utils.encode_cell({ c: 2, r: R });\n      if (consolidatedSheet[propCellRef]) {\n        consolidatedSheet[propCellRef].t = \"n\";\n        consolidatedSheet[propCellRef].z = \"0.00%\";\n      }\n    }\n\n    // Format amount column (index 3) with proper decimal places\n    for (let R = allocationTableStartRow; R < allocationTableEndRow + 1; R++) {\n      // +1 to include total row\n      const amtCellRef = XLSX.utils.encode_cell({ c: 3, r: R });\n      if (consolidatedSheet[amtCellRef]) {\n        consolidatedSheet[amtCellRef].t = \"n\";\n        consolidatedSheet[amtCellRef].z =\n          `#,##0.${\"0\".repeat(settings.decimalPlaces || 2)}`;\n      }\n    }\n\n    // Add the consolidated sheet to the workbook with a meaningful name\n    XLSX.utils.book_append_sheet(\n      workbook,\n      consolidatedSheet,\n      t(\"ResultsDisplay.consolidatedSheetName\", {\n        defaultValue: \"Invoice Split Report\",\n      }),\n    );\n\n    const filename = `InvoiceSplit_${format(new Date(), \"yyyyMMdd\")}.xlsx`;\n    XLSX.writeFile(workbook, filename);\n  } catch (error) {\n    console.error(\"Failed to load xlsx library or export Excel:\", error);\n    throw new Error(\"Failed to export Excel. Please try again.\");\n  }\n}\n","import { InputDataForDisplay, JsPDFWithInternal } from \"./types\";\nimport { de, enUS } from \"date-fns/locale\";\nimport {\n  formatDateLocale,\n  formatNumber,\n  formatPercent,\n} from \"@/lib/formattingUtils\";\nimport {\n  formatPeriodIdForDisplay,\n  getPeriodHeader,\n} from \"./utils\";\n\nimport { AppSettings } from \"@/context/settings-context\";\nimport { CalculationResult } from \"@/lib/calculations\";\nimport type { CellHookData } from \"jspdf-autotable\";\nimport { format } from \"date-fns\";\n\nexport async function exportToPdf(\n  results: CalculationResult,\n  inputData: InputDataForDisplay,\n  settings: Omit<AppSettings, \"locale\">,\n  totalInputAmount: number,\n  totalDurationDays: number,\n  totalAggregatedAmount: number,\n  splitPeriodUsed: \"yearly\" | \"quarterly\" | \"monthly\",\n  currentLocale: string,\n  t: (key: string, options?: { defaultValue?: string; values?: Record<string, string | number> }) => string,\n): Promise<void> {\n  try {\n    const [{ jsPDF }, { default: autoTable }] = await Promise.all([\n      import(\"jspdf\"),\n      import(\"jspdf-autotable\"),\n    ]);\n\n    const doc = new jsPDF() as JsPDFWithInternal;\n    let yPos = 20;\n    const filename = `InvoiceSplit_${format(new Date(), \"yyyyMMdd\")}.pdf`;\n\n    // Summary Section\n    doc.text(\n      `${t(\"ResultsDisplay.periodLabel\")}: ${formatDateLocale(inputData.startDate, currentLocale)} - ${formatDateLocale(inputData.endDate, currentLocale)}`,\n      14,\n      yPos,\n    );\n    yPos += 5;\n    doc.text(\n      `${t(\"ResultsDisplay.originalTotalLabel\", { defaultValue: \"Total Input Amount:\" })}: ${formatNumber(totalInputAmount, currentLocale, settings)}`,\n      14,\n      yPos,\n    );\n    yPos += 15;\n    doc.text(\n      `${t(\"ResultsDisplay.totalDurationLabel\", { defaultValue: \"Total Duration (days)\" })}: ${totalDurationDays} ${t(\"ResultsDisplay.daysLabel\")}`,\n      14,\n      yPos,\n    );\n    yPos += 5;\n    doc.text(\n      `${t(\"InvoiceForm.includeEndDateLabel\", { defaultValue: \"Include Final Day in Service Period?\" })}: ${inputData.includeEndDate ? t(\"ResultsDisplay.yesLabel\", { defaultValue: \"Yes\" }) : t(\"ResultsDisplay.noLabel\", { defaultValue: \"No\" })}`,\n      14,\n      yPos,\n    );\n    yPos += 5;\n    doc.text(\n      `${t(\"InvoiceForm.splitPeriodLabel\", { defaultValue: \"Split Period\" })}: ${splitPeriodUsed === \"yearly\" ? t(\"InvoiceForm.periodYearly\") : splitPeriodUsed === \"quarterly\" ? t(\"InvoiceForm.periodQuarterly\") : t(\"InvoiceForm.periodMonthly\")}`,\n      14,\n      yPos,\n    );\n    yPos += 5;\n\n    // Allocation Table\n    const tableRowsData =\n      results.aggregatedSplits?.map((split) => [\n        formatPeriodIdForDisplay(\n          split.periodIdentifier,\n          splitPeriodUsed,\n          currentLocale,\n        ),\n        split.daysInPeriod,\n        formatPercent(split.proportion, currentLocale),\n        formatNumber(split.totalSplitAmount, currentLocale, settings),\n      ]) || [];\n\n    autoTable(doc, {\n      head: [\n        [\n          getPeriodHeader(splitPeriodUsed, t),\n          t(\"ResultsDisplay.daysHeader\"),\n          t(\"ResultsDisplay.proportionHeader\"),\n          t(\"ResultsDisplay.amountHeader\"),\n        ],\n      ],\n      body: tableRowsData,\n      foot: [\n        [\n          t(\"ResultsDisplay.totalLabel\", { defaultValue: \"Total\" }),\n          totalDurationDays,\n          formatPercent(1, currentLocale),\n          formatNumber(totalAggregatedAmount, currentLocale, settings),\n        ],\n      ],\n      startY: yPos,\n      theme: \"grid\",\n      headStyles: {\n        // Convert primary color to RGB for PDF\n        fillColor: getComputedStyle(document.documentElement)\n          .getPropertyValue(\"--primary\")\n          .trim()\n          .split(\" \")\n          .map((v, i) => (i === 0 ? parseInt(v) : parseFloat(v) * 2.55))\n          .filter((_, i) => i < 3) as [number, number, number],\n      },\n      footStyles: {\n        // Convert muted color to RGB for PDF\n        fillColor: getComputedStyle(document.documentElement)\n          .getPropertyValue(\"--muted\")\n          .trim()\n          .split(\" \")\n          .map((v, i) => (i === 0 ? parseInt(v) : parseFloat(v) * 2.55))\n          .filter((_, i) => i < 3) as [number, number, number],\n        textColor:\n          getComputedStyle(document.documentElement)\n            .getPropertyValue(\"--foreground\")\n            .trim()\n            .split(\" \")\n            .map((v, i) => (i === 0 ? parseInt(v) : parseFloat(v) * 2.55))\n            .filter((_, i) => i < 3)\n            .reduce((sum, c) => sum + c, 0) / 3,\n        fontStyle: \"bold\",\n      },\n      didParseCell: function (data: CellHookData) {\n        if (\n          data.column.index !== undefined &&\n          [1, 2, 3].includes(data.column.index)\n        ) {\n          data.cell.styles.halign = \"right\";\n        }\n      },\n    });\n\n    // Calculation Steps Section\n    if (results.calculationSteps) {\n      const steps = results.calculationSteps;\n      const { periodSegments, amountCalculations } = steps;\n      yPos = doc.lastAutoTable?.finalY\n        ? doc.lastAutoTable.finalY + 15\n        : yPos + 50;\n\n      doc.text(\n        t(\"ResultsDisplay.calculationStepsTitle\", {\n          defaultValue: \"View Full Split Calculation\",\n        }),\n        14,\n        yPos,\n      );\n      yPos += 10;\n\n      doc.text(t(\"ResultsDisplay.totalDuration\"), 14, yPos);\n      yPos += 7;\n\n      // Use type assertions to handle the string dates from the API\n      const startDate = steps.totalDuration.start as string;\n      const endDate = steps.totalDuration.end as string;\n\n      doc.text(\n        `${t(\"ResultsDisplay.periodLabel\")}: ${formatDateLocale(startDate, currentLocale)} - ${formatDateLocale(endDate, currentLocale)}`,\n        20,\n        yPos,\n      );\n      yPos += 5;\n      doc.text(\n        `${t(\"ResultsDisplay.totalDays\")}: ${steps.totalDuration.days} ${steps.totalDuration.included ? t(\"ResultsDisplay.inclusiveLabel\") : t(\"ResultsDisplay.exclusiveLabel\")}`,\n        20,\n        yPos,\n      );\n      yPos += 10;\n\n      doc.text(t(\"ResultsDisplay.proportionCalculation\"), 14, yPos);\n      yPos += 7;\n      doc.setFontSize(10);\n\n      if (yPos > doc.internal.pageSize.height - 50) {\n        doc.addPage();\n        yPos = 20;\n      }\n\n      for (const segment of periodSegments) {\n        doc.text(\n          `${formatPeriodIdForDisplay(segment.periodIdentifier, splitPeriodUsed, currentLocale)}: ${segment.days} / ${steps.totalDuration.days} = ${formatPercent(segment.proportion, currentLocale)}`,\n          20,\n          yPos,\n        );\n        yPos += 5;\n        if (yPos > doc.internal.pageSize.height - 30) {\n          doc.addPage();\n          yPos = 20;\n        }\n      }\n      yPos += 5;\n\n      doc.text(t(\"ResultsDisplay.splitCalculation\"), 14, yPos);\n      yPos += 7;\n\n      for (let i = 0; i < amountCalculations.length; i++) {\n        const amtCalc = amountCalculations[i];\n        if (yPos > doc.internal.pageSize.height - 70) {\n          doc.addPage();\n          yPos = 20;\n        }\n        doc.setFontSize(11);\n        doc.text(\n          `${t(\"ResultsDisplay.inputAmountLabel\")} #${i + 1}: ${formatNumber(amtCalc.originalAmount, currentLocale, settings)}`,\n          20,\n          yPos,\n        );\n        yPos += 7;\n        doc.setFontSize(10);\n\n        for (const split of amtCalc.periodSplits) {\n          const periodSeg = periodSegments.find(\n            (s) => s.periodIdentifier === split.periodIdentifier,\n          );\n          doc.text(\n            `${formatPeriodIdForDisplay(split.periodIdentifier, splitPeriodUsed, currentLocale)}:`,\n            25,\n            yPos,\n          );\n          yPos += 5;\n          doc.text(\n            `${formatNumber(amtCalc.originalAmount, currentLocale, settings)}  ${periodSeg?.proportion.toFixed(6)} = ${split.rawSplit.toFixed(6)}`,\n            30,\n            yPos,\n          );\n          yPos += 5;\n          doc.text(\n            ` ${t(\"ResultsDisplay.roundedLabel\")}: ${formatNumber(split.roundedSplit, currentLocale, settings)}`,\n            30,\n            yPos,\n          );\n          yPos += 5;\n          if (split.adjustment !== 0) {\n            doc.text(\n              `${t(\"ResultsDisplay.adjustmentLabel\")}: ${formatNumber(split.adjustment, currentLocale, settings)}`,\n              30,\n              yPos,\n            );\n            yPos += 5;\n          }\n          if (yPos > doc.internal.pageSize.height - 40) {\n            doc.addPage();\n            yPos = 20;\n          }\n        }\n        doc.text(\n          `${t(\"ResultsDisplay.discrepancyLabel\")}: ${formatNumber(amtCalc.discrepancy, currentLocale, settings)}`,\n          25,\n          yPos,\n        );\n        yPos += 5;\n        if (amtCalc.adjustmentAppliedToPeriod) {\n          doc.text(\n            `${t(\"ResultsDisplay.adjustedInYearLabel\", { defaultValue: \"Applied in Year\" })}: ${formatPeriodIdForDisplay(amtCalc.adjustmentAppliedToPeriod, splitPeriodUsed, currentLocale)}`,\n            25,\n            yPos,\n          );\n          yPos += 5;\n        }\n        doc.text(\n          `${t(\"ResultsDisplay.finalSumLabel\")}: ${formatNumber(amtCalc.finalSum, currentLocale, settings)}`,\n          25,\n          yPos,\n        );\n        yPos += 10;\n        if (\n          yPos > doc.internal.pageSize.height - 50 &&\n          i < amountCalculations.length - 1\n        ) {\n          doc.addPage();\n          yPos = 20;\n        }\n      }\n    }\n\n    const pageCount = doc.internal.getNumberOfPages();\n    doc.setFontSize(8);\n    for (let i = 1; i <= pageCount; i++) {\n      doc.setPage(i);\n      doc.text(\n        `Generated by BillSplitter - ${format(new Date(), \"PPpp\", { locale: currentLocale === \"de\" ? de : enUS })}`,\n        14,\n        doc.internal.pageSize.height - 10,\n      );\n      doc.text(\n        `Page ${i} of ${pageCount}`,\n        doc.internal.pageSize.width - 35,\n        doc.internal.pageSize.height - 10,\n      );\n    }\n    doc.save(filename);\n  } catch (error) {\n    console.error(\"Error generating PDF:\", error);\n    throw new Error(\"Failed to generate PDF. Please try again.\");\n  }\n}\n","\"use client\";\n\nimport {\n  Accordion,\n  AccordionContent,\n  AccordionItem,\n  AccordionTrigger,\n} from \"@/components/ui/accordion\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport React, { useState } from \"react\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableFooter,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport {\n  formatDateForDisplay,\n  formatNumForDisplay,\n  formatPctForDisplay,\n  formatPeriodIdForDisplay,\n  getPeriodHeader,\n} from \"./utils\";\n\nimport { Button } from \"@/components/ui/button\";\nimport { CalculationStepsDisplay } from \"./calculation-steps-display\";\nimport { ResultsDisplayProps } from \"./types\";\nimport { SettingsModal } from \"@/components/settings-modal\";\nimport { exportToExcel } from \"./export-excel\";\nimport { exportToPdf } from \"./export-pdf\";\nimport { useSettings } from \"@/context/settings-context\";\nimport { useTranslation } from \"@/translations\";\n\n// Internal component function\nfunction ResultsDisplayComponent({ results, inputData }: ResultsDisplayProps) {\n  const { t, i18n } = useTranslation();\n  const { settings } = useSettings();\n  const [isSettingsOpen, setIsSettingsOpen] = useState(false);\n  const currentLocale = i18n.language;\n\n  // Ensure we use the splitPeriod from the inputData if available\n  const splitPeriodUsed = inputData.splitPeriod || \"yearly\";\n\n  // Calculate derived values with checks\n  const totalDurationDays = results.calculationSteps?.totalDuration?.days ?? 0;\n  const totalInputAmount = inputData.amounts.reduce(\n    (sum, val) => sum + (isNaN(val) ? 0 : val),\n    0,\n  );\n  const totalAggregatedAmount =\n    results.aggregatedSplits?.reduce(\n      (sum, s) => sum + (s.totalSplitAmount ?? 0),\n      0,\n    ) ?? 0;\n\n  // Handler functions for export\n  function handleExportExcel() {\n    exportToExcel(\n      results,\n      inputData,\n      settings,\n      totalInputAmount,\n      totalDurationDays,\n      totalAggregatedAmount,\n      splitPeriodUsed,\n      currentLocale,\n      t,\n    ).catch((error) => {\n      console.error(\"Failed to export Excel:\", error);\n      alert(\"Failed to export Excel. Please try again.\");\n    });\n  }\n\n  function handleExportPdf() {\n    exportToPdf(\n      results,\n      inputData,\n      settings,\n      totalInputAmount,\n      totalDurationDays,\n      totalAggregatedAmount,\n      splitPeriodUsed,\n      currentLocale,\n      t,\n    ).catch((error) => {\n      console.error(\"Failed to generate PDF:\", error);\n      alert(\"Failed to generate PDF. Please try again.\");\n    });\n  }\n\n  return (\n    <div className=\"w-full animate-fadeIn\">\n      {/* Wrap everything except the modal in a single card */}\n      <Card className=\"shadow-lg border border-border/50\">\n        <CardContent className=\"p-6 space-y-8\">\n          <Card className=\"shadow-md border border-border/40 overflow-hidden\">\n            <CardContent className=\"p-6\">\n              <div className=\"flex justify-between items-center mb-6 pb-4 border-b\">\n                <h3 className=\"text-xl font-semibold text-primary\">\n                  {t(\"ResultsDisplay.summaryTitle\")}\n                </h3>\n                <button\n                  onClick={() => setIsSettingsOpen(true)}\n                  className=\"p-1.5 rounded-md text-muted-foreground hover:text-primary-foreground hover:bg-primary transition-colors cursor-pointer\"\n                  aria-label={t(\"ResultsDisplay.settingsLabel\")}\n                >\n                  <svg\n                    xmlns=\"http://www.w3.org/2000/svg\"\n                    width=\"18\"\n                    height=\"18\"\n                    viewBox=\"0 0 24 24\"\n                    fill=\"none\"\n                    stroke=\"currentColor\"\n                    strokeWidth=\"2\"\n                    strokeLinecap=\"round\"\n                    strokeLinejoin=\"round\"\n                  >\n                    <path d=\"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.38a2 2 0 0 0-.73-2.73l-.15-.09a2 2 0 0 1-1-1.74v-.51a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z\" />\n                    <circle cx=\"12\" cy=\"12\" r=\"3\" />\n                  </svg>\n                </button>\n              </div>\n              <div className=\"space-y-2 text-sm text-muted-foreground\">\n                <div className=\"flex justify-between\">\n                  <span>{t(\"ResultsDisplay.periodLabel\")}</span>\n                  <span className=\"font-medium text-foreground\">\n                    {formatDateForDisplay(inputData.startDate, currentLocale)} -{\" \"}\n                    {formatDateForDisplay(inputData.endDate, currentLocale)}\n                  </span>\n                </div>\n                <div className=\"flex justify-between\">\n                  <span>\n                    {t(\"ResultsDisplay.totalDurationLabel\", {\n                      defaultValue: \"Total Duration (days)\",\n                    })}\n                  </span>\n                  <span className=\"font-medium text-foreground\">\n                    {totalDurationDays} {t(\"ResultsDisplay.daysLabel\")}\n                  </span>\n                </div>\n                <div className=\"flex justify-between\">\n                  <span>\n                    {t(\"InvoiceForm.includeEndDateLabel\", {\n                      defaultValue: \"Include Final Day in Service Period?\",\n                    })}\n                  </span>\n                  <span className=\"font-medium text-foreground\">\n                    {inputData.includeEndDate\n                      ? t(\"ResultsDisplay.yesLabel\", { defaultValue: \"Yes\" })\n                      : t(\"ResultsDisplay.noLabel\", { defaultValue: \"No\" })}\n                  </span>\n                </div>\n                <div className=\"flex justify-between\">\n                  <span>\n                    {t(\"InvoiceForm.splitPeriodLabel\", {\n                      defaultValue: \"Split Period\",\n                    })}\n                  </span>\n                  <span className=\"font-medium text-foreground\">\n                    {splitPeriodUsed === \"yearly\" &&\n                      t(\"InvoiceForm.periodYearly\")}\n                    {splitPeriodUsed === \"quarterly\" &&\n                      t(\"InvoiceForm.periodQuarterly\")}\n                    {splitPeriodUsed === \"monthly\" &&\n                      t(\"InvoiceForm.periodMonthly\")}\n                  </span>\n                </div>\n                <div className=\"flex justify-between pt-2 border-t border-border/30\">\n                  <span className=\"font-semibold text-foreground\">\n                    {t(\"ResultsDisplay.originalTotalLabel\", {\n                      defaultValue: \"Total Input Amount:\",\n                    })}\n                  </span>\n                  <span className=\"font-semibold text-foreground\">\n                    {formatNumForDisplay(\n                      totalInputAmount,\n                      currentLocale,\n                      settings,\n                    )}\n                  </span>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card className=\"shadow-md border border-border/40 overflow-hidden\">\n            <CardContent className=\"p-6\">\n              <h3 className=\"text-xl font-semibold mb-6 pb-4 border-b text-primary\">\n                {t(\"ResultsDisplay.aggregatedTitle\", {\n                  defaultValue: \"Allocation per Period\",\n                })}\n              </h3>\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>{getPeriodHeader(splitPeriodUsed, t)}</TableHead>\n                    <TableHead className=\"text-right\">\n                      {t(\"ResultsDisplay.daysHeader\")}\n                    </TableHead>\n                    <TableHead className=\"text-right\">\n                      {t(\"ResultsDisplay.proportionHeader\")}\n                    </TableHead>\n                    <TableHead className=\"text-right\">\n                      {t(\"ResultsDisplay.amountHeader\")}\n                    </TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {results.aggregatedSplits?.map((split, index) => (\n                    <TableRow key={index}>\n                      <TableCell className=\"font-medium text-foreground whitespace-nowrap\">\n                        {formatPeriodIdForDisplay(\n                          split.periodIdentifier,\n                          splitPeriodUsed,\n                          currentLocale,\n                        )}\n                      </TableCell>\n                      <TableCell className=\"text-right text-muted-foreground\">\n                        {split.daysInPeriod}\n                      </TableCell>\n                      <TableCell className=\"text-right text-muted-foreground\">\n                        {formatPctForDisplay(split.proportion, currentLocale)}\n                      </TableCell>\n                      <TableCell className=\"text-right font-medium text-foreground\">\n                        {formatNumForDisplay(\n                          split.totalSplitAmount,\n                          currentLocale,\n                          settings,\n                        )}\n                      </TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n                <TableFooter>\n                  <TableRow>\n                    <TableCell>\n                      {t(\"ResultsDisplay.totalLabel\", {\n                        defaultValue: \"Total\",\n                      })}\n                    </TableCell>\n                    <TableCell className=\"text-right font-semibold text-foreground\">\n                      {totalDurationDays}\n                    </TableCell>\n                    <TableCell className=\"text-right font-semibold text-foreground\">\n                      {formatPctForDisplay(1, currentLocale)}\n                    </TableCell>\n                    <TableCell className=\"text-right font-semibold text-foreground\">\n                      {formatNumForDisplay(\n                        totalAggregatedAmount,\n                        currentLocale,\n                        settings,\n                      )}\n                    </TableCell>\n                  </TableRow>\n                </TableFooter>\n              </Table>\n            </CardContent>\n          </Card>\n\n          {/* Calculation Details Accordion */}\n          <Accordion type=\"single\" collapsible className=\"w-full\">\n            <AccordionItem\n              value=\"item-1\"\n              className=\"border rounded-lg shadow-md bg-card\"\n            >\n              <AccordionTrigger className=\"px-6 py-4 text-lg font-semibold text-primary hover:bg-muted/40\">\n                {t(\"ResultsDisplay.calculationStepsTitle\", {\n                  defaultValue: \"View Full Split Calculation\",\n                })}\n              </AccordionTrigger>\n              <AccordionContent className=\"px-6 py-4 bg-background border-t\">\n                {results.calculationSteps ? (\n                  <CalculationStepsDisplay\n                    steps={results.calculationSteps}\n                    settings={settings}\n                    splitPeriodUsed={splitPeriodUsed}\n                  />\n                ) : (\n                  <p>{t(\"ResultsDisplay.noStepsAvailable\")}</p>\n                )}\n              </AccordionContent>\n            </AccordionItem>\n          </Accordion>\n\n          {/* Export Buttons Section */}\n          <div className=\"mt-8 w-full flex flex-col items-center sm:flex-row sm:justify-center gap-4 px-4 sm:px-0\">\n            <Button\n              variant=\"outline\"\n              onClick={handleExportExcel}\n              className=\"w-full sm:w-auto\"\n            >\n              <svg\n                className=\"mr-2 h-4 w-4\"\n                xmlns=\"http://www.w3.org/2000/svg\"\n                viewBox=\"0 0 24 24\"\n                fill=\"none\"\n                stroke=\"currentColor\"\n                strokeWidth=\"2\"\n                strokeLinecap=\"round\"\n                strokeLinejoin=\"round\"\n              >\n                <path d=\"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z\" />\n                <polyline points=\"14 2 14 8 20 8\" />\n                <line x1=\"16\" y1=\"13\" x2=\"8\" y2=\"13\" />\n                <line x1=\"16\" y1=\"17\" x2=\"8\" y2=\"17\" />\n                <polyline points=\"10 9 9 9 8 9\" />\n              </svg>\n              {t(\"ResultsDisplay.exportExcelButton\")}\n            </Button>\n            <Button\n              variant=\"outline\"\n              onClick={handleExportPdf}\n              className=\"w-full sm:w-auto\"\n            >\n              <svg\n                className=\"mr-2 h-4 w-4\"\n                xmlns=\"http://www.w3.org/2000/svg\"\n                viewBox=\"0 0 24 24\"\n                fill=\"none\"\n                stroke=\"currentColor\"\n                strokeWidth=\"2\"\n                strokeLinecap=\"round\"\n                strokeLinejoin=\"round\"\n              >\n                <path d=\"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z\" />\n                <polyline points=\"14 2 14 8 20 8\" />\n                <line x1=\"16\" y1=\"13\" x2=\"8\" y2=\"13\" />\n                <line x1=\"16\" y1=\"17\" x2=\"8\" y2=\"17\" />\n                <polyline points=\"10 9 9 9 8 9\" />\n              </svg>\n              {t(\"ResultsDisplay.exportPdfButton\")}\n            </Button>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Settings Modal remains outside the main card */}\n      <SettingsModal isOpen={isSettingsOpen} onOpenChange={setIsSettingsOpen} />\n    </div>\n  );\n}\n\n// Wrapper component to export\nexport function ResultsDisplay(props: ResultsDisplayProps) {\n  return <ResultsDisplayComponent {...props} />;\n}\n","// This file is a compatibility layer that re-exports from the modular implementation\nexport * from \"./results-display/index\";\n","import { ERROR_CODES, InputValidationError } from \"@/lib/errors\";\n\nimport { CalculationError } from \"@/lib/calculations\";\nimport { CalculationErrorType } from \"./types\";\n\ntype ErrorHandlerProps = {\n  error: CalculationErrorType;\n  t: (key: string, options?: Record<string, unknown> | string) => string;\n};\n\nexport function handleCalculationError({\n  error,\n  t,\n}: ErrorHandlerProps): string | null {\n  if (!error) return null;\n\n  const baseErrorTitle = t(\"Errors.calculationErrorTitle\");\n\n  if (error instanceof InputValidationError) {\n    switch (error.code) {\n      case ERROR_CODES.NO_AMOUNTS:\n        return baseErrorTitle + \": \" + t(\"InvoiceForm.errorAmountRequired\");\n      case ERROR_CODES.INVALID_AMOUNT:\n        return baseErrorTitle + \": \" + t(\"InvoiceForm.errorAmountPositive\");\n      case ERROR_CODES.END_BEFORE_START:\n        return baseErrorTitle + \": \" + t(\"InvoiceForm.errorEndDateBeforeStart\");\n      case ERROR_CODES.INVALID_DATES:\n        return (\n          baseErrorTitle +\n          \": \" +\n          t(\"InvoiceForm.errorInvalidDates\", {\n            defaultValue: \"Valid start and end dates are required\",\n          })\n        );\n      case ERROR_CODES.ZERO_DURATION:\n        return (\n          baseErrorTitle +\n          \": \" +\n          t(\"InvoiceForm.errorZeroDuration\", {\n            defaultValue: \"The date range must result in a positive duration\",\n          })\n        );\n      default:\n        console.warn(`Input validation error: ${error.code}`, error.details);\n        return baseErrorTitle + \": \" + error.message;\n    }\n  }\n\n  if (error instanceof CalculationError) {\n    console.error(\n      `Calculation error: ${error.code} (${error.category})`,\n      error.details,\n    );\n    return baseErrorTitle + \": \" + error.message;\n  }\n\n  if (typeof error === \"string\") {\n    if (error.includes(\"At least one amount is required\")) {\n      return baseErrorTitle + \": \" + t(\"InvoiceForm.errorAmountRequired\");\n    } else if (error.includes(\"Start date must be before\")) {\n      return baseErrorTitle + \": \" + t(\"InvoiceForm.errorEndDateBeforeStart\");\n    } else {\n      return baseErrorTitle + \": \" + error;\n    }\n  }\n\n  if (error instanceof Error) {\n    console.error(\"Error object received:\", error);\n    return baseErrorTitle + \": \" + error.message;\n  }\n\n  if (error && typeof error === \"object\") {\n    console.error(\"Error object received:\", error);\n    if (\"message\" in error && typeof error.message === \"string\") {\n      return baseErrorTitle + \": \" + error.message;\n    } else {\n      try {\n        const stringifiedError = JSON.stringify(error);\n        return (\n          baseErrorTitle +\n          \": \" +\n          (stringifiedError !== \"{}\"\n            ? stringifiedError\n            : t(\"Errors.unexpectedError\"))\n        );\n      } catch {\n        return baseErrorTitle + \": \" + t(\"Errors.unexpectedError\");\n      }\n    }\n  }\n\n  console.error(\"An unexpected or non-standard error was received:\", error);\n  return baseErrorTitle + \": \" + t(\"Errors.unexpectedError\");\n}\n","import { useCallback, useEffect, useRef, useState } from \"react\";\n\nimport { DemoDataType } from \"./form-schema\";\n\nexport function useDemoDataHandler() {\n  const [initialDemoData, setInitialDemoData] = useState<DemoDataType>(null);\n  const demoDataProcessedRef = useRef(false);\n\n  useEffect(() => {\n    if (demoDataProcessedRef.current) {\n      return;\n    }\n\n    if (typeof window !== \"undefined\") {\n      const demoDataString = sessionStorage.getItem(\"billSplitterDemoData\");\n      console.log(\n        \"Reading sessionStorage billSplitterDemoData:\",\n        demoDataString,\n      );\n\n      if (demoDataString) {\n        try {\n          const parsedDemoData = JSON.parse(demoDataString);\n          if (parsedDemoData && parsedDemoData.isDemo) {\n            localStorage.removeItem(\"invoiceFormDataCache\");\n            console.log(\n              \"Cleared localStorage cache to ensure demo data is used\",\n            );\n\n            console.log(\"Setting initialDemoData state:\", parsedDemoData);\n            setInitialDemoData(parsedDemoData);\n\n            sessionStorage.removeItem(\"billSplitterDemoData\");\n            console.log(\"Removed billSplitterDemoData from sessionStorage\");\n\n            demoDataProcessedRef.current = true;\n          } else {\n            sessionStorage.removeItem(\"billSplitterDemoData\");\n          }\n        } catch (error) {\n          console.error(\"Error parsing demo data:\", error);\n          sessionStorage.removeItem(\"billSplitterDemoData\");\n        }\n      }\n    }\n  }, []);\n\n  const handleDemoDataApplied = useCallback(() => {\n    console.log(\"Demo data processed by InvoiceForm, clearing state\");\n    setInitialDemoData(null);\n  }, []);\n\n  return {\n    initialDemoData,\n    handleDemoDataApplied,\n  };\n}\n","\"use client\";\n\nimport { Alert, AlertDescription, AlertTitle } from \"@/components/ui/alert\";\nimport { CalculationInput, CalculationResult } from \"@/lib/calculations\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Suspense, useEffect, useRef, useState } from \"react\";\n\nimport { CalculationCallbackData } from \"@/components/invoice-form\";\nimport { CalculationErrorType } from \"./invoice-form/types\";\nimport Cookies from \"js-cookie\";\nimport { GoogleAnalytics } from \"@next/third-parties/google\";\nimport { Loader2 } from \"lucide-react\";\nimport { ResultsDisplay } from \"@/components/results-display\";\nimport { SettingsModal } from \"@/components/settings-modal\";\nimport { Terminal } from \"lucide-react\";\nimport dynamic from \"next/dynamic\";\nimport { handleCalculationError } from \"./invoice-form/error-handler\";\nimport { safeText } from \"@/lib/utils\";\nimport { useDemoDataHandler } from \"./invoice-form/demo-data-handler\";\nimport { useTranslation } from \"@/translations\";\n\nconst InvoiceForm = dynamic(\n  () =>\n    import(\"@/components/invoice-form\").then((mod) => ({\n      default: mod.InvoiceForm,\n    })),\n  {\n    ssr: false,\n    loading: () => (\n      <div className=\"space-y-6 animate-pulse\">\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n          <div className=\"h-24 bg-muted/60 rounded-lg\"></div>\n          <div className=\"h-24 bg-muted/60 rounded-lg\"></div>\n        </div>\n        <div className=\"h-20 bg-muted/60 rounded-lg\"></div>\n        <div className=\"h-48 bg-muted/60 rounded-lg\"></div>\n        <div className=\"h-10 bg-muted/60 rounded-lg\"></div>\n      </div>\n    ),\n  },\n);\n\ntype InputDataForDisplay = Pick<\n  CalculationInput,\n  \"startDate\" | \"endDate\" | \"includeEndDate\" | \"amounts\" | \"splitPeriod\"\n>;\n\ninterface InvoiceCalculatorClientProps {\n  pageTitle: string;\n}\n\nexport default function InvoiceCalculatorClient({\n  pageTitle,\n}: InvoiceCalculatorClientProps) {\n  const { t } = useTranslation();\n  const [mounted, setMounted] = useState(false);\n  const [calculationResult, setCalculationResult] =\n    useState<CalculationResult | null>(null);\n  const [calculationError, setCalculationError] = useState<string | null>(null);\n  const [storedInputData, setStoredInputData] =\n    useState<CalculationCallbackData>(null);\n  const [isSettingsOpen, setIsSettingsOpen] = useState(false);\n  const resultsSectionRef = useRef<HTMLDivElement>(null);\n\n  const { initialDemoData, handleDemoDataApplied } = useDemoDataHandler();\n\n  const gaMeasurementId = \"G-9H2KTHX5YK\";\n  const consentCookieName = \"siempiBillSplitterConsent\";\n  const [hasConsent, setHasConsent] = useState(false);\n\n  useEffect(() => {\n    return () => {\n      if (typeof window !== \"undefined\") {\n        const hasDemoData =\n          sessionStorage.getItem(\"billSplitterDemoData\") !== null;\n        const hasFormCache =\n          sessionStorage.getItem(\"invoiceFormDataCache\") !== null;\n\n        try {\n          sessionStorage.removeItem(\"invoiceFormDataCache\");\n          console.log(\n            \"[InvoiceCalculatorClient] Cleaned up sessionStorage on unmount\",\n            {\n              hadDemoData: hasDemoData,\n              hadFormCache: hasFormCache,\n            },\n          );\n        } catch (error) {\n          console.error(\n            \"[InvoiceCalculatorClient] Error clearing sessionStorage on unmount:\",\n            error,\n          );\n        }\n      }\n    };\n  }, []);\n\n  useEffect(() => {\n    setMounted(true);\n    const consentGiven = Cookies.get(consentCookieName) === \"true\";\n    setHasConsent(consentGiven);\n  }, []);\n\n  const handleCalculation = (\n    formData: CalculationCallbackData,\n    results: CalculationResult | null,\n    error?: CalculationErrorType,\n  ) => {\n    setCalculationResult(results);\n    const displayError = error ? handleCalculationError({ error, t }) : null;\n    setCalculationError(displayError);\n\n    if (formData && results && !displayError) {\n      setStoredInputData(formData);\n      setTimeout(() => {\n        requestAnimationFrame(() => {\n          if (resultsSectionRef.current) {\n            resultsSectionRef.current.scrollIntoView({\n              behavior: \"smooth\",\n              block: \"start\",\n            });\n          }\n        });\n      }, 200);\n    } else {\n      setStoredInputData(null);\n      if (displayError) {\n        setCalculationResult(null);\n      }\n    }\n  };\n\n  const description1 =\n    pageTitle === \"Rechnungsperioden-Rechner\"\n      ? \"Teilen Sie Rechnungen ber Geschftsjahre auf. Konform mit IFRS, HGB und OR  keine Anmeldung, keine Datenspeicherung. Einfach, schnell, przise.\"\n      : \"Split invoices across fiscal years. Stay compliant with IFRS, HGB, and OR  no login, no data storage. Simple, fast, precise.\";\n\n  const description2 =\n    pageTitle === \"Rechnungsperioden-Rechner\"\n      ? \"Ideal fr Buchhalter bei der Erstellung von Gewinn- und Verlustrechnungen und Bilanzen, fr Finanzfachleute bei der Budgetverwaltung oder fr alle, die eine klare finanzielle Aufschlsselung fr das Reporting bentigen.\"\n      : \"Ideal for accountants preparing income statements and balance sheets, financial professionals managing budgets, or anyone needing a clear financial breakdown for reporting.\";\n\n  return (\n    <>\n      {hasConsent && gaMeasurementId && (\n        <GoogleAnalytics gaId={gaMeasurementId} />\n      )}\n\n      <div className=\"container mx-auto px-4 py-8 max-w-4xl grow overflow-hidden w-full\">\n        <div className=\"text-center mb-8\">\n          <h1 className=\"text-3xl font-bold text-center mb-4\">{pageTitle}</h1>\n          <div className=\"max-w-2xl mx-auto space-y-2 px-4\">\n            <p>{mounted ? t(\"InvoiceForm.description_p1\") : description1}</p>\n            <p>{mounted ? t(\"InvoiceForm.description_p2\") : description2}</p>\n          </div>\n        </div>\n\n        {!mounted && (\n          <div className=\"flex items-center gap-2 justify-center text-muted-foreground text-sm mb-6\">\n            <Loader2 className=\"animate-spin h-4 w-4 text-primary\" />\n            <span>Loading calculator...</span>\n          </div>\n        )}\n\n        <div className=\"mx-auto\" style={{ maxWidth: \"768px\" }}>\n          <Card\n            className=\"mb-12 shadow-md w-full transition-opacity duration-300 ease-in-out\"\n            data-loaded={mounted ? \"true\" : \"false\"}\n            style={{ opacity: mounted ? 1 : 0.85 }}\n          >\n            <CardContent className=\"pt-6\">\n              <div className=\"w-full\">\n                <Suspense\n                  fallback={\n                    <div className=\"space-y-6 animate-pulse\">\n                      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                        <div className=\"h-24 bg-muted/60 rounded-lg\"></div>\n                        <div className=\"h-24 bg-muted/60 rounded-lg\"></div>\n                      </div>\n                      <div className=\"h-20 bg-muted/60 rounded-lg\"></div>\n                      <div className=\"h-48 bg-muted/60 rounded-lg\"></div>\n                      <div className=\"h-10 bg-muted/60 rounded-lg\"></div>\n                    </div>\n                  }\n                >\n                  <InvoiceForm\n                    onCalculateAction={handleCalculation}\n                    initialDemoData={initialDemoData}\n                    onDemoDataApplied={handleDemoDataApplied}\n                  />\n                </Suspense>\n              </div>\n            </CardContent>\n          </Card>\n\n          <div ref={resultsSectionRef} className=\"mt-12 w-full\">\n            {mounted && calculationError && (\n              <Alert variant=\"destructive\" className=\"w-full\">\n                <Terminal className=\"h-4 w-4\" />\n                <AlertTitle>{t(\"Errors.calculationErrorTitle\")}</AlertTitle>\n                <AlertDescription>\n                  {safeText(calculationError)}\n                </AlertDescription>\n              </Alert>\n            )}\n            {mounted &&\n              calculationResult &&\n              storedInputData &&\n              !calculationError && (\n                <ResultsDisplay\n                  results={calculationResult}\n                  inputData={storedInputData as InputDataForDisplay}\n                />\n              )}\n            {!mounted && calculationResult === null && (\n              <Card className=\"shadow-md w-full h-64 flex items-center justify-center\">\n                <div className=\"space-y-4 p-6 w-full\">\n                  <div className=\"h-6 bg-muted/60 rounded-md animate-pulse w-3/4 mx-auto mb-8\" />\n                  <div className=\"grid grid-cols-4 gap-4 mb-6\">\n                    <div className=\"h-4 bg-muted/60 rounded-sm animate-pulse\" />\n                    <div className=\"h-4 bg-muted/60 rounded-sm animate-pulse\" />\n                    <div className=\"h-4 bg-muted/60 rounded-sm animate-pulse\" />\n                    <div className=\"h-4 bg-muted/60 rounded-sm animate-pulse\" />\n                  </div>\n                  <div className=\"h-24 bg-muted/60 rounded-md animate-pulse\" />\n                </div>\n              </Card>\n            )}\n          </div>\n        </div>\n      </div>\n\n      {mounted && (\n        <SettingsModal\n          isOpen={isSettingsOpen}\n          onOpenChange={setIsSettingsOpen}\n        />\n      )}\n    </>\n  );\n}\n","import * as React from \"react\";\n\nimport { cn } from \"@/lib/utils\";\n\ninterface InputProps extends React.ComponentProps<\"input\"> {\n  helperText?: string;\n  error?: string;\n  id?: string;\n  onDoubleClick?: (e: React.MouseEvent<HTMLInputElement>) => void;\n}\n\nfunction Input(\n  {\n    className,\n    type,\n    helperText,\n    error,\n    id,\n    onDoubleClick,\n    ...props\n  }: InputProps,\n  ref: React.Ref<HTMLInputElement>,\n) {\n  const errorId = error ? `${id}-error` : undefined;\n\n  const handleDoubleClick = (e: React.MouseEvent<HTMLInputElement>) => {\n    e.currentTarget.select();\n\n    if (onDoubleClick) {\n      onDoubleClick(e);\n    }\n  };\n\n  return (\n    <div className=\"w-full\">\n      <input\n        id={id}\n        ref={ref}\n        type={type}\n        data-slot=\"input\"\n        aria-invalid={!!error}\n        aria-describedby={errorId}\n        onDoubleClick={handleDoubleClick}\n        className={cn(\n          \"flex h-10 w-full rounded-lg border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n          \"shadow-sm\",\n          \"selection:bg-primary selection:text-primary-foreground\",\n          error\n            ? \"border-destructive ring-destructive/40 focus-visible:ring-destructive\"\n            : \"\",\n          className,\n        )}\n        {...props}\n      />\n      {helperText && (\n        <p className=\"text-xs text-muted-foreground mt-1 mb-3 pl-3\">\n          {helperText}\n        </p>\n      )}\n      {error && (\n        <p id={errorId} role=\"alert\" className=\"form-error-message\">\n          {error}\n        </p>\n      )}\n    </div>\n  );\n}\n\nconst ForwardedInput = React.forwardRef(Input);\n\nexport { ForwardedInput as Input };\n","import * as React from \"react\";\n\n/**\n * VisuallyHidden component hides its children visually but keeps them accessible to screen readers.\n */\nfunction VisuallyHidden({ children }: { children: React.ReactNode }) {\n  return (\n    <span\n      className=\"absolute w-px h-px p-0 -m-px overflow-hidden whitespace-nowrap border-0\"\n      style={{ clip: \"rect(0, 0, 0, 0)\" }}\n    >\n      {children}\n    </span>\n  );\n}\n\nexport { VisuallyHidden };\n","import * as React from \"react\";\n\nimport { VisuallyHidden } from \"@/components/ui/visually-hidden\";\n\ninterface AccessibleIconProps {\n  label: string;\n  children: React.ReactNode;\n}\n\n/**\n * AccessibleIcon component wraps an icon and provides a visually hidden label for screen readers.\n */\nfunction AccessibleIcon({ label, children }: AccessibleIconProps) {\n  return (\n    <span className=\"inline-flex items-center justify-center\">\n      {children}\n      <VisuallyHidden>{label}</VisuallyHidden>\n    </span>\n  );\n}\n\nexport { AccessibleIcon };\n","\"use client\";\n\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\";\nimport * as React from \"react\";\n\nimport { AccessibleIcon } from \"@/components/ui/accessible-icon\";\nimport { XIcon } from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\n\nfunction Dialog({\n  ...props\n}: React.ComponentProps<typeof DialogPrimitive.Root>) {\n  return <DialogPrimitive.Root data-slot=\"dialog\" {...props} />;\n}\n\nfunction DialogTrigger({\n  ...props\n}: React.ComponentProps<typeof DialogPrimitive.Trigger>) {\n  return <DialogPrimitive.Trigger data-slot=\"dialog-trigger\" {...props} />;\n}\n\nfunction DialogPortal({\n  ...props\n}: React.ComponentProps<typeof DialogPrimitive.Portal>) {\n  return <DialogPrimitive.Portal data-slot=\"dialog-portal\" {...props} />;\n}\n\nfunction DialogClose({\n  ...props\n}: React.ComponentProps<typeof DialogPrimitive.Close>) {\n  return <DialogPrimitive.Close data-slot=\"dialog-close\" {...props} />;\n}\n\nfunction DialogOverlay({\n  className,\n  ...props\n}: React.ComponentProps<typeof DialogPrimitive.Overlay>) {\n  return (\n    <DialogPrimitive.Overlay\n      data-slot=\"dialog-overlay\"\n      className={cn(\n        \"data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 backdrop-blur-sm bg-black/30\",\n        className,\n      )}\n      {...props}\n    />\n  );\n}\n\nfunction DialogContent({\n  className,\n  children,\n  ...props\n}: React.ComponentProps<typeof DialogPrimitive.Content>) {\n  const [isMounted, setIsMounted] = React.useState(false);\n  const isMountedRef = React.useRef(true);\n\n  React.useEffect(() => {\n    isMountedRef.current = true;\n    const mountTimer = setTimeout(() => {\n      if (isMountedRef.current) {\n        setIsMounted(true);\n      }\n    }, 10);\n\n    return () => {\n      isMountedRef.current = false;\n      clearTimeout(mountTimer);\n    };\n  }, []);\n\n  if (!isMounted) {\n    return null;\n  }\n\n  return (\n    <DialogPortal data-slot=\"dialog-portal\">\n      <DialogOverlay />\n      <DialogPrimitive.Content\n        data-slot=\"dialog-content\"\n        className={cn(\n          \"bg-card data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-xl duration-200 sm:max-w-lg mx-auto\",\n          className,\n        )}\n        style={{ backgroundColor: \"hsl(var(--card))\", opacity: 1 }}\n        {...props}\n      >\n        {children}\n        <DialogPrimitive.Close\n          aria-label=\"Close dialog\"\n          className=\"ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-sm opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-none disabled:pointer-events-none cursor-pointer\"\n        >\n          <AccessibleIcon label=\"Close\">\n            <XIcon className=\"size-4\" />\n          </AccessibleIcon>\n        </DialogPrimitive.Close>\n      </DialogPrimitive.Content>\n    </DialogPortal>\n  );\n}\n\nfunction DialogHeader({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"dialog-header\"\n      className={cn(\"flex flex-col gap-2 text-center sm:text-left\", className)}\n      {...props}\n    />\n  );\n}\n\nfunction DialogFooter({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"dialog-footer\"\n      className={cn(\n        \"flex flex-col-reverse gap-2 sm:flex-row sm:justify-end\",\n        className,\n      )}\n      {...props}\n    />\n  );\n}\n\nfunction DialogTitle({\n  className,\n  ...props\n}: React.ComponentProps<typeof DialogPrimitive.Title>) {\n  return (\n    <DialogPrimitive.Title\n      data-slot=\"dialog-title\"\n      className={cn(\"text-lg leading-none font-semibold\", className)}\n      {...props}\n    />\n  );\n}\n\nfunction DialogDescription({\n  className,\n  ...props\n}: React.ComponentProps<typeof DialogPrimitive.Description>) {\n  return (\n    <DialogPrimitive.Description\n      data-slot=\"dialog-description\"\n      className={cn(\"text-muted-foreground text-sm\", className)}\n      {...props}\n    />\n  );\n}\n\nexport {\n  Dialog,\n  DialogClose,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogOverlay,\n  DialogPortal,\n  DialogTitle,\n  DialogTrigger,\n};\n","import * as React from \"react\";\n\nimport { cn } from \"@/lib/utils\";\n\nfunction Card({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"card\"\n      className={cn(\n        \"bg-card text-card-foreground flex flex-col gap-6 rounded-lg border py-6 shadow-sm\",\n        className,\n      )}\n      {...props}\n    />\n  );\n}\n\nfunction CardHeader({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"card-header\"\n      className={cn(\n        \"@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-2 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6\",\n        className,\n      )}\n      {...props}\n    />\n  );\n}\n\nfunction CardTitle({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"card-title\"\n      className={cn(\"leading-none font-semibold\", className)}\n      {...props}\n    />\n  );\n}\n\nfunction CardDescription({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"card-description\"\n      className={cn(\"text-muted-foreground text-sm\", className)}\n      {...props}\n    />\n  );\n}\n\nfunction CardAction({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"card-action\"\n      className={cn(\n        \"col-start-2 row-span-2 row-start-1 self-start justify-self-end\",\n        className,\n      )}\n      {...props}\n    />\n  );\n}\n\nfunction CardContent({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"card-content\"\n      className={cn(\"px-6\", className)}\n      {...props}\n    />\n  );\n}\n\nfunction CardFooter({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"card-footer\"\n      className={cn(\"flex items-center px-6 [.border-t]:pt-6\", className)}\n      {...props}\n    />\n  );\n}\n\nexport {\n  Card,\n  CardHeader,\n  CardFooter,\n  CardTitle,\n  CardAction,\n  CardDescription,\n  CardContent,\n};\n","// Add ESLint disable comments for unused imports that are kept for future use\n\nimport {\n  CalculationError,\n  CalculationProcessingError,\n  ERROR_CODES,\n  InputValidationError,\n} from \"./errors\";\nimport {\n  addDays,\n  differenceInDays,\n  endOfMonth,\n  endOfQuarter,\n  endOfYear,\n  format,\n  getQuarter,\n  getYear,\n  startOfDay,\n} from \"date-fns\";\n\n// Re-export error types so they can be imported from calculations.ts\nexport {\n  CalculationError,\n  CalculationProcessingError,\n  InputValidationError,\n  ERROR_CODES,\n} from \"./errors\";\n\n// Helper function for rounding to a specific number of decimal places\nfunction round(value: number, decimals: number): number {\n  return Number(Math.round(Number(value + \"e\" + decimals)) + \"e-\" + decimals);\n}\n\n// Updated Input: Accepts an array of amounts and split period type\nexport interface CalculationInput {\n  startDate: Date;\n  endDate: Date;\n  includeEndDate: boolean;\n  amounts: number[]; // Array of amounts to be summed and split\n  splitPeriod?: \"yearly\" | \"quarterly\" | \"monthly\"; // Replaced daily with monthly\n}\n\n// Represents the split portion of a SINGLE original amount for a specific period (year, quarter, or day)\ninterface SingleAmountPeriodSplit {\n  splitAmount: number; // Rounded split portion for this period\n}\n\n// Represents the split results for ONE original input amount across all periods\nexport interface AmountSplitResult {\n  originalAmount: number;\n  adjustedTotalAmount: number; // Sum of splits for this amount after adjustment\n  splits: { [periodIdentifier: string]: SingleAmountPeriodSplit }; // Map period identifier (YYYY, YYYY-Qn, YYYY-MM) to its split portion\n}\n\n// Represents the aggregated results per period across ALL input amounts\nexport interface AggregatedPeriodSplit {\n  periodIdentifier: string; // YYYY, YYYY-Qn, or YYYY-MM\n  daysInPeriod: number;\n  proportion: number;\n  totalSplitAmount: number; // Sum of all individual amount splits for this period\n  year?: number; // For backwards compatibility with tests\n  daysInYear?: number; // For backwards compatibility with tests\n}\n\n// Updated CalculationResult structure\nexport interface CalculationResult {\n  totalDays: number;\n  originalTotalAmount: number; // Sum of all input amounts\n  adjustedTotalAmount: number; // Sum of all adjusted split amounts\n  resultsPerAmount: AmountSplitResult[]; // Detailed results for each input amount\n  aggregatedSplits: AggregatedPeriodSplit[]; // Aggregated results per period\n  calculationSteps: CalculationStepDetails;\n  splitPeriodUsed: \"yearly\" | \"quarterly\" | \"monthly\"; // Replaced daily with monthly\n}\n\n// --- Helper for structuring calculation steps ---\nexport interface CalculationStepDetails {\n  totalDuration: {\n    days: number;\n    start: string;\n    end: string;\n    included: boolean;\n  };\n  periodSegments: {\n    periodIdentifier: string;\n    days: number;\n    proportion: number;\n  }[]; // Renamed from yearSegments\n  amountCalculations: {\n    originalAmount: number;\n    periodSplits: {\n      // Renamed from yearSplits\n      periodIdentifier: string;\n      rawSplit: number;\n      roundedSplit: number;\n      adjustment: number;\n    }[];\n    adjustmentAppliedToPeriod?: string; // Renamed from adjustmentAppliedToYear\n    discrepancy: number;\n    finalSum: number;\n  }[];\n  error?: string | CalculationError;\n}\n// --- End Helper ---\n\n// New return types for calculateInvoiceSplit\ninterface CalculateInvoiceSplitSuccess\n  extends Omit<CalculationResult, \"calculationSteps\"> {\n  success: true;\n  calculationSteps: Omit<CalculationStepDetails, \"error\"> & {\n    error?: undefined;\n  };\n}\n\ninterface CalculateInvoiceSplitFailure {\n  success: false;\n  error: CalculationError;\n  calculationSteps: CalculationStepDetails; // Contains the error details\n  originalTotalAmount: number;\n  splitPeriodUsed: \"yearly\" | \"quarterly\" | \"monthly\";\n  // Minimal fields for consistency with createErrorResult's context\n  totalDays: 0;\n  adjustedTotalAmount: 0;\n  resultsPerAmount: [];\n  aggregatedSplits: [];\n}\n\nexport type CalculateInvoiceSplitReturnType =\n  | CalculateInvoiceSplitSuccess\n  | CalculateInvoiceSplitFailure;\n\n// Helper function to get the end of the next period based on the type\nfunction getNextPeriodBoundary(\n  currentDate: Date,\n  periodType: \"yearly\" | \"quarterly\" | \"monthly\",\n): Date {\n  switch (periodType) {\n    case \"monthly\":\n      return startOfDay(addDays(endOfMonth(currentDate), 1));\n    case \"quarterly\":\n      return startOfDay(addDays(endOfQuarter(currentDate), 1));\n    case \"yearly\":\n    default:\n      return startOfDay(addDays(endOfYear(currentDate), 1));\n  }\n}\n\n// Helper function to generate a period identifier string\nfunction getPeriodIdentifier(\n  date: Date,\n  periodType: \"yearly\" | \"quarterly\" | \"monthly\",\n): string {\n  const year = getYear(date);\n  switch (periodType) {\n    case \"monthly\":\n      return format(date, \"yyyy-MM\");\n    case \"quarterly\":\n      const quarter = getQuarter(date);\n      return `${year}-Q${quarter}`;\n    case \"yearly\":\n    default:\n      return year.toString();\n  }\n}\n\n/**\n * Calculates the proportional split of invoice amounts across specified periods.\n * Applies rounding and adjustment for precision.\n *\n * @throws {InputValidationError} When input data is invalid\n * @throws {CalculationProcessingError} When calculation can't be completed successfully\n */\nexport function calculateInvoiceSplit(\n  input: CalculationInput,\n): CalculateInvoiceSplitReturnType {\n  const splitPeriod = input.splitPeriod || \"yearly\"; // Default to yearly if not provided\n  const calcSteps: CalculationStepDetails = {\n    totalDuration: {\n      days: 0,\n      start: \"\",\n      end: \"\",\n      included: input.includeEndDate,\n    },\n    periodSegments: [], // Renamed\n    amountCalculations: [],\n  };\n\n  // Validate inputs with clear error messages\n  if (!input.amounts || input.amounts.length === 0) {\n    const error = new InputValidationError(\n      \"At least one invoice amount is required.\",\n      ERROR_CODES.NO_AMOUNTS,\n    );\n    calcSteps.error = error;\n    return {\n      success: false,\n      error: error,\n      calculationSteps: calcSteps,\n      originalTotalAmount: 0, // No amounts processed yet\n      splitPeriodUsed: splitPeriod,\n      totalDays: 0,\n      adjustedTotalAmount: 0,\n      resultsPerAmount: [],\n      aggregatedSplits: [],\n    };\n  }\n\n  if (input.amounts.some((a) => isNaN(a) || a === null || a <= 0)) {\n    const invalidAmounts = input.amounts.filter(\n      (a) => isNaN(a) || a === null || a <= 0,\n    );\n    const error = new InputValidationError(\n      \"All amounts must be valid positive numbers.\",\n      ERROR_CODES.INVALID_AMOUNT,\n      { invalidAmounts },\n    );\n    calcSteps.error = error;\n    return {\n      success: false,\n      error: error,\n      calculationSteps: calcSteps,\n      originalTotalAmount: 0, // Or sum of amounts if calculated before this check\n      splitPeriodUsed: splitPeriod,\n      totalDays: 0,\n      adjustedTotalAmount: 0,\n      resultsPerAmount: [],\n      aggregatedSplits: [],\n    };\n  }\n\n  const originalTotalAmount = round(\n    input.amounts.reduce((sum, a) => sum + a, 0),\n    2,\n  );\n\n  // Start date and end date validation\n  if (\n    !input.startDate ||\n    !input.endDate ||\n    !(input.startDate instanceof Date) ||\n    !(input.endDate instanceof Date)\n  ) {\n    const error = new InputValidationError(\n      \"Valid start and end dates are required.\",\n      ERROR_CODES.INVALID_DATES,\n      { startDate: input.startDate, endDate: input.endDate },\n    );\n    calcSteps.error = error;\n    return {\n      success: false,\n      error: error,\n      calculationSteps: calcSteps,\n      originalTotalAmount: originalTotalAmount,\n      splitPeriodUsed: splitPeriod,\n      totalDays: 0,\n      adjustedTotalAmount: 0,\n      resultsPerAmount: [],\n      aggregatedSplits: [],\n    };\n  }\n\n  const cleanStartDate = startOfDay(input.startDate);\n  let cleanEffectiveEndDate = startOfDay(input.endDate);\n  if (input.includeEndDate) {\n    cleanEffectiveEndDate = addDays(cleanEffectiveEndDate, 1);\n  }\n  calcSteps.totalDuration.start = format(cleanStartDate, \"yyyy-MM-dd\");\n  // Use original end date for display if included, otherwise the day before effective end\n  calcSteps.totalDuration.end = format(\n    input.includeEndDate ? input.endDate : addDays(cleanEffectiveEndDate, -1),\n    \"yyyy-MM-dd\",\n  );\n\n  if (cleanStartDate >= cleanEffectiveEndDate) {\n    const error = new InputValidationError(\n      \"Start date must be before the end date.\",\n      ERROR_CODES.END_BEFORE_START,\n      {\n        startDate: format(cleanStartDate, \"yyyy-MM-dd\"),\n        endDate: format(cleanEffectiveEndDate, \"yyyy-MM-dd\"),\n        includeEndDate: input.includeEndDate,\n      },\n    );\n    calcSteps.error = error;\n    return {\n      success: false,\n      error: error,\n      calculationSteps: calcSteps,\n      originalTotalAmount: originalTotalAmount,\n      splitPeriodUsed: splitPeriod,\n      totalDays: 0,\n      adjustedTotalAmount: 0,\n      resultsPerAmount: [],\n      aggregatedSplits: [],\n    };\n  }\n\n  const totalDurationDays = differenceInDays(\n    cleanEffectiveEndDate,\n    cleanStartDate,\n  );\n  calcSteps.totalDuration.days = totalDurationDays;\n\n  if (totalDurationDays <= 0) {\n    const error = new InputValidationError(\n      \"The date range must result in a positive duration.\",\n      ERROR_CODES.ZERO_DURATION,\n      {\n        startDate: format(cleanStartDate, \"yyyy-MM-dd\"),\n        endDate: format(cleanEffectiveEndDate, \"yyyy-MM-dd\"),\n        calculatedDays: totalDurationDays,\n      },\n    );\n    calcSteps.error = error;\n    return {\n      success: false,\n      error: error,\n      calculationSteps: calcSteps,\n      originalTotalAmount: originalTotalAmount,\n      splitPeriodUsed: splitPeriod,\n      totalDays: 0,\n      adjustedTotalAmount: 0,\n      resultsPerAmount: [],\n      aggregatedSplits: [],\n    };\n  }\n\n  try {\n    // --- Calculate days and proportions per period segment ---\n    const periodSegmentMap: {\n      [periodIdentifier: string]: { days: number; proportion: number };\n    } = {};\n    let currentDate = cleanStartDate;\n    while (currentDate < cleanEffectiveEndDate) {\n      const periodIdentifier = getPeriodIdentifier(currentDate, splitPeriod);\n      const nextPeriodBoundary = getNextPeriodBoundary(\n        currentDate,\n        splitPeriod,\n      );\n      const segmentEndDate =\n        cleanEffectiveEndDate < nextPeriodBoundary\n          ? cleanEffectiveEndDate\n          : nextPeriodBoundary;\n      const daysInSegment = differenceInDays(segmentEndDate, currentDate);\n\n      if (daysInSegment > 0) {\n        const proportion = daysInSegment / totalDurationDays;\n        if (!periodSegmentMap[periodIdentifier]) {\n          periodSegmentMap[periodIdentifier] = { days: 0, proportion: 0 };\n        }\n        periodSegmentMap[periodIdentifier].days += daysInSegment;\n        periodSegmentMap[periodIdentifier].proportion += proportion;\n      }\n      currentDate = segmentEndDate;\n    }\n    // Store period segment details for calculation steps display\n    calcSteps.periodSegments = Object.entries(periodSegmentMap)\n      .map(([identifier, data]) => ({\n        periodIdentifier: identifier,\n        days: data.days,\n        proportion: data.proportion,\n      }))\n      // Custom sort needed: Year > Quarter > Month\n      .sort((a, b) => {\n        // Sort YYYY, YYYY-Qn, YYYY-MM correctly\n        return a.periodIdentifier.localeCompare(b.periodIdentifier);\n      });\n    // --- End Segment Calculation ---\n\n    const resultsPerAmount: AmountSplitResult[] = [];\n\n    // --- Process each amount individually ---\n    for (const amount of input.amounts) {\n      const amountCalcStep: CalculationStepDetails[\"amountCalculations\"][0] = {\n        originalAmount: amount,\n        periodSplits: [], // Renamed\n        discrepancy: 0,\n        finalSum: 0,\n      };\n\n      const rawSplits: { periodIdentifier: string; rawSplit: number }[] = [];\n      for (const identifier in periodSegmentMap) {\n        const segment = periodSegmentMap[identifier];\n        const rawSplitAmount = amount * segment.proportion;\n        rawSplits.push({\n          periodIdentifier: identifier,\n          rawSplit: rawSplitAmount,\n        });\n        amountCalcStep.periodSplits.push({\n          periodIdentifier: identifier,\n          rawSplit: rawSplitAmount,\n          roundedSplit: 0,\n          adjustment: 0,\n        }); // Initialize step details\n      }\n\n      // Round initial splits for this amount\n      const roundedSplits = rawSplits.map((split) => ({\n        ...split,\n        roundedSplit: round(split.rawSplit, 2),\n      }));\n\n      // Update steps with rounded values\n      roundedSplits.forEach((rs) => {\n        const step = amountCalcStep.periodSplits.find(\n          (s) => s.periodIdentifier === rs.periodIdentifier,\n        );\n        if (step) step.roundedSplit = rs.roundedSplit;\n      });\n\n      // Calculate discrepancy for this amount\n      const currentTotal = round(\n        roundedSplits.reduce((sum, s) => sum + s.roundedSplit, 0),\n        2,\n      );\n      const discrepancy = round(amount - currentTotal, 2);\n      amountCalcStep.discrepancy = discrepancy;\n\n      // Apply rounding adjustment to the period with the largest raw amount\n      if (discrepancy !== 0 && roundedSplits.length > 0) {\n        // Find the period with the max *raw* split amount to minimize impact of rounding intermediate values\n        const periodToAdjustDetails = rawSplits.reduce((max, current) =>\n          Math.abs(current.rawSplit) > Math.abs(max.rawSplit) ? current : max,\n        );\n        const periodIdentifierToAdjust = periodToAdjustDetails.periodIdentifier;\n\n        // Find the corresponding entry in roundedSplits to apply the adjustment\n        const splitToAdjust = roundedSplits.find(\n          (s) => s.periodIdentifier === periodIdentifierToAdjust,\n        );\n        if (splitToAdjust) {\n          splitToAdjust.roundedSplit = round(\n            splitToAdjust.roundedSplit + discrepancy,\n            2,\n          );\n\n          // Update calculation steps with the adjustment detail\n          const step = amountCalcStep.periodSplits.find(\n            (s) => s.periodIdentifier === periodIdentifierToAdjust,\n          );\n          if (step) {\n            step.roundedSplit = splitToAdjust.roundedSplit; // Ensure step reflects adjusted rounded value\n            step.adjustment = discrepancy;\n          }\n          amountCalcStep.adjustmentAppliedToPeriod = periodIdentifierToAdjust;\n        } else {\n          throw new CalculationProcessingError(\n            \"Calculation error: Unable to apply rounding adjustment.\",\n            ERROR_CODES.ROUNDING_ERROR,\n            { discrepancy, periodToAdjust: periodIdentifierToAdjust },\n          );\n        }\n      }\n\n      // Store final splits for this amount\n      const finalAmountSplits: {\n        [periodIdentifier: string]: SingleAmountPeriodSplit;\n      } = {};\n      roundedSplits.forEach((s) => {\n        finalAmountSplits[s.periodIdentifier] = { splitAmount: s.roundedSplit };\n      });\n\n      const adjustedTotalForThisAmount = round(\n        roundedSplits.reduce((sum, s) => sum + s.roundedSplit, 0),\n        2,\n      );\n      amountCalcStep.finalSum = adjustedTotalForThisAmount;\n\n      resultsPerAmount.push({\n        originalAmount: amount,\n        adjustedTotalAmount: adjustedTotalForThisAmount,\n        splits: finalAmountSplits,\n      });\n      calcSteps.amountCalculations.push(amountCalcStep);\n    }\n    // --- End Amount Processing ---\n\n    // --- Aggregate results per period ---\n    const aggregatedSplits: AggregatedPeriodSplit[] = Object.entries(\n      periodSegmentMap,\n    )\n      .map(([identifier, segment]) => {\n        const periodIdentifier = identifier;\n        let totalSplitForPeriod = 0;\n        resultsPerAmount.forEach((amountResult) => {\n          totalSplitForPeriod +=\n            amountResult.splits[periodIdentifier]?.splitAmount || 0;\n        });\n        \n        // Extract year from periodIdentifier (format is YYYY, YYYY-Qn, or YYYY-MM)\n        const yearString = periodIdentifier.split(\"-\")[0];\n        const year = parseInt(yearString, 10);\n        \n        return {\n          periodIdentifier: periodIdentifier,\n          daysInPeriod: segment.days,\n          proportion: segment.proportion,\n          totalSplitAmount: round(totalSplitForPeriod, 2),\n          year: year, // For backward compatibility with tests\n          daysInYear: segment.days, // For backward compatibility with tests\n        };\n      })\n      // Use the same sort as periodSegments\n      .sort((a, b) => a.periodIdentifier.localeCompare(b.periodIdentifier));\n    // --- End Aggregation ---\n\n    const finalAdjustedTotalAmount = round(\n      aggregatedSplits.reduce((sum, s) => sum + s.totalSplitAmount, 0),\n      2,\n    );\n\n    // Final sanity check: does adjusted total match original total?\n    const finalDiscrepancy = round(\n      originalTotalAmount - finalAdjustedTotalAmount,\n      2,\n    );\n    if (Math.abs(finalDiscrepancy) > 0.01 * input.amounts.length) {\n      // Allow small tolerance per amount\n      console.warn(\n        `Potential rounding discrepancy: Original ${originalTotalAmount}, Adjusted ${finalAdjustedTotalAmount}, Diff ${finalDiscrepancy}`,\n      );\n      // Do not throw here, but we could add a warning to the result\n    }\n\n    // MODIFIED: Ensure calcSteps.error is undefined for success case\n    const successCalcSteps: Omit<CalculationStepDetails, \"error\"> & {\n      error?: undefined;\n    } = { ...calcSteps, error: undefined };\n\n    return {\n      success: true,\n      totalDays: totalDurationDays,\n      originalTotalAmount: originalTotalAmount,\n      adjustedTotalAmount: finalAdjustedTotalAmount,\n      resultsPerAmount: resultsPerAmount,\n      aggregatedSplits: aggregatedSplits,\n      calculationSteps: successCalcSteps,\n      splitPeriodUsed: splitPeriod,\n    };\n  } catch (error) {\n    // Handle unexpected errors or re-throw known errors\n    let caughtError: CalculationError;\n    if (error instanceof CalculationError) {\n      caughtError = error;\n    } else {\n      // Convert unknown errors to CalculationError\n      caughtError = new CalculationProcessingError(\n        error instanceof Error\n          ? error.message\n          : \"An unexpected error occurred during calculation.\",\n        ERROR_CODES.UNEXPECTED_ERROR,\n        { originalError: error },\n      );\n    }\n    calcSteps.error = caughtError; // Ensure calcSteps has the error for the failure object\n\n    // MODIFIED: Return CalculateInvoiceSplitFailure\n    return {\n      success: false,\n      error: caughtError,\n      calculationSteps: calcSteps,\n      originalTotalAmount: originalTotalAmount,\n      splitPeriodUsed: splitPeriod,\n      totalDays: 0,\n      adjustedTotalAmount: 0,\n      resultsPerAmount: [],\n      aggregatedSplits: [],\n    };\n  }\n}\n","\"use client\";\n\nimport * as React from \"react\";\nimport * as LabelPrimitive from \"@radix-ui/react-label\";\n\nimport { cn } from \"@/lib/utils\";\n\nfunction Label({\n  className,\n  ...props\n}: React.ComponentProps<typeof LabelPrimitive.Root>) {\n  return (\n    <LabelPrimitive.Root\n      data-slot=\"label\"\n      className={cn(\n        \"flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50\",\n        className,\n      )}\n      {...props}\n    />\n  );\n}\n\nexport { Label };\n","\"use client\";\n\nimport * as React from \"react\";\nimport * as LabelPrimitive from \"@radix-ui/react-label\";\nimport { Slot } from \"@radix-ui/react-slot\";\nimport {\n  Controller,\n  FormProvider,\n  useFormContext,\n  useFormState,\n  type ControllerProps,\n  type FieldPath,\n  type FieldValues,\n} from \"react-hook-form\";\n\nimport { cn } from \"@/lib/utils\";\nimport { Label } from \"@/components/ui/label\";\n\nexport const Form = FormProvider;\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>,\n> = {\n  name: TName;\n};\n\nexport const FormFieldContext = React.createContext<FormFieldContextValue>(\n  {} as FormFieldContextValue,\n);\n\nexport const FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>,\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  );\n};\n\nexport const useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext);\n  const itemContext = React.useContext(FormItemContext);\n  const { getFieldState } = useFormContext();\n  const formState = useFormState({ name: fieldContext.name });\n  const fieldState = getFieldState(fieldContext.name, formState);\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\");\n  }\n\n  const { id } = itemContext;\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  };\n};\n\ntype FormItemContextValue = {\n  id: string;\n};\n\nexport const FormItemContext = React.createContext<FormItemContextValue>(\n  {} as FormItemContextValue,\n);\n\nexport function FormItem({ className, ...props }: React.ComponentProps<\"div\">) {\n  const id = React.useId();\n\n  return (\n    <FormItemContext.Provider value={{ id }}>\n      <div\n        data-slot=\"form-item\"\n        className={cn(\"grid gap-2\", className)}\n        {...props}\n      />\n    </FormItemContext.Provider>\n  );\n}\n\nfunction FormLabelInternal({\n  fieldContext,\n  itemContext,\n  className,\n  htmlFor: explicitHtmlFor,\n  ...props\n}: React.ComponentProps<typeof LabelPrimitive.Root> & {\n  fieldContext: FormFieldContextValue;\n  itemContext: FormItemContextValue;\n  htmlFor?: string;\n}) {\n  const { getFieldState } = useFormContext();\n  const formState = useFormState({ name: fieldContext.name });\n  const fieldState = getFieldState(fieldContext.name, formState);\n\n  const formItemId = `${itemContext.id}-form-item`;\n  const hasError = !!fieldState.error;\n  const derivedHtmlFor = explicitHtmlFor || formItemId;\n\n  return (\n    <Label\n      data-slot=\"form-label\"\n      data-error={hasError}\n      className={cn(\"data-[error=true]:text-destructive\", className)}\n      htmlFor={derivedHtmlFor}\n      {...props}\n    />\n  );\n}\n\nexport function FormLabel({\n  className,\n  htmlFor,\n  ...props\n}: React.ComponentProps<typeof LabelPrimitive.Root>) {\n  const fieldContext = React.useContext(FormFieldContext);\n  const itemContext = React.useContext(FormItemContext);\n\n  const hasContext =\n    fieldContext &&\n    Object.keys(fieldContext).length > 0 &&\n    itemContext &&\n    itemContext.id;\n\n  if (hasContext) {\n    return (\n      <FormLabelInternal\n        fieldContext={fieldContext}\n        itemContext={itemContext}\n        className={className}\n        htmlFor={htmlFor}\n        {...props}\n      />\n    );\n  }\n\n  return (\n    <Label\n      data-slot=\"form-label\"\n      data-error={false}\n      className={cn(\"data-[error=true]:text-destructive\", className)}\n      htmlFor={htmlFor}\n      {...props}\n    />\n  );\n}\n\nexport function FormControl({ ...props }: React.ComponentProps<typeof Slot>) {\n  const { error, formItemId, formDescriptionId, formMessageId } =\n    useFormField();\n\n  return (\n    <Slot\n      data-slot=\"form-control\"\n      id={formItemId}\n      aria-describedby={\n        !error\n          ? `${formDescriptionId}`\n          : `${formDescriptionId} ${formMessageId}`\n      }\n      aria-invalid={!!error}\n      {...props}\n    />\n  );\n}\n\nexport function FormDescription({\n  className,\n  ...props\n}: React.ComponentProps<\"p\">) {\n  const { formDescriptionId } = useFormField();\n\n  return (\n    <p\n      data-slot=\"form-description\"\n      id={formDescriptionId}\n      className={cn(\"text-muted-foreground text-sm\", className)}\n      {...props}\n    />\n  );\n}\n\nexport function FormMessage({\n  className,\n  ...props\n}: React.ComponentProps<\"p\">) {\n  const { error, formMessageId } = useFormField();\n  const body = error ? String(error?.message ?? \"\") : props.children;\n\n  if (!body) {\n    return null;\n  }\n\n  return (\n    <p\n      data-slot=\"form-message\"\n      id={formMessageId}\n      className={cn(\"form-error-message\", className)}\n      {...props}\n    >\n      {body}\n    </p>\n  );\n}\n","\"use client\";\n\nexport {\n  useFormField,\n  Form,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormDescription,\n  FormMessage,\n  FormField,\n} from \"./form-components\";\n","/**\n * Custom error classes for the application\n * These classes provide structured error handling with error codes and categorization\n */\n\n/**\n * Base calculation error class that all specific calculation errors inherit from\n */\nexport class CalculationError extends Error {\n  code: string;\n  category: \"input\" | \"calculation\" | \"system\";\n  details?: Record<string, unknown>;\n\n  constructor(\n    message: string,\n    code: string,\n    category: \"input\" | \"calculation\" | \"system\" = \"calculation\",\n    details?: Record<string, unknown>,\n  ) {\n    super(message);\n    this.name = \"CalculationError\";\n    this.code = code;\n    this.category = category;\n    this.details = details;\n\n    // This is needed for instanceof to work properly with custom errors\n    Object.setPrototypeOf(this, CalculationError.prototype);\n  }\n}\n\n/**\n * Error for invalid input data\n */\nexport class InputValidationError extends CalculationError {\n  constructor(\n    message: string,\n    code: string,\n    details?: Record<string, unknown>,\n  ) {\n    super(message, code, \"input\", details);\n    this.name = \"InputValidationError\";\n\n    // This is needed for instanceof to work properly with custom errors\n    Object.setPrototypeOf(this, InputValidationError.prototype);\n  }\n}\n\n/**\n * Error that occurs during calculation processing\n */\nexport class CalculationProcessingError extends CalculationError {\n  constructor(\n    message: string,\n    code: string,\n    details?: Record<string, unknown>,\n  ) {\n    super(message, code, \"calculation\", details);\n    this.name = \"CalculationProcessingError\";\n\n    // This is needed for instanceof to work properly with custom errors\n    Object.setPrototypeOf(this, CalculationProcessingError.prototype);\n  }\n}\n\n/**\n * System-level errors (unexpected failures)\n */\nexport class SystemError extends CalculationError {\n  constructor(\n    message: string,\n    code: string,\n    details?: Record<string, unknown>,\n  ) {\n    super(message, code, \"system\", details);\n    this.name = \"SystemError\";\n\n    // This is needed for instanceof to work properly with custom errors\n    Object.setPrototypeOf(this, SystemError.prototype);\n  }\n}\n\n// Error codes for consistent identification\nexport const ERROR_CODES = {\n  // Input validation error codes\n  NO_AMOUNTS: \"ERR_NO_AMOUNTS\",\n  INVALID_AMOUNT: \"ERR_INVALID_AMOUNT\",\n  INVALID_DATES: \"ERR_INVALID_DATES\",\n  END_BEFORE_START: \"ERR_END_BEFORE_START\",\n  ZERO_DURATION: \"ERR_ZERO_DURATION\",\n\n  // Calculation processing error codes\n  ROUNDING_ERROR: \"ERR_ROUNDING\",\n  PERIOD_ALLOCATION_ERROR: \"ERR_PERIOD_ALLOCATION\",\n\n  // System error codes\n  UNEXPECTED_ERROR: \"ERR_UNEXPECTED\",\n};\n","\"use client\";\n\nimport { Loader2 } from \"lucide-react\";\nimport React from \"react\";\nimport { useTranslation } from \"@/translations\";\n\nexport default function Loading() {\n  const { t } = useTranslation();\n\n  return (\n    <div className=\"flex items-center gap-2 justify-center text-muted-foreground text-sm py-6\">\n      <Loader2 className=\"animate-spin h-4 w-4 text-primary\" />\n      <span>{t(\"General.loading\", \"Loading calculator...\")}</span>\n    </div>\n  );\n}\n"],"names":["defaultSettings","decimalPlaces","roundingPrecision","thousandsSeparator","SettingsContext","createContext","undefined","SettingsProvider","children","settings","setSettings","useState","loadedSettings","localStorage","getItem","initialSettings","JSON","parse","locale","isLoaded","setIsLoaded","useEffect","savedSettings","parsed","includes","prev","warn","removeItem","error","console","Provider","value","saveSettings","newSettings","cleanSettings","updatedSettings","setItem","stringify","useSettings","context","useContext","createUTCDate","dateStr","Date","parseDate","formats","date","isValid","format","formatPattern","parsedDate","formatDateForDisplay","dateObj","Intl","DateTimeFormat","year","month","day","timeZone","match","toISOString","split","AppSeoContent","mounted","setMounted","pathname","usePathname","isAppPage","isGerman","div","className","script","type","dangerouslySetInnerHTML","__html","name","applicationCategory","operatingSystem","offers","price","priceCurrency","description","Accordion","props","AccordionPrimitive","data-slot","AccordionItem","cn","AccordionTrigger","ChevronDownIcon","AccordionContent","buttonVariants","cva","variants","variant","default","destructive","outline","secondary","ghost","link","size","sm","lg","icon","defaultVariants","Button","asChild","Comp","Slot","Select","SelectPrimitive","SelectValue","SelectTrigger","id","data-size","SelectContent","position","style","backgroundColor","opacity","sideOffset","avoidCollisions","collisionPadding","SelectScrollUpButton","SelectScrollDownButton","SelectItem","key","restProps","span","CheckIcon","ChevronUpIcon","alertVariants","Alert","role","AlertTitle","AlertDescription","Table","table","TableHeader","thead","TableBody","tbody","TableFooter","tfoot","TableRow","tr","TableHead","th","TableCell","td","formatNumber","NumberFormat","minimumFractionDigits","maximumFractionDigits","toFixed","formatDateLocale","dateInput","formatPercent","getPeriodHeader","splitPeriodUsed","t","formatNumForDisplay","formatPctForDisplay","formatPeriodIdForDisplay","periodType","identifier","parseInt","de","enUS","CalculationStepsDisplay","steps","i18n","useTranslation","currentLocale","language","errorMessage","message","p","periodSegments","amountCalculations","fmtNum","num","fmtPeriod","fmtDate","fmtPct","val","section","h4","totalDuration","start","end","days","included","map","seg","periodIdentifier","proportion","amtCalc","index","originalAmount","periodSplits","ps","periodIndex","length","find","s","rawSplit","roundedSplit","adjustment","Math","abs","discrepancy","adjustmentAppliedToPeriod","defaultValue","finalSum","FormSchema","z","nonempty","LocaleSelect","form","FormField","control","render","field","FormItem","FormLabel","onValueChange","onChange","FormControl","placeholder","FormDescription","FormMessage","NumberField","label","Input","required","SeparatorSelect","currentSeparator","DEFAULT_SEPARATOR","SettingsModal","isOpen","externalIsOpen","onOpenChange","externalOnOpenChange","internalIsOpen","setInternalIsOpen","isMounted","setIsMounted","setIsValid","useForm","resolver","zodResolver","defaultValues","toString","mode","reset","subscription","watch","hasErrors","Object","keys","formState","errors","formValues","getValues","isDecimalEmpty","unsubscribe","triggerLabel","dialogTitle","dialogDescription","saveLabel","cancelLabel","onClick","aria-label","Settings","Dialog","open","handleOpenChange","DialogContent","DialogHeader","DialogTitle","UiDialogDescription","Form","onSubmit","handleSubmit","decimalPlacesResult","validateDecimalPlaces","Number","isNaN","valid","data","setError","roundingPrecisionResult","validateRoundingPrecision","normalized","replace","newLocale","window","dispatchEvent","CustomEvent","detail","DialogFooter","DialogClose","disabled","exportToExcel","results","inputData","totalInputAmount","totalDurationDays","totalAggregatedAmount","XLSX","workbook","utils","book_new","consolidatedData","push","startDate","endDate","includeEndDate","aggregatedSplits","forEach","daysInPeriod","totalSplitAmount","calculationSteps","segment","formattedProportion","toLocaleString","i","periodSeg","consolidatedSheet","aoa_to_sheet","allocationTableEndRow","allocationTableStartRow","R","propCellRef","encode_cell","c","r","amtCellRef","repeat","book_append_sheet","filename","writeFile","exportToPdf","jsPDF","autoTable","Promise","all","doc","yPos","text","tableRowsData","head","body","foot","startY","theme","headStyles","fillColor","getComputedStyle","document","documentElement","getPropertyValue","trim","v","parseFloat","filter","_","footStyles","textColor","reduce","sum","fontStyle","didParseCell","column","cell","styles","halign","lastAutoTable","finalY","setFontSize","internal","pageSize","height","addPage","pageCount","getNumberOfPages","setPage","width","save","ResultsDisplayComponent","isSettingsOpen","setIsSettingsOpen","splitPeriod","amounts","Card","CardContent","h3","button","svg","xmlns","viewBox","fill","stroke","strokeWidth","strokeLinecap","strokeLinejoin","path","d","circle","cx","cy","collapsible","handleExportExcel","catch","alert","polyline","points","line","x1","y1","x2","y2","handleExportPdf","ResultsDisplay","InvoiceForm","dynamic","then","mod","ssr","loading","InvoiceCalculatorClient","pageTitle","calculationResult","setCalculationResult","calculationError","setCalculationError","storedInputData","setStoredInputData","resultsSectionRef","useRef","initialDemoData","handleDemoDataApplied","useDemoDataHandler","setInitialDemoData","demoDataProcessedRef","current","demoDataString","sessionStorage","log","parsedDemoData","isDemo","useCallback","gaMeasurementId","hasConsent","setHasConsent","hasDemoData","hasFormCache","hadDemoData","hadFormCache","Cookies","consentGiven","get","GoogleAnalytics","gaId","h1","description1","description2","Loader2","maxWidth","data-loaded","Suspense","fallback","onCalculateAction","handleCalculation","displayError","handleCalculationError","baseErrorTitle","InputValidationError","code","ERROR_CODES","NO_AMOUNTS","INVALID_AMOUNT","END_BEFORE_START","INVALID_DATES","ZERO_DURATION","details","CalculationError","category","Error","stringifiedError","formData","setTimeout","requestAnimationFrame","scrollIntoView","behavior","block","onDemoDataApplied","ref","Terminal","safeText","ForwardedInput","React","helperText","onDoubleClick","errorId","input","aria-invalid","aria-describedby","e","handleDoubleClick","currentTarget","select","VisuallyHidden","clip","AccessibleIcon","DialogPrimitive","DialogPortal","DialogOverlay","isMountedRef","mountTimer","clearTimeout","XIcon","DialogDescription","CardHeader","CardTitle","round","decimals","calculateInvoiceSplit","calcSteps","success","originalTotalAmount","totalDays","adjustedTotalAmount","resultsPerAmount","some","a","invalidAmounts","cleanStartDate","startOfDay","cleanEffectiveEndDate","addDays","differenceInDays","calculatedDays","periodSegmentMap","currentDate","getPeriodIdentifier","getYear","quarter","getQuarter","nextPeriodBoundary","getNextPeriodBoundary","endOfMonth","endOfQuarter","endOfYear","segmentEndDate","daysInSegment","entries","sort","b","localeCompare","amount","amountCalcStep","rawSplits","rawSplitAmount","roundedSplits","step","rs","currentTotal","periodIdentifierToAdjust","max","splitToAdjust","CalculationProcessingError","ROUNDING_ERROR","periodToAdjust","finalAmountSplits","splitAmount","adjustedTotalForThisAmount","splits","totalSplitForPeriod","amountResult","yearString","daysInYear","finalAdjustedTotalAmount","finalDiscrepancy","successCalcSteps","caughtError","UNEXPECTED_ERROR","originalError","Label","LabelPrimitive","FormProvider","FormFieldContext","Controller","fieldContext","itemContext","FormItemContext","getFieldState","useFormContext","useFormState","fieldState","formItemId","formDescriptionId","formMessageId","FormLabelInternal","htmlFor","explicitHtmlFor","hasError","data-error","derivedHtmlFor","hasContext","useFormField","String","constructor","setPrototypeOf","prototype","PERIOD_ALLOCATION_ERROR","Loading"],"sourceRoot":""}