"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7867],{47867:(e,t,a)=>{a.r(t),a.d(t,{InvoiceForm:()=>ea});var r=a(95155),s=a(62177),n=a(22966),l=a(55594);let i={startDateString:"",endDateString:"",includeEndDate:!0,splitPeriod:"yearly",amounts:[{value:""}]},o=e=>l.z.object({startDateString:l.z.string().optional(),endDateString:l.z.string().optional(),includeEndDate:l.z.boolean(),splitPeriod:l.z.enum(["yearly","quarterly","monthly"]),amounts:l.z.array(l.z.object({value:l.z.string().min(1,{message:e("InvoiceForm.errorAmountValueRequired")}).refine(e=>!isNaN(parseFloat(e))&&parseFloat(e)>0,{message:e("InvoiceForm.errorAmountPositive")})})).min(1,e("InvoiceForm.errorAmountRequired"))}).refine(e=>!!(0,n.V0)(e.startDateString||""),{message:e("InvoiceForm.errorStartDateRequired"),path:["startDateString"]}).refine(e=>!!(0,n.V0)(e.endDateString||""),{message:e("InvoiceForm.errorEndDateRequired"),path:["endDateString"]}).refine(e=>{let t=(0,n.V0)(e.startDateString||""),a=(0,n.V0)(e.endDateString||"");return!t||!a||a>=t},{message:e("InvoiceForm.errorEndDateBeforeStart"),path:["endDateString"]});var d=a(70290),c=a(49103),u=a(51154),m=a(77116),g=a(62713),h=a(83039),f=a(12115),p=a(48287);function v(e,t){let a=t?.fieldName||"Date",r=t?.customMessages||{};if(!e||""===e.trim())return t?.required?{valid:!1,message:r.required||`${a} is required`,value:null}:{valid:!0,message:"",value:null};let s=(0,n.Xb)(e,{minDate:t?.minDate,maxDate:t?.maxDate});if(!s.valid){if(null===s.parsedDate&&r.invalid)return{valid:!1,message:r.invalid,value:null};if(t?.minDate&&s.parsedDate&&s.parsedDate<t.minDate&&r.minDate)return{valid:!1,message:r.minDate,value:s.parsedDate};if(t?.maxDate&&s.parsedDate&&s.parsedDate>t.maxDate&&r.maxDate)return{valid:!1,message:r.maxDate,value:s.parsedDate}}return{valid:s.valid,message:s.message,value:s.parsedDate}}function x(e,t,a){let r=v(e,{required:!0,fieldName:t("InvoiceForm.endDateLabel",{defaultValue:"End Date"}),customMessages:{required:t("InvoiceForm.errorEndDateRequired",{defaultValue:"End date is required"}),invalid:t("InvoiceForm.supportedDateFormats",{defaultValue:"Supported formats: YYYY-MM-DD, DD.MM.YYYY"})}});if(r.valid&&a){let e=(0,n.V0)(a);if(e&&r.value&&r.value<e)return{valid:!1,message:t("InvoiceForm.errorEndDateBeforeStart",{defaultValue:"End date cannot be before start date"}),value:r.value}}return r}var y=a(40646),b=a(85339),j=a(54861),S=a(30285),N=a(62523),D=a(16781);function w(e){let{index:t,field:a,canRemove:s,onRemoveAction:n,hasError:l,errorMessage:i}=e,{t:o}=(0,D.Bd)(),c=function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return function(e,t){let a=t?.fieldName||"Value",r=t?.customMessages||{};if(null==e||""===e)return t?.required?{valid:!1,message:r.required||`${a} is required`,value:null}:{valid:!0,message:"",value:null};let s=(0,p.vK)(e,NaN);return isNaN(s)?{valid:!1,message:r.invalid||`${a} must be a valid number`,value:e}:t?.integer&&!Number.isInteger(s)?{valid:!1,message:r.integer||`${a} must be a whole number`,value:s}:t?.positive&&s<=0?{valid:!1,message:r.positive||`${a} must be positive`,value:s}:t?.min!==void 0&&s<t.min?{valid:!1,message:r.min||`${a} must be at least ${t.min}`,value:s}:t?.max!==void 0&&s>t.max?{valid:!1,message:r.max||`${a} must be at most ${t.max}`,value:s}:{valid:!0,message:"",value:s}}(e,{required:!0,fieldName:t(0===a?"InvoiceForm.amountLabel":"InvoiceForm.additionalAmountLabel",{defaultValue:0===a?"Amount":`Amount ${a+1}`}),positive:!0,customMessages:{required:t("InvoiceForm.errorAmountValueRequired",{defaultValue:"Amount is required"}),positive:t("InvoiceForm.errorAmountPositive",{defaultValue:"Amount must be a positive number"}),invalid:t("InvoiceForm.errorAmountInvalid",{defaultValue:"Amount must be a valid number"})}})}(a.value,o,t).valid;return(0,r.jsxs)(d.eI,{className:"mb-3",children:[(0,r.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,r.jsxs)(d.lR,{htmlFor:`amount-${t}`,className:"text-sm font-medium",children:["#",t+1]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsxs)("div",{className:"relative flex-1",children:[(0,r.jsx)(d.MJ,{children:(0,r.jsx)(N.p,{type:"number",step:"any",className:"focus:border-primary focus:ring-2 focus:ring-primary/20 transition-transform duration-150 pr-8",...a,id:`amount-${t}`,name:`amounts.${t}.value`})}),(0,r.jsxs)("div",{className:"absolute right-2 top-0 h-full flex items-center justify-center z-[1]",children:[c&&(0,r.jsx)("div",{className:"flex items-center justify-center h-5 w-5",children:(0,r.jsx)(y.A,{className:"h-4 w-4 text-success"})}),l&&(0,r.jsx)("div",{className:"flex items-center justify-center h-5 w-5",children:(0,r.jsx)(b.A,{className:"h-4 w-4 text-destructive"})})]})]}),s&&(0,r.jsx)(S.$,{type:"button",variant:"ghost",size:"icon",onClick:n,className:"text-gray-400 hover:text-gray-500 hover:bg-gray-100 transition-all duration-200 shrink-0","aria-label":"Remove amount",children:(0,r.jsx)(j.A,{className:"h-4 w-4 transition-transform duration-150 hover:scale-95"})})]})]}),l&&i&&(0,r.jsx)(d.C5,{className:"text-xs mt-1 error-message",children:i})]})}var E=a(69074),I=a(26681),F=a(20547),A=a(59434);function V(e){let{...t}=e;return(0,r.jsx)(F.bL,{"data-slot":"popover",...t})}function C(e){let{...t}=e;return(0,r.jsx)(F.l9,{"data-slot":"popover-trigger",...t})}function P(e){let{className:t,align:a="center",sideOffset:s=4,...n}=e,[l,i]=f.useState(!1),o=f.useRef(!0);return(f.useEffect(()=>{o.current=!0;let e=setTimeout(()=>{o.current&&i(!0)},10);return()=>{o.current=!1,clearTimeout(e),i(!1),"undefined"!=typeof document&&setTimeout(()=>{document.querySelectorAll("[data-radix-popover-content]").forEach(e=>{try{e&&e.parentNode&&e.parentNode.removeChild(e)}catch{}})},0)}},[]),l)?(0,r.jsx)(F.ZL,{children:(0,r.jsx)(F.UC,{"data-slot":"popover-content",align:a,sideOffset:s,className:(0,A.cn)("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-72 origin-(--radix-popover-content-transform-origin) rounded-md border p-4 shadow-md outline-hidden",t),style:{backgroundColor:"hsl(var(--popover))",opacity:1},...n})}):null}var _=a(42355),R=a(13052),O=a(42507);function T(e){let{className:t,classNames:a,showOutsideDays:s=!0,locale:n,...l}=e;return(0,r.jsx)(O.h,{showOutsideDays:s,className:(0,A.cn)("p-3",t),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:(0,A.cn)((0,S.r)({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100 transition-colors duration-200"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",month_grid:"w-full border-collapse space-y-1",weekdays:"flex",weekday:"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",week:"flex w-full mt-2",cell:"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day:(0,A.cn)((0,S.r)({variant:"ghost"}),"h-9 w-9 p-0 font-normal bg-transparent rounded-md transition-colors duration-200","hover:bg-primary hover:text-primary-foreground","aria-selected:bg-primary aria-selected:text-primary-foreground aria-selected:font-bold","aria-selected:hover:bg-primary aria-selected:hover:text-primary-foreground","data-[current=true]:bg-accent/15 data-[current=true]:font-bold","active:scale-95 active:ring-1 active:ring-primary/50"),day_range_end:"day-range-end",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent/15 text-foreground hover:bg-primary hover:text-primary-foreground font-bold",day_outside:"day-outside text-muted-foreground opacity-50 aria-selected:bg-accent/50 aria-selected:text-muted-foreground aria-selected:opacity-30 hover:bg-primary/50 hover:text-primary-foreground",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...a},components:{Chevron:e=>{let{className:t,orientation:a,...s}=e;return"left"===a?(0,r.jsx)(_.A,{className:(0,A.cn)(t,"h-4 w-4"),...s}):(0,r.jsx)(R.A,{className:(0,A.cn)(t,"h-4 w-4"),...s})}},locale:n,weekStartsOn:n?.options?.weekStartsOn??1,...l})}function k(e){let{fieldName:t,label:a,placeholder:s,field:l,form:i,onFieldChangeAction:o,displayDateFormat:c,locale:u,disabled:m,autoFocus:g}=e,[h,p]=(0,f.useState)(!1),v=(0,n.V0)(l.value??"")||("endDateString"===t?(0,n.V0)(i.getValues("startDateString")??""):void 0)||new Date;return(0,f.useEffect)(()=>()=>{p(!1)},[]),(0,r.jsxs)(d.eI,{className:"flex flex-col",children:[(0,r.jsx)(d.lR,{htmlFor:t,children:a}),(0,r.jsxs)(V,{open:h,onOpenChange:p,children:[(0,r.jsx)(d.MJ,{children:(0,r.jsxs)("div",{className:"w-full relative",children:[(0,r.jsx)(N.p,{value:l.value,onChange:e=>{l.onChange(e),o(e)},onBlur:()=>i.trigger(t),placeholder:s,className:`w-full pr-16 ${i.formState.errors[t]?"border-destructive focus:border-destructive focus:ring-2 focus:ring-destructive/20":""}`,autoFocus:g,id:t,name:t}),l.value&&!i.formState.errors[t]&&(0,r.jsx)("div",{className:"absolute inset-y-0 right-12 flex items-center z-[1]",children:(0,r.jsx)(y.A,{className:"h-4 w-4 text-success"})}),i.formState.errors[t]&&(0,r.jsx)("div",{className:"absolute inset-y-0 right-12 flex items-center z-[1]",children:(0,r.jsx)(b.A,{className:"h-4 w-4 text-destructive"})}),(0,r.jsx)("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center z-[1]",children:(0,r.jsx)(C,{asChild:!0,children:(0,r.jsx)(S.$,{type:"button",variant:"ghost",className:"h-7 w-7 p-0 rounded-full hover:bg-primary hover:text-primary-foreground transition-colors duration-200 cursor-pointer","aria-label":"Pick a date",children:(0,r.jsx)(E.A,{className:"h-4 w-4 transition-colors duration-200"})})})})]})}),(0,r.jsx)(P,{className:"w-auto p-0",align:"start",children:(0,r.jsx)(T,{mode:"single",selected:(0,n.V0)(l.value??"")||void 0,onSelect:e=>{if(e){let a=(0,I.GP)(e,c);i.setValue(t,a,{shouldValidate:!0})}p(!1)},initialFocus:!0,locale:u,defaultMonth:v,disabled:m})})]}),(0,r.jsx)(d.C5,{className:"text-xs mt-1 error-message",children:i.formState.errors[t]?.message})]})}T.displayName="Calendar";let $="invoiceFormDataCache";function q(e){let{className:t,...a}=e;return(0,r.jsx)("div",{"data-slot":"skeleton",className:(0,A.cn)("bg-accent animate-pulse rounded-md",t),...a})}function z(e){let{className:t,variant:a="text",width:s="100%",height:n,animate:l=!0,lines:i=1,lastLineWidth:o="75%"}=e,d=e=>1===i?s:e===i-1&&o?o:"100%",c=()=>{if(n)return n;switch(a){case"heading":return"1.75rem";case"subheading":return"1.25rem";default:return"1rem"}};return(0,r.jsx)("div",{className:"space-y-2",children:Array.from({length:i}).map((e,s)=>(0,r.jsx)(q,{className:(0,A.cn)(l?"animate-pulse":"","heading"===a?"h-7 rounded-md":"rounded-sm","subheading"===a?"h-5 rounded-sm":"","text"===a?"h-4 rounded-sm":"",t),style:{width:d(s),height:c()}},s))})}function M(e){let{className:t,width:a="100%",height:s="2.5rem",animate:n=!0,hasLabel:l=!1,labelWidth:i="40%"}=e;return(0,r.jsxs)("div",{className:"space-y-2",children:[l&&(0,r.jsx)(q,{className:(0,A.cn)("h-4 rounded-sm",n?"animate-pulse":""),style:{width:i}}),(0,r.jsx)(q,{className:(0,A.cn)("rounded-md",n?"animate-pulse":"",t),style:{width:a,height:s}})]})}function Y(e){let{className:t,width:a="100%",height:s="2.5rem",animate:n=!0,variant:l="button"}=e;return(0,r.jsx)(q,{className:(0,A.cn)("rounded-md","button"===l?"bg-primary/40":"bg-muted/60",n?"animate-pulse":"",t),style:{width:a,height:s}})}function L(e){let{className:t,width:a="100%",height:s="12rem",animate:n=!0,hasBorder:l=!0,hasHeader:i=!1,hasFooter:o=!1,children:d}=e;return(0,r.jsxs)("div",{className:(0,A.cn)("rounded-lg bg-muted/40",l?"border border-muted/30":"",n?"animate-pulse":"",t),style:{width:a,height:s},children:[i&&(0,r.jsx)("div",{className:"p-4 border-b border-muted/30",children:(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)(q,{className:"h-5 w-1/3"}),(0,r.jsx)(q,{className:"h-5 w-16"})]})}),(0,r.jsx)("div",{className:"p-4",children:d}),o&&(0,r.jsx)("div",{className:"p-4 border-t border-muted/30",children:(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)(q,{className:"h-4 w-1/4"}),(0,r.jsx)(q,{className:"h-9 w-24"})]})})]})}function B(e){let{className:t,width:a="2.5rem",height:s="1.5rem",animate:n=!0,hasLabel:l=!0,labelWidth:i="60%"}=e;return(0,r.jsxs)("div",{className:"flex items-center justify-between space-x-2",children:[l&&(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)(q,{className:(0,A.cn)("h-4 rounded-sm",n?"animate-pulse":""),style:{width:i}}),(0,r.jsx)(q,{className:(0,A.cn)("h-3 rounded-sm",n?"animate-pulse":""),style:{width:"calc(100% + 2rem)"}})]}),(0,r.jsx)(q,{className:(0,A.cn)("rounded-full",n?"animate-pulse":"",t),style:{width:a,height:s}})]})}function K(e){let{className:t,animate:a=!0,columns:s=2,rows:n=1,gap:l="1.5rem",children:i}=e,o=`repeat(${s}, minmax(0, 1fr))`;return(0,r.jsx)("div",{className:(0,A.cn)("grid w-full",a?"animate-pulse":"",t),style:{gridTemplateColumns:o,gap:l},children:i||Array.from({length:s*n}).map((e,t)=>(0,r.jsx)(q,{className:"h-24 rounded-lg"},t))})}function G(e){let{className:t,animate:a=!0,spacing:s="1.5rem",children:n}=e;return(0,r.jsx)("div",{className:(0,A.cn)("w-full",a?"animate-pulse":"",t),style:{gap:s},children:n})}function H(){return(0,r.jsxs)(G,{spacing:"1.5rem",children:[(0,r.jsxs)(K,{columns:2,gap:"1.5rem",children:[(0,r.jsx)(M,{hasLabel:!0,labelWidth:"40%"}),(0,r.jsx)(M,{hasLabel:!0,labelWidth:"40%"})]}),(0,r.jsx)(B,{labelWidth:"40%"}),(0,r.jsx)(L,{height:"5rem",hasBorder:!0,children:(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(z,{width:"8rem"}),(0,r.jsx)(z,{width:"16rem",variant:"text"})]}),(0,r.jsx)(M,{width:"7rem",height:"2.5rem",hasLabel:!1})]})}),(0,r.jsx)(L,{height:"auto",hasBorder:!0,children:(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)(z,{variant:"subheading",width:"25%"}),(0,r.jsx)(z,{width:"60%"}),(0,r.jsxs)("div",{className:"mt-4 space-y-4",children:[(0,r.jsx)(M,{hasLabel:!0,labelWidth:"2rem"}),(0,r.jsx)(Y,{variant:"button",width:"10rem",className:"mt-4"})]})]})}),(0,r.jsx)(Y,{height:"2.75rem"})]})}var J=a(80333),U=a(83339);let W={MEMORY_CACHE_SIZE:20,CACHE_VERSION:"v1.0",STORAGE_KEY:"invoice-calculation-cache",TTL:864e5,USE_PERSISTENT_STORAGE:!0};function Q(e){return JSON.stringify({startDate:e.startDate.toISOString().split("T")[0],endDate:e.endDate.toISOString().split("T")[0],includeEndDate:e.includeEndDate,amounts:[...e.amounts].sort((e,t)=>e-t),splitPeriod:e.splitPeriod||"yearly"})}function Z(e){return`${W.CACHE_VERSION}:${e}`}class X{constructor(e){this.capacity=e,this.cache=new Map}get(e){let t=Z(e),a=this.cache.get(t);return a?Date.now()-a.timestamp>a.ttl?(this.cache.delete(t),null):(this.cache.delete(t),this.cache.set(t,a),a.result):null}set(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:W.TTL,r=Z(e);if(this.cache.size>=this.capacity){let e=this.cache.keys().next().value;e&&this.cache.delete(e)}this.cache.set(r,{timestamp:Date.now(),result:t,ttl:a})}clear(){this.cache.clear()}getStats(){return{size:this.cache.size,keys:Array.from(this.cache.keys())}}}let ee=new X(W.MEMORY_CACHE_SIZE);var et=a(90221);function ea(e){let{onCalculateAction:t,initialDemoData:a,onDemoDataApplied:l}=e,{t:p,i18n:y}=(0,D.Bd)(),[b,j]=(0,f.useState)(""),N=y.language.startsWith("de")?g.de:h.c,E=y.language.startsWith("de")?n.Kn.DE:n.Kn.ISO,I=y.language.startsWith("de")?"z.B. 31.12.2023":"e.g. 2023-12-31",F=o(p),V=(0,s.mN)({resolver:(0,et.u)(F),defaultValues:i,mode:"onBlur"}),{fields:C,append:P,remove:_}=(0,s.jz)({control:V.control,name:"amounts"}),R=(0,f.useCallback)(e=>{let t=e.amounts?.length>0?e.amounts:[{value:""}];return{...e,amounts:t,splitPeriod:e.splitPeriod||"yearly"}},[]),O=(0,f.useCallback)(e=>{j(p("InvoiceForm.calculatingButton")),function(e,t,a){let r=(0,n.V0)(e.startDateString||""),s=(0,n.V0)(e.endDateString||""),l=e.amounts.map(e=>parseFloat(e.value)),i={startDate:r,endDate:s,includeEndDate:e.includeEndDate,splitPeriod:e.splitPeriod,amounts:l.filter(e=>!isNaN(e))};if(!r||!s)return t(i,null,new U.gK(a("InvoiceForm.errorInvalidDatesMessages",{defaultValue:"Valid start and end dates are required."}),U.OQ.INVALID_DATES,{startDateString:e.startDateString,endDateString:e.endDateString}));if(l.some(isNaN))return t(i,null,new U.gK(a("InvoiceForm.errorAmountPositive"),U.OQ.INVALID_AMOUNT,{invalidAmounts:e.amounts.filter(e=>isNaN(parseFloat(e.value))).map(e=>e.value)}));let o={startDate:r,endDate:s,includeEndDate:e.includeEndDate,splitPeriod:e.splitPeriod,amounts:l},d=function(e){let t=Q(e),a=ee.get(t);if(a)return a;let r=function(e){if(!W.USE_PERSISTENT_STORAGE)return null;try{let t=(0,A.jD)(localStorage.getItem(W.STORAGE_KEY)||"{}",{}),a=Z(e),r=t[a];if(!r)return null;if(Date.now()-r.timestamp>r.ttl)return delete t[a],localStorage.setItem(W.STORAGE_KEY,JSON.stringify(t)),null;return r.result}catch(e){return console.error("Error reading from cache:",e),null}}(t);return r?(ee.set(t,r),r):null}(o);if(d)return t(i,d,void 0);let c=(0,U.e9)(o);if(c.success){let e={totalDays:c.totalDays,originalTotalAmount:c.originalTotalAmount,adjustedTotalAmount:c.adjustedTotalAmount,resultsPerAmount:c.resultsPerAmount,aggregatedSplits:c.aggregatedSplits,calculationSteps:c.calculationSteps,splitPeriodUsed:c.splitPeriodUsed},a=Q(o);ee.set(a,e),function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:W.TTL;if(W.USE_PERSISTENT_STORAGE)try{let r=(0,A.jD)(localStorage.getItem(W.STORAGE_KEY)||"{}",{});r[Z(e)]={timestamp:Date.now(),result:t,ttl:a};let s=(0,A.jD)(localStorage.getItem(`${W.STORAGE_KEY}_metadata`)||"{}",{version:W.CACHE_VERSION,lastCleanup:0,itemCount:0}),n=Date.now()-864e5;(s.lastCleanup<n||s.version!==W.CACHE_VERSION)&&(Object.keys(r).forEach(e=>{let t=r[e];(!e.startsWith(W.CACHE_VERSION)||Date.now()-t.timestamp>t.ttl)&&delete r[e]}),s.lastCleanup=Date.now(),s.version=W.CACHE_VERSION,s.itemCount=Object.keys(r).length,localStorage.setItem(`${W.STORAGE_KEY}_metadata`,JSON.stringify(s))),localStorage.setItem(W.STORAGE_KEY,JSON.stringify(r))}catch(e){console.error("Error saving to cache:",e)}}(a,e),t(i,e,void 0)}else t(i,null,c.error)}(e,(e,a,r)=>{t(e,a,r)},p),j(p("InvoiceForm.calculateButton",{defaultValue:"Calculate Split"}))},[t,p]),{mounted:T,isProcessing:q,showSuccessAnimation:z,handleSubmit:M}=function(e){let{form:t,storageKey:a,initialDemoData:r,onDemoDataApplied:n,validateBeforeSave:l,onSubmit:i,debounceTime:o=800,autoSubmitWithDemoData:d=!0}=e,[c,u]=(0,f.useState)(!1),[m,g]=(0,f.useState)(!1),[h,p]=(0,f.useState)(!1),v=(0,f.useRef)(!1),x=(0,f.useRef)(null),y=(0,f.useCallback)(e=>{if(c&&v.current)try{let t=l?l(e):e;console.log(`[PersistentForm] Saving form data to localStorage (${a})`),localStorage.setItem(a,JSON.stringify(t))}catch(e){console.error(`[PersistentForm] Failed to save form data to localStorage (${a}):`,e)}},[c,a,l]),b=(0,f.useCallback)(e=>{x.current&&(clearTimeout(x.current),x.current=null),x.current=setTimeout(()=>{y(e)},o)},[y,o]),j=(0,f.useCallback)(()=>{x.current&&(clearTimeout(x.current),x.current=null)},[]),S=(0,s.FH)({control:t.control});(0,f.useEffect)(()=>{c&&v.current&&S&&b(t.getValues())},[S,b,t,c]),(0,f.useEffect)(()=>()=>{j(),console.log(`[PersistentForm] Component unmounting, cancelled pending save operations (${a}).`)},[j,a]);let N=(0,f.useCallback)(()=>{if(c&&!v.current){v.current=!0,console.log(`[PersistentForm] Initializing form data (${a})...`);try{if(r){console.log("[PersistentForm] Using demo data from prop:",r),t.reset(r),localStorage.setItem(a,JSON.stringify(r)),n&&(console.log("[PersistentForm] Notifying parent that demo data was applied"),n()),d&&i&&setTimeout(()=>{t.trigger().then(e=>{e?(console.log("[PersistentForm] Form is valid, auto-submitting"),t.handleSubmit(e=>{i&&i(e)})()):console.warn("[PersistentForm] Auto-submit cancelled - validation failed:",t.formState.errors)})},350);return}{let e=new URLSearchParams(window.location.search);if("true"===e.get("clean")){console.log(`[PersistentForm] 'clean=true' parameter detected, clearing cache (${a})`),localStorage.removeItem(a);return}}let e=localStorage.getItem(a);if(e){console.log(`[PersistentForm] Loading data from localStorage cache (${a})`);try{let a=JSON.parse(e),r=l?l(a):a;t.reset(r)}catch(e){console.error(`[PersistentForm] Error parsing cached data (${a}):`,e),localStorage.removeItem(a)}}else console.log(`[PersistentForm] No cached data found (${a}), using defaults`)}catch(e){console.error(`[PersistentForm] Error during initialization (${a}):`,e),localStorage.removeItem(a)}}},[c,t,a,r,n,l,i,d]),D=(0,f.useCallback)(e=>async t=>{g(!0);try{let a=e||i;a&&await a(t),p(!0),setTimeout(()=>p(!1),1500)}catch(e){console.error("[PersistentForm] Error during form submission:",e)}finally{g(!1)}},[i]);return(0,f.useEffect)(()=>(u(!0),()=>u(!1)),[]),(0,f.useEffect)(()=>{c&&!v.current&&N()},[c,N]),{mounted:c,isProcessing:m,showSuccessAnimation:h,handleSubmit:D,cancelSave:j}}({form:V,storageKey:$,initialDemoData:(0,f.useMemo)(()=>a?{...a,amounts:a.amount?[{value:a.amount}]:[{value:""}],splitPeriod:a.splitPeriod||"yearly",includeEndDate:a.includeEndDate??!0}:a,[a]),onDemoDataApplied:l,validateBeforeSave:R,onSubmit:O,autoSubmitWithDemoData:!0});(0,f.useEffect)(()=>{if(!T)return;j(p("InvoiceForm.calculateButton",{defaultValue:"Calculate Split"}));let e=V.getValues(),t=!1;e.splitPeriod&&["yearly","quarterly","monthly"].includes(e.splitPeriod)||(V.setValue("splitPeriod","yearly"),t=!0),"boolean"!=typeof e.includeEndDate&&(V.setValue("includeEndDate",!0),t=!0),e.amounts&&0!==e.amounts.length||(V.setValue("amounts",[{value:""}]),t=!0),t&&console.log("[InvoiceForm] Applied default values for missing form fields")},[T,V,p]);let Y=e=>{let t=e.target.value;V.clearErrors("startDateString"),V.setValue("startDateString",t,{shouldValidate:!1});let a=V.getValues("endDateString"),r=function(e,t,a){let r=v(e,{required:!0,fieldName:t("InvoiceForm.startDateLabel",{defaultValue:"Start Date"}),customMessages:{required:t("InvoiceForm.errorStartDateRequired",{defaultValue:"Start date is required"}),invalid:t("InvoiceForm.supportedDateFormats",{defaultValue:"Supported formats: YYYY-MM-DD, DD.MM.YYYY"})}});if(r.valid&&a){let r=function(e,t,a){let r=a?.customMessage||"End date must be after start date";if(!e||!t)return{valid:!0,message:""};let s="string"==typeof e?(0,n.V0)(e):e,l="string"==typeof t?(0,n.V0)(t):t;if(!s||!l)return{valid:!0,message:""};let i=a?.allowEqual?s<=l:s<l;return{valid:i,message:i?"":r,value:{startDate:s,endDate:l}}}(e,a,{allowEqual:!0,customMessage:t("InvoiceForm.errorStartDateAfterEnd",{defaultValue:"Start date must be before or equal to end date"})});if(!r.valid)return r}return r}(t,p,a);if(r.valid){if(a){let e=x(a,p,t);e.valid?V.clearErrors("endDateString"):V.setError("endDateString",{type:"manual",message:e.message})}}else V.setError("startDateString",{type:"manual",message:r.message});V.trigger("startDateString")},L=e=>{let t=e.target.value;V.clearErrors("endDateString"),V.setValue("endDateString",t,{shouldValidate:!1});let a=x(t,p,V.getValues("startDateString"));a.valid||V.setError("endDateString",{type:"manual",message:a.message}),V.trigger("endDateString")};return T?(0,r.jsx)(s.Op,{...V,children:(0,r.jsxs)("form",{onSubmit:V.handleSubmit(M()),className:(0,A.cn)("space-y-6",T&&"opacity-100 transition-opacity duration-500 ease-in-out",!T&&"opacity-0"),children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,r.jsx)(d.zB,{control:V.control,name:"startDateString",render:e=>{let{field:t}=e;return(0,r.jsx)(k,{fieldName:"startDateString",label:p("InvoiceForm.startDateLabel"),placeholder:I,field:t,form:V,onFieldChangeAction:Y,displayDateFormat:E,locale:N,autoFocus:!0})}}),(0,r.jsx)(d.zB,{control:V.control,name:"endDateString",render:e=>{let{field:t}=e;return(0,r.jsx)(k,{fieldName:"endDateString",label:p("InvoiceForm.endDateLabel"),placeholder:I,field:t,form:V,onFieldChangeAction:L,displayDateFormat:E,locale:N,disabled:e=>{let t=(0,n.V0)(V.watch("startDateString")??"");return!!t&&e<t}})}})]}),(0,r.jsx)(d.zB,{control:V.control,name:"includeEndDate",render:e=>{let{field:t}=e;return(0,r.jsxs)(d.eI,{className:"flex flex-row items-center justify-between rounded-lg border p-4",children:[(0,r.jsxs)("div",{className:"space-y-0.5",children:[(0,r.jsx)(d.lR,{htmlFor:"includeEndDate",className:"text-base",children:p("InvoiceForm.includeEndDateLabel")}),(0,r.jsx)(d.Rr,{children:p("InvoiceForm.includeEndDateDescription")})]}),(0,r.jsx)("div",{className:"flex items-center border-none outline-none",children:(0,r.jsx)(J.d,{checked:t.value,onCheckedChange:t.onChange,id:"includeEndDate",name:"includeEndDate"})})]})}}),(0,r.jsx)(d.zB,{control:V.control,name:"splitPeriod",render:e=>{let{field:t}=e;return(0,r.jsxs)(d.eI,{className:"flex flex-col items-start justify-start rounded-lg border p-4",children:[(0,r.jsxs)("div",{className:"space-y-0.5 pr-4 mb-3",children:[(0,r.jsx)(d.lR,{htmlFor:"splitPeriod",className:"text-base",children:p("InvoiceForm.splitPeriodLabel",{defaultValue:"Split Period"})}),(0,r.jsx)(d.Rr,{children:p("InvoiceForm.splitPeriodDescription",{defaultValue:"Choose how to split the invoice amounts."})})]}),(0,r.jsxs)("div",{className:"w-full",children:[(0,r.jsxs)(m.l6,{onValueChange:t.onChange,defaultValue:t.value,value:t.value,name:t.name,children:[(0,r.jsx)(m.bq,{className:"w-full",id:"splitPeriod",children:(0,r.jsx)(m.yv,{placeholder:p("InvoiceForm.periodYearly",{defaultValue:"Yearly"})})}),(0,r.jsxs)(m.gC,{className:"!fixed !z-[9999] !overflow-visible shadow-lg",position:"popper",sideOffset:8,align:"center",avoidCollisions:!0,collisionPadding:20,children:[(0,r.jsx)(m.eb,{value:"yearly",className:"select-dropdown-item !cursor-pointer",style:{cursor:"pointer"},children:`${p("InvoiceForm.periodYearly",{defaultValue:"Yearly"})}`},"yearly"),(0,r.jsx)(m.eb,{value:"quarterly",className:"select-dropdown-item !cursor-pointer",style:{cursor:"pointer"},children:`${p("InvoiceForm.periodQuarterly",{defaultValue:"Quarterly"})}`},"quarterly"),(0,r.jsx)(m.eb,{value:"monthly",className:"select-dropdown-item !cursor-pointer",style:{cursor:"pointer"},children:`${p("InvoiceForm.periodMonthly",{defaultValue:"Monthly"})}`},"monthly")]})]}),(0,r.jsx)(d.C5,{})]})]})}}),(0,r.jsxs)("div",{className:"space-y-5 rounded-lg border p-6 shadow-xs",children:[(0,r.jsx)("h3",{className:"text-base font-medium",id:"amounts-section-label",children:p("InvoiceForm.amountsLabel")}),(0,r.jsx)(d.Rr,{children:p("InvoiceForm.amountsDescription")}),(0,r.jsxs)("div",{"aria-labelledby":"amounts-section-label",className:"space-y-4 mt-4",children:[C.map((e,t)=>(0,r.jsx)(d.zB,{control:V.control,name:`amounts.${t}.value`,render:e=>{let{field:a}=e;return(0,r.jsx)(w,{index:t,field:a,canRemove:C.length>1,onRemoveAction:()=>_(t),hasError:!!V.formState.errors.amounts?.[t]?.value,errorMessage:V.formState.errors.amounts?.[t]?.value?.message})}},e.id)),(0,r.jsxs)(S.$,{type:"button",variant:"outline",size:"sm",onClick:()=>{P({value:""}),setTimeout(()=>{let e=document.querySelectorAll('input[type="number"]');e.length>0&&e[e.length-1].focus()},10)},className:"mt-4",children:[(0,r.jsx)(c.A,{className:"mr-2 h-4 w-4"})," ",p("InvoiceForm.addAmountButton")]}),V.formState.errors.amounts&&!V.formState.errors.amounts.root&&V.formState.errors.amounts.message&&(0,r.jsx)("p",{className:"text-sm font-medium text-destructive",children:V.formState.errors.amounts.message}),V.formState.errors.amounts?.root?.message&&(0,r.jsx)("p",{className:"text-sm font-medium text-destructive",children:V.formState.errors.amounts.root.message})]})]}),(0,r.jsx)(S.$,{type:"submit",variant:"default",className:`w-full bg-primary text-primary-foreground hover:bg-primary/90 hover:scale-[1.02] px-6 py-2 h-11 font-medium rounded-md shadow-sm transition-all duration-200 hover:shadow-lg hover:shadow-primary/20 ${z?"animate-successGlow":""}`,disabled:V.formState.isSubmitting||q,"aria-live":"polite",children:q?(0,r.jsxs)("span",{className:"flex items-center justify-center",children:[(0,r.jsx)(u.A,{className:"mr-2 h-4 w-4 animate-spin"}),b]}):b})]})}):(0,r.jsx)(H,{})}},80333:(e,t,a)=>{a.d(t,{d:()=>i});var r=a(95155),s=a(12115),n=a(96440),l=a(59434);let i=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(n.bL,{className:(0,l.cn)("peer inline-flex h-[22px] w-[42px] shrink-0 cursor-pointer items-center rounded-sm border-0 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input dark:data-[state=unchecked]:bg-slate-700","rounded-sm",a),...s,ref:t,children:(0,r.jsx)(n.zi,{className:(0,l.cn)("pointer-events-none block h-[18px] w-[18px] rounded-xs bg-white shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-[19px] data-[state=unchecked]:translate-x-[3px]")})})});i.displayName=n.bL.displayName}}]);