{"version":3,"file":"static/chunks/4798.f707eb882b74dd13.js","mappings":"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","sources":["webpack://_N_E/./src/lib/calculations.ts","webpack://_N_E/./src/components/ui/popover.tsx","webpack://_N_E/./src/components/ui/calendar.tsx","webpack://_N_E/./src/components/invoice-form.tsx","webpack://_N_E/./src/components/ui/switch.tsx"],"sourcesContent":["// Add ESLint disable comments for unused imports that are kept for future use\r\nimport {\r\n  addDays,\r\n  differenceInDays,\r\n  endOfMonth,\r\n  endOfQuarter,\r\n  endOfYear,\r\n  format,\r\n  getQuarter,\r\n  getYear,\r\n  startOfDay,\r\n} from \"date-fns\";\r\n\r\n// Helper function for rounding to a specific number of decimal places\r\nfunction round(value: number, decimals: number): number {\r\n  return Number(Math.round(Number(value + \"e\" + decimals)) + \"e-\" + decimals);\r\n}\r\n\r\n// Updated Input: Accepts an array of amounts and split period type\r\nexport interface CalculationInput {\r\n  startDate: Date;\r\n  endDate: Date;\r\n  includeEndDate: boolean;\r\n  amounts: number[]; // Array of amounts to be summed and split\r\n  splitPeriod?: 'yearly' | 'quarterly' | 'monthly'; // Replaced daily with monthly\r\n}\r\n\r\n// Represents the split portion of a SINGLE original amount for a specific period (year, quarter, or day)\r\ninterface SingleAmountPeriodSplit {\r\n  splitAmount: number; // Rounded split portion for this period\r\n}\r\n\r\n// Represents the split results for ONE original input amount across all periods\r\nexport interface AmountSplitResult {\r\n  originalAmount: number;\r\n  adjustedTotalAmount: number; // Sum of splits for this amount after adjustment\r\n  splits: { [periodIdentifier: string]: SingleAmountPeriodSplit }; // Map period identifier (YYYY, YYYY-Qn, YYYY-MM) to its split portion\r\n}\r\n\r\n// Represents the aggregated results per period across ALL input amounts\r\nexport interface AggregatedPeriodSplit {\r\n  periodIdentifier: string; // YYYY, YYYY-Qn, or YYYY-MM\r\n  daysInPeriod: number;\r\n  proportion: number;\r\n  totalSplitAmount: number; // Sum of all individual amount splits for this period\r\n}\r\n\r\n// Updated CalculationResult structure\r\nexport interface CalculationResult {\r\n  totalDays: number;\r\n  originalTotalAmount: number; // Sum of all input amounts\r\n  adjustedTotalAmount: number; // Sum of all adjusted split amounts\r\n  resultsPerAmount: AmountSplitResult[]; // Detailed results for each input amount\r\n  aggregatedSplits: AggregatedPeriodSplit[]; // Aggregated results per period\r\n  calculationSteps: CalculationStepDetails;\r\n  splitPeriodUsed: 'yearly' | 'quarterly' | 'monthly'; // Replaced daily with monthly\r\n}\r\n\r\n// --- Helper for structuring calculation steps ---\r\nexport interface CalculationStepDetails {\r\n  totalDuration: {\r\n    days: number;\r\n    start: string;\r\n    end: string;\r\n    included: boolean;\r\n  };\r\n  periodSegments: { periodIdentifier: string; days: number; proportion: number }[]; // Renamed from yearSegments\r\n  amountCalculations: {\r\n    originalAmount: number;\r\n    periodSplits: { // Renamed from yearSplits\r\n      periodIdentifier: string;\r\n      rawSplit: number;\r\n      roundedSplit: number;\r\n      adjustment: number;\r\n    }[];\r\n    adjustmentAppliedToPeriod?: string; // Renamed from adjustmentAppliedToYear\r\n    discrepancy: number;\r\n    finalSum: number;\r\n  }[];\r\n  error?: string;\r\n}\r\n// --- End Helper ---\r\n\r\n// Helper function to get the end of the next period based on the type\r\nfunction getNextPeriodBoundary(currentDate: Date, periodType: 'yearly' | 'quarterly' | 'monthly'): Date {\r\n  switch (periodType) {\r\n    case 'monthly':\r\n      return startOfDay(addDays(endOfMonth(currentDate), 1));\r\n    case 'quarterly':\r\n      return startOfDay(addDays(endOfQuarter(currentDate), 1));\r\n    case 'yearly':\r\n    default:\r\n      return startOfDay(addDays(endOfYear(currentDate), 1));\r\n  }\r\n}\r\n\r\n// Helper function to generate a period identifier string\r\nfunction getPeriodIdentifier(date: Date, periodType: 'yearly' | 'quarterly' | 'monthly'): string {\r\n  const year = getYear(date);\r\n  switch (periodType) {\r\n    case 'monthly':\r\n      return format(date, 'yyyy-MM');\r\n    case 'quarterly':\r\n      const quarter = getQuarter(date);\r\n      return `${year}-Q${quarter}`;\r\n    case 'yearly':\r\n    default:\r\n      return year.toString();\r\n  }\r\n}\r\n\r\n/**\r\n * Calculates the proportional split of invoice amounts across specified periods.\r\n * Applies rounding and adjustment for precision.\r\n */\r\nexport function calculateInvoiceSplit(\r\n  input: CalculationInput,\r\n): CalculationResult {\r\n  const splitPeriod = input.splitPeriod || 'yearly'; // Default to yearly if not provided\r\n  const calcSteps: CalculationStepDetails = {\r\n    totalDuration: {\r\n      days: 0,\r\n      start: \"\",\r\n      end: \"\",\r\n      included: input.includeEndDate,\r\n    },\r\n    periodSegments: [], // Renamed\r\n    amountCalculations: [],\r\n  };\r\n\r\n  if (!input.amounts || input.amounts.length === 0) {\r\n    // Return structure indicating error\r\n    return {\r\n      totalDays: 0,\r\n      originalTotalAmount: 0,\r\n      adjustedTotalAmount: 0,\r\n      resultsPerAmount: [],\r\n      aggregatedSplits: [],\r\n      calculationSteps: {\r\n        ...calcSteps,\r\n        error: \"At least one amount is required.\",\r\n      },\r\n      splitPeriodUsed: splitPeriod,\r\n    };\r\n  }\r\n  if (input.amounts.some((a) => isNaN(a) || a === null)) {\r\n    return {\r\n      totalDays: 0,\r\n      originalTotalAmount: 0,\r\n      adjustedTotalAmount: 0,\r\n      resultsPerAmount: [],\r\n      aggregatedSplits: [],\r\n      calculationSteps: {\r\n        ...calcSteps,\r\n        error: \"Invalid non-numeric amount provided.\",\r\n      },\r\n      splitPeriodUsed: splitPeriod,\r\n    };\r\n  }\r\n\r\n  const originalTotalAmount = round(\r\n    input.amounts.reduce((sum, a) => sum + a, 0),\r\n    2,\r\n  );\r\n\r\n  const cleanStartDate = startOfDay(input.startDate);\r\n  let cleanEffectiveEndDate = startOfDay(input.endDate);\r\n  if (input.includeEndDate) {\r\n    cleanEffectiveEndDate = addDays(cleanEffectiveEndDate, 1);\r\n  }\r\n  calcSteps.totalDuration.start = format(cleanStartDate, \"yyyy-MM-dd\");\r\n  // Use original end date for display if included, otherwise the day before effective end\r\n  calcSteps.totalDuration.end = format(input.includeEndDate ? input.endDate : addDays(cleanEffectiveEndDate, -1), \"yyyy-MM-dd\"); \r\n\r\n  if (cleanStartDate >= cleanEffectiveEndDate) {\r\n    return {\r\n      totalDays: 0,\r\n      originalTotalAmount,\r\n      adjustedTotalAmount: 0,\r\n      resultsPerAmount: [],\r\n      aggregatedSplits: [],\r\n      calculationSteps: {\r\n        ...calcSteps,\r\n        error: \"Start date must be before the effective end date.\",\r\n      },\r\n      splitPeriodUsed: splitPeriod,\r\n    };\r\n  }\r\n\r\n  const totalDurationDays = differenceInDays(\r\n    cleanEffectiveEndDate,\r\n    cleanStartDate,\r\n  );\r\n  calcSteps.totalDuration.days = totalDurationDays;\r\n\r\n  if (totalDurationDays <= 0) {\r\n    return {\r\n      totalDays: 0,\r\n      originalTotalAmount,\r\n      adjustedTotalAmount: 0,\r\n      resultsPerAmount: [],\r\n      aggregatedSplits: [],\r\n      calculationSteps: {\r\n        ...calcSteps,\r\n        error: \"Calculated duration is zero or negative.\",\r\n      },\r\n      splitPeriodUsed: splitPeriod,\r\n    };\r\n  }\r\n\r\n  // --- Calculate days and proportions per period segment ---\r\n  const periodSegmentMap: {\r\n    [periodIdentifier: string]: { days: number; proportion: number };\r\n  } = {};\r\n  let currentDate = cleanStartDate;\r\n  while (currentDate < cleanEffectiveEndDate) {\r\n    const periodIdentifier = getPeriodIdentifier(currentDate, splitPeriod);\r\n    const nextPeriodBoundary = getNextPeriodBoundary(currentDate, splitPeriod);\r\n    const segmentEndDate =\r\n      cleanEffectiveEndDate < nextPeriodBoundary\r\n        ? cleanEffectiveEndDate\r\n        : nextPeriodBoundary;\r\n    const daysInSegment = differenceInDays(segmentEndDate, currentDate);\r\n\r\n    if (daysInSegment > 0) {\r\n      const proportion = daysInSegment / totalDurationDays;\r\n      if (!periodSegmentMap[periodIdentifier]) {\r\n        periodSegmentMap[periodIdentifier] = { days: 0, proportion: 0 };\r\n      }\r\n      periodSegmentMap[periodIdentifier].days += daysInSegment;\r\n      periodSegmentMap[periodIdentifier].proportion += proportion;\r\n    }\r\n    currentDate = segmentEndDate;\r\n  }\r\n  // Store period segment details for calculation steps display\r\n  calcSteps.periodSegments = Object.entries(periodSegmentMap)\r\n    .map(([identifier, data]) => ({\r\n      periodIdentifier: identifier,\r\n      days: data.days,\r\n      proportion: data.proportion,\r\n    }))\r\n    // Custom sort needed: Year > Quarter > Month\r\n    .sort((a, b) => {\r\n        // Sort YYYY, YYYY-Qn, YYYY-MM correctly\r\n        return a.periodIdentifier.localeCompare(b.periodIdentifier);\r\n    });\r\n  // --- End Segment Calculation ---\r\n\r\n  const resultsPerAmount: AmountSplitResult[] = [];\r\n\r\n  // --- Process each amount individually ---\r\n  for (const amount of input.amounts) {\r\n    const amountCalcStep: CalculationStepDetails[\"amountCalculations\"][0] = {\r\n      originalAmount: amount,\r\n      periodSplits: [], // Renamed\r\n      discrepancy: 0,\r\n      finalSum: 0,\r\n    };\r\n\r\n    const rawSplits: { periodIdentifier: string; rawSplit: number }[] = [];\r\n    for (const identifier in periodSegmentMap) {\r\n      const segment = periodSegmentMap[identifier];\r\n      const rawSplitAmount = amount * segment.proportion;\r\n      rawSplits.push({ periodIdentifier: identifier, rawSplit: rawSplitAmount });\r\n      amountCalcStep.periodSplits.push({\r\n        periodIdentifier: identifier,\r\n        rawSplit: rawSplitAmount,\r\n        roundedSplit: 0,\r\n        adjustment: 0,\r\n      }); // Initialize step details\r\n    }\r\n\r\n    // Round initial splits for this amount\r\n    const roundedSplits = rawSplits.map((split) => ({\r\n      ...split,\r\n      roundedSplit: round(split.rawSplit, 2),\r\n    }));\r\n\r\n    // Update steps with rounded values\r\n    roundedSplits.forEach((rs) => {\r\n      const step = amountCalcStep.periodSplits.find((s) => s.periodIdentifier === rs.periodIdentifier);\r\n      if (step) step.roundedSplit = rs.roundedSplit;\r\n    });\r\n\r\n    // Calculate discrepancy for this amount\r\n    const currentTotal = round(\r\n      roundedSplits.reduce((sum, s) => sum + s.roundedSplit, 0),\r\n      2,\r\n    );\r\n    const discrepancy = round(amount - currentTotal, 2);\r\n    amountCalcStep.discrepancy = discrepancy;\r\n\r\n    // Apply rounding adjustment to the period with the largest raw amount\r\n    if (discrepancy !== 0 && roundedSplits.length > 0) {\r\n      // Find the period with the max *raw* split amount to minimize impact of rounding intermediate values\r\n      const periodToAdjustDetails = rawSplits.reduce((max, current) => \r\n         Math.abs(current.rawSplit) > Math.abs(max.rawSplit) ? current : max\r\n      );\r\n      const periodIdentifierToAdjust = periodToAdjustDetails.periodIdentifier;\r\n\r\n      // Find the corresponding entry in roundedSplits to apply the adjustment\r\n      const splitToAdjust = roundedSplits.find(s => s.periodIdentifier === periodIdentifierToAdjust);\r\n      if(splitToAdjust) {\r\n        splitToAdjust.roundedSplit = round(splitToAdjust.roundedSplit + discrepancy, 2);\r\n        \r\n        // Update calculation steps with the adjustment detail\r\n        const step = amountCalcStep.periodSplits.find(s => s.periodIdentifier === periodIdentifierToAdjust);\r\n        if (step) {\r\n            step.roundedSplit = splitToAdjust.roundedSplit; // Ensure step reflects adjusted rounded value\r\n            step.adjustment = discrepancy;\r\n        }\r\n        amountCalcStep.adjustmentAppliedToPeriod = periodIdentifierToAdjust;\r\n      } else {\r\n        // Fallback if somehow the period wasn't found (shouldn't happen)\r\n        console.warn(\"Could not find period to apply adjustment, discrepancy unapplied for this amount.\")\r\n      }\r\n    }\r\n\r\n    // Store final splits for this amount\r\n    const finalAmountSplits: { [periodIdentifier: string]: SingleAmountPeriodSplit } = {};\r\n    roundedSplits.forEach((s) => {\r\n      finalAmountSplits[s.periodIdentifier] = { splitAmount: s.roundedSplit };\r\n    });\r\n\r\n    const adjustedTotalForThisAmount = round(\r\n      roundedSplits.reduce((sum, s) => sum + s.roundedSplit, 0),\r\n      2,\r\n    );\r\n    amountCalcStep.finalSum = adjustedTotalForThisAmount;\r\n\r\n    resultsPerAmount.push({\r\n      originalAmount: amount,\r\n      adjustedTotalAmount: adjustedTotalForThisAmount,\r\n      splits: finalAmountSplits,\r\n    });\r\n    calcSteps.amountCalculations.push(amountCalcStep);\r\n  }\r\n  // --- End Amount Processing ---\r\n\r\n  // --- Aggregate results per period ---\r\n  const aggregatedSplits: AggregatedPeriodSplit[] = Object.entries(periodSegmentMap)\r\n    .map(([identifier, segment]) => {\r\n      const periodIdentifier = identifier;\r\n      let totalSplitForPeriod = 0;\r\n      resultsPerAmount.forEach((amountResult) => {\r\n        totalSplitForPeriod += amountResult.splits[periodIdentifier]?.splitAmount || 0;\r\n      });\r\n      return {\r\n        periodIdentifier: periodIdentifier,\r\n        daysInPeriod: segment.days,\r\n        proportion: segment.proportion,\r\n        totalSplitAmount: round(totalSplitForPeriod, 2),\r\n      };\r\n    })\r\n    // Use the same sort as periodSegments\r\n    .sort((a, b) => a.periodIdentifier.localeCompare(b.periodIdentifier));\r\n  // --- End Aggregation ---\r\n\r\n  const finalAdjustedTotalAmount = round(\r\n    aggregatedSplits.reduce((sum, s) => sum + s.totalSplitAmount, 0),\r\n    2,\r\n  );\r\n\r\n  // Final sanity check: does adjusted total match original total?\r\n  const finalDiscrepancy = round(originalTotalAmount - finalAdjustedTotalAmount, 2);\r\n  if (Math.abs(finalDiscrepancy) > 0.01 * input.amounts.length) { // Allow small tolerance per amount\r\n       console.warn(`Potential rounding discrepancy: Original ${originalTotalAmount}, Adjusted ${finalAdjustedTotalAmount}, Diff ${finalDiscrepancy}`);\r\n       // Optionally add a warning to the results/steps if needed\r\n  }\r\n\r\n  return {\r\n    totalDays: totalDurationDays,\r\n    originalTotalAmount: originalTotalAmount,\r\n    adjustedTotalAmount: finalAdjustedTotalAmount,\r\n    resultsPerAmount: resultsPerAmount,\r\n    aggregatedSplits: aggregatedSplits,\r\n    calculationSteps: calcSteps,\r\n    splitPeriodUsed: splitPeriod,\r\n  };\r\n}\r\n","\"use client\";\n\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\";\nimport * as React from \"react\";\n\nimport { cn } from \"@/lib/utils\";\n\nfunction Popover({\n  ...props\n}: React.ComponentProps<typeof PopoverPrimitive.Root>) {\n  return <PopoverPrimitive.Root data-slot=\"popover\" {...props} />;\n}\n\nfunction PopoverTrigger({\n  ...props\n}: React.ComponentProps<typeof PopoverPrimitive.Trigger>) {\n  return <PopoverPrimitive.Trigger data-slot=\"popover-trigger\" {...props} />;\n}\n\nfunction PopoverContent({\n  className,\n  align = \"center\",\n  sideOffset = 4,\n  ...props\n}: React.ComponentProps<typeof PopoverPrimitive.Content>) {\n  const [isMounted, setIsMounted] = React.useState(false);\n  const isMountedRef = React.useRef(true);\n\n  React.useEffect(() => {\n    isMountedRef.current = true;\n    const mountTimer = setTimeout(() => {\n      if (isMountedRef.current) {\n        setIsMounted(true);\n      }\n    }, 10); // Small delay for mount animation\n\n    return () => {\n      isMountedRef.current = false;\n      clearTimeout(mountTimer);\n      // Immediately set isMounted to false to trigger clean removal\n      setIsMounted(false);\n      \n      // Make sure we clean up any portals that might still be in the DOM\n      if (typeof document !== 'undefined') {\n        // Give React a chance to unmount naturally before we force cleanup\n        setTimeout(() => {\n          // Find any orphaned popover elements and remove them\n          document.querySelectorAll('[data-radix-popover-content]').forEach(element => {\n            try {\n              if (element && element.parentNode) {\n                element.parentNode.removeChild(element);\n              }\n            } catch /* (error) */ {\n              // Silently handle any errors during forced cleanup\n            }\n          });\n        }, 0);\n      }\n    };\n  }, []);\n\n  if (!isMounted) {\n    return null; // Render nothing until mounted or after unmount\n  }\n\n  return (\n    <PopoverPrimitive.Portal>\n      <PopoverPrimitive.Content\n        data-slot=\"popover-content\"\n        align={align}\n        sideOffset={sideOffset}\n        className={cn(\n          \"bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-72 origin-(--radix-popover-content-transform-origin) rounded-md border p-4 shadow-md outline-hidden\",\n          className,\n        )}\n        {...props}\n      />\n    </PopoverPrimitive.Portal>\n  );\n}\n\nfunction PopoverAnchor({\n  ...props\n}: React.ComponentProps<typeof PopoverPrimitive.Anchor>) {\n  return <PopoverPrimitive.Anchor data-slot=\"popover-anchor\" {...props} />;\n}\n\nexport { Popover, PopoverTrigger, PopoverContent, PopoverAnchor };\n","\"use client\";\r\n\r\nimport * as React from \"react\";\r\n\r\nimport { ChevronLeft, ChevronRight } from \"lucide-react\";\r\n\r\nimport { DayPicker } from \"react-day-picker\";\r\nimport { Locale } from \"date-fns\";\r\nimport { buttonVariants } from \"@/components/ui/button\";\r\nimport { cn } from \"@/lib/utils\";\r\n\r\nexport type CalendarProps = React.ComponentProps<typeof DayPicker> & {\r\n  locale?: Locale;\r\n};\r\n\r\nfunction Calendar({\r\n  className,\r\n  classNames,\r\n  showOutsideDays = true,\r\n  locale,\r\n  ...props\r\n}: CalendarProps) {\r\n  return (\r\n    <DayPicker\r\n      showOutsideDays={showOutsideDays}\r\n      className={cn(\"p-3\", className)}\r\n      classNames={{\r\n        months: \"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0\",\r\n        month: \"space-y-4\",\r\n        caption: \"flex justify-center pt-1 relative items-center\",\r\n        caption_label: \"text-sm font-medium\",\r\n        nav: \"space-x-1 flex items-center\",\r\n        nav_button: cn(\r\n          buttonVariants({ variant: \"outline\" }),\r\n          \"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100\",\r\n        ),\r\n        nav_button_previous: \"absolute left-1\",\r\n        nav_button_next: \"absolute right-1\",\r\n        month_grid: \"w-full border-collapse space-y-1\",\r\n        weekdays: \"flex\",\r\n        weekday:\r\n          \"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]\",\r\n        week: \"flex w-full mt-2\",\r\n        cell: \"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20\",\r\n        day: cn(\r\n          buttonVariants({ variant: \"ghost\" }),\r\n          \"h-9 w-9 p-0 font-normal aria-selected:opacity-100 hover:!bg-primary hover:!text-primary-foreground dark:hover:!bg-primary dark:hover:!text-primary-foreground transition-colors duration-200 active:scale-95 active:ring-1 active:ring-primary/50\",\r\n        ),\r\n        day_range_end: \"day-range-end\",\r\n        day_selected:\r\n          \"bg-primary text-primary-foreground hover:!bg-primary hover:!text-primary-foreground focus:bg-primary focus:text-primary-foreground active:scale-95\",\r\n        day_today: \"bg-accent text-accent-foreground hover:!bg-primary hover:!text-primary-foreground active:scale-95\",\r\n        day_outside:\r\n          \"day-outside text-muted-foreground opacity-50 aria-selected:bg-accent/50 aria-selected:text-muted-foreground aria-selected:opacity-30 hover:!bg-primary/50 hover:!text-primary-foreground active:scale-95\",\r\n        day_disabled: \"text-muted-foreground opacity-50\",\r\n        day_range_middle:\r\n          \"aria-selected:bg-accent aria-selected:text-accent-foreground\",\r\n        day_hidden: \"invisible\",\r\n        ...classNames,\r\n      }}\r\n      components={{\r\n        Chevron: ({ className, orientation, ...props }) =>\r\n          orientation === \"left\" ? (\r\n            <ChevronLeft className={cn(className, \"h-4 w-4\")} {...props} />\r\n          ) : (\r\n            <ChevronRight className={cn(className, \"h-4 w-4\")} {...props} />\r\n          ),\r\n      }}\r\n      locale={locale}\r\n      weekStartsOn={locale?.options?.weekStartsOn ?? 1}\r\n      {...props}\r\n    />\r\n  );\r\n}\r\nCalendar.displayName = \"Calendar\";\r\n\r\nexport { Calendar };\r\n","\"use client\";\r\n\r\nimport { AlertCircle, CalendarIcon, CheckCircle, Loader2, PlusCircle, XCircle } from \"lucide-react\";\r\nimport { CalculationInput, CalculationResult, calculateInvoiceSplit } from \"@/lib/calculations\";\r\nimport {\r\n    FormControl,\r\n    FormDescription,\r\n    FormField,\r\n    FormItem,\r\n    FormLabel,\r\n    FormMessage,\r\n} from \"@/components/ui/form\";\r\nimport { FormProvider, useFieldArray, useForm, useWatch } from \"react-hook-form\";\r\nimport { Popover, PopoverContent, PopoverTrigger } from \"@/components/ui/popover\";\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\r\nimport { cn, safeText } from \"@/lib/utils\";\r\nimport { de, enUS } from 'date-fns/locale';\r\nimport { format, isValid, parse, startOfDay } from \"date-fns\";\r\nimport { useCallback, useEffect, useMemo, useRef, useState } from \"react\";\r\n\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Calendar } from \"@/components/ui/calendar\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport React from \"react\";\r\nimport { Switch } from \"@/components/ui/switch\";\r\nimport { debounce } from 'lodash';\r\nimport { useTranslation } from '@/translations';\r\nimport { z } from \"zod\";\r\nimport { zodResolver } from \"@hookform/resolvers/zod\";\r\n\r\n// Constants for date formats\r\nconst DATE_FORMAT_ISO = \"yyyy-MM-dd\";\r\nconst DATE_FORMAT_DE = \"dd.MM.yyyy\";\r\nconst DATE_FORMAT_US = \"MM/dd/yyyy\";\r\nconst DATE_FORMAT_DOTS = \"dd.MM.yy\";\r\nconst DATE_FORMAT_SLASHES = \"MM/dd/yy\";\r\nconst DATE_FORMAT_DASHES = \"dd-MM-yyyy\";\r\n\r\n// List of all supported date formats for parsing\r\nconst supportedDateFormats = [\r\n    DATE_FORMAT_ISO,\r\n    DATE_FORMAT_DE,\r\n    DATE_FORMAT_US,\r\n    DATE_FORMAT_DOTS,\r\n    DATE_FORMAT_SLASHES,\r\n    DATE_FORMAT_DASHES\r\n];\r\n\r\n// Function to try parsing a date string with multiple formats\r\nconst tryParseDate = (value: string): Date | null => {\r\n    if (!value) return null;\r\n\r\n    // Trim the input\r\n    const trimmedValue = value.trim();\r\n    \r\n    // Basic format check before attempting parsing - require separators\r\n    const hasDateSeparators = /[\\.\\-\\/]/.test(trimmedValue);\r\n    if (!hasDateSeparators) {\r\n        return null;\r\n    }\r\n    \r\n    // Validate against common date patterns to ensure complete dates\r\n    const validDatePattern = /^(\\d{4}-\\d{2}-\\d{2}|\\d{2}\\.\\d{2}\\.\\d{4}|\\d{2}\\/\\d{2}\\/\\d{4}|\\d{2}-\\d{2}-\\d{4})$/;\r\n    if (!validDatePattern.test(trimmedValue)) {\r\n        return null;\r\n    }\r\n    \r\n    // Attempt parsing with supported formats\r\n    for (const format of supportedDateFormats) {\r\n        const attemptedParse = parse(trimmedValue, format, new Date());\r\n        if (isValid(attemptedParse)) {\r\n            return startOfDay(attemptedParse);\r\n        }\r\n    }\r\n\r\n    return null;\r\n};\r\n\r\n// Update CalculationInput type to include splitPeriod\r\ndeclare module '@/lib/calculations' {\r\n    interface CalculationInput {\r\n        splitPeriod?: 'yearly' | 'quarterly' | 'monthly';\r\n    }\r\n}\r\n\r\n// Define the error type to match invoice-calculator-client.tsx\r\ntype CalculationErrorType = string | Error | { message?: string; [key: string]: unknown } | null | undefined;\r\n\r\n// Schema for form validation\r\nconst formSchema = (t: ReturnType<typeof useTranslation>['t']) => z\r\n    .object({\r\n        startDateString: z.string().optional(),\r\n        endDateString: z.string().optional(),\r\n        includeEndDate: z.boolean(),\r\n        splitPeriod: z.enum(['yearly', 'quarterly', 'monthly']),\r\n        amounts: z.array(z.object({\r\n            value: z.string()\r\n                .min(1, { message: t('InvoiceForm.errorAmountValueRequired') })\r\n                .refine((val) => !isNaN(parseFloat(val)) && parseFloat(val) > 0, {\r\n                    message: t('InvoiceForm.errorAmountPositive'),\r\n                })\r\n        })).min(1, t('InvoiceForm.errorAmountRequired'))\r\n    })\r\n    .refine((data) => {\r\n        const startDate = tryParseDate(data.startDateString || '');\r\n        return !!startDate;\r\n    }, {\r\n        message: t('InvoiceForm.errorStartDateRequired'),\r\n        path: [\"startDateString\"],\r\n    })\r\n    .refine((data) => {\r\n        const endDate = tryParseDate(data.endDateString || '');\r\n        return !!endDate;\r\n    }, {\r\n        message: t('InvoiceForm.errorEndDateRequired'),\r\n        path: [\"endDateString\"],\r\n    })\r\n    .refine((data) => {\r\n        const startDate = tryParseDate(data.startDateString || '');\r\n        const endDate = tryParseDate(data.endDateString || '');\r\n        return !startDate || !endDate || endDate >= startDate;\r\n    }, {\r\n        message: t('InvoiceForm.errorEndDateBeforeStart'),\r\n        path: [\"endDateString\"],\r\n    });\r\n\r\n// Form data type\r\ntype FormSchemaType = z.infer<ReturnType<typeof formSchema>>;\r\n\r\n// Data passed back to parent on calculation\r\nexport type CalculationCallbackData = {\r\n    startDate: Date;\r\n    endDate: Date;\r\n    includeEndDate: boolean;\r\n    splitPeriod: 'yearly' | 'quarterly' | 'monthly';\r\n    amounts: number[];\r\n} | null;\r\n\r\n// Type definition for demo data\r\ntype DemoDataType = {\r\n  startDateString?: string;\r\n  endDateString?: string;\r\n  amount?: string;\r\n  includeEndDate?: boolean;\r\n  splitPeriod?: 'yearly' | 'quarterly' | 'monthly';\r\n  isDemo?: boolean;\r\n} | null;\r\n\r\ninterface InvoiceFormProps {\r\n    onCalculateAction: (formData: CalculationCallbackData, results: CalculationResult | null, error?: CalculationErrorType) => void;\r\n    initialDemoData?: DemoDataType | null;\r\n    onDemoDataApplied?: () => void;\r\n}\r\n\r\nexport function InvoiceForm({ \r\n    onCalculateAction, \r\n    initialDemoData,\r\n    onDemoDataApplied \r\n}: InvoiceFormProps) {\r\n    const { t, i18n } = useTranslation();\r\n    const [mounted, setMounted] = useState(false);\r\n    const [isCalculating, setIsCalculating] = useState(false);\r\n    const [buttonText, setButtonText] = useState('');\r\n    const [showSuccessGlow, setShowSuccessGlow] = useState(false);\r\n    const initRef = useRef(false);\r\n\r\n    const currentLocale = i18n.language.startsWith('de') ? de : enUS;\r\n    const displayDateFormat = i18n.language.startsWith('de') ? DATE_FORMAT_DE : DATE_FORMAT_ISO;\r\n    const dateExamplePlaceholder = i18n.language.startsWith('de') ? 'z.B. 31.12.2023' : 'e.g. 2023-12-31';\r\n    const storageKey = 'invoiceFormDataCache';\r\n    \r\n    // State for popover visibility\r\n    const [isStartDatePopoverOpen, setIsStartDatePopoverOpen] = useState(false);\r\n    const [isEndDatePopoverOpen, setIsEndDatePopoverOpen] = useState(false);\r\n\r\n    const currentFormSchema = formSchema(t);\r\n    const form = useForm<FormSchemaType>({\r\n        resolver: zodResolver(currentFormSchema),\r\n        defaultValues: {\r\n            startDateString: '',\r\n            endDateString: '',\r\n            includeEndDate: true,\r\n            splitPeriod: 'yearly' as const,\r\n            amounts: [{ value: '' }]\r\n        },\r\n        mode: \"onBlur\",\r\n    });\r\n\r\n    const { fields, append, remove } = useFieldArray({\r\n        control: form.control,\r\n        name: \"amounts\"\r\n    });\r\n\r\n    // MOVED: Debounced function to save data to localStorage (BEFORE the effects that use it)\r\n    const debouncedSaveFunction = useMemo(\r\n        () => debounce((dataToSave: FormSchemaType) => {\r\n            if (mounted) {\r\n                try {\r\n                    // Don't save during initial load or auto-submit\r\n                    if (initRef.current) {\r\n                        const amountsToSave = dataToSave.amounts?.length > 0\r\n                            ? dataToSave.amounts\r\n                            : [{ value: '' }];\r\n                        const saveData = { ...dataToSave, amounts: amountsToSave };\r\n                        \r\n                        console.log(\"[InvoiceForm] Saving form data to localStorage:\", saveData);\r\n                        localStorage.setItem(storageKey, JSON.stringify(saveData));\r\n                    }\r\n                } catch (error) {\r\n                    console.error(\"[InvoiceForm] Failed to save form data to localStorage:\", error);\r\n                }\r\n            }\r\n        }, 500),\r\n        [mounted] // Only depends on mounted state\r\n    );\r\n    \r\n    // Effect to trigger debounced save when form values change\r\n    const watchedFields = useWatch({ control: form.control });\r\n    useEffect(() => {\r\n        if (mounted) {\r\n            debouncedSaveFunction(form.getValues());\r\n        }\r\n    }, [watchedFields, debouncedSaveFunction, form, mounted]);\r\n    \r\n    // Cleanup function in a separate effect\r\n    useEffect(() => {\r\n        return () => {\r\n            debouncedSaveFunction.cancel();\r\n            // Close any open popovers to ensure proper cleanup\r\n            setIsStartDatePopoverOpen(false);\r\n            setIsEndDatePopoverOpen(false);\r\n            \r\n            console.log(\"[InvoiceForm] Component unmounting, cancelled pending save operations.\");\r\n            // DO NOT set mounted=false here, as it will cause re-renders in StrictMode\r\n        };\r\n    }, [debouncedSaveFunction]);\r\n\r\n    const onSubmit = useCallback((values: FormSchemaType) => {\r\n        setIsCalculating(true);\r\n        setButtonText(t('InvoiceForm.calculatingButton'));\r\n        const startDate = tryParseDate(values.startDateString || '');\r\n        const endDate = tryParseDate(values.endDateString || '');\r\n        if (!startDate || !endDate) {\r\n            onCalculateAction(null, null, t('Errors.unexpectedError')); \r\n            setIsCalculating(false);\r\n            setButtonText(t('InvoiceForm.calculateButton', { defaultValue: 'Calculate Split' }));\r\n            return; \r\n        }\r\n        const amountsNum = values.amounts.map(amount => Number(amount.value));\r\n        const splitPeriod = values.splitPeriod || 'yearly';\r\n        const validFormData: CalculationCallbackData = {\r\n            startDate, endDate, includeEndDate: values.includeEndDate, splitPeriod, amounts: amountsNum,\r\n        };\r\n        onCalculateAction(validFormData, null, undefined);\r\n        const calculationInput: CalculationInput = {\r\n            startDate, endDate, includeEndDate: values.includeEndDate, amounts: amountsNum, splitPeriod,\r\n        };\r\n        try {\r\n            const results = calculateInvoiceSplit(calculationInput);\r\n            setTimeout(() => {\r\n                if (results.calculationSteps?.error) {\r\n                    onCalculateAction(validFormData, null, safeText(results.calculationSteps.error));\r\n                } else if (!results.aggregatedSplits || results.aggregatedSplits.length === 0) {\r\n                    onCalculateAction(validFormData, null, \"Calculation completed but resulted in no splits.\");\r\n                } else {\r\n                    onCalculateAction(validFormData, results);\r\n                    setButtonText(t('InvoiceForm.calculationComplete', { defaultValue: 'Split completed successfully!' }));\r\n                    setShowSuccessGlow(true);\r\n                    setTimeout(() => {\r\n                        setButtonText(t('InvoiceForm.calculateButton', { defaultValue: 'Calculate Split' }));\r\n                        setShowSuccessGlow(false);\r\n                    }, 2000);\r\n                }\r\n                setIsCalculating(false);\r\n            }, 300);\r\n        } catch (error) {\r\n            // Improved error handling to properly format errors\r\n            let errorMessage: CalculationErrorType;\r\n            \r\n            if (error instanceof Error) {\r\n                // Use Error object directly, don't convert to string\r\n                errorMessage = error;\r\n            } else if (typeof error === 'string') {\r\n                errorMessage = error;\r\n            } else if (error && typeof error === 'object') {\r\n                // Pass the object as is, let the parent component handle stringification\r\n                errorMessage = error as { [key: string]: unknown };\r\n            } else {\r\n                // Fallback for unknown error types\r\n                errorMessage = t('Errors.unexpectedError');\r\n            }\r\n            \r\n            onCalculateAction(validFormData, null, errorMessage);\r\n            setTimeout(() => {\r\n                setIsCalculating(false);\r\n                setButtonText(t('InvoiceForm.calculateButton', { defaultValue: 'Calculate Split' }));\r\n            }, 300);\r\n        }\r\n    }, [t, onCalculateAction, setIsCalculating, setButtonText, setShowSuccessGlow]);\r\n\r\n    // Effect to ensure splitPeriod always has a value\r\n    useEffect(() => {\r\n        const currentSplitPeriod = form.getValues('splitPeriod');\r\n        if (!currentSplitPeriod) {\r\n            form.setValue('splitPeriod', 'yearly');\r\n        }\r\n    }, [form]);\r\n\r\n    // Single useEffect for initialization and theme handling\r\n    useEffect(() => {\r\n        if (!mounted) {\r\n            console.log(\"[InvoiceForm] Component mounting\");\r\n            setMounted(true);\r\n            setButtonText(t('InvoiceForm.calculateButton', { defaultValue: 'Calculate Split' }));\r\n            \r\n            // Don't try to access localStorage until component is mounted\r\n            return;\r\n        }\r\n        \r\n        // Only run initialization logic once\r\n        if (initRef.current) {\r\n            return;\r\n        }\r\n        \r\n        initRef.current = true;\r\n        console.log(\"[InvoiceForm] Initializing form data...\");\r\n        \r\n        try {\r\n            // Initialization priority:\r\n            // 1. Demo data from props\r\n            // 2. Clean URL parameter\r\n            // 3. Cached data from localStorage\r\n            // 4. Default values\r\n            \r\n            // Check if demo data is provided\r\n            if (initialDemoData) {\r\n                console.log(\"[InvoiceForm] Using demo data from prop:\", initialDemoData);\r\n                \r\n                const demoFormData = {\r\n                    startDateString: initialDemoData.startDateString || '',\r\n                    endDateString: initialDemoData.endDateString || '',\r\n                    includeEndDate: initialDemoData.includeEndDate === true,\r\n                    splitPeriod: initialDemoData.splitPeriod || 'yearly',\r\n                    amounts: [{ value: initialDemoData.amount ? String(initialDemoData.amount) : '' }]\r\n                };\r\n\r\n                // Apply demo data to form\r\n                form.reset(demoFormData);\r\n                \r\n                // Save demo data to localStorage\r\n                localStorage.setItem(storageKey, JSON.stringify(demoFormData));\r\n                \r\n                // Notify parent that demo data was processed\r\n                if (onDemoDataApplied) {\r\n                    console.log(\"[InvoiceForm] Notifying parent that demo data was applied\");\r\n                    onDemoDataApplied();\r\n                }\r\n                \r\n                // Auto-submit the form after a short delay\r\n                setTimeout(() => {\r\n                    form.trigger().then(isValid => {\r\n                        if (isValid) {\r\n                            console.log(\"[InvoiceForm] Form is valid, auto-submitting\");\r\n                            form.handleSubmit(onSubmit)();\r\n                        } else {\r\n                            console.warn(\"[InvoiceForm] Auto-submit cancelled - validation failed:\", form.formState.errors);\r\n                        }\r\n                    });\r\n                }, 350);\r\n                \r\n                return;\r\n            }\r\n            \r\n            // Check for clean URL parameter\r\n            const urlParams = new URLSearchParams(window.location.search);\r\n            const forceClean = urlParams.get('clean') === 'true';\r\n            \r\n            if (forceClean) {\r\n                console.log(\"[InvoiceForm] 'clean=true' parameter detected, clearing cache\");\r\n                localStorage.removeItem(storageKey);\r\n                form.reset({\r\n                    startDateString: '',\r\n                    endDateString: '',\r\n                    includeEndDate: true,\r\n                    splitPeriod: 'yearly',\r\n                    amounts: [{ value: '' }]\r\n                });\r\n                return;\r\n            }\r\n            \r\n            // Try loading from cache\r\n            const cachedDataString = localStorage.getItem(storageKey);\r\n            if (cachedDataString) {\r\n                console.log(\"[InvoiceForm] Loading data from localStorage cache\");\r\n                try {\r\n                    const parsedCache = JSON.parse(cachedDataString) as FormSchemaType;\r\n                    if (!parsedCache.amounts || parsedCache.amounts.length === 0) {\r\n                        parsedCache.amounts = [{ value: '' }];\r\n                    }\r\n                    form.reset(parsedCache);\r\n                } catch (error) {\r\n                    console.error(\"[InvoiceForm] Error parsing cached data:\", error);\r\n                    localStorage.removeItem(storageKey);\r\n                    form.reset({\r\n                        startDateString: '',\r\n                        endDateString: '',\r\n                        includeEndDate: true,\r\n                        splitPeriod: 'yearly',\r\n                        amounts: [{ value: '' }]\r\n                    });\r\n                }\r\n            } else {\r\n                console.log(\"[InvoiceForm] No cached data found, using defaults\");\r\n                // No need to reset - form already has default values\r\n            }\r\n        } catch (error) {\r\n            // Fallback if there are any errors accessing localStorage\r\n            console.error(\"[InvoiceForm] Error during initialization:\", error);\r\n            form.reset({\r\n                startDateString: '',\r\n                endDateString: '',\r\n                includeEndDate: true,\r\n                splitPeriod: 'yearly',\r\n                amounts: [{ value: '' }]\r\n            });\r\n        }\r\n    }, [\r\n        mounted, \r\n        initialDemoData, \r\n        onDemoDataApplied, \r\n        t, \r\n        form, \r\n        storageKey,\r\n        onSubmit\r\n    ]);\r\n    \r\n    const getDateHelpText = () => {\r\n        if (i18n.language.startsWith('de')) {\r\n            return t('InvoiceForm.supportedDateFormats', { defaultValue: 'Unterstützte Formate: TT.MM.JJJJ, JJJJ-MM-TT' });\r\n        } else {\r\n            return t('InvoiceForm.supportedDateFormats', { defaultValue: 'Supported formats: YYYY-MM-DD, DD.MM.YYYY' });\r\n        }\r\n    };\r\n\r\n    const onSelectStartDate = (date: Date | undefined) => {\r\n        if (date) {\r\n            const formatted = format(date, displayDateFormat);\r\n            form.setValue(\"startDateString\", formatted, { shouldValidate: true });\r\n        }\r\n        setIsStartDatePopoverOpen(false);\r\n    };\r\n\r\n    const onSelectEndDate = (date: Date | undefined) => {\r\n        if (date) {\r\n            const formatted = format(date, displayDateFormat);\r\n            form.setValue(\"endDateString\", formatted, { shouldValidate: true });\r\n        }\r\n        setIsEndDatePopoverOpen(false);\r\n    };\r\n\r\n    const handleStartDateChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n        const value = e.target.value;\r\n        \r\n        // Clear any previous errors\r\n        form.clearErrors(\"startDateString\");\r\n        \r\n        // Set the new value\r\n        form.setValue(\"startDateString\", value, { shouldValidate: false });\r\n        \r\n        // Validate the date format\r\n        const parsedDate = tryParseDate(value);\r\n        if (value && !parsedDate) {\r\n            form.setError(\"startDateString\", {\r\n                type: \"manual\",\r\n                message: getDateHelpText()\r\n            });\r\n        } \r\n        // If this is a valid date, check if end date is now invalid in comparison\r\n        else if (parsedDate) {\r\n            const endDateValue = form.getValues(\"endDateString\");\r\n            const endDate = tryParseDate(endDateValue ?? '');\r\n            \r\n            // If end date exists and is now before start date, set end date error\r\n            if (endDate && endDate < parsedDate) {\r\n                form.setError(\"endDateString\", {\r\n                    type: \"manual\",\r\n                    message: t('InvoiceForm.errorEndDateBeforeStart')\r\n                });\r\n            }\r\n        }\r\n        \r\n        // Always trigger validation to update form state\r\n        form.trigger(\"startDateString\");\r\n    };\r\n\r\n    const handleEndDateChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n        const value = e.target.value;\r\n        \r\n        // Clear any previous errors\r\n        form.clearErrors(\"endDateString\");\r\n        \r\n        // Set the new value\r\n        form.setValue(\"endDateString\", value, { shouldValidate: false });\r\n        \r\n        // Validate the date format\r\n        const parsedDate = tryParseDate(value);\r\n        if (value && !parsedDate) {\r\n            form.setError(\"endDateString\", {\r\n                type: \"manual\",\r\n                message: getDateHelpText()\r\n            });\r\n        } \r\n        // If this is a valid date, check if it's before the start date\r\n        else if (parsedDate) {\r\n            const startDateValue = form.getValues(\"startDateString\");\r\n            const startDate = tryParseDate(startDateValue ?? '');\r\n            \r\n            // If start date exists and end date is before it, set error\r\n            if (startDate && parsedDate < startDate) {\r\n                form.setError(\"endDateString\", {\r\n                    type: \"manual\",\r\n                    message: t('InvoiceForm.errorEndDateBeforeStart')\r\n                });\r\n            }\r\n        }\r\n        \r\n        // Always trigger validation to update form state\r\n        form.trigger(\"endDateString\");\r\n    };\r\n\r\n    if (!mounted) {\r\n        return (\r\n            <div className=\"space-y-6\">\r\n                {/* Date fields grid */}\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n                   <div className=\"space-y-2\">\r\n                        <div className=\"h-4 bg-muted/60 rounded-sm animate-pulse w-2/5\" />\r\n                        <div className=\"h-10 bg-muted/60 rounded-md animate-pulse w-full\" />\r\n                   </div>\r\n                    <div className=\"space-y-2\">\r\n                        <div className=\"h-4 bg-muted/60 rounded-sm animate-pulse w-2/5\" />\r\n                        <div className=\"h-10 bg-muted/60 rounded-md animate-pulse w-full\" />\r\n                   </div>\r\n                </div>\r\n                \r\n                {/* Include End Date toggle */}\r\n                <div className=\"h-20 bg-muted/40 rounded-lg animate-pulse border border-muted/30 p-4 flex justify-between items-center\">\r\n                    <div className=\"space-y-2\">\r\n                        <div className=\"h-4 bg-muted/60 rounded-sm animate-pulse w-40\" />\r\n                        <div className=\"h-3 bg-muted/60 rounded-sm animate-pulse w-56\" />\r\n                    </div>\r\n                    <div className=\"h-6 w-12 bg-muted/60 rounded-full animate-pulse\" />\r\n                </div>\r\n                \r\n                {/* Split Period dropdown */}\r\n                <div className=\"h-20 bg-muted/40 rounded-lg animate-pulse border border-muted/30 p-4 flex justify-between items-center\">\r\n                    <div className=\"space-y-2\">\r\n                        <div className=\"h-4 bg-muted/60 rounded-sm animate-pulse w-32\" />\r\n                        <div className=\"h-3 bg-muted/60 rounded-sm animate-pulse w-64\" />\r\n                    </div>\r\n                    <div className=\"h-10 w-28 bg-muted/60 rounded-md animate-pulse\" />\r\n                </div>\r\n                \r\n                {/* Amounts section */}\r\n                <div className=\"rounded-lg border border-muted/30 p-6 shadow-xs space-y-4 bg-muted/10\">\r\n                    <div className=\"h-5 bg-muted/60 rounded-sm animate-pulse w-1/4\" />\r\n                    <div className=\"h-4 bg-muted/60 rounded-sm animate-pulse w-3/5 mb-4\" />\r\n                    <div className=\"space-y-4\">\r\n                        <div className=\"space-y-2\">\r\n                            <div className=\"h-3 bg-muted/60 rounded-sm animate-pulse w-8\" />\r\n                            <div className=\"flex gap-2\">\r\n                                <div className=\"h-10 bg-muted/60 rounded-md animate-pulse flex-grow\" />\r\n                                <div className=\"h-10 w-10 bg-muted/60 rounded-md animate-pulse opacity-0\" />\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"h-8 bg-muted/60 rounded-md animate-pulse w-40 mt-6\" />\r\n                </div>\r\n              \r\n                {/* Calculate button */}\r\n                <div className=\"h-11 bg-primary/40 rounded-md animate-pulse w-full\" />\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <FormProvider {...form}>\r\n            <form \r\n                onSubmit={form.handleSubmit(onSubmit)} \r\n                className={cn(\"space-y-6\", mounted && \"opacity-100 transition-opacity duration-500 ease-in-out\", !mounted && \"opacity-0\")}\r\n            >\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n                    <FormField \r\n                        control={form.control} \r\n                        name=\"startDateString\" \r\n                        render={({ field }) => (\r\n                            <FormItem className=\"flex flex-col\">\r\n                                <FormLabel htmlFor=\"startDateString\">{t('InvoiceForm.startDateLabel')}</FormLabel>\r\n                                <Popover open={isStartDatePopoverOpen} onOpenChange={setIsStartDatePopoverOpen}>\r\n                                    <FormControl>\r\n                                        <div className=\"w-full relative\">\r\n                                            <Input \r\n                                                value={field.value} \r\n                                                onChange={(e) => { \r\n                                                    field.onChange(e); \r\n                                                    handleStartDateChange(e); \r\n                                                }} \r\n                                                onBlur={() => form.trigger(\"startDateString\")} \r\n                                                placeholder={dateExamplePlaceholder} \r\n                                                className={`w-full pr-16 ${form.formState.errors.startDateString ? \"border-destructive focus:border-destructive focus:ring-2 focus:ring-destructive/20\" : \"\"}`} \r\n                                                autoFocus \r\n                                                id=\"startDateString\"\r\n                                                name=\"startDateString\"\r\n                                            />\r\n                                            {field.value && !form.formState.errors.startDateString && (\r\n                                                <div className=\"absolute inset-y-0 right-12 flex items-center z-[1]\">\r\n                                                    <CheckCircle className=\"h-4 w-4 text-green-500\" />\r\n                                                </div>\r\n                                            )}\r\n                                            {form.formState.errors.startDateString && (\r\n                                                <div className=\"absolute inset-y-0 right-12 flex items-center z-[1]\">\r\n                                                    <AlertCircle className=\"h-4 w-4 text-destructive\" />\r\n                                                </div>\r\n                                            )}\r\n                                            <div className=\"absolute inset-y-0 right-0 pr-3 flex items-center z-[1]\">\r\n                                                <PopoverTrigger asChild>\r\n                                                    <Button \r\n                                                        type=\"button\" \r\n                                                        variant=\"ghost\" \r\n                                                        className=\"h-7 w-7 p-0 rounded-full hover:bg-primary hover:text-primary-foreground transition-colors duration-200 cursor-pointer\" \r\n                                                        aria-label=\"Pick a date\"\r\n                                                    >\r\n                                                        <CalendarIcon className=\"h-4 w-4 transition-colors duration-200\" />\r\n                                                    </Button>\r\n                                                </PopoverTrigger>\r\n                                            </div>\r\n                                        </div>\r\n                                    </FormControl>\r\n                                    <PopoverContent className=\"w-auto p-0\" align=\"start\">\r\n                                        <Calendar \r\n                                            mode=\"single\" \r\n                                            selected={tryParseDate(form.watch(\"startDateString\") ?? '') || undefined} \r\n                                            onSelect={onSelectStartDate} \r\n                                            initialFocus \r\n                                            locale={currentLocale}\r\n                                            defaultMonth={tryParseDate(form.watch(\"startDateString\") ?? '') || new Date()}\r\n                                        />\r\n                                    </PopoverContent>\r\n                                </Popover>\r\n                                <FormMessage className=\"text-xs mt-1 error-message\">{form.formState.errors.startDateString?.message}</FormMessage>\r\n                            </FormItem>\r\n                        )} \r\n                    />\r\n                    <FormField \r\n                        control={form.control} \r\n                        name=\"endDateString\" \r\n                        render={({ field }) => (\r\n                            <FormItem className=\"flex flex-col\">\r\n                                <FormLabel htmlFor=\"endDateString\">{t('InvoiceForm.endDateLabel')}</FormLabel>\r\n                                <Popover open={isEndDatePopoverOpen} onOpenChange={setIsEndDatePopoverOpen}>\r\n                                    <FormControl>\r\n                                        <div className=\"w-full relative\">\r\n                                            <Input \r\n                                                value={field.value} \r\n                                                onChange={(e) => { \r\n                                                    field.onChange(e); \r\n                                                    handleEndDateChange(e); \r\n                                                }} \r\n                                                onBlur={() => form.trigger(\"endDateString\")} \r\n                                                placeholder={dateExamplePlaceholder} \r\n                                                className={`w-full pr-16 ${form.formState.errors.endDateString ? \"border-destructive focus:border-destructive focus:ring-2 focus:ring-destructive/20\" : \"\"}`} \r\n                                                id=\"endDateString\"\r\n                                                name=\"endDateString\"\r\n                                            />\r\n                                            {field.value && !form.formState.errors.endDateString && (\r\n                                                <div className=\"absolute inset-y-0 right-12 flex items-center z-[1]\">\r\n                                                    <CheckCircle className=\"h-4 w-4 text-green-500\" />\r\n                                                </div>\r\n                                            )}\r\n                                            {form.formState.errors.endDateString && (\r\n                                                <div className=\"absolute inset-y-0 right-12 flex items-center z-[1]\">\r\n                                                    <AlertCircle className=\"h-4 w-4 text-destructive\" />\r\n                                                </div>\r\n                                            )}\r\n                                            <div className=\"absolute inset-y-0 right-0 pr-3 flex items-center z-[1]\">\r\n                                                <PopoverTrigger asChild>\r\n                                                    <Button \r\n                                                        type=\"button\" \r\n                                                        variant=\"ghost\" \r\n                                                        className=\"h-7 w-7 p-0 rounded-full hover:bg-primary hover:text-primary-foreground transition-colors duration-200 cursor-pointer\" \r\n                                                        aria-label=\"Pick a date\"\r\n                                                    >\r\n                                                        <CalendarIcon className=\"h-4 w-4 transition-colors duration-200\" />\r\n                                                    </Button>\r\n                                                </PopoverTrigger>\r\n                                            </div>\r\n                                        </div>\r\n                                    </FormControl>\r\n                                    <PopoverContent className=\"w-auto p-0\" align=\"start\">\r\n                                        <Calendar \r\n                                            mode=\"single\" \r\n                                            selected={tryParseDate(form.watch(\"endDateString\") ?? '') || undefined} \r\n                                            onSelect={onSelectEndDate} \r\n                                            initialFocus \r\n                                            locale={currentLocale}\r\n                                            defaultMonth={tryParseDate(form.watch(\"endDateString\") ?? '') || tryParseDate(form.watch(\"startDateString\") ?? '') || new Date()}\r\n                                            disabled={(date) => { \r\n                                                const startDate = tryParseDate(form.watch(\"startDateString\") ?? ''); \r\n                                                return startDate ? date < startDate : false; \r\n                                            }} \r\n                                        />\r\n                                    </PopoverContent>\r\n                                </Popover>\r\n                                <FormMessage className=\"text-xs mt-1 error-message\">{form.formState.errors.endDateString?.message}</FormMessage>\r\n                            </FormItem>\r\n                        )} \r\n                    />\r\n                </div>\r\n                <FormField \r\n                    control={form.control} \r\n                    name=\"includeEndDate\" \r\n                    render={({ field }) => (\r\n                        <FormItem className=\"flex flex-row items-center justify-between rounded-lg border p-4\">\r\n                            <div className=\"space-y-0.5\">\r\n                                <FormLabel htmlFor=\"includeEndDate\" className=\"text-base\">{t('InvoiceForm.includeEndDateLabel')}</FormLabel>\r\n                                <FormDescription>{t('InvoiceForm.includeEndDateDescription')}</FormDescription>\r\n                            </div>\r\n                            <FormControl>\r\n                                <Switch \r\n                                    checked={field.value} \r\n                                    onCheckedChange={field.onChange}\r\n                                    id=\"includeEndDate\"\r\n                                    name=\"includeEndDate\"\r\n                                    className=\"include-end-date-switch\"\r\n                                />\r\n                            </FormControl>\r\n                        </FormItem>\r\n                    )} \r\n                />\r\n                <FormField \r\n                    control={form.control} \r\n                    name=\"splitPeriod\" \r\n                    render={({ field }) => (\r\n                        <FormItem className=\"flex flex-col items-start justify-start rounded-lg border p-4\">\r\n                            <div className=\"space-y-0.5 pr-4 mb-3\">\r\n                                <FormLabel htmlFor=\"splitPeriod\" className=\"text-base\">{t('InvoiceForm.splitPeriodLabel', { defaultValue: 'Split Period' })}</FormLabel>\r\n                                <FormDescription>{t('InvoiceForm.splitPeriodDescription', { defaultValue: 'Choose how to split the invoice amounts.' })}</FormDescription>\r\n                            </div>\r\n                            <div className=\"w-full\">\r\n                                <Select \r\n                                    onValueChange={field.onChange} \r\n                                    defaultValue={field.value}\r\n                                    value={field.value}\r\n                                    name={field.name}\r\n                                >\r\n                                    <FormControl>\r\n                                        <SelectTrigger className=\"w-full\" id=\"splitPeriod\">\r\n                                            <SelectValue placeholder={t('InvoiceForm.periodYearly', { defaultValue: 'Yearly' })} />\r\n                                        </SelectTrigger>\r\n                                    </FormControl>\r\n                                    <SelectContent \r\n                                        className=\"!fixed !z-[9999] !overflow-visible shadow-lg\" \r\n                                        position=\"popper\" \r\n                                        sideOffset={8}\r\n                                        align=\"center\"\r\n                                        avoidCollisions\r\n                                        collisionPadding={20}\r\n                                    >\r\n                                        <SelectItem \r\n                                            key=\"yearly\" \r\n                                            value=\"yearly\" \r\n                                            className=\"select-dropdown-item !cursor-pointer\"\r\n                                            style={{cursor: 'pointer'}}\r\n                                        >\r\n                                            {`${t('InvoiceForm.periodYearly', { defaultValue: 'Yearly' })}`}\r\n                                        </SelectItem>\r\n                                        <SelectItem \r\n                                            key=\"quarterly\" \r\n                                            value=\"quarterly\" \r\n                                            className=\"select-dropdown-item !cursor-pointer\"\r\n                                            style={{cursor: 'pointer'}}\r\n                                        >\r\n                                            {`${t('InvoiceForm.periodQuarterly', { defaultValue: 'Quarterly' })}`}\r\n                                        </SelectItem>\r\n                                        <SelectItem \r\n                                            key=\"monthly\" \r\n                                            value=\"monthly\" \r\n                                            className=\"select-dropdown-item !cursor-pointer\"\r\n                                            style={{cursor: 'pointer'}}\r\n                                        >\r\n                                            {`${t('InvoiceForm.periodMonthly', { defaultValue: 'Monthly' })}`}\r\n                                        </SelectItem>\r\n                                    </SelectContent>\r\n                                </Select>\r\n                                <FormMessage />\r\n                            </div>\r\n                        </FormItem>\r\n                    )} \r\n                />\r\n                <div className=\"space-y-5 rounded-lg border p-6 shadow-xs\">\r\n                    <h3 className=\"text-base font-medium\" id=\"amounts-section-label\">{t('InvoiceForm.amountsLabel')}</h3>\r\n                    <FormDescription>{t('InvoiceForm.amountsDescription')}</FormDescription>\r\n                    <div aria-labelledby=\"amounts-section-label\" className=\"space-y-4 mt-4\">\r\n                    {fields.map((item, index) => (\r\n                        <FormField \r\n                            control={form.control} \r\n                            key={item.id} \r\n                            name={`amounts.${index}.value`} \r\n                            render={({ field }) => (\r\n                                <FormItem className=\"mb-3\">\r\n                                    <div className=\"flex flex-col gap-1\">\r\n                                        <FormLabel htmlFor={`amount-${index}`} className=\"text-sm font-medium\">#{index + 1}</FormLabel>\r\n                                        <div className=\"flex items-center gap-2\">\r\n                                            <div className=\"relative flex-1\">\r\n                                                <FormControl>\r\n                                                    <Input \r\n                                                        type=\"number\" \r\n                                                        step=\"any\" \r\n                                                        className=\"focus:border-primary focus:ring-2 focus:ring-primary/20 transition-transform duration-150 pr-8\" \r\n                                                        {...field} \r\n                                                        id={`amount-${index}`}\r\n                                                        name={`amounts.${index}.value`}\r\n                                                    />\r\n                                                </FormControl>\r\n                                                <div className=\"absolute right-2 top-0 h-full flex items-center justify-center z-[1]\">\r\n                                                    {field.value && !isNaN(parseFloat(field.value)) && parseFloat(field.value) > 0 && (\r\n                                                        <div className=\"flex items-center justify-center h-5 w-5\">\r\n                                                            <CheckCircle className=\"h-4 w-4 text-green-500\" />\r\n                                                        </div>\r\n                                                    )}\r\n                                                    {form.formState.errors.amounts?.[index]?.value && (\r\n                                                        <div className=\"flex items-center justify-center h-5 w-5\">\r\n                                                            <AlertCircle className=\"h-4 w-4 text-destructive\" />\r\n                                                        </div>\r\n                                                    )}\r\n                                                </div>\r\n                                            </div>\r\n                                            {fields.length > 1 && (\r\n                                                <Button \r\n                                                    type=\"button\" \r\n                                                    variant=\"ghost\" \r\n                                                    size=\"icon\" \r\n                                                    onClick={() => remove(index)} \r\n                                                    className=\"text-gray-400 hover:text-gray-500 hover:bg-gray-100 transition-all duration-200 shrink-0\" \r\n                                                    aria-label=\"Remove amount\"\r\n                                                >\r\n                                                    <XCircle className=\"h-4 w-4 transition-transform duration-150 hover:scale-95\" />\r\n                                                </Button>\r\n                                            )}\r\n                                        </div>\r\n                                    </div>\r\n                                    <FormMessage className=\"text-xs mt-1 error-message\" />\r\n                                </FormItem>\r\n                            )} \r\n                        />\r\n                    ))}\r\n                    <Button \r\n                        type=\"button\" \r\n                        variant=\"outline\" \r\n                        size=\"sm\" \r\n                        onClick={() => { \r\n                            append({ value: \"\" }); \r\n                            setTimeout(() => { \r\n                                const ni = document.querySelectorAll('input[type=\"number\"]'); \r\n                                if (ni.length > 0) (ni[ni.length - 1] as HTMLInputElement).focus(); \r\n                            }, 10); \r\n                        }} \r\n                        className=\"mt-4\"\r\n                    >\r\n                        <PlusCircle className=\"mr-2 h-4 w-4\" /> {t('InvoiceForm.addAmountButton')}\r\n                    </Button>\r\n                    {form.formState.errors.amounts && !form.formState.errors.amounts.root && form.formState.errors.amounts.message && (\r\n                        <p className=\"text-sm font-medium text-destructive\">{form.formState.errors.amounts.message}</p>\r\n                    )}\r\n                    {form.formState.errors.amounts?.root?.message && (\r\n                        <p className=\"text-sm font-medium text-destructive\">{form.formState.errors.amounts.root.message}</p>\r\n                    )}\r\n                    </div>\r\n                </div>\r\n                <Button \r\n                    type=\"submit\" \r\n                    variant=\"default\"\r\n                    className={`w-full bg-primary text-primary-foreground hover:bg-primary/90 hover:scale-[1.02] px-6 py-2 h-11 font-medium rounded-md shadow-sm transition-all duration-200 hover:shadow-lg hover:shadow-primary/20 ${showSuccessGlow ? 'animate-success-glow' : ''}`}\r\n                    disabled={form.formState.isSubmitting || isCalculating}\r\n                    aria-live=\"polite\"\r\n                >\r\n                    {isCalculating ? (\r\n                        <span className=\"flex items-center justify-center\">\r\n                            <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\r\n                            {buttonText}\r\n                        </span>\r\n                    ) : (\r\n                        buttonText\r\n                    )}\r\n                </Button>\r\n            </form>\r\n        </FormProvider>\r\n    );\r\n}\r\n\r\n// Need to wrap with TooltipProvider at a higher level if using tooltips inside \r\n","\"use client\";\r\n\r\nimport * as React from \"react\";\r\nimport * as SwitchPrimitive from \"@radix-ui/react-switch\";\r\n\r\nimport { cn } from \"@/lib/utils\";\r\n\r\nfunction Switch({\r\n  className,\r\n  ...props\r\n}: React.ComponentProps<typeof SwitchPrimitive.Root>) {\r\n  return (\r\n    <SwitchPrimitive.Root\r\n      data-slot=\"switch\"\r\n      className={cn(\r\n        \"peer data-[state=checked]:bg-primary data-[state=unchecked]:bg-muted/70 focus-visible:border-ring focus-visible:ring-ring/50 dark:data-[state=unchecked]:bg-input/80 inline-flex h-[1.15rem] w-8 shrink-0 items-center rounded-full border border-transparent shadow-sm transition-all outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 cursor-pointer\",\r\n        className,\r\n      )}\r\n      {...props}\r\n    >\r\n      <SwitchPrimitive.Thumb\r\n        data-slot=\"switch-thumb\"\r\n        className={cn(\r\n          \"bg-white data-[state=checked]:shadow-md dark:data-[state=unchecked]:bg-foreground dark:data-[state=checked]:bg-white pointer-events-none block size-4 rounded-full ring-0 shadow-sm transition-transform data-[state=checked]:translate-x-[calc(100%-2px)] data-[state=unchecked]:translate-x-0\",\r\n        )}\r\n      />\r\n    </SwitchPrimitive.Root>\r\n  );\r\n}\r\n\r\nexport { Switch };\r\n"],"names":["round","value","decimals","Number","Math","Popover","props","PopoverPrimitive","data-slot","PopoverTrigger","PopoverContent","className","align","sideOffset","isMounted","setIsMounted","React","isMountedRef","current","mountTimer","setTimeout","clearTimeout","document","querySelectorAll","forEach","element","parentNode","removeChild","cn","Calendar","classNames","showOutsideDays","locale","DayPicker","months","month","caption","caption_label","nav","nav_button","buttonVariants","variant","nav_button_previous","nav_button_next","month_grid","weekdays","weekday","week","cell","day","day_range_end","day_selected","day_today","day_outside","day_disabled","day_range_middle","day_hidden","components","Chevron","orientation","ChevronLeft","ChevronRight","weekStartsOn","options","displayName","DATE_FORMAT_ISO","DATE_FORMAT_DE","supportedDateFormats","tryParseDate","trimmedValue","trim","test","format","attemptedParse","parse","Date","isValid","startOfDay","formSchema","z","object","startDateString","string","optional","endDateString","includeEndDate","boolean","splitPeriod","enum","amounts","array","min","message","t","refine","isNaN","parseFloat","val","data","path","endDate","startDate","InvoiceForm","onCalculateAction","initialDemoData","onDemoDataApplied","i18n","useTranslation","mounted","setMounted","useState","isCalculating","setIsCalculating","buttonText","setButtonText","showSuccessGlow","setShowSuccessGlow","initRef","useRef","currentLocale","language","startsWith","de","enUS","displayDateFormat","dateExamplePlaceholder","storageKey","isStartDatePopoverOpen","setIsStartDatePopoverOpen","isEndDatePopoverOpen","setIsEndDatePopoverOpen","currentFormSchema","form","useForm","resolver","zodResolver","defaultValues","mode","fields","append","remove","useFieldArray","control","name","debouncedSaveFunction","useMemo","debounce","amountsToSave","dataToSave","length","saveData","console","log","localStorage","setItem","JSON","stringify","error","watchedFields","useWatch","useEffect","cancel","onSubmit","useCallback","values","defaultValue","amountsNum","map","amount","validFormData","undefined","calculationInput","results","calculateInvoiceSplit","input","calcSteps","totalDuration","days","start","end","included","periodSegments","amountCalculations","totalDays","originalTotalAmount","adjustedTotalAmount","resultsPerAmount","aggregatedSplits","calculationSteps","splitPeriodUsed","some","a","reduce","sum","cleanStartDate","cleanEffectiveEndDate","addDays","totalDurationDays","differenceInDays","periodSegmentMap","currentDate","periodIdentifier","getPeriodIdentifier","periodType","year","getYear","date","quarter","getQuarter","toString","nextPeriodBoundary","endOfMonth","endOfQuarter","endOfYear","segmentEndDate","daysInSegment","proportion","Object","entries","identifier","sort","b","localeCompare","amountCalcStep","originalAmount","periodSplits","discrepancy","finalSum","rawSplits","rawSplitAmount","push","rawSplit","roundedSplit","adjustment","roundedSplits","split","step","find","s","rs","currentTotal","periodIdentifierToAdjust","max","abs","splitToAdjust","adjustmentAppliedToPeriod","warn","finalAmountSplits","splitAmount","adjustedTotalForThisAmount","splits","segment","totalSplitForPeriod","amountResult","daysInPeriod","totalSplitAmount","finalAdjustedTotalAmount","finalDiscrepancy","safeText","errorMessage","Error","currentSplitPeriod","getValues","setValue","demoFormData","String","reset","trigger","then","handleSubmit","formState","errors","urlParams","URLSearchParams","window","location","search","forceClean","get","removeItem","cachedDataString","getItem","parsedCache","getDateHelpText","onSelectStartDate","formatted","shouldValidate","onSelectEndDate","handleStartDateChange","e","target","clearErrors","parsedDate","setError","type","handleEndDateChange","FormProvider","div","FormField","render","field","FormItem","FormLabel","htmlFor","open","onOpenChange","FormControl","Input","onChange","onBlur","placeholder","autoFocus","id","CheckCircle","AlertCircle","asChild","Button","aria-label","CalendarIcon","selected","watch","onSelect","initialFocus","defaultMonth","FormMessage","disabled","FormDescription","Switch","checked","onCheckedChange","Select","onValueChange","SelectTrigger","SelectValue","SelectContent","position","avoidCollisions","collisionPadding","SelectItem","style","cursor","h3","aria-labelledby","item","index","size","onClick","XCircle","ni","focus","PlusCircle","root","p","isSubmitting","aria-live","span","Loader2","SwitchPrimitive"],"sourceRoot":""}