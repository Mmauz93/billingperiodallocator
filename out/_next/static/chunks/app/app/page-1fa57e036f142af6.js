(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[466],{424:(e,t,a)=>{"use strict";a.d(t,{Z:()=>i,t:()=>o});var s=a(95155),r=a(12115);let l={decimalPlaces:2,roundingPrecision:.01,thousandsSeparator:","},n=(0,r.createContext)(void 0),i=e=>{let{children:t}=e,[a,i]=(0,r.useState)(()=>{let e=localStorage.getItem("appSettings"),t=e?JSON.parse(e):{};return"locale"in t&&delete t.locale,{...l,...t}}),[o,d]=(0,r.useState)(!1);return(0,r.useEffect)(()=>{if(!o){try{let e=localStorage.getItem("appSettings");if(e){let t=JSON.parse(e);"locale"in t&&delete t.locale,"number"==typeof t.decimalPlaces&&"number"==typeof t.roundingPrecision&&t.roundingPrecision>0&&"string"==typeof t.thousandsSeparator&&[",",".","'"," "].includes(t.thousandsSeparator)?i(e=>({...l,...e,...t})):(console.warn("Loaded settings from localStorage are invalid or incomplete (excluding locale). Using defaults."),i(l),localStorage.removeItem("appSettings"))}else i(l)}catch(e){console.error("Failed to load settings from localStorage:",e),i(l)}d(!0)}},[o]),(0,s.jsx)(n.Provider,{value:{settings:a,saveSettings:e=>{try{let t={...void 0!==e.decimalPlaces&&{decimalPlaces:e.decimalPlaces},...void 0!==e.roundingPrecision&&{roundingPrecision:e.roundingPrecision},...void 0!==e.thousandsSeparator&&{thousandsSeparator:e.thousandsSeparator}},s={...a,...t};i(s),localStorage.setItem("appSettings",JSON.stringify(s))}catch(e){console.error("Failed to save settings to localStorage:",e)}}},children:t})},o=()=>{let e=(0,r.useContext)(n);if(!e)throw Error("useSettings must be used within a SettingsProvider");return e}},10549:(e,t,a)=>{"use strict";a.d(t,{$m:()=>d,As:()=>o,nD:()=>i,ub:()=>c});var s=a(95155);a(12115);var r=a(23478),l=a(66474),n=a(59434);function i(e){let{...t}=e;return(0,s.jsx)(r.bL,{"data-slot":"accordion",...t})}function o(e){let{className:t,...a}=e;return(0,s.jsx)(r.q7,{"data-slot":"accordion-item",className:(0,n.cn)("border-b last:border-b-0",t),...a})}function d(e){let{className:t,children:a,...i}=e;return(0,s.jsx)(r.Y9,{className:"flex",children:(0,s.jsxs)(r.l9,{"data-slot":"accordion-trigger",className:(0,n.cn)("focus-visible:border-ring focus-visible:ring-ring/50 flex flex-1 items-start justify-between gap-4 rounded-md py-4 text-left text-sm font-medium transition-all outline-none hover:underline focus-visible:ring-[3px] disabled:pointer-events-none disabled:opacity-50 [&[data-state=open]>svg]:rotate-180",t),...i,children:[a,(0,s.jsx)(l.A,{className:"text-muted-foreground pointer-events-none size-4 shrink-0 translate-y-0.5 transition-transform duration-200"})]})})}function c(e){let{className:t,children:a,...l}=e;return(0,s.jsx)(r.UC,{"data-slot":"accordion-content",className:"data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down overflow-hidden text-sm",...l,children:(0,s.jsx)("div",{className:(0,n.cn)("pt-0 pb-4",t),children:a})})}},25264:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>e1});var s=a(95155),r=a(12115),l=a(74466),n=a(59434);let i=(0,l.F)("relative w-full rounded-lg border px-4 py-3 text-sm grid has-[>svg]:grid-cols-[calc(var(--spacing)*4)_1fr] grid-cols-[0_1fr] has-[>svg]:gap-x-3 gap-y-0.5 items-start [&>svg]:size-4 [&>svg]:translate-y-0.5 [&>svg]:text-current",{variants:{variant:{default:"bg-card text-card-foreground",destructive:"text-destructive bg-card [&>svg]:text-current *:data-[slot=alert-description]:text-destructive/90"}},defaultVariants:{variant:"default"}});function o(e){let{className:t,variant:a,...r}=e;return(0,s.jsx)("div",{"data-slot":"alert",role:"alert",className:(0,n.cn)(i({variant:a}),t),...r})}function d(e){let{className:t,...a}=e;return(0,s.jsx)("div",{"data-slot":"alert-title",className:(0,n.cn)("col-start-2 line-clamp-1 min-h-4 font-medium tracking-tight",t),...a})}function c(e){let{className:t,...a}=e;return(0,s.jsx)("div",{"data-slot":"alert-description",className:(0,n.cn)("text-muted-foreground col-start-2 grid justify-items-start gap-1 text-sm [&_p]:leading-relaxed",t),...a})}function u(e){let{className:t,...a}=e;return(0,s.jsx)("div",{"data-slot":"card",className:(0,n.cn)("bg-card text-card-foreground flex flex-col gap-6 rounded-lg border py-6 shadow-sm",t),...a})}function m(e){let{className:t,...a}=e;return(0,s.jsx)("div",{"data-slot":"card-content",className:(0,n.cn)("px-6",t),...a})}var p=a(57383),x=a(65125),g=a(85339),h=a(40646),f=a(69074),v=a(54861),y=a(49103),b=a(51154),j=a(99708),S=a(62177),N=a(85057);let D=S.Op,w=r.createContext({}),P=e=>{let{...t}=e;return(0,s.jsx)(w.Provider,{value:{name:t.name},children:(0,s.jsx)(S.xI,{...t})})},I=()=>{let e=r.useContext(w),t=r.useContext(F),{getFieldState:a}=(0,S.xW)(),s=(0,S.lN)({name:e.name}),l=a(e.name,s);if(!e)throw Error("useFormField should be used within <FormField>");let{id:n}=t;return{id:n,name:e.name,formItemId:"".concat(n,"-form-item"),formDescriptionId:"".concat(n,"-form-item-description"),formMessageId:"".concat(n,"-form-item-message"),...l}},F=r.createContext({});function R(e){let{className:t,...a}=e,l=r.useId();return(0,s.jsx)(F.Provider,{value:{id:l},children:(0,s.jsx)("div",{"data-slot":"form-item",className:(0,n.cn)("grid gap-2",t),...a})})}function A(e){let{className:t,...a}=e,{error:r,formItemId:l}=I();return(0,s.jsx)(N.J,{"data-slot":"form-label","data-error":!!r,className:(0,n.cn)("data-[error=true]:text-destructive",t),htmlFor:l,...a})}function k(e){let{...t}=e,{error:a,formItemId:r,formDescriptionId:l,formMessageId:n}=I();return(0,s.jsx)(j.DX,{"data-slot":"form-control",id:r,"aria-describedby":a?"".concat(l," ").concat(n):"".concat(l),"aria-invalid":!!a,...t})}function C(e){let{className:t,...a}=e,{formDescriptionId:r}=I();return(0,s.jsx)("p",{"data-slot":"form-description",id:r,className:(0,n.cn)("text-muted-foreground text-sm",t),...a})}function L(e){var t;let{className:a,...r}=e,{error:l,formMessageId:i}=I(),o=l?String(null!=(t=null==l?void 0:l.message)?t:""):r.children;return o?(0,s.jsx)("p",{"data-slot":"form-message",id:i,className:(0,n.cn)("text-destructive text-sm pl-3",a),...r,children:o}):null}var E=a(6711),M=a(40714),V=a(32944),z=a(9282),T=a(43163),_=a(55551),Y=a(26681),O=a(7038),B=a(98449);function q(e,t){return Number(Math.round(Number(e+"e"+t))+"e-"+t)}var G=a(20547);function H(e){let{...t}=e;return(0,s.jsx)(G.bL,{"data-slot":"popover",...t})}function J(e){let{...t}=e;return(0,s.jsx)(G.l9,{"data-slot":"popover-trigger",...t})}function U(e){let{className:t,align:a="center",sideOffset:r=4,...l}=e;return(0,s.jsx)(G.ZL,{children:(0,s.jsx)(G.UC,{"data-slot":"popover-content",align:a,sideOffset:r,className:(0,n.cn)("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-72 origin-(--radix-popover-content-transform-origin) rounded-md border p-4 shadow-md outline-hidden",t),...l})})}var W=a(14582),$=a(66474),Q=a(5196),Z=a(47863);function X(e){let{...t}=e;return(0,s.jsx)(W.bL,{"data-slot":"select",...t})}function K(e){let{...t}=e;return(0,s.jsx)(W.WT,{"data-slot":"select-value",...t})}function ee(e){let{className:t,size:a="default",children:r,...l}=e;return(0,s.jsxs)(W.l9,{"data-slot":"select-trigger","data-size":a,className:(0,n.cn)("border-input data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 dark:hover:bg-input/50 flex w-fit items-center justify-between gap-2 rounded-md border bg-transparent px-3 py-2 text-sm whitespace-nowrap shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 data-[size=default]:h-9 data-[size=sm]:h-8 *:data-[slot=select-value]:line-clamp-1 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",t),...l,children:[r,(0,s.jsx)(W.In,{asChild:!0,children:(0,s.jsx)($.A,{className:"size-4 opacity-50"})})]})}function et(e){let{className:t,children:a,position:r="popper",...l}=e;return(0,s.jsx)(W.ZL,{children:(0,s.jsxs)(W.UC,{"data-slot":"select-content",className:(0,n.cn)("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 relative z-50 max-h-(--radix-select-content-available-height) min-w-[8rem] origin-(--radix-select-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border shadow-md","popper"===r&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:r,...l,children:[(0,s.jsx)(es,{}),(0,s.jsx)(W.LM,{className:(0,n.cn)("p-1","popper"===r&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)] scroll-my-1"),children:a}),(0,s.jsx)(er,{})]})})}function ea(e){let{className:t,children:a,...r}=e;return(0,s.jsxs)(W.q7,{"data-slot":"select-item",className:(0,n.cn)("focus:bg-accent focus:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex w-full cursor-default items-center gap-2 rounded-sm py-1.5 pr-8 pl-2 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 *:[span]:last:flex *:[span]:last:items-center *:[span]:last:gap-2",t),...r,children:[(0,s.jsx)("span",{className:"absolute right-2 flex size-3.5 items-center justify-center",children:(0,s.jsx)(W.VF,{children:(0,s.jsx)(Q.A,{className:"size-4"})})}),(0,s.jsx)(W.p4,{children:a})]})}function es(e){let{className:t,...a}=e;return(0,s.jsx)(W.PP,{"data-slot":"select-scroll-up-button",className:(0,n.cn)("flex cursor-default items-center justify-center py-1",t),...a,children:(0,s.jsx)(Z.A,{className:"size-4"})})}function er(e){let{className:t,...a}=e;return(0,s.jsx)(W.wn,{"data-slot":"select-scroll-down-button",className:(0,n.cn)("flex cursor-default items-center justify-center py-1",t),...a,children:(0,s.jsx)($.A,{className:"size-4"})})}var el=a(62713),en=a(83039),ei=a(28738),eo=a(23068),ed=a(30285),ec=a(42355),eu=a(13052),em=a(42507);function ep(e){var t,a;let{className:r,classNames:l,showOutsideDays:i=!0,locale:o,...d}=e;return(0,s.jsx)(em.h,{showOutsideDays:i,className:(0,n.cn)("p-3",r),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:(0,n.cn)((0,ed.r)({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",month_grid:"w-full border-collapse space-y-1",weekdays:"flex",weekday:"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",week:"flex w-full mt-2",cell:"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day:(0,n.cn)((0,ed.r)({variant:"ghost"}),"h-9 w-9 p-0 font-normal aria-selected:opacity-100"),day_range_end:"day-range-end",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"day-outside text-muted-foreground opacity-50 aria-selected:bg-accent/50 aria-selected:text-muted-foreground aria-selected:opacity-30",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...l},components:{Chevron:e=>{let{className:t,orientation:a,...r}=e;return"left"===a?(0,s.jsx)(ec.A,{className:(0,n.cn)(t,"h-4 w-4"),...r}):(0,s.jsx)(eu.A,{className:(0,n.cn)(t,"h-4 w-4"),...r})}},locale:o,weekStartsOn:null!=(a=null==o||null==(t=o.options)?void 0:t.weekStartsOn)?a:1,...d})}ep.displayName="Calendar";let ex=r.forwardRef(function(e,t){let{className:a,type:r,helperText:l,error:i,id:o,...d}=e,c=i?"".concat(o,"-error"):void 0;return(0,s.jsxs)("div",{className:"w-full",children:[(0,s.jsx)("input",{id:o,ref:t,type:r,"data-slot":"input","aria-invalid":!!i,"aria-describedby":c,className:(0,n.cn)("flex h-10 w-full rounded-lg border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50","shadow-sm","selection:bg-primary selection:text-primary-foreground",i?"border-destructive ring-destructive/40 focus-visible:ring-destructive":"",a),...d}),l&&(0,s.jsx)("p",{className:"text-xs text-gray-500 mt-1 mb-3 pl-3",children:l}),i&&(0,s.jsx)("p",{id:c,role:"alert",className:"text-sm font-medium text-destructive mt-1",children:i})]})});var eg=a(4884);function eh(e){let{className:t,...a}=e;return(0,s.jsx)(eg.bL,{"data-slot":"switch",className:(0,n.cn)("peer data-[state=checked]:bg-primary data-[state=unchecked]:bg-input focus-visible:border-ring focus-visible:ring-ring/50 dark:data-[state=unchecked]:bg-input/80 inline-flex h-[1.15rem] w-8 shrink-0 items-center rounded-full border border-transparent shadow-xs transition-all outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 cursor-pointer",t),...a,children:(0,s.jsx)(eg.zi,{"data-slot":"switch-thumb",className:(0,n.cn)("bg-background dark:data-[state=unchecked]:bg-foreground dark:data-[state=checked]:bg-primary-foreground pointer-events-none block size-4 rounded-full ring-0 transition-transform data-[state=checked]:translate-x-[calc(100%-2px)] data-[state=unchecked]:translate-x-0")})})}var ef=a(45964),ev=a.n(ef),ey=a(91218),eb=a(55594),ej=a(90221);let eS="yyyy-MM-dd",eN="dd.MM.yyyy",eD=[eS,eN,"MM/dd/yyyy","dd.MM.yy","MM/dd/yy","dd-MM-yyyy"],ew=e=>{if(!e)return null;let t=e.trim();if(!/[\.\-\/]/.test(t)||!/^(\d{4}-\d{2}-\d{2}|\d{2}\.\d{2}\.\d{4}|\d{2}\/\d{2}\/\d{4}|\d{2}-\d{2}-\d{4})$/.test(t))return null;for(let e of eD){let a=(0,ei.qg)(t,e,new Date);if((0,eo.f)(a))return(0,E.o)(a)}return null},eP=e=>eb.z.object({startDateString:eb.z.string().optional(),endDateString:eb.z.string().optional(),includeEndDate:eb.z.boolean(),splitPeriod:eb.z.enum(["yearly","quarterly","monthly"]),amounts:eb.z.array(eb.z.object({value:eb.z.string().min(1,{message:e("InvoiceForm.errorAmountValueRequired")}).refine(e=>!isNaN(parseFloat(e))&&parseFloat(e)>0,{message:e("InvoiceForm.errorAmountPositive")})})).min(1,e("InvoiceForm.errorAmountRequired"))}).refine(e=>!!ew(e.startDateString||""),{message:e("InvoiceForm.errorStartDateRequired"),path:["startDateString"]}).refine(e=>!!ew(e.endDateString||""),{message:e("InvoiceForm.errorEndDateRequired"),path:["endDateString"]}).refine(e=>{let t=ew(e.startDateString||""),a=ew(e.endDateString||"");return!t||!a||a>=t},{message:e("InvoiceForm.errorEndDateBeforeStart"),path:["endDateString"]}),eI=e=>{let{children:t,...a}=e;return(0,s.jsx)(A,{...a,style:{color:"var(--foreground)",fontWeight:500},children:t})},eF=e=>{let{className:t,...a}=e;return a.children&&"string"==typeof a.children&&a.children.length>0?(0,s.jsxs)(L,{className:(0,n.cn)("pl-3 flex items-center","py-1 px-2 rounded text-destructive font-medium",t),...a,children:[(0,s.jsx)(g.A,{className:"h-3 w-3 mr-1 flex-shrink-0"}),(0,s.jsx)("span",{children:a.children})]}):null};function eR(e){var t,a;let{onCalculateAction:l}=e,{t:i,i18n:o}=(0,ey.Bd)(),[d,c]=(0,r.useState)(!1),[u,m]=(0,r.useState)(!1),[p,x]=(0,r.useState)(""),[j,N]=(0,r.useState)(!1),D=o.language.startsWith("de")?el.de:en.c,w=o.language.startsWith("de")?eN:eS,I=o.language.startsWith("de")?"z.B. 31.12.2023":"e.g. 2023-12-31",F="invoiceFormDataCache",A=eP(i),L=(0,S.mN)({resolver:(0,ej.u)(A),defaultValues:{startDateString:"",endDateString:"",includeEndDate:!0,splitPeriod:"yearly",amounts:[{value:""}]},mode:"onBlur"}),{fields:G,append:W,remove:$}=(0,S.jz)({control:L.control,name:"amounts"}),Q=(0,r.useCallback)(e=>{m(!0),x(i("InvoiceForm.calculatingButton"));let t=ew(e.startDateString||""),a=ew(e.endDateString||"");if(!t||!a){l(null,null,i("Errors.unexpectedError")),m(!1),x(i("InvoiceForm.calculateButton",{defaultValue:"Calculate Split"}));return}let s=e.amounts.map(e=>Number(e.value)),r=e.splitPeriod||"yearly",n={startDate:t,endDate:a,includeEndDate:e.includeEndDate,splitPeriod:r,amounts:s};l(n,null,void 0);let o={startDate:t,endDate:a,includeEndDate:e.includeEndDate,amounts:s,splitPeriod:r};try{let e=function(e){let t=e.splitPeriod||"yearly",a={totalDuration:{days:0,start:"",end:"",included:e.includeEndDate},periodSegments:[],amountCalculations:[]};if(!e.amounts||0===e.amounts.length)return{totalDays:0,originalTotalAmount:0,adjustedTotalAmount:0,resultsPerAmount:[],aggregatedSplits:[],calculationSteps:{...a,error:"At least one amount is required."},splitPeriodUsed:t};if(e.amounts.some(e=>isNaN(e)||null===e))return{totalDays:0,originalTotalAmount:0,adjustedTotalAmount:0,resultsPerAmount:[],aggregatedSplits:[],calculationSteps:{...a,error:"Invalid non-numeric amount provided."},splitPeriodUsed:t};let s=q(e.amounts.reduce((e,t)=>e+t,0),2),r=(0,E.o)(e.startDate),l=(0,E.o)(e.endDate);if(e.includeEndDate&&(l=(0,M.f)(l,1)),a.totalDuration.start=(0,Y.GP)(r,"yyyy-MM-dd"),a.totalDuration.end=(0,Y.GP)(e.includeEndDate?e.endDate:(0,M.f)(l,-1),"yyyy-MM-dd"),r>=l)return{totalDays:0,originalTotalAmount:s,adjustedTotalAmount:0,resultsPerAmount:[],aggregatedSplits:[],calculationSteps:{...a,error:"Start date must be before the effective end date."},splitPeriodUsed:t};let n=(0,B.c)(l,r);if(a.totalDuration.days=n,n<=0)return{totalDays:0,originalTotalAmount:s,adjustedTotalAmount:0,resultsPerAmount:[],aggregatedSplits:[],calculationSteps:{...a,error:"Calculated duration is zero or negative."},splitPeriodUsed:t};let i={},o=r;for(;o<l;){let e=function(e,t){let a=(0,_.C)(e);switch(t){case"monthly":return(0,Y.GP)(e,"yyyy-MM");case"quarterly":let s=(0,O.F)(e);return"".concat(a,"-Q").concat(s);default:return a.toString()}}(o,t),a=function(e,t){switch(t){case"monthly":return(0,E.o)((0,M.f)((0,V.p)(e),1));case"quarterly":return(0,E.o)((0,M.f)((0,z.j)(e),1));default:return(0,E.o)((0,M.f)((0,T.Q)(e),1))}}(o,t),s=l<a?l:a,r=(0,B.c)(s,o);if(r>0){let t=r/n;i[e]||(i[e]={days:0,proportion:0}),i[e].days+=r,i[e].proportion+=t}o=s}a.periodSegments=Object.entries(i).map(e=>{let[t,a]=e;return{periodIdentifier:t,days:a.days,proportion:a.proportion}}).sort((e,t)=>e.periodIdentifier.localeCompare(t.periodIdentifier));let d=[];for(let t of e.amounts){let e={originalAmount:t,periodSplits:[],discrepancy:0,finalSum:0},s=[];for(let a in i){let r=t*i[a].proportion;s.push({periodIdentifier:a,rawSplit:r}),e.periodSplits.push({periodIdentifier:a,rawSplit:r,roundedSplit:0,adjustment:0})}let r=s.map(e=>({...e,roundedSplit:q(e.rawSplit,2)}));r.forEach(t=>{let a=e.periodSplits.find(e=>e.periodIdentifier===t.periodIdentifier);a&&(a.roundedSplit=t.roundedSplit)});let l=q(r.reduce((e,t)=>e+t.roundedSplit,0),2),n=q(t-l,2);if(e.discrepancy=n,0!==n&&r.length>0){let t=s.reduce((e,t)=>Math.abs(t.rawSplit)>Math.abs(e.rawSplit)?t:e).periodIdentifier,a=r.find(e=>e.periodIdentifier===t);if(a){a.roundedSplit=q(a.roundedSplit+n,2);let s=e.periodSplits.find(e=>e.periodIdentifier===t);s&&(s.roundedSplit=a.roundedSplit,s.adjustment=n),e.adjustmentAppliedToPeriod=t}else console.warn("Could not find period to apply adjustment, discrepancy unapplied for this amount.")}let o={};r.forEach(e=>{o[e.periodIdentifier]={splitAmount:e.roundedSplit}});let c=q(r.reduce((e,t)=>e+t.roundedSplit,0),2);e.finalSum=c,d.push({originalAmount:t,adjustedTotalAmount:c,splits:o}),a.amountCalculations.push(e)}let c=Object.entries(i).map(e=>{let[t,a]=e,s=0;return d.forEach(e=>{var a;s+=(null==(a=e.splits[t])?void 0:a.splitAmount)||0}),{periodIdentifier:t,daysInPeriod:a.days,proportion:a.proportion,totalSplitAmount:q(s,2)}}).sort((e,t)=>e.periodIdentifier.localeCompare(t.periodIdentifier)),u=q(c.reduce((e,t)=>e+t.totalSplitAmount,0),2),m=q(s-u,2);return Math.abs(m)>.01*e.amounts.length&&console.warn("Potential rounding discrepancy: Original ".concat(s,", Adjusted ").concat(u,", Diff ").concat(m)),{totalDays:n,originalTotalAmount:s,adjustedTotalAmount:u,resultsPerAmount:d,aggregatedSplits:c,calculationSteps:a,splitPeriodUsed:t}}(o);setTimeout(()=>{var t;(null==(t=e.calculationSteps)?void 0:t.error)?l(n,null,e.calculationSteps.error):e.aggregatedSplits&&0!==e.aggregatedSplits.length?(l(n,e),x(i("InvoiceForm.calculationComplete",{defaultValue:"Split completed successfully!"})),N(!0),setTimeout(()=>{x(i("InvoiceForm.calculateButton",{defaultValue:"Calculate Split"})),N(!1)},2e3)):l(n,null,"Calculation completed but resulted in no splits."),m(!1)},300)}catch(e){l(n,null,e instanceof Error?e.message:"An unexpected error occurred during calculation."),setTimeout(()=>{m(!1),x(i("InvoiceForm.calculateButton",{defaultValue:"Calculate Split"}))},300)}},[i,l,m,x,N]);(0,r.useEffect)(()=>{if(d)return;let e=!1,t=sessionStorage.getItem("billSplitterDemoData");if(t)try{let a=JSON.parse(t);if(a.isDemo){let t={startDateString:a.startDateString?(0,Y.GP)(ew(a.startDateString)||new Date,w):void 0,endDateString:a.endDateString?(0,Y.GP)(ew(a.endDateString)||new Date,w):void 0,includeEndDate:void 0===a.includeEndDate||a.includeEndDate,splitPeriod:a.splitPeriod||"yearly",amounts:a.amount?[{value:a.amount}]:[{value:""}]},s={startDateString:t.startDateString||"",endDateString:t.endDateString||"",includeEndDate:void 0===t.includeEndDate||t.includeEndDate,splitPeriod:t.splitPeriod||"yearly",amounts:t.amounts||[{value:""}]};L.reset(s),sessionStorage.removeItem("billSplitterDemoData"),e=!0,L.trigger().then(e=>{e&&setTimeout(()=>{L.formState.isValid&&L.handleSubmit(Q)()},500)})}}catch(e){console.error("Error parsing demo data from session storage:",e),sessionStorage.removeItem("billSplitterDemoData")}if(!e){let e=sessionStorage.getItem(F);if(e)try{let t=JSON.parse(e);L.reset(t)}catch(e){console.error("Failed to parse cached form data:",e),sessionStorage.removeItem(F)}}c(!0),x(i("InvoiceForm.calculateButton",{defaultValue:"Calculate Split"}))},[L,w,Q,i,F,d]);let Z=(0,r.useMemo)(()=>ev()(e=>{if(d)try{sessionStorage.setItem(F,JSON.stringify(e))}catch(e){console.error("Failed to save form data to cache:",e)}},500),[d,F]),es=(0,S.FH)({control:L.control});(0,r.useEffect)(()=>{d&&Z(L.getValues())},[es,Z,L,d]);let[er,ei]=(0,r.useState)(!1),[eo,ec]=(0,r.useState)(!1),eu=()=>o.language.startsWith("de")?i("InvoiceForm.supportedDateFormats",{defaultValue:"Unterst\xfctzte Formate: TT.MM.JJJJ, JJJJ-MM-TT"}):i("InvoiceForm.supportedDateFormats",{defaultValue:"Supported formats: YYYY-MM-DD, DD.MM.YYYY"}),em=e=>{if(e){let t=(0,Y.GP)(e,w);L.setValue("startDateString",t,{shouldValidate:!0})}ei(!1)},eg=e=>{if(e){let t=(0,Y.GP)(e,w);L.setValue("endDateString",t,{shouldValidate:!0})}ec(!1)},ef=e=>{let t=e.target.value;L.setValue("startDateString",t,{shouldValidate:!0}),L.trigger("startDateString").then(()=>{let e=ew(t);t&&!e&&L.setError("startDateString",{type:"manual",message:eu()})})},eb=e=>{let t=e.target.value;L.setValue("endDateString",t,{shouldValidate:!1});let a=ew(t),s=ew(L.getValues("startDateString")||"");L.clearErrors("endDateString"),t&&!a?L.setError("endDateString",{type:"manual",message:eu()}):a&&s&&a<s&&L.setError("endDateString",{type:"manual",message:i("InvoiceForm.errorEndDateBeforeStart")}),L.trigger("endDateString")};return d?(0,s.jsx)(S.Op,{...L,children:(0,s.jsxs)("form",{onSubmit:L.handleSubmit(Q),className:(0,n.cn)("space-y-6",d&&"opacity-100 transition-opacity duration-500 ease-in-out",!d&&"opacity-0"),children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,s.jsx)(P,{control:L.control,name:"startDateString",render:e=>{var t,a;let{field:r}=e;return(0,s.jsxs)(R,{className:"flex flex-col",children:[(0,s.jsx)(eI,{children:i("InvoiceForm.startDateLabel")}),(0,s.jsxs)(H,{open:er,onOpenChange:ei,children:[(0,s.jsx)(k,{children:(0,s.jsxs)("div",{className:"w-full relative",children:[(0,s.jsx)(ex,{value:r.value,onChange:e=>{r.onChange(e),ef(e)},onBlur:()=>L.trigger("startDateString"),placeholder:I,className:"w-full pr-10 ".concat(L.formState.errors.startDateString?"border-destructive focus:border-destructive focus:ring-2 focus:ring-destructive/20":""),autoFocus:!0}),r.value&&!L.formState.errors.startDateString&&(0,s.jsx)("div",{className:"absolute inset-y-0 right-10 flex items-center",children:(0,s.jsx)(h.A,{className:"h-4 w-4 text-green-500"})}),L.formState.errors.startDateString&&(0,s.jsx)("div",{className:"absolute inset-y-0 right-10 flex items-center",children:(0,s.jsx)(g.A,{className:"h-4 w-4 text-destructive"})}),(0,s.jsx)("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center",children:(0,s.jsx)(J,{asChild:!0,children:(0,s.jsx)(ed.$,{type:"button",variant:"ghost",className:"h-7 w-7 p-0","aria-label":"Pick a date",children:(0,s.jsx)(f.A,{className:"h-4 w-4 text-muted-foreground"})})})})]})}),(0,s.jsx)(U,{className:"w-auto p-0",align:"start",children:(0,s.jsx)(ep,{mode:"single",selected:ew(null!=(a=L.watch("startDateString"))?a:"")||void 0,onSelect:em,initialFocus:!0,locale:D})})]}),(0,s.jsx)(eF,{className:"text-xs mt-1",children:null==(t=L.formState.errors.startDateString)?void 0:t.message})]})}}),(0,s.jsx)(P,{control:L.control,name:"endDateString",render:e=>{var t,a;let{field:r}=e;return(0,s.jsxs)(R,{className:"flex flex-col",children:[(0,s.jsx)(eI,{children:i("InvoiceForm.endDateLabel")}),(0,s.jsxs)(H,{open:eo,onOpenChange:ec,children:[(0,s.jsx)(k,{children:(0,s.jsxs)("div",{className:"w-full relative",children:[(0,s.jsx)(ex,{value:r.value,onChange:e=>{r.onChange(e),eb(e)},onBlur:()=>L.trigger("endDateString"),placeholder:I,className:"w-full pr-10 ".concat(L.formState.errors.endDateString?"border-destructive focus:border-destructive focus:ring-2 focus:ring-destructive/20":"")}),r.value&&!L.formState.errors.endDateString&&(0,s.jsx)("div",{className:"absolute inset-y-0 right-10 flex items-center",children:(0,s.jsx)(h.A,{className:"h-4 w-4 text-green-500"})}),L.formState.errors.endDateString&&(0,s.jsx)("div",{className:"absolute inset-y-0 right-10 flex items-center",children:(0,s.jsx)(g.A,{className:"h-4 w-4 text-destructive"})}),(0,s.jsx)("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center",children:(0,s.jsx)(J,{asChild:!0,children:(0,s.jsx)(ed.$,{type:"button",variant:"ghost",className:"h-7 w-7 p-0","aria-label":"Pick a date",children:(0,s.jsx)(f.A,{className:"h-4 w-4 text-muted-foreground"})})})})]})}),(0,s.jsx)(U,{className:"w-auto p-0",align:"start",children:(0,s.jsx)(ep,{mode:"single",selected:ew(null!=(a=L.watch("endDateString"))?a:"")||void 0,onSelect:eg,initialFocus:!0,locale:D,disabled:e=>{var t;let a=ew(null!=(t=L.watch("startDateString"))?t:"");return!!a&&e<a}})})]}),(0,s.jsx)(eF,{className:"text-xs mt-1",children:null==(t=L.formState.errors.endDateString)?void 0:t.message})]})}})]}),(0,s.jsx)(P,{control:L.control,name:"includeEndDate",render:e=>{let{field:t}=e;return(0,s.jsxs)(R,{className:"flex flex-row items-center justify-between rounded-lg border p-4",children:[(0,s.jsxs)("div",{className:"space-y-0.5",children:[(0,s.jsx)(eI,{className:"text-base",children:i("InvoiceForm.includeEndDateLabel")}),(0,s.jsx)(C,{children:i("InvoiceForm.includeEndDateDescription")})]}),(0,s.jsx)(k,{children:(0,s.jsx)(eh,{checked:t.value,onCheckedChange:t.onChange})})]})}}),(0,s.jsx)(P,{control:L.control,name:"splitPeriod",render:e=>{let{field:t}=e;return(0,s.jsxs)(R,{className:"flex flex-row items-center justify-between rounded-lg border p-4",children:[(0,s.jsxs)("div",{className:"space-y-0.5 pr-4",children:[(0,s.jsx)(eI,{className:"text-base",children:i("InvoiceForm.splitPeriodLabel",{defaultValue:"Split Period"})}),(0,s.jsx)(C,{children:i("InvoiceForm.splitPeriodDescription",{defaultValue:"Choose how to split the invoice amounts."})})]}),(0,s.jsxs)("div",{className:"min-w-[120px]",children:[(0,s.jsxs)(X,{onValueChange:t.onChange,defaultValue:t.value,children:[(0,s.jsx)(k,{children:(0,s.jsx)(ee,{className:"w-full",children:(0,s.jsx)(K,{placeholder:i("InvoiceForm.selectPeriodPlaceholder",{defaultValue:"Select..."})})})}),(0,s.jsxs)(et,{children:[(0,s.jsx)(ea,{value:"yearly",children:i("InvoiceForm.periodYearly",{defaultValue:"Yearly"})}),(0,s.jsx)(ea,{value:"quarterly",children:i("InvoiceForm.periodQuarterly",{defaultValue:"Quarterly"})}),(0,s.jsx)(ea,{value:"monthly",children:i("InvoiceForm.periodMonthly",{defaultValue:"Monthly"})})]})]}),(0,s.jsx)(eF,{})]})]})}}),(0,s.jsxs)("div",{className:"space-y-5 rounded-lg border p-6 shadow-xs",children:[(0,s.jsx)(eI,{className:"text-base",children:i("InvoiceForm.amountsLabel")}),(0,s.jsx)(C,{children:i("InvoiceForm.amountsDescription")}),G.map((e,t)=>(0,s.jsx)(P,{control:L.control,name:"amounts.".concat(t,".value"),render:e=>{var a,r;let{field:l}=e;return(0,s.jsxs)(R,{className:"mb-3",children:[(0,s.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,s.jsxs)(eI,{className:"text-sm font-medium",children:["#",t+1]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsxs)("div",{className:"relative flex-1",children:[(0,s.jsx)(k,{children:(0,s.jsx)(ex,{type:"number",step:"any",className:"focus:border-primary focus:ring-2 focus:ring-primary/20 transition-transform duration-150 pr-8",...l})}),(0,s.jsxs)("div",{className:"absolute right-2 top-0 h-full flex items-center justify-center",children:[l.value&&!isNaN(parseFloat(l.value))&&parseFloat(l.value)>0&&(0,s.jsx)("div",{className:"flex items-center justify-center h-5 w-5",children:(0,s.jsx)(h.A,{className:"h-4 w-4 text-green-500"})}),(null==(r=L.formState.errors.amounts)||null==(a=r[t])?void 0:a.value)&&(0,s.jsx)("div",{className:"flex items-center justify-center h-5 w-5",children:(0,s.jsx)(g.A,{className:"h-4 w-4 text-destructive"})})]})]}),G.length>1&&(0,s.jsx)(ed.$,{type:"button",variant:"ghost",size:"icon",onClick:()=>$(t),className:"text-gray-400 hover:text-gray-500 hover:bg-gray-100 transition-all duration-200 shrink-0","aria-label":"Remove amount",children:(0,s.jsx)(v.A,{className:"h-4 w-4 transition-transform duration-150 hover:scale-95"})})]})]}),(0,s.jsx)(eF,{})]})}},e.id)),(0,s.jsxs)(ed.$,{type:"button",variant:"outline",size:"sm",onClick:()=>{W({value:""}),setTimeout(()=>{let e=document.querySelectorAll('input[type="number"]');e.length>0&&e[e.length-1].focus()},10)},className:"mt-4",children:[(0,s.jsx)(y.A,{className:"mr-2 h-4 w-4"})," ",i("InvoiceForm.addAmountButton")]}),L.formState.errors.amounts&&!L.formState.errors.amounts.root&&L.formState.errors.amounts.message&&(0,s.jsx)("p",{className:"text-sm font-medium text-destructive",children:L.formState.errors.amounts.message}),(null==(a=L.formState.errors.amounts)||null==(t=a.root)?void 0:t.message)&&(0,s.jsx)("p",{className:"text-sm font-medium text-destructive",children:L.formState.errors.amounts.root.message})]}),(0,s.jsx)(ed.$,{type:"submit",disabled:L.formState.isSubmitting||u,className:"w-full bg-primary text-white hover:bg-primary/90 hover:scale-[1.02] px-6 py-2 h-11 font-medium rounded-md shadow-sm transition-all duration-200 hover:shadow-lg hover:shadow-primary/20 ".concat(j?"animate-success-glow":""),children:u?(0,s.jsxs)("span",{className:"flex items-center justify-center",children:[(0,s.jsx)(b.A,{className:"mr-2 h-4 w-4 animate-spin"}),p]}):p})]})}):(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("div",{className:"h-4 bg-muted/60 rounded-sm animate-pulse w-2/5"}),(0,s.jsx)("div",{className:"h-10 bg-muted/60 rounded-md animate-pulse w-full"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("div",{className:"h-4 bg-muted/60 rounded-sm animate-pulse w-2/5"}),(0,s.jsx)("div",{className:"h-10 bg-muted/60 rounded-md animate-pulse w-full"})]})]}),(0,s.jsxs)("div",{className:"h-20 bg-muted/40 rounded-lg animate-pulse border border-muted/30 p-4 flex justify-between items-center",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("div",{className:"h-4 bg-muted/60 rounded-sm animate-pulse w-40"}),(0,s.jsx)("div",{className:"h-3 bg-muted/60 rounded-sm animate-pulse w-56"})]}),(0,s.jsx)("div",{className:"h-6 w-12 bg-muted/60 rounded-full animate-pulse"})]}),(0,s.jsxs)("div",{className:"h-20 bg-muted/40 rounded-lg animate-pulse border border-muted/30 p-4 flex justify-between items-center",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("div",{className:"h-4 bg-muted/60 rounded-sm animate-pulse w-32"}),(0,s.jsx)("div",{className:"h-3 bg-muted/60 rounded-sm animate-pulse w-64"})]}),(0,s.jsx)("div",{className:"h-10 w-28 bg-muted/60 rounded-md animate-pulse"})]}),(0,s.jsxs)("div",{className:"rounded-lg border border-muted/30 p-6 shadow-xs space-y-4 bg-muted/10",children:[(0,s.jsx)("div",{className:"h-5 bg-muted/60 rounded-sm animate-pulse w-1/4"}),(0,s.jsx)("div",{className:"h-4 bg-muted/60 rounded-sm animate-pulse w-3/5 mb-4"}),(0,s.jsx)("div",{className:"space-y-4",children:(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("div",{className:"h-3 bg-muted/60 rounded-sm animate-pulse w-8"}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("div",{className:"h-10 bg-muted/60 rounded-md animate-pulse flex-grow"}),(0,s.jsx)("div",{className:"h-10 w-10 bg-muted/60 rounded-md animate-pulse opacity-0"})]})]})}),(0,s.jsx)("div",{className:"h-8 bg-muted/60 rounded-md animate-pulse w-40 mt-6"})]}),(0,s.jsx)("div",{className:"h-11 bg-primary/40 rounded-md animate-pulse w-full"})]})}var eA=a(10549);function ek(e){let{className:t,...a}=e;return(0,s.jsx)("div",{"data-slot":"table-container",className:"relative w-full overflow-x-auto",children:(0,s.jsx)("table",{"data-slot":"table",className:(0,n.cn)("w-full caption-bottom text-sm",t),...a})})}function eC(e){let{className:t,...a}=e;return(0,s.jsx)("thead",{"data-slot":"table-header",className:(0,n.cn)("[&_tr]:border-b",t),...a})}function eL(e){let{className:t,...a}=e;return(0,s.jsx)("tbody",{"data-slot":"table-body",className:(0,n.cn)("[&_tr:last-child]:border-0",t),...a})}function eE(e){let{className:t,...a}=e;return(0,s.jsx)("tfoot",{"data-slot":"table-footer",className:(0,n.cn)("bg-muted/50 border-t font-medium [&>tr]:last:border-b-0",t),...a})}function eM(e){let{className:t,...a}=e;return(0,s.jsx)("tr",{"data-slot":"table-row",className:(0,n.cn)("hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors",t),...a})}function eV(e){let{className:t,...a}=e;return(0,s.jsx)("th",{"data-slot":"table-head",className:(0,n.cn)("text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",t),...a})}function ez(e){let{className:t,...a}=e;return(0,s.jsx)("td",{"data-slot":"table-cell",className:(0,n.cn)("p-2 align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",t),...a})}var eT=a(54165),e_=a(381),eY=a(424);let eO=e=>{let{children:t,...a}=e;return(0,s.jsx)(A,{...a,style:{color:"var(--foreground)",fontWeight:500},children:t})},eB=e=>{let{className:t,...a}=e;return(0,s.jsx)(L,{className:(0,n.cn)("text-destructive text-sm",t),...a})},eq=e=>{let{className:t,...a}=e,{error:r}=I();return r?null:(0,s.jsx)(C,{className:t,...a})},eG=e=>{let{className:t,...a}=e;return(0,s.jsx)(R,{className:t,...a})},eH=eb.Ik({decimalPlaces:eb.Yj().nonempty("Decimal places is required"),roundingPrecision:eb.Yj().nonempty("Rounding precision is required"),thousandsSeparator:eb.Yj(),locale:eb.Yj()});function eJ(e){var t,a;let{isOpen:l,onOpenChange:n,variant:i="ghost",size:o="icon",className:d}=e,{settings:c,saveSettings:u}=(0,eY.t)(),{t:m,i18n:p}=(0,ey.Bd)(),[x,g]=(0,r.useState)(!1),[h,f]=(0,r.useState)(!1),v=void 0!==l?l:x,y=n||g,[b,j]=(0,r.useState)(!0),N=(0,S.mN)({resolver:(0,ej.u)(eH),defaultValues:{decimalPlaces:(null==(t=c.decimalPlaces)?void 0:t.toString())||"",roundingPrecision:(null==(a=c.roundingPrecision)?void 0:a.toString())||"0.01",thousandsSeparator:c.thousandsSeparator||",",locale:p.language||"en-US"},mode:"onChange"});(0,r.useEffect)(()=>{if(v){var e,t;N.reset({decimalPlaces:(null==(e=c.decimalPlaces)?void 0:e.toString())||"",roundingPrecision:(null==(t=c.roundingPrecision)?void 0:t.toString())||"0.01",thousandsSeparator:c.thousandsSeparator||",",locale:p.language||"en-US"})}},[v,c,p.language,N,","]),(0,r.useEffect)(()=>{let e=N.watch(()=>{let e=!!Object.keys(N.formState.errors).length,t=N.getValues(),a=!t.decimalPlaces||""===t.decimalPlaces;j(!e&&!a)});return()=>e.unsubscribe()},[N]),(0,r.useEffect)(()=>{f(!0)},[c]);let w=N.watch("thousandsSeparator")||",",I=h?m("SettingsModal.settingsModalTitle"):"Number Formatting Settings",F=h?m("SettingsModal.settingsModalTitle"):"Number Formatting Settings",R=h?m("SettingsModal.settingsModalDescription"):"Adjust your preferred number formatting for allocations and reports.",A=h?m("SettingsModal.saveButton"):"Save Settings";return(0,s.jsxs)(s.Fragment,{children:[!l&&!n&&(0,s.jsxs)(ed.$,{variant:i,size:o,onClick:()=>g(!0),className:d,"aria-label":I,children:[(0,s.jsx)(e_.A,{className:"size-4"}),"icon"!==o&&m("SettingsModal.settingsButtonText","Settings")]}),(0,s.jsx)(eT.lG,{open:v,onOpenChange:e=>{if(!e){var t,a;N.reset({decimalPlaces:(null==(t=c.decimalPlaces)?void 0:t.toString())||"",roundingPrecision:(null==(a=c.roundingPrecision)?void 0:a.toString())||"0.01",thousandsSeparator:c.thousandsSeparator||",",locale:p.language||"en-US"})}y(e)},children:(0,s.jsxs)(eT.Cf,{className:"sm:max-w-[425px]",children:[(0,s.jsxs)(eT.c7,{children:[(0,s.jsx)(eT.L3,{children:F}),(0,s.jsx)(eT.rr,{children:R})]}),(0,s.jsx)(D,{...N,children:(0,s.jsxs)("form",{onSubmit:N.handleSubmit(function(e){let t=Number(e.decimalPlaces);if(isNaN(t)||t<0||t>6)return void N.setError("decimalPlaces",{type:"manual",message:"Decimal places must be between 0 and 6"});let a=Number(e.roundingPrecision.replace(",","."));if(isNaN(a)||a<1e-4||a>100)return void N.setError("roundingPrecision",{type:"manual",message:"Rounding precision must be between 0.0001 and 100"});let s={decimalPlaces:t,roundingPrecision:a,thousandsSeparator:e.thousandsSeparator||",",locale:e.locale},r=e.locale;r&&p.language!==r&&p.changeLanguage(r),u(s),window.dispatchEvent(new CustomEvent("settingsChanged",{detail:{settings:s}})),y(!1)}),className:"space-y-6",children:[(0,s.jsx)(P,{control:N.control,name:"decimalPlaces",render:e=>{let{field:t}=e;return(0,s.jsxs)(eG,{children:[(0,s.jsx)(eO,{children:m("SettingsModal.decimalPlacesLabel")}),(0,s.jsx)(k,{children:(0,s.jsx)(ex,{required:!0,...t})}),(0,s.jsx)(eq,{children:m("SettingsModal.decimalPlacesDescription")}),(0,s.jsx)(eB,{})]})}}),(0,s.jsx)(P,{control:N.control,name:"roundingPrecision",render:e=>{let{field:t}=e;return(0,s.jsxs)(eG,{children:[(0,s.jsx)(eO,{children:m("SettingsModal.roundingPrecisionLabel")}),(0,s.jsx)(k,{children:(0,s.jsx)(ex,{required:!0,...t})}),(0,s.jsx)(eq,{children:m("SettingsModal.roundingPrecisionDescription")}),(0,s.jsx)(eB,{})]})}}),(0,s.jsx)(P,{control:N.control,name:"thousandsSeparator",render:e=>{let{field:t}=e;return(0,s.jsxs)(eG,{children:[(0,s.jsx)(eO,{children:m("SettingsModal.thousandsSeparatorLabel")}),(0,s.jsxs)(X,{onValueChange:e=>{t.onChange(e||",")},value:w,children:[(0,s.jsx)(k,{children:(0,s.jsx)(ee,{children:(0,s.jsx)(K,{children:","===w?"".concat(m("SettingsModal.comma")," (1,234.56)"):"."===w?"".concat(m("SettingsModal.period")," (1.234,56)"):"'"===w?"".concat(m("SettingsModal.apostrophe")," (1&apos;234.56)"):" "===w?"".concat(m("SettingsModal.space")," (1 234.56)"):m("SettingsModal.comma")})})}),(0,s.jsxs)(et,{children:[(0,s.jsxs)(ea,{value:",",children:[m("SettingsModal.comma")," (1,234.56)"]}),(0,s.jsxs)(ea,{value:".",children:[m("SettingsModal.period")," (1.234,56)"]}),(0,s.jsxs)(ea,{value:"'",children:[m("SettingsModal.apostrophe")," (1'234.56)"]}),(0,s.jsxs)(ea,{value:" ",children:[m("SettingsModal.space")," (1 234.56)"]})]})]}),(0,s.jsx)(eq,{children:m("SettingsModal.thousandsSeparatorDescription")}),(0,s.jsx)(eB,{})]})}}),(0,s.jsx)(eT.Es,{className:"pt-4",children:(0,s.jsx)(ed.$,{type:"submit",disabled:!b||N.formState.isSubmitting||Object.keys(N.formState.errors).length>0,children:A})})]})})]})})]})}function eU(e,t,a){if(null==e||isNaN(e))return"";let s=new Intl.NumberFormat(t,{minimumFractionDigits:a.decimalPlaces,maximumFractionDigits:a.decimalPlaces,useGrouping:!0}).format(e),r=t.startsWith("de")?".":",";return a.thousandsSeparator&&a.thousandsSeparator!==r&&(s=s.replace(RegExp("\\".concat(r),"g"),a.thousandsSeparator)),s}function eW(e,t){return null==e||isNaN(e)?"":new Intl.NumberFormat(t,{minimumFractionDigits:2,maximumFractionDigits:2}).format(100*e)+"%"}function e$(e,t){if(!e)return"";try{let a=new Date(e+"T00:00:00Z");if(isNaN(a.getTime()))return e;return new Intl.DateTimeFormat(t,{year:"numeric",month:"numeric",day:"numeric"}).format(a)}catch(t){return console.error("Error formatting date:",t),e}}function eQ(e,t,a){if("monthly"!==t)return e;try{let[t,s]=e.split("-"),r=new Date(parseInt(t),parseInt(s)-1,1);return(0,Y.GP)(r,"MMMM yyyy",{locale:"de"===a?el.de:en.c})}catch(t){return e}}let eZ=e=>{let{steps:t,settings:a,splitPeriodUsed:r}=e,{t:l,i18n:n}=(0,ey.Bd)(),i=n.language;if(t.error)return(0,s.jsx)("p",{className:"text-destructive",children:t.error});let{periodSegments:o,amountCalculations:d}=t,c=e=>eU(e,i,a),u=e=>eQ(e,r,i);return(0,s.jsxs)("div",{className:"text-sm space-y-6",children:[(0,s.jsxs)("section",{className:"bg-muted/40 rounded-lg p-4 space-y-4",children:[(0,s.jsx)("h4",{className:"font-semibold text-foreground",children:l("ResultsDisplay.totalDuration")}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-2 text-xs border-b pb-2 mb-2",children:[(0,s.jsx)("div",{children:l("ResultsDisplay.periodLabel")})," ",(0,s.jsxs)("div",{className:"text-right",children:[e$(t.totalDuration.start,i)," - ",e$(t.totalDuration.end,i)]}),(0,s.jsx)("div",{children:l("ResultsDisplay.totalDays")})," ",(0,s.jsxs)("div",{className:"text-right",children:[t.totalDuration.days," (",t.totalDuration.included?l("ResultsDisplay.inclusiveLabel"):l("ResultsDisplay.exclusiveLabel"),")"]})]}),(0,s.jsx)("h4",{className:"font-semibold text-foreground",children:l("ResultsDisplay.proportionCalculation")}),(0,s.jsx)("div",{className:"space-y-1",children:o.map(e=>(0,s.jsxs)("div",{className:"grid grid-cols-3 gap-2 text-xs",children:[(0,s.jsxs)("div",{className:"font-medium",children:[u(e.periodIdentifier),":"]}),(0,s.jsxs)("div",{className:"text-muted-foreground text-center",children:[e.days," / ",t.totalDuration.days," ",l("ResultsDisplay.daysLabel")]}),(0,s.jsx)("div",{className:"text-muted-foreground text-right",children:eW(e.proportion,i)})]},e.periodIdentifier))})]}),(0,s.jsxs)("section",{className:"bg-muted/40 rounded-lg p-4",children:[(0,s.jsx)("h4",{className:"font-semibold text-foreground mb-4",children:l("ResultsDisplay.splitCalculation")}),(0,s.jsx)("div",{className:"space-y-6",children:d.map((e,t)=>(0,s.jsxs)("div",{className:"rounded-md border bg-background p-4 space-y-2 transition-shadow hover:shadow-md",children:[(0,s.jsxs)("div",{className:"font-bold text-[15px] text-primary mb-3 pb-1 border-b border-primary/20 bg-primary/[0.08] -mx-4 px-4 py-2 rounded-t-md",children:[l("ResultsDisplay.inputAmountLabel")," #",t+1,":"," ",c(e.originalAmount)]}),(0,s.jsx)("div",{className:"space-y-3",children:e.periodSplits.map((t,a)=>{var r;return(0,s.jsxs)("div",{className:"pl-2 text-xs space-y-0.5 ".concat(a<e.periodSplits.length-1?"border-b border-muted/30 pb-2":""),children:[(0,s.jsxs)("div",{className:"font-medium shrink-0 text-foreground",children:[u(t.periodIdentifier),":"]}),(0,s.jsxs)("div",{className:"text-muted-foreground ml-2",children:[(0,s.jsxs)("span",{children:[c(e.originalAmount)," *"," ",null==(r=o.find(e=>e.periodIdentifier===t.periodIdentifier))?void 0:r.proportion.toFixed(6)]}),(0,s.jsxs)("span",{className:"block sm:inline",children:[" ","= ",t.rawSplit.toFixed(6)]})]}),(0,s.jsxs)("div",{className:"ml-2 flex items-center gap-x-2",children:[(0,s.jsx)("span",{children:"â†’"}),(0,s.jsxs)("span",{className:"font-medium text-foreground",children:[l("ResultsDisplay.roundedLabel"),":"," ",c(t.roundedSplit)]}),0!==t.adjustment&&(0,s.jsxs)("span",{className:"text-muted-foreground text-xs",children:["(",l("ResultsDisplay.adjustmentLabel"),":"," ",c(t.adjustment),")"]})]})]},t.periodIdentifier)})}),(0,s.jsxs)("div",{className:"border-t pt-2 mt-2 space-y-1 text-xs",children:[(0,s.jsxs)("p",{children:[(0,s.jsxs)("span",{className:"font-medium text-foreground",children:[l("ResultsDisplay.discrepancyLabel"),":"]}),(0,s.jsxs)("span",{className:"".concat(Math.abs(e.discrepancy)>.001?"text-amber-600 dark:text-amber-500":"text-muted-foreground/70"),children:[" ",c(e.discrepancy)]}),e.adjustmentAppliedToPeriod&&(0,s.jsxs)("span",{className:"text-muted-foreground",children:["(",l("ResultsDisplay.adjustedInYearLabel",{defaultValue:"Applied in Year"})," ",u(e.adjustmentAppliedToPeriod),")"]})]}),(0,s.jsxs)("p",{className:"font-semibold text-sm text-foreground pt-1",children:[l("ResultsDisplay.finalSumLabel"),":"," ",(0,s.jsx)("span",{className:"text-primary",children:c(e.finalSum)})]})]})]},t))})]})]})};function eX(e){var t,l,n,i,o,d;let{results:c,inputData:p}=e,{t:x,i18n:g}=(0,ey.Bd)(),{settings:h}=(0,eY.t)(),[f,v]=(0,r.useState)(!1),y=g.language,b=p.splitPeriod||"yearly",j=e=>void 0!==e?eU(e,y,h):"",S=e=>void 0!==e?eW(e,y):"",N=e=>e?e$((0,Y.GP)(e,"yyyy-MM-dd"),y):"",D=e=>eQ(e,b,y),w=()=>{switch(b){case"monthly":return x("ResultsDisplay.monthHeader");case"quarterly":return x("ResultsDisplay.quarterHeader");default:return x("ResultsDisplay.yearHeader")}},P=null!=(o=null==(l=c.calculationSteps)||null==(t=l.totalDuration)?void 0:t.days)?o:0,I=p.amounts.reduce((e,t)=>e+(isNaN(t)?0:t),0),F=null!=(d=null==(n=c.aggregatedSplits)?void 0:n.reduce((e,t)=>{var a;return e+(null!=(a=t.totalSplitAmount)?a:0)},0))?d:0;return(0,s.jsxs)("div",{className:"w-full animate-fadeIn",children:[(0,s.jsx)(u,{className:"shadow-lg border border-border/50 overflow-hidden",children:(0,s.jsxs)(m,{className:"p-6 space-y-8",children:[(0,s.jsx)(u,{className:"shadow-md border border-border/40 overflow-hidden",children:(0,s.jsxs)(m,{className:"p-6",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-6 pb-4 border-b",children:[(0,s.jsx)("h3",{className:"text-xl font-semibold text-primary",children:x("ResultsDisplay.summaryTitle")}),(0,s.jsx)("button",{onClick:()=>v(!0),className:"p-1.5 rounded-md text-muted-foreground hover:text-foreground hover:bg-muted transition-colors","aria-label":x("ResultsDisplay.settingsLabel"),children:(0,s.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,s.jsx)("path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.38a2 2 0 0 0-.73-2.73l-.15-.09a2 2 0 0 1-1-1.74v-.51a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"}),(0,s.jsx)("circle",{cx:"12",cy:"12",r:"3"})]})})]}),(0,s.jsxs)("div",{className:"space-y-2 text-sm text-muted-foreground",children:[(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{children:x("ResultsDisplay.periodLabel")}),(0,s.jsxs)("span",{className:"font-medium text-foreground",children:[N(p.startDate)," - "," ",N(p.endDate)]})]}),(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{children:x("ResultsDisplay.totalDurationLabel",{defaultValue:"Total Duration (days)"})}),(0,s.jsxs)("span",{className:"font-medium text-foreground",children:[P," ",x("ResultsDisplay.daysLabel")]})]}),(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{children:x("InvoiceForm.includeEndDateLabel",{defaultValue:"Include Final Day in Service Period?"})}),(0,s.jsx)("span",{className:"font-medium text-foreground",children:p.includeEndDate?x("ResultsDisplay.yesLabel",{defaultValue:"Yes"}):x("ResultsDisplay.noLabel",{defaultValue:"No"})})]}),(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{children:x("InvoiceForm.splitPeriodLabel",{defaultValue:"Split Period"})}),(0,s.jsxs)("span",{className:"font-medium text-foreground",children:["yearly"===b&&x("InvoiceForm.periodYearly"),"quarterly"===b&&x("InvoiceForm.periodQuarterly"),"monthly"===b&&x("InvoiceForm.periodMonthly")]})]}),(0,s.jsxs)("div",{className:"flex justify-between pt-2 border-t border-border/30",children:[(0,s.jsx)("span",{className:"font-semibold text-foreground",children:x("ResultsDisplay.originalTotalLabel",{defaultValue:"Total Input Amount:"})}),(0,s.jsx)("span",{className:"font-semibold text-foreground",children:j(I)})]})]})]})}),(0,s.jsx)(u,{className:"shadow-md border border-border/40 overflow-hidden",children:(0,s.jsxs)(m,{className:"p-6",children:[(0,s.jsx)("h3",{className:"text-xl font-semibold mb-6 pb-4 border-b text-primary",children:x("ResultsDisplay.aggregatedTitle",{defaultValue:"Allocation per Period"})}),(0,s.jsxs)(ek,{children:[(0,s.jsx)(eC,{children:(0,s.jsxs)(eM,{children:[(0,s.jsx)(eV,{children:w()}),(0,s.jsx)(eV,{className:"text-right",children:x("ResultsDisplay.daysHeader")}),(0,s.jsx)(eV,{className:"text-right",children:x("ResultsDisplay.proportionHeader")}),(0,s.jsx)(eV,{className:"text-right",children:x("ResultsDisplay.amountHeader")})]})}),(0,s.jsx)(eL,{children:null==(i=c.aggregatedSplits)?void 0:i.map((e,t)=>(0,s.jsxs)(eM,{children:[(0,s.jsx)(ez,{className:"font-medium text-foreground whitespace-nowrap",children:D(e.periodIdentifier)}),(0,s.jsx)(ez,{className:"text-right text-muted-foreground",children:e.daysInPeriod}),(0,s.jsx)(ez,{className:"text-right text-muted-foreground",children:S(e.proportion)}),(0,s.jsx)(ez,{className:"text-right font-medium text-foreground",children:j(e.totalSplitAmount)})]},t))}),(0,s.jsx)(eE,{children:(0,s.jsxs)(eM,{children:[(0,s.jsx)(ez,{children:x("ResultsDisplay.totalLabel",{defaultValue:"Total"})}),(0,s.jsx)(ez,{className:"text-right font-semibold text-foreground",children:P}),(0,s.jsx)(ez,{className:"text-right font-semibold text-foreground",children:S(1)}),(0,s.jsx)(ez,{className:"text-right font-semibold text-foreground",children:j(F)})]})})]})]})}),(0,s.jsx)(eA.nD,{type:"single",collapsible:!0,className:"w-full",children:(0,s.jsxs)(eA.As,{value:"item-1",className:"border rounded-lg shadow-md bg-card overflow-hidden",children:[(0,s.jsx)(eA.$m,{className:"px-6 py-4 text-lg font-semibold text-primary hover:bg-muted/40",children:x("ResultsDisplay.calculationStepsTitle",{defaultValue:"View Full Split Calculation"})}),(0,s.jsx)(eA.ub,{className:"px-6 py-4 bg-background border-t",children:c.calculationSteps?(0,s.jsx)(eZ,{steps:c.calculationSteps,settings:h,splitPeriodUsed:b}):(0,s.jsx)("p",{children:x("ResultsDisplay.noStepsAvailable")})})]})}),(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row justify-center gap-4 pt-4 border-t border-border/30",children:[(0,s.jsxs)(ed.$,{variant:"outline",onClick:function(){Promise.all([a.e(524),a.e(436)]).then(a.bind(a,3925)).then(e=>{var t;let a=e.utils.book_new(),s=[[x("ResultsDisplay.summaryTitle",{defaultValue:"Summary"})],[],[x("ResultsDisplay.periodLabel"),"".concat(N(p.startDate)," - ").concat(N(p.endDate))],[x("ResultsDisplay.totalDurationLabel",{defaultValue:"Total Duration (days)"}),"".concat(P," ").concat(x("ResultsDisplay.daysLabel"))],[x("InvoiceForm.includeEndDateLabel",{defaultValue:"Include Final Day in Service Period?"}),p.includeEndDate?x("ResultsDisplay.yesLabel",{defaultValue:"Yes"}):x("ResultsDisplay.noLabel",{defaultValue:"No"})],[x("InvoiceForm.splitPeriodLabel",{defaultValue:"Split Period"}),"yearly"===b?x("InvoiceForm.periodYearly"):"quarterly"===b?x("InvoiceForm.periodQuarterly"):x("InvoiceForm.periodMonthly")],[x("ResultsDisplay.originalTotalLabel",{defaultValue:"Total Input Amount:"}),j(I)]],r=e.utils.aoa_to_sheet(s);e.utils.book_append_sheet(a,r,x("ResultsDisplay.inputSummarySheetName",{defaultValue:"Input Summary"}));let l=[[w(),x("ResultsDisplay.daysHeader"),x("ResultsDisplay.proportionHeader"),x("ResultsDisplay.amountHeader")],...(null==(t=c.aggregatedSplits)?void 0:t.map(e=>[D(e.periodIdentifier),e.daysInPeriod,e.proportion,e.totalSplitAmount]))||[],[x("ResultsDisplay.totalLabel",{defaultValue:"Total"}),P,1,F]],n=e.utils.aoa_to_sheet(l),i=n["!ref"];if(i){let t=e.utils.decode_range(i);for(let a=t.s.r+1;a<=t.e.r-1;++a){let t=e.utils.encode_cell({c:2,r:a});n[t]&&(n[t].t="n",n[t].z="0.00%");let s=e.utils.encode_cell({c:3,r:a});n[s]&&(n[s].t="n",n[s].z="#,##0.".concat("0".repeat(h.decimalPlaces||2)))}let a=e.utils.encode_cell({c:3,r:t.e.r});n[a]&&(n[a].t="n",n[a].z="#,##0.".concat("0".repeat(h.decimalPlaces||2)))}if(e.utils.book_append_sheet(a,n,x("ResultsDisplay.aggregatedSheetName",{defaultValue:"Aggregated Results"})),c.calculationSteps){let t=c.calculationSteps,{periodSegments:s,amountCalculations:r}=t,l=[];for(let e of(l.push([x("ResultsDisplay.calculationStepsTitle",{defaultValue:"View Full Split Calculation"})]),l.push([]),l.push([x("ResultsDisplay.totalDuration")]),l.push([x("ResultsDisplay.periodLabel"),"".concat(e$(t.totalDuration.start,y)," - ").concat(e$(t.totalDuration.end,y))]),l.push([x("ResultsDisplay.totalDays"),"".concat(t.totalDuration.days," ").concat(t.totalDuration.included?x("ResultsDisplay.inclusiveLabel"):x("ResultsDisplay.exclusiveLabel"))]),l.push([]),l.push([x("ResultsDisplay.proportionCalculation")]),s))l.push([eQ(e.periodIdentifier,b,y),"".concat(e.days," / ").concat(t.totalDuration.days," = ").concat(eW(e.proportion,y))]);l.push([]),l.push([x("ResultsDisplay.splitCalculation")]);for(let e=0;e<r.length;e++){let t=r[e];for(let a of(l.push(["".concat(x("ResultsDisplay.inputAmountLabel")," #").concat(e+1,":"),j(t.originalAmount)]),t.periodSplits)){let e=s.find(e=>e.periodIdentifier===a.periodIdentifier);l.push([eQ(a.periodIdentifier,b,y),"".concat(j(t.originalAmount)," \xd7 ").concat(null==e?void 0:e.proportion.toFixed(6)," = ").concat(a.rawSplit.toFixed(6)," â†’ ").concat(j(a.roundedSplit))]),0!==a.adjustment&&l.push([x("ResultsDisplay.adjustmentLabel"),j(a.adjustment)])}l.push([x("ResultsDisplay.discrepancyLabel"),j(t.discrepancy)]),t.adjustmentAppliedToPeriod&&l.push([x("ResultsDisplay.adjustedInYearLabel",{defaultValue:"Applied in Year"}),eQ(t.adjustmentAppliedToPeriod,b,y)]),l.push([x("ResultsDisplay.finalSumLabel"),j(t.finalSum)]),l.push([])}let n=e.utils.aoa_to_sheet(l);e.utils.book_append_sheet(a,n,x("ResultsDisplay.detailedSheetName",{defaultValue:"Detailed Breakdown"}))}let o="InvoiceSplit_".concat((0,Y.GP)(new Date,"yyyyMMdd"),".xlsx");e.writeFile(a,o)}).catch(e=>{console.error("Failed to load xlsx library or export Excel:",e),alert("Failed to export Excel. Please try again.")})},className:"w-full sm:w-auto",children:[(0,s.jsxs)("svg",{className:"mr-2 h-4 w-4",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,s.jsx)("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),(0,s.jsx)("polyline",{points:"14 2 14 8 20 8"}),(0,s.jsx)("line",{x1:"16",y1:"13",x2:"8",y2:"13"}),(0,s.jsx)("line",{x1:"16",y1:"17",x2:"8",y2:"17"}),(0,s.jsx)("polyline",{points:"10 9 9 9 8 9"})]}),x("ResultsDisplay.exportExcelButton")]}),(0,s.jsxs)(ed.$,{variant:"outline",onClick:function(){Promise.all([Promise.all([a.e(930),a.e(913)]).then(a.bind(a,26597)),a.e(118).then(a.bind(a,76118))]).then(e=>{let[{jsPDF:t},{default:a}]=e;try{var s,r;let e=new t,l=20;e.setFontSize(14),e.text(x("ResultsDisplay.summaryTitle"),14,l),l+=10,e.setFontSize(10),e.text("".concat(x("ResultsDisplay.periodLabel"),": ").concat(N(p.startDate)," - ").concat(N(p.endDate)),14,l),l+=5,e.text("".concat(x("ResultsDisplay.totalDurationLabel",{defaultValue:"Total Duration (days)"}),": ").concat(P," ").concat(x("ResultsDisplay.daysLabel")),14,l),l+=5,e.text("".concat(x("InvoiceForm.includeEndDateLabel",{defaultValue:"Include Final Day in Service Period?"}),": ").concat(p.includeEndDate?x("ResultsDisplay.yesLabel",{defaultValue:"Yes"}):x("ResultsDisplay.noLabel",{defaultValue:"No"})),14,l),l+=5,e.text("".concat(x("InvoiceForm.splitPeriodLabel",{defaultValue:"Split Period"}),": ").concat("yearly"===b?x("InvoiceForm.periodYearly"):"quarterly"===b?x("InvoiceForm.periodQuarterly"):x("InvoiceForm.periodMonthly")),14,l),l+=5,e.text("".concat(x("ResultsDisplay.originalTotalLabel",{defaultValue:"Total Input Amount:"}),": ").concat(j(I)),14,l),l+=15,e.setFontSize(14),e.text(x("ResultsDisplay.aggregatedTitle",{defaultValue:"Allocation per Period"}),14,l),l+=5;let n=[w(),x("ResultsDisplay.daysHeader"),x("ResultsDisplay.proportionHeader"),x("ResultsDisplay.amountHeader")],i=(null==(s=c.aggregatedSplits)?void 0:s.map(e=>[D(e.periodIdentifier),e.daysInPeriod,S(e.proportion),j(e.totalSplitAmount)]))||[],o=[x("ResultsDisplay.totalLabel",{defaultValue:"Total"}),P,S(1),j(F)];if(a(e,{head:[n],body:i,foot:[o],startY:l,theme:"grid",headStyles:{fillColor:[46,90,140]},footStyles:{fillColor:[240,240,240],textColor:40,fontStyle:"bold"},didParseCell:function(e){void 0!==e.column.index&&[1,2,3].includes(e.column.index)&&(e.cell.styles.halign="right")}}),c.calculationSteps){let t=c.calculationSteps,{periodSegments:a,amountCalculations:s}=t;for(let s of(l=(null==(r=e.lastAutoTable)?void 0:r.finalY)?e.lastAutoTable.finalY+15:l+50,e.setFontSize(14),e.text(x("ResultsDisplay.calculationStepsTitle",{defaultValue:"View Full Split Calculation"}),14,l),l+=10,e.setFontSize(12),e.text(x("ResultsDisplay.totalDuration"),14,l),l+=7,e.setFontSize(10),e.text("".concat(x("ResultsDisplay.periodLabel"),": ").concat(e$(t.totalDuration.start,y)," - ").concat(e$(t.totalDuration.end,y)),20,l),l+=5,e.text("".concat(x("ResultsDisplay.totalDays"),": ").concat(t.totalDuration.days," ").concat(t.totalDuration.included?x("ResultsDisplay.inclusiveLabel"):x("ResultsDisplay.exclusiveLabel")),20,l),l+=10,e.setFontSize(12),e.text(x("ResultsDisplay.proportionCalculation"),14,l),l+=7,e.setFontSize(10),l>e.internal.pageSize.height-50&&(e.addPage(),l=20),a))e.text("".concat(eQ(s.periodIdentifier,b,y),": ").concat(s.days," / ").concat(t.totalDuration.days," = ").concat(eW(s.proportion,y)),20,l),(l+=5)>e.internal.pageSize.height-30&&(e.addPage(),l=20);l+=5,e.setFontSize(12),e.text(x("ResultsDisplay.splitCalculation"),14,l),l+=7;for(let t=0;t<s.length;t++){let r=s[t];for(let s of(l>e.internal.pageSize.height-70&&(e.addPage(),l=20),e.setFontSize(11),e.text("".concat(x("ResultsDisplay.inputAmountLabel")," #").concat(t+1,": ").concat(j(r.originalAmount)),20,l),l+=7,e.setFontSize(10),r.periodSplits)){let t=a.find(e=>e.periodIdentifier===s.periodIdentifier);e.text("".concat(eQ(s.periodIdentifier,b,y),":"),25,l),l+=5,e.text("".concat(j(r.originalAmount)," \xd7 ").concat(null==t?void 0:t.proportion.toFixed(6)," = ").concat(s.rawSplit.toFixed(6)),30,l),l+=5,e.text("â†’ ".concat(x("ResultsDisplay.roundedLabel"),": ").concat(j(s.roundedSplit)),30,l),l+=5,0!==s.adjustment&&(e.text("".concat(x("ResultsDisplay.adjustmentLabel"),": ").concat(j(s.adjustment)),30,l),l+=5),l>e.internal.pageSize.height-40&&(e.addPage(),l=20)}e.text("".concat(x("ResultsDisplay.discrepancyLabel"),": ").concat(j(r.discrepancy)),25,l),l+=5,r.adjustmentAppliedToPeriod&&(e.text("".concat(x("ResultsDisplay.adjustedInYearLabel",{defaultValue:"Applied in Year"}),": ").concat(eQ(r.adjustmentAppliedToPeriod,b,y)),25,l),l+=5),e.text("".concat(x("ResultsDisplay.finalSumLabel"),": ").concat(j(r.finalSum)),25,l),(l+=10)>e.internal.pageSize.height-50&&t<s.length-1&&(e.addPage(),l=20)}}let d=e.internal.getNumberOfPages();e.setFontSize(8);for(let t=1;t<=d;t++)e.setPage(t),e.text("Generated by BillSplitter - ".concat((0,Y.GP)(new Date,"PPpp")),14,e.internal.pageSize.height-10),e.text("Page ".concat(t," of ").concat(d),e.internal.pageSize.width-35,e.internal.pageSize.height-10);let u="InvoiceSplit_".concat((0,Y.GP)(new Date,"yyyyMMdd"),".pdf");e.save(u)}catch(e){console.error("Error generating PDF:",e),alert("Failed to generate PDF. Please try again.")}}).catch(e=>{console.error("Failed to load PDF generation libraries:",e),alert("Failed to load PDF generation libraries. Please try again.")})},className:"w-full sm:w-auto",children:[(0,s.jsxs)("svg",{className:"mr-2 h-4 w-4",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,s.jsx)("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),(0,s.jsx)("polyline",{points:"14 2 14 8 20 8"}),(0,s.jsx)("line",{x1:"16",y1:"13",x2:"8",y2:"13"}),(0,s.jsx)("line",{x1:"16",y1:"17",x2:"8",y2:"17"}),(0,s.jsx)("polyline",{points:"10 9 9 9 8 9"})]}),x("ResultsDisplay.exportPdfButton")]})]})]})}),(0,s.jsx)(eJ,{isOpen:f,onOpenChange:v})]})}function eK(e){return(0,s.jsx)(eX,{...e})}var e0=a(41684);function e2(){let{t:e}=(0,ey.Bd)(),[t,a]=(0,r.useState)(!1),[l,n]=(0,r.useState)(""),[i,g]=(0,r.useState)(null),[h,f]=(0,r.useState)(null),[v,y]=(0,r.useState)(null),[j,S]=(0,r.useState)(!1),N=(0,r.useRef)(null),D="G-9H2KTHX5YK",[w,P]=(0,r.useState)(!1);return(0,r.useEffect)(()=>{a(!0),n(e("InvoiceForm.title")),P("true"===p.A.get("siempiBillSplitterConsent"))},[e]),(0,s.jsxs)(s.Fragment,{children:[w&&D&&(0,s.jsx)(x.GoogleAnalytics,{gaId:D}),(0,s.jsxs)("div",{className:"container mx-auto px-4 py-8 max-w-4xl grow overflow-hidden w-full",children:[(0,s.jsx)("div",{className:"text-center mb-8",children:t?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("h1",{className:"text-3xl font-bold mb-4",children:l}),(0,s.jsxs)("div",{className:"max-w-2xl mx-auto space-y-2 px-4",children:[(0,s.jsx)("p",{children:e("InvoiceForm.description_p1")}),(0,s.jsx)("p",{children:e("InvoiceForm.description_p2")})]})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"h-9 bg-muted/60 rounded-md animate-pulse w-1/3 mx-auto mb-4"}),(0,s.jsx)("div",{className:"h-4 bg-muted/60 rounded-sm animate-pulse w-2/3 mx-auto mb-2"}),(0,s.jsx)("div",{className:"h-4 bg-muted/60 rounded-sm animate-pulse w-1/2 mx-auto"})]})}),!t&&(0,s.jsxs)("div",{className:"flex items-center gap-2 justify-center text-muted-foreground text-sm mb-6",children:[(0,s.jsx)(b.A,{className:"animate-spin h-4 w-4 text-primary"}),(0,s.jsx)("span",{children:"Loading calculator..."})]}),(0,s.jsxs)("div",{className:"mx-auto",style:{maxWidth:"768px"},children:[(0,s.jsx)(u,{className:"mb-12 shadow-md w-full transition-opacity duration-300 ease-in-out","data-loaded":t?"true":"false",style:{opacity:t?1:.85},children:(0,s.jsx)(m,{className:"pt-6",children:(0,s.jsx)("div",{className:"w-full",children:(0,s.jsx)(eR,{onCalculateAction:(t,a,s)=>{g(a),s&&s.includes("At least one amount is required")?f(e("Errors.calculationErrorTitle")+": "+e("InvoiceForm.errorAmountRequired")):s&&s.includes("Start date must be before")?f(e("Errors.calculationErrorTitle")+": "+e("InvoiceForm.errorEndDateBeforeStart")):f(s?e("Errors.calculationErrorTitle")+": "+e("Errors.unexpectedError"):null),t&&a&&!s?(y(t),setTimeout(()=>{requestAnimationFrame(()=>{N.current&&N.current.scrollIntoView({behavior:"smooth",block:"start"})})},200)):y(null)}})})})}),(0,s.jsxs)("div",{ref:N,className:"mt-12 w-full",children:[t&&h&&(0,s.jsxs)(o,{variant:"destructive",className:"w-full",children:[(0,s.jsx)(e0.A,{className:"h-4 w-4"}),(0,s.jsx)(d,{children:e("Errors.calculationErrorTitle")}),(0,s.jsx)(c,{children:h})]}),t&&i&&v&&!h&&(0,s.jsx)(eK,{results:i,inputData:v}),!t&&null===i&&(0,s.jsx)(u,{className:"shadow-md w-full h-64 flex items-center justify-center",children:(0,s.jsxs)("div",{className:"space-y-4 p-6 w-full",children:[(0,s.jsx)("div",{className:"h-6 bg-muted/60 rounded-md animate-pulse w-3/4 mx-auto mb-8"}),(0,s.jsxs)("div",{className:"grid grid-cols-4 gap-4 mb-6",children:[(0,s.jsx)("div",{className:"h-4 bg-muted/60 rounded-sm animate-pulse"}),(0,s.jsx)("div",{className:"h-4 bg-muted/60 rounded-sm animate-pulse"}),(0,s.jsx)("div",{className:"h-4 bg-muted/60 rounded-sm animate-pulse"}),(0,s.jsx)("div",{className:"h-4 bg-muted/60 rounded-sm animate-pulse"})]}),(0,s.jsx)("div",{className:"h-24 bg-muted/60 rounded-md animate-pulse"})]})})]})]})]}),t&&(0,s.jsx)(eJ,{isOpen:j,onOpenChange:S})]})}function e1(){return(0,s.jsx)(e2,{})}},30285:(e,t,a)=>{"use strict";a.d(t,{$:()=>o,r:()=>i});var s=a(95155);a(12115);var r=a(99708),l=a(74466),n=a(59434);let i=(0,l.F)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-2 aria-[invalid=true]:ring-destructive/20 dark:aria-[invalid=true]:ring-destructive/40 aria-[invalid=true]:border-destructive cursor-pointer hover:transform hover:translate-y-[-2px] hover:scale-[1.015]",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-md hover:bg-primary/90 hover:shadow-md",destructive:"bg-destructive text-destructive-foreground shadow-md hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 hover:shadow-md",outline:"border bg-background shadow-md hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50 hover:shadow-md",secondary:"bg-secondary text-secondary-foreground shadow-md hover:bg-secondary/80 hover:shadow-md",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-8 rounded-md px-3 py-1",lg:"h-12 px-6 py-3",icon:"size-10"}},defaultVariants:{variant:"default",size:"default"}});function o(e){let{className:t,variant:a,size:l,asChild:o=!1,...d}=e,c=o?r.DX:"button";return(0,s.jsx)(c,{"data-slot":"button",className:(0,n.cn)(i({variant:a,size:l,className:t})),...d})}},35363:(e,t,a)=>{"use strict";a.d(t,{S:()=>l});var s=a(95155);function r(e){let{children:t}=e;return(0,s.jsx)("span",{className:"absolute w-px h-px p-0 -m-px overflow-hidden whitespace-nowrap border-0",style:{clip:"rect(0, 0, 0, 0)"},children:t})}function l(e){let{label:t,children:a}=e;return(0,s.jsxs)("span",{className:"inline-flex items-center justify-center",children:[a,(0,s.jsx)(r,{children:t})]})}a(12115)},54165:(e,t,a)=>{"use strict";a.d(t,{Cf:()=>p,Es:()=>g,HM:()=>u,L3:()=>h,c7:()=>x,lG:()=>d,rr:()=>f});var s=a(95155),r=a(15452),l=a(12115),n=a(35363),i=a(54416),o=a(59434);function d(e){let{...t}=e;return l.useEffect(()=>{let e=e=>{if(e){let e=window.innerWidth-document.documentElement.clientWidth;document.body.style.paddingRight="".concat(e,"px"),document.body.style.overflow="hidden"}else document.body.style.paddingRight="",document.body.style.overflow=""},t=t=>{e(t.detail.open)};return document.addEventListener("dialogStateChange",t),()=>{document.removeEventListener("dialogStateChange",t),document.body.style.paddingRight="",document.body.style.overflow=""}},[]),(0,s.jsx)(r.bL,{onOpenChange:e=>{var a;document.dispatchEvent(new CustomEvent("dialogStateChange",{detail:{open:e}})),null==(a=t.onOpenChange)||a.call(t,e)},...t,"data-slot":"dialog"})}function c(e){let{...t}=e;return(0,s.jsx)(r.ZL,{"data-slot":"dialog-portal",...t})}function u(e){let{...t}=e;return(0,s.jsx)(r.bm,{"data-slot":"dialog-close",...t})}function m(e){let{className:t,...a}=e;return(0,s.jsx)(r.hJ,{"data-slot":"dialog-overlay",className:(0,o.cn)("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 backdrop-blur-sm bg-black/30",t),...a})}function p(e){let{className:t,children:a,...d}=e,[u,p]=l.useState(!1);return(l.useEffect(()=>(p(!0),()=>p(!1)),[]),u)?(0,s.jsxs)(c,{"data-slot":"dialog-portal",children:[(0,s.jsx)(m,{}),(0,s.jsxs)(r.UC,{"data-slot":"dialog-content",className:(0,o.cn)("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-xl duration-200 sm:max-w-lg mx-auto",t),...d,children:[a,(0,s.jsx)(r.bm,{"aria-label":"Close dialog",className:"ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-sm opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-none disabled:pointer-events-none cursor-pointer",children:(0,s.jsx)(n.S,{label:"Close",children:(0,s.jsx)(i.A,{className:"size-4"})})})]})]}):null}function x(e){let{className:t,...a}=e;return(0,s.jsx)("div",{"data-slot":"dialog-header",className:(0,o.cn)("flex flex-col gap-2 text-center sm:text-left",t),...a})}function g(e){let{className:t,...a}=e;return(0,s.jsx)("div",{"data-slot":"dialog-footer",className:(0,o.cn)("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",t),...a})}function h(e){let{className:t,...a}=e;return(0,s.jsx)(r.hE,{"data-slot":"dialog-title",className:(0,o.cn)("text-lg leading-none font-semibold",t),...a})}function f(e){let{className:t,...a}=e;return(0,s.jsx)(r.VY,{"data-slot":"dialog-description",className:(0,o.cn)("text-muted-foreground text-sm",t),...a})}},59434:(e,t,a)=>{"use strict";a.d(t,{cn:()=>l});var s=a(52596),r=a(39688);function l(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,r.QP)((0,s.$)(t))}},83503:(e,t,a)=>{Promise.resolve().then(a.bind(a,25264))},85057:(e,t,a)=>{"use strict";a.d(t,{J:()=>n});var s=a(95155);a(12115);var r=a(40968),l=a(59434);function n(e){let{className:t,...a}=e;return(0,s.jsx)(r.b,{"data-slot":"label",className:(0,l.cn)("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",t),...a})}}},e=>{var t=t=>e(e.s=t);e.O(0,[218,409,604,681,576,441,684,358],()=>t(83503)),_N_E=e.O()}]);